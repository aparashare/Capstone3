/*! Yuwee-7.6.1.min.js file */

function RecordRTC(e,t){function n(n){n&&(t.initCallback=function(){n(),n=t.initCallback=null});var r=new GetRecorderType(e,t);(u=new r(e,t)).record(),s("recording"),t.disableLogs||console.log("Initialized recorderType:",u.constructor.name,"for output-type:",t.type)}function r(e){function n(n){if(u){Object.keys(u).forEach(function(e){"function"!=typeof u[e]&&(l[e]=u[e])});var r=u.blob;if(!r){if(!n)throw"Recording failed.";u.blob=r=n}if(r&&!t.disableLogs&&console.log(r.type,"->",bytesToSize(r.size)),e){var i;try{i=URL.createObjectURL(r)}catch(e){}"function"==typeof e.call?e.call(l,i):e(i)}t.autoWriteToDisk&&o(function(e){var n={};n[t.type+"Blob"]=e,DiskStorage.Store(n)})}else"function"==typeof e.call?e.call(l,""):e("")}return e=e||function(){},u?"paused"===l.state?(l.resumeRecording(),void setTimeout(function(){r(e)},1)):("recording"===l.state||t.disableLogs||console.warn('Recording state should be: "recording", however current state is: ',l.state),t.disableLogs||console.log("Stopped recording "+t.type+" stream."),"gif"!==t.type?u.stop(n):(u.stop(),n()),void s("stopped")):void c()}function i(e){postMessage((new FileReaderSync).readAsDataURL(e))}function o(e,n){if(!e)throw"Pass a callback function over getDataURL.";var r=n?n.blob:(u||{}).blob;if(!r)return t.disableLogs||console.warn("Blob encoder did not finish its job yet."),void setTimeout(function(){o(e,n)},1e3);if("undefined"==typeof Worker||navigator.mozGetUserMedia){var a=new FileReader;a.readAsDataURL(r),a.onload=function(t){e(t.target.result)}}else{var s=function(e){try{var t=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),n=new Worker(t);return URL.revokeObjectURL(t),n}catch(e){}}(i);s.onmessage=function(t){e(t.data)},s.postMessage(r)}}function a(e){if(e=e||0,"paused"!==l.state){if("stopped"!==l.state){if(e>=l.recordingDuration)return void r(l.onRecordingStopped);e+=1e3,setTimeout(function(){a(e)},1e3)}}else setTimeout(function(){a(e)},1e3)}function s(e){l&&(l.state=e,"function"==typeof l.onStateChanged.call?l.onStateChanged.call(l,e):l.onStateChanged(e))}function c(){!0!==t.disableLogs&&console.warn(d)}if(!e)throw"First parameter is required.";var u,l=this,d='It seems that recorder is destroyed or "startRecording" is not invoked for '+(t=new RecordRTCConfiguration(e,t=t||{type:"video"})).type+" recorder.",f={startRecording:function(r){return t.disableLogs||console.log("RecordRTC version: ",l.version),r&&(t=new RecordRTCConfiguration(e,r)),t.disableLogs||console.log("started recording "+t.type+" stream."),u?(u.clearRecordedData(),u.record(),s("recording"),l.recordingDuration&&a(),l):(n(function(){l.recordingDuration&&a()}),l)},stopRecording:r,pauseRecording:function(){return u?"recording"!==l.state?void(t.disableLogs||console.warn("Unable to pause the recording. Recording state: ",l.state)):(s("paused"),u.pause(),void(t.disableLogs||console.log("Paused recording."))):void c()},resumeRecording:function(){return u?"paused"!==l.state?void(t.disableLogs||console.warn("Unable to resume the recording. Recording state: ",l.state)):(s("recording"),u.resume(),void(t.disableLogs||console.log("Resumed recording."))):void c()},initRecorder:n,setRecordingDuration:function(e,t){if(void 0===e)throw"recordingDuration is required.";if("number"!=typeof e)throw"recordingDuration must be a number.";return l.recordingDuration=e,l.onRecordingStopped=t||function(){},{onRecordingStopped:function(e){l.onRecordingStopped=e}}},clearRecordedData:function(){return u?(u.clearRecordedData(),void(t.disableLogs||console.log("Cleared old recorded data."))):void c()},getBlob:function(){return u?u.blob:void c()},getDataURL:o,toURL:function(){return u?URL.createObjectURL(u.blob):void c()},getInternalRecorder:function(){return u},save:function(e){return u?void invokeSaveAsDialog(u.blob,e):void c()},getFromDisk:function(e){return u?void RecordRTC.getFromDisk(t.type,e):void c()},setAdvertisementArray:function(e){t.advertisement=[];for(var n=e.length,r=0;r<n;r++)t.advertisement.push({duration:r,image:e[r]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){"recording"!==l.state||t.disableLogs||console.warn("Stop an active recorder."),u&&"function"==typeof u.clearRecordedData&&u.clearRecordedData(),u=null,s("inactive"),l.blob=null},onStateChanged:function(e){t.disableLogs||console.log("Recorder state changed:",e)},state:"inactive",getState:function(){return l.state},destroy:function(){var e=t.disableLogs;t={disableLogs:!0},l.reset(),s("destroyed"),f=l=null,Storage.AudioContextConstructor&&(Storage.AudioContextConstructor.close(),Storage.AudioContextConstructor=null),t.disableLogs=e,t.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.5.9"};if(!this)return l=f,f;for(var p in f)this[p]=f[p];return l=this,f}function RecordRTCConfiguration(e,t){return t.recorderType||t.type||(t.audio&&t.video?t.type="video":t.audio&&!t.video&&(t.type="audio")),t.recorderType&&!t.type&&(t.recorderType===WhammyRecorder||t.recorderType===CanvasRecorder||void 0!==WebAssemblyRecorder&&t.recorderType===WebAssemblyRecorder?t.type="video":t.recorderType===GifRecorder?t.type="gif":t.recorderType===StereoAudioRecorder?t.type="audio":t.recorderType===MediaStreamRecorder&&(getTracks(e,"audio").length&&getTracks(e,"video").length?t.type="video":!getTracks(e,"audio").length&&getTracks(e,"video").length?t.type="video":getTracks(e,"audio").length&&!getTracks(e,"video").length&&(t.type="audio"))),void 0!==MediaStreamRecorder&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(t.mimeType||(t.mimeType="video/webm"),t.type||(t.type=t.mimeType.split("/")[0]),t.bitsPerSecond),t.type||(t.mimeType&&(t.type=t.mimeType.split("/")[0]),t.type||(t.type="audio")),t}function GetRecorderType(e,t){var n;return(isChrome||isEdge||isOpera)&&(n=StereoAudioRecorder),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!isChrome&&(n=MediaStreamRecorder),"video"===t.type&&(isChrome||isOpera)&&(n=WhammyRecorder,void 0!==WebAssemblyRecorder&&"undefined"!=typeof ReadableStream&&(n=WebAssemblyRecorder)),"gif"===t.type&&(n=GifRecorder),"canvas"===t.type&&(n=CanvasRecorder),isMediaRecorderCompatible()&&n!==CanvasRecorder&&n!==GifRecorder&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(getTracks(e,"video").length||getTracks(e,"audio").length)&&("audio"===t.type?"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(n=MediaStreamRecorder):"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(n=MediaStreamRecorder)),e instanceof Array&&e.length&&(n=MultiStreamRecorder),t.recorderType&&(n=t.recorderType),!t.disableLogs&&n&&n.name&&console.log("Using recorderType:",n.name||n.constructor.name),!n&&isSafari&&(n=MediaStreamRecorder),n}function MRecordRTC(e){this.addStream=function(t){t&&(e=t)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var t,n=this.mediaType,r=this.mimeType||{audio:null,video:null,gif:null};if("function"!=typeof n.audio&&isMediaRecorderCompatible()&&!getTracks(e,"audio").length&&(n.audio=!1),"function"!=typeof n.video&&isMediaRecorderCompatible()&&!getTracks(e,"video").length&&(n.video=!1),"function"!=typeof n.gif&&isMediaRecorderCompatible()&&!getTracks(e,"video").length&&(n.gif=!1),!n.audio&&!n.video&&!n.gif)throw"MediaStream must have either audio or video tracks.";if(n.audio&&(t=null,"function"==typeof n.audio&&(t=n.audio),this.audioRecorder=new RecordRTC(e,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:t,mimeType:r.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),n.video||this.audioRecorder.startRecording()),n.video){t=null,"function"==typeof n.video&&(t=n.video);var i=e;if(isMediaRecorderCompatible()&&n.audio&&"function"==typeof n.audio){var o=getTracks(e,"video")[0];isFirefox?((i=new MediaStream).addTrack(o),t&&t===WhammyRecorder&&(t=MediaStreamRecorder)):(i=new MediaStream).addTrack(o)}this.videoRecorder=new RecordRTC(i,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:t,mimeType:r.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),n.audio||this.videoRecorder.startRecording()}if(n.audio&&n.video){var a=this,s=!0===isMediaRecorderCompatible();n.audio instanceof StereoAudioRecorder&&n.video?s=!1:!0!==n.audio&&!0!==n.video&&n.audio!==n.video&&(s=!1),!0===s?(a.audioRecorder=null,a.videoRecorder.startRecording()):a.videoRecorder.initRecorder(function(){a.audioRecorder.initRecorder(function(){a.videoRecorder.startRecording(),a.audioRecorder.startRecording()})})}n.gif&&(t=null,"function"==typeof n.gif&&(t=n.gif),this.gifRecorder=new RecordRTC(e,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:t,mimeType:r.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(e){e=e||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(t){e(t,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(t){e(t,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(t){e(t,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(e){function t(e,t){if("undefined"!=typeof Worker){var n=function(e){var t,n=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),r=new Worker(n);if(void 0!==URL)t=URL;else{if("undefined"==typeof webkitURL)throw"Neither URL nor webkitURL detected.";t=webkitURL}return t.revokeObjectURL(n),r}(function(e){postMessage((new FileReaderSync).readAsDataURL(e))});n.onmessage=function(e){t(e.data)},n.postMessage(e)}else{var r=new FileReader;r.readAsDataURL(e),r.onload=function(e){t(e.target.result)}}}this.getBlob(function(n){n.audio&&n.video?t(n.audio,function(r){t(n.video,function(t){e({audio:r,video:t})})}):n.audio?t(n.audio,function(t){e({audio:t})}):n.video&&t(n.video,function(t){e({video:t})})})},this.writeToDisk=function(){RecordRTC.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){(e=e||{audio:!0,video:!0,gif:!0}).audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof e.audio?e.audio:""),e.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof e.video?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof e.gif?e.gif:"")}}function bytesToSize(e){if(0===e)return"0 Bytes";var t=parseInt(Math.floor(Math.log(e)/Math.log(1e3)),10);return(e/Math.pow(1e3,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][t]}function invokeSaveAsDialog(e,t){if(!e)throw"Blob object is required.";if(!e.type)try{e.type="video/webm"}catch(e){}var n=(e.type||"video/webm").split("/")[1];if(t&&-1!==t.indexOf(".")){var r=t.split(".");t=r[0],n=r[1]}var i=(t||Math.round(9999999999*Math.random())+888888888)+"."+n;if(void 0!==navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(e,i);if(void 0!==navigator.msSaveBlob)return navigator.msSaveBlob(e,i);var o=document.createElement("a");o.href=URL.createObjectURL(e),o.download=i,o.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(o),"function"==typeof o.click?o.click():(o.target="_blank",o.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),URL.revokeObjectURL(o.href)}function isElectron(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||!("undefined"==typeof process||"object"!=typeof process.versions||!process.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}function getTracks(e,t){return e&&e.getTracks?e.getTracks().filter(function(e){return e.kind===(t||"audio")}):[]}function setSrcObject(e,t){"srcObject"in t?t.srcObject=e:"mozSrcObject"in t?t.mozSrcObject=e:t.srcObject=e}function getSeekableBlob(e,t){if("undefined"==typeof EBML)throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var n=new EBML.Reader,r=new EBML.Decoder,i=EBML.tools,o=new FileReader;o.onload=function(e){r.decode(this.result).forEach(function(e){n.read(e)}),n.stop();var o=i.makeMetadataSeekable(n.metadatas,n.duration,n.cues),a=this.result.slice(n.metadataSize),s=new Blob([o,a],{type:"video/webm"});t(s)},o.readAsArrayBuffer(e)}function isMediaRecorderCompatible(){if(isFirefox||isSafari||isEdge)return!0;var e,t,n=(navigator.appVersion,navigator.userAgent),r=""+parseFloat(navigator.appVersion),i=parseInt(navigator.appVersion,10);return(isChrome||isOpera)&&(e=n.indexOf("Chrome"),r=n.substring(e+7)),-1!==(t=r.indexOf(";"))&&(r=r.substring(0,t)),-1!==(t=r.indexOf(" "))&&(r=r.substring(0,t)),i=parseInt(""+r,10),isNaN(i)&&(r=""+parseFloat(navigator.appVersion),i=parseInt(navigator.appVersion,10)),i>=49}function MediaStreamRecorder(e,t){function n(){o.timestamps.push((new Date).getTime()),"function"==typeof t.onTimeStamp&&t.onTimeStamp(o.timestamps[o.timestamps.length-1],o.timestamps)}function r(e){return s&&s.mimeType?s.mimeType:e.mimeType||"video/webm"}function i(){c=[],s=null,o.timestamps=[]}var o=this;if(void 0===e)throw'First argument "MediaStream" is required.';if("undefined"==typeof MediaRecorder)throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";if("audio"===(t=t||{mimeType:"video/webm"}).type){var a;if(getTracks(e,"video").length&&getTracks(e,"audio").length)navigator.mozGetUserMedia?(a=new MediaStream).addTrack(getTracks(e,"audio")[0]):a=new MediaStream(getTracks(e,"audio")),e=a;t.mimeType&&-1!==t.mimeType.toString().toLowerCase().indexOf("audio")||(t.mimeType=isChrome?"audio/webm":"audio/ogg"),t.mimeType&&"audio/ogg"!==t.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(t.mimeType="audio/ogg")}var s,c=[];this.getArrayOfBlobs=function(){return c},this.record=function(){o.blob=null,o.clearRecordedData(),o.timestamps=[],u=[],c=[];var i=t;t.disableLogs||console.log("Passing following config over MediaRecorder API.",i),s&&(s=null),isChrome&&!isMediaRecorderCompatible()&&(i="video/vp8"),"function"==typeof MediaRecorder.isTypeSupported&&i.mimeType&&(MediaRecorder.isTypeSupported(i.mimeType)||(t.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",i.mimeType),i.mimeType="audio"===t.type?"audio/webm":"video/webm"));try{s=new MediaRecorder(e,i),t.mimeType=i.mimeType}catch(t){s=new MediaRecorder(e)}i.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in s&&!1===s.canRecordMimeType(i.mimeType)&&(t.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",i.mimeType)),s.ondataavailable=function(e){if(e.data&&u.push("ondataavailable: "+bytesToSize(e.data.size)),"number"!=typeof t.timeSlice){if(!e.data||!e.data.size||e.data.size<100||o.blob)return void(o.recordingCallback&&(o.recordingCallback(new Blob([],{type:r(i)})),o.recordingCallback=null));o.blob=t.getNativeBlob?e.data:new Blob([e.data],{type:r(i)}),o.recordingCallback&&(o.recordingCallback(o.blob),o.recordingCallback=null)}else if(e.data&&e.data.size&&e.data.size>100&&(c.push(e.data),n(),"function"==typeof t.ondataavailable)){var a=t.getNativeBlob?e.data:new Blob([e.data],{type:r(i)});t.ondataavailable(a)}},s.onstart=function(){u.push("started")},s.onpause=function(){u.push("paused")},s.onresume=function(){u.push("resumed")},s.onstop=function(){u.push("stopped")},s.onerror=function(e){e&&(e.name||(e.name="UnknownError"),u.push("error: "+e),t.disableLogs||(-1!==e.name.toString().toLowerCase().indexOf("invalidstate")?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",e):-1!==e.name.toString().toLowerCase().indexOf("notsupported")?console.error("MIME type (",i.mimeType,") is not supported.",e):-1!==e.name.toString().toLowerCase().indexOf("security")?console.error("MediaRecorder security error",e):"OutOfMemory"===e.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"IllegalStreamModification"===e.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"OtherRecordingError"===e.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"GenericError"===e.name?console.error("The UA cannot provide the codec or recording option that has been requested.",e):console.error("MediaRecorder Error",e)),!o.manuallyStopped&&s&&"inactive"===s.state?(delete t.timeslice,s.start(6e5)):setTimeout(void 0,1e3),"inactive"!==s.state&&"stopped"!==s.state&&s.stop())},"number"==typeof t.timeSlice?(n(),s.start(t.timeSlice)):s.start(36e5),t.initCallback&&t.initCallback()},this.timestamps=[],this.stop=function(e){e=e||function(){},o.manuallyStopped=!0,s&&(this.recordingCallback=e,"recording"===s.state&&s.stop(),"number"==typeof t.timeSlice&&setTimeout(function(){o.blob=new Blob(c,{type:r(t)}),o.recordingCallback(o.blob)},100))},this.pause=function(){s&&"recording"===s.state&&s.pause()},this.resume=function(){s&&"paused"===s.state&&s.resume()},this.clearRecordedData=function(){s&&"recording"===s.state&&o.stop(i),i()},this.getInternalRecorder=function(){return s},this.blob=null,this.getState=function(){return s&&s.state||"inactive"};var u=[];this.getAllStates=function(){return u},void 0===t.checkForInactiveTracks&&(t.checkForInactiveTracks=!1);o=this;!function n(){if(s&&!1!==t.checkForInactiveTracks)return!1===function(){if("active"in e){if(!e.active)return!1}else if("ended"in e&&e.ended)return!1;return!0}()?(t.disableLogs||console.log("MediaStream seems stopped."),void o.stop()):void setTimeout(n,1e3)}(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}function StereoAudioRecorder(e,t){function n(){if(!1===t.checkForInactiveTracks)return!0;if("active"in e){if(!e.active)return!1}else if("ended"in e&&e.ended)return!1;return!0}function r(e,t){function n(e,t){function n(e,t,n){var i=Math.round(e.length*(t/n)),o=[],a=Number((e.length-1)/(i-1));o[0]=e[0];for(var s=1;s<i-1;s++){var c=s*a,u=Number(Math.floor(c)).toFixed(),l=Number(Math.ceil(c)).toFixed(),d=c-u;o[s]=r(e[u],e[l],d)}return o[i-1]=e[e.length-1],o}function r(e,t,n){return e+(t-e)*n}function i(e,t){for(var n=new Float64Array(t),r=0,i=e.length,o=0;o<i;o++){var a=e[o];n.set(a,r),r+=a.length}return n}function o(e,t,n){for(var r=n.length,i=0;i<r;i++)e.setUint8(t+i,n.charCodeAt(i))}var a,s=e.numberOfAudioChannels,c=e.leftBuffers.slice(0),u=e.rightBuffers.slice(0),l=e.sampleRate,d=e.internalInterleavedLength,f=e.desiredSampRate;2===s&&(c=i(c,d),u=i(u,d),f&&(c=n(c,f,l),u=n(u,f,l))),1===s&&(c=i(c,d),f&&(c=n(c,f,l))),f&&(l=f),2===s&&(a=function(e,t){for(var n=e.length+t.length,r=new Float64Array(n),i=0,o=0;o<n;)r[o++]=e[i],r[o++]=t[i],i++;return r}(c,u)),1===s&&(a=c);var p=a.length,h=new ArrayBuffer(44+2*p),m=new DataView(h);o(m,0,"RIFF"),m.setUint32(4,36+2*p,!0),o(m,8,"WAVE"),o(m,12,"fmt "),m.setUint32(16,16,!0),m.setUint16(20,1,!0),m.setUint16(22,s,!0),m.setUint32(24,l,!0),m.setUint32(28,2*l,!0),m.setUint16(32,2*s,!0),m.setUint16(34,16,!0),o(m,36,"data"),m.setUint32(40,2*p,!0);for(var g=p,v=44,y=0;y<g;y++)m.setInt16(v,32767*a[y],!0),v+=2;return t?t({buffer:h,view:m}):void postMessage({buffer:h,view:m})}if(e.noWorker)n(e,function(e){t(e.buffer,e.view)});else{var r,i,o,a=(r=n,i=URL.createObjectURL(new Blob([r.toString(),";this.onmessage =  function (eee) {"+r.name+"(eee.data);}"],{type:"application/javascript"})),(o=new Worker(i)).workerURL=i,o);a.onmessage=function(e){t(e.data.buffer,e.data.view),URL.revokeObjectURL(a.workerURL),a.terminate()},a.postMessage(e)}}function i(){u=[],l=[],f=0,C=!1,d=!1,S=!1,m=null,c.leftchannel=u,c.rightchannel=l,c.numberOfAudioChannels=p,c.desiredSampRate=h,c.sampleRate=b,c.recordingLength=f,w={left:[],right:[],recordingLength:0}}function o(){s&&(s.onaudioprocess=null,s.disconnect(),s=null),g&&(g.disconnect(),g=null),i()}function a(){d&&"function"==typeof t.ondataavailable&&void 0!==t.timeSlice&&(w.left.length?(r({desiredSampRate:h,sampleRate:b,numberOfAudioChannels:p,internalInterleavedLength:w.recordingLength,leftBuffers:w.left,rightBuffers:1===p?[]:w.right},function(e,n){var r=new Blob([n],{type:"audio/wav"});t.ondataavailable(r),setTimeout(a,t.timeSlice)}),w={left:[],right:[],recordingLength:0}):setTimeout(a,t.timeSlice))}if(!getTracks(e,"audio").length)throw"Your stream has no audio tracks.";var s,c=this,u=[],l=[],d=!1,f=0,p=2,h=(t=t||{}).desiredSampRate;!0===t.leftChannel&&(p=1),1===t.numberOfAudioChannels&&(p=1),(!p||p<1)&&(p=2),t.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+p),void 0===t.checkForInactiveTracks&&(t.checkForInactiveTracks=!0),this.record=function(){if(!1===n())throw"Please make sure MediaStream is active.";i(),C=S=!1,d=!0,void 0!==t.timeSlice&&a()},this.stop=function(e){e=e||function(){},d=!1,r({desiredSampRate:h,sampleRate:b,numberOfAudioChannels:p,internalInterleavedLength:f,leftBuffers:u,rightBuffers:1===p?[]:l,noWorker:t.noWorker},function(t,n){c.blob=new Blob([n],{type:"audio/wav"}),c.buffer=new ArrayBuffer(n.buffer.byteLength),c.view=n,c.sampleRate=h||b,c.bufferSize=y,c.length=f,C=!1,e&&e(c.blob)})},void 0===RecordRTC.Storage&&(RecordRTC.Storage={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}),RecordRTC.Storage.AudioContextConstructor&&"closed"!==RecordRTC.Storage.AudioContextConstructor.state||(RecordRTC.Storage.AudioContextConstructor=new RecordRTC.Storage.AudioContext);var m=RecordRTC.Storage.AudioContextConstructor,g=m.createMediaStreamSource(e),v=[0,256,512,1024,2048,4096,8192,16384],y=void 0===t.bufferSize?4096:t.bufferSize;if(-1===v.indexOf(y)&&(t.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(v,null,"\t"))),m.createJavaScriptNode)s=m.createJavaScriptNode(y,p,p);else{if(!m.createScriptProcessor)throw"WebAudio API has no support on this browser.";s=m.createScriptProcessor(y,p,p)}g.connect(s),t.bufferSize||(y=s.bufferSize);var b=void 0!==t.sampleRate?t.sampleRate:m.sampleRate||44100;(b<22050||b>96e3)&&(t.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),t.disableLogs||t.desiredSampRate&&console.log("Desired sample-rate: "+t.desiredSampRate);var S=!1;this.pause=function(){S=!0},this.resume=function(){if(!1===n())throw"Please make sure MediaStream is active.";return d?void(S=!1):(t.disableLogs||console.log("Seems recording has been restarted."),void this.record())},this.clearRecordedData=function(){t.checkForInactiveTracks=!1,d&&this.stop(o),o()},this.name="StereoAudioRecorder",this.toString=function(){return this.name};var C=!1;s.onaudioprocess=function(e){if(!S){if(!1===n()&&(t.disableLogs||console.log("MediaStream seems stopped."),s.disconnect(),d=!1),!d)return void(g&&(g.disconnect(),g=null));C||(C=!0,t.onAudioProcessStarted&&t.onAudioProcessStarted(),t.initCallback&&t.initCallback());var r=e.inputBuffer.getChannelData(0),i=new Float32Array(r);if(u.push(i),2===p){var o=e.inputBuffer.getChannelData(1),a=new Float32Array(o);l.push(a)}f+=y,c.recordingLength=f,void 0!==t.timeSlice&&(w.recordingLength+=y,w.left.push(i),2===p&&w.right.push(a))}},m.createMediaStreamDestination?s.connect(m.createMediaStreamDestination()):s.connect(m.destination),this.leftchannel=u,this.rightchannel=l,this.numberOfAudioChannels=p,this.desiredSampRate=h,this.sampleRate=b,c.recordingLength=f;var w={left:[],right:[],recordingLength:0}}function CanvasRecorder(e,t){function n(){p.frames=[],s=!1,d=!1}function r(){if(d)return f=(new Date).getTime(),setTimeout(r,500);if("canvas"===e.nodeName.toLowerCase()){var n=(new Date).getTime()-f;return f=(new Date).getTime(),p.frames.push({image:(i=document.createElement("canvas"),o=i.getContext("2d"),i.width=e.width,i.height=e.height,o.drawImage(e,0,0),i),duration:n}),void(s&&setTimeout(r,t.frameInterval))}var i,o;html2canvas(e,{grabMouse:void 0===t.showMousePointer||t.showMousePointer,onrendered:function(e){var n=(new Date).getTime()-f;return n?(f=(new Date).getTime(),p.frames.push({image:e.toDataURL("image/webp",1),duration:n}),void(s&&setTimeout(r,t.frameInterval))):setTimeout(r,t.frameInterval)}})}if("undefined"==typeof html2canvas)throw"Please link: https://www.webrtc-experiment.com/screenshot.js";(t=t||{}).frameInterval||(t.frameInterval=10);var i=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){e in document.createElement("canvas")&&(i=!0)});var o,a,s,c=!(!window.webkitRTCPeerConnection&&!window.webkitGetUserMedia||!window.chrome),u=50,l=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(c&&l&&l[2]&&(u=parseInt(l[2],10)),c&&u<52&&(i=!1),t.useWhammyRecorder&&(i=!1),i)if(t.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),e instanceof HTMLCanvasElement)o=e;else{if(!(e instanceof CanvasRenderingContext2D))throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";o=e.canvas}else navigator.mozGetUserMedia&&(t.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));this.record=function(){if(s=!0,i&&!t.useWhammyRecorder){var e;"captureStream"in o?e=o.captureStream(25):"mozCaptureStream"in o?e=o.mozCaptureStream(25):"webkitCaptureStream"in o&&(e=o.webkitCaptureStream(25));try{var n=new MediaStream;n.addTrack(getTracks(e,"video")[0]),e=n}catch(e){}if(!e)throw"captureStream API are NOT available.";(a=new MediaStreamRecorder(e,{mimeType:t.mimeType||"video/webm"})).record()}else p.frames=[],f=(new Date).getTime(),r();t.initCallback&&t.initCallback()},this.getWebPImages=function(n){if("canvas"===e.nodeName.toLowerCase()){var r=p.frames.length;p.frames.forEach(function(e,n){var i=r-n;t.disableLogs||console.log(i+"/"+r+" frames remaining"),t.onEncodingCallback&&t.onEncodingCallback(i,r);var o=e.image.toDataURL("image/webp",1);p.frames[n].image=o}),t.disableLogs||console.log("Generating WebM"),n()}else n()},this.stop=function(e){s=!1;var n=this;return i&&a?void a.stop(e):void this.getWebPImages(function(){p.compile(function(r){t.disableLogs||console.log("Recording finished!"),n.blob=r,n.blob.forEach&&(n.blob=new Blob([],{type:"video/webm"})),e&&e(n.blob),p.frames=[]})})};var d=!1;this.pause=function(){d=!0,a instanceof MediaStreamRecorder&&a.pause()},this.resume=function(){return d=!1,a instanceof MediaStreamRecorder?void a.resume():void(s||this.record())},this.clearRecordedData=function(){s&&this.stop(n),n()},this.name="CanvasRecorder",this.toString=function(){return this.name};var f=(new Date).getTime(),p=new Whammy.Video(100)}function WhammyRecorder(e,t){function n(e){e=void 0!==e?e:10;var t=(new Date).getTime()-c;return t?a?(c=(new Date).getTime(),setTimeout(n,100)):(c=(new Date).getTime(),s.paused&&s.play(),d.drawImage(s,0,0,l.width,l.height),u.frames.push({duration:t,image:l.toDataURL("image/webp")}),void(o||setTimeout(n,e,e))):setTimeout(n,e,e)}function r(e,t,n,r,i){var o=document.createElement("canvas");o.width=l.width,o.height=l.height;var a,s,c,u=o.getContext("2d"),d=[],f=-1===t,p=t&&t>0&&t<=e.length?t:e.length,h=0,m=0,g=0,v=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),y=n&&n>=0&&n<=1?n:0,b=r&&r>=0&&r<=1?r:0,S=!1;s=-1,c=(a={length:p,functionToLoop:function(t,n){var r,i,o,a=function(){!S&&o-r<=o*b||(f&&(S=!0),d.push(e[n])),t()};if(S)a();else{var s=new Image;s.onload=function(){u.drawImage(s,0,0,l.width,l.height);var e=u.getImageData(0,0,l.width,l.height);r=0,i=e.data.length,o=e.data.length/4;for(var t=0;t<i;t+=4){var n={r:e.data[t],g:e.data[t+1],b:e.data[t+2]};Math.sqrt(Math.pow(n.r-h,2)+Math.pow(n.g-m,2)+Math.pow(n.b-g,2))<=v*y&&r++}a()},s.src=e[n].image}},callback:function(){(d=d.concat(e.slice(p))).length<=0&&d.push(e[e.length-1]),i(d)}}).length,function e(){return++s===c?void a.callback():void setTimeout(function(){a.functionToLoop(e,s)},1)}()}function i(){u.frames=[],o=!0,a=!1}(t=t||{}).frameInterval||(t.frameInterval=10),t.disableLogs||console.log("Using frames-interval:",t.frameInterval),this.record=function(){t.width||(t.width=320),t.height||(t.height=240),t.video||(t.video={width:t.width,height:t.height}),t.canvas||(t.canvas={width:t.width,height:t.height}),l.width=t.canvas.width||320,l.height=t.canvas.height||240,d=l.getContext("2d"),t.video&&t.video instanceof HTMLVideoElement?(s=t.video.cloneNode(),t.initCallback&&t.initCallback()):(s=document.createElement("video"),setSrcObject(e,s),s.onloadedmetadata=function(){t.initCallback&&t.initCallback()},s.width=t.video.width,s.height=t.video.height),s.muted=!0,s.play(),c=(new Date).getTime(),u=new Whammy.Video,t.disableLogs||(console.log("canvas resolutions",l.width,"*",l.height),console.log("video width/height",s.width||l.width,"*",s.height||l.height)),n(t.frameInterval)};var o=!1;this.stop=function(e){e=e||function(){},o=!0;var n=this;setTimeout(function(){r(u.frames,-1,null,null,function(r){u.frames=r,t.advertisement&&t.advertisement.length&&(u.frames=t.advertisement.concat(u.frames)),u.compile(function(t){n.blob=t,n.blob.forEach&&(n.blob=new Blob([],{type:"video/webm"})),e&&e(n.blob)})})},10)};var a=!1;this.pause=function(){a=!0},this.resume=function(){a=!1,o&&this.record()},this.clearRecordedData=function(){o||this.stop(i),i()},this.name="WhammyRecorder",this.toString=function(){return this.name};var s,c,u,l=document.createElement("canvas"),d=l.getContext("2d")}function GifRecorder(e,t){if("undefined"==typeof GIFEncoder){var n=document.createElement("script");n.src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(n)}t=t||{};var r=e instanceof CanvasRenderingContext2D||e instanceof HTMLCanvasElement;this.record=function(){return"undefined"==typeof GIFEncoder?void setTimeout(f.record,1e3):s?(r||(t.width||(t.width=c.offsetWidth||320),t.height||(t.height=c.offsetHeight||240),t.video||(t.video={width:t.width,height:t.height}),t.canvas||(t.canvas={width:t.width,height:t.height}),o.width=t.canvas.width||320,o.height=t.canvas.height||240,c.width=t.video.width||320,c.height=t.video.height||240),(l=new GIFEncoder).setRepeat(0),l.setDelay(t.frameRate||200),l.setQuality(t.quality||10),l.start(),"function"==typeof t.onGifRecordingStarted&&t.onGifRecordingStarted(),Date.now(),d=requestAnimationFrame(function e(n){if(!0!==f.clearedRecordedData){if(i)return setTimeout(function(){e(n)},100);d=requestAnimationFrame(e),void 0===typeof u&&(u=n),n-u<90||(!r&&c.paused&&c.play(),r||a.drawImage(c,0,0,o.width,o.height),t.onGifPreview&&t.onGifPreview(o.toDataURL("image/png")),l.addFrame(a),u=n)}}),void(t.initCallback&&t.initCallback())):void setTimeout(f.record,1e3)},this.stop=function(e){e=e||function(){},d&&cancelAnimationFrame(d),Date.now(),this.blob=new Blob([new Uint8Array(l.stream().bin)],{type:"image/gif"}),e(this.blob),l.stream().bin=[]};var i=!1;this.pause=function(){i=!0},this.resume=function(){i=!1},this.clearRecordedData=function(){f.clearedRecordedData=!0,l&&(l.stream().bin=[])},this.name="GifRecorder",this.toString=function(){return this.name};var o=document.createElement("canvas"),a=o.getContext("2d");r&&(e instanceof CanvasRenderingContext2D?o=(a=e).canvas:e instanceof HTMLCanvasElement&&(a=e.getContext("2d"),o=e));var s=!0;if(!r){var c=document.createElement("video");c.muted=!0,c.autoplay=!0,c.playsInline=!0,s=!1,c.onloadedmetadata=function(){s=!0},setSrcObject(e,c),c.play()}var u,l,d=null,f=this}function MultiStreamsMixer(e,t){function n(){if(!c){var e=s.length,t=!1,i=[];if(s.forEach(function(e){e.stream||(e.stream={}),e.stream.fullcanvas?t=e:i.push(e)}),t)u.width=t.stream.width,u.height=t.stream.height;else if(i.length){u.width=e>1?2*i[0].width:i[0].width;var o=1;3!==e&&4!==e||(o=2),5!==e&&6!==e||(o=3),7!==e&&8!==e||(o=4),9!==e&&10!==e||(o=5),u.height=i[0].height*o}else u.width=d.width||360,u.height=d.height||240;t&&t instanceof HTMLVideoElement&&r(t),i.forEach(function(e,t){r(e,t)}),setTimeout(n,d.frameInterval)}}function r(e,t){if(!c){var n=0,r=0,i=e.width,o=e.height;1===t&&(n=e.width),2===t&&(r=e.height),3===t&&(n=e.width,r=e.height),4===t&&(r=2*e.height),5===t&&(n=e.width,r=2*e.height),6===t&&(r=3*e.height),7===t&&(n=e.width,r=3*e.height),void 0!==e.stream.left&&(n=e.stream.left),void 0!==e.stream.top&&(r=e.stream.top),void 0!==e.stream.width&&(i=e.stream.width),void 0!==e.stream.height&&(o=e.stream.height),l.drawImage(e,n,r,i,o),"function"==typeof e.stream.onRender&&e.stream.onRender(l,n,r,i,o,t)}}function i(e){var n=document.createElement("video");return function(e,t){"srcObject"in t?t.srcObject=e:"mozSrcObject"in t?t.mozSrcObject=e:t.srcObject=e}(e,n),n.className=t,n.muted=!0,n.volume=0,n.width=e.width||d.width||360,n.height=e.height||d.height||240,n.play(),n}function o(t){s=[],(t=t||e).forEach(function(e){if(e.getTracks().filter(function(e){return"video"===e.kind}).length){var t=i(e);t.stream=e,s.push(t)}})}var a;a="undefined"!=typeof global?global:null,void 0===RecordRTC&&a&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},global.console||(global.console={}),void 0!==global.console.log&&void 0!==global.console.error||(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(a.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return e},a.HTMLVideoElement=function(){}),"undefined"==typeof location&&(a.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(a.screen={width:0,height:0}),void 0===p&&(a.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),a.window=global),t=t||"multi-streams-mixer";var s=[],c=!1,u=document.createElement("canvas"),l=u.getContext("2d");u.style.opacity=0,u.style.position="absolute",u.style.zIndex=-1,u.style.top="-1000em",u.style.left="-1000em",u.className=t,(document.body||document.documentElement).appendChild(u),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var d=this,f=window.AudioContext;void 0===f&&("undefined"!=typeof webkitAudioContext&&(f=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(f=mozAudioContext));var p=window.URL;void 0===p&&"undefined"!=typeof webkitURL&&(p=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var h=window.MediaStream;void 0===h&&"undefined"!=typeof webkitMediaStream&&(h=webkitMediaStream),void 0!==h&&void 0===h.prototype.stop&&(h.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})});var m={};void 0!==f?m.AudioContext=f:"undefined"!=typeof webkitAudioContext&&(m.AudioContext=webkitAudioContext),this.startDrawingFrames=function(){n()},this.appendStreams=function(t){if(!t)throw"First parameter is required.";t instanceof Array||(t=[t]),t.forEach(function(t){var n=new h;if(t.getTracks().filter(function(e){return"video"===e.kind}).length){var r=i(t);r.stream=t,s.push(r),n.addTrack(t.getTracks().filter(function(e){return"video"===e.kind})[0])}if(t.getTracks().filter(function(e){return"audio"===e.kind}).length){var o=d.audioContext.createMediaStreamSource(t);d.audioDestination=d.audioContext.createMediaStreamDestination(),o.connect(d.audioDestination),n.addTrack(d.audioDestination.stream.getTracks().filter(function(e){return"audio"===e.kind})[0])}e.push(n)})},this.releaseStreams=function(){s=[],c=!0,d.gainNode&&(d.gainNode.disconnect(),d.gainNode=null),d.audioSources.length&&(d.audioSources.forEach(function(e){e.disconnect()}),d.audioSources=[]),d.audioDestination&&(d.audioDestination.disconnect(),d.audioDestination=null),d.audioContext&&d.audioContext.close(),d.audioContext=null,l.clearRect(0,0,u.width,u.height),u.stream&&(u.stream.stop(),u.stream=null)},this.resetVideoStreams=function(e){!e||e instanceof Array||(e=[e]),o(e)},this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=function(){c=!1;var t=function(){var e;o(),"captureStream"in u?e=u.captureStream():"mozCaptureStream"in u?e=u.mozCaptureStream():d.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var t=new h;return e.getTracks().filter(function(e){return"video"===e.kind}).forEach(function(e){t.addTrack(e)}),u.stream=t,t}(),n=function(){m.AudioContextConstructor||(m.AudioContextConstructor=new m.AudioContext),d.audioContext=m.AudioContextConstructor,d.audioSources=[],!0===d.useGainNode&&(d.gainNode=d.audioContext.createGain(),d.gainNode.connect(d.audioContext.destination),d.gainNode.gain.value=0);var t=0;if(e.forEach(function(e){if(e.getTracks().filter(function(e){return"audio"===e.kind}).length){t++;var n=d.audioContext.createMediaStreamSource(e);!0===d.useGainNode&&n.connect(d.gainNode),d.audioSources.push(n)}}),t)return d.audioDestination=d.audioContext.createMediaStreamDestination(),d.audioSources.forEach(function(e){e.connect(d.audioDestination)}),d.audioDestination.stream}();return n&&n.getTracks().filter(function(e){return"audio"===e.kind}).forEach(function(e){t.addTrack(e)}),e.forEach(function(e){e.fullcanvas}),t}}function MultiStreamRecorder(e,t){e=e||[];var n,r,i=this;(t=t||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}}).frameInterval||(t.frameInterval=10),t.video||(t.video={}),t.video.width||(t.video.width=360),t.video.height||(t.video.height=240),this.record=function(){var i;n=new MultiStreamsMixer(e,t.elementClass||"multi-streams-mixer"),(i=[],e.forEach(function(e){getTracks(e,"video").forEach(function(e){i.push(e)})}),i).length&&(n.frameInterval=t.frameInterval||10,n.width=t.video.width||360,n.height=t.video.height||240,n.startDrawingFrames()),t.previewStream&&"function"==typeof t.previewStream&&t.previewStream(n.getMixedStream()),(r=new MediaStreamRecorder(n.getMixedStream(),t)).record()},this.stop=function(e){r&&r.stop(function(t){i.blob=t,e(t),i.clearRecordedData()})},this.pause=function(){r&&r.pause()},this.resume=function(){r&&r.resume()},this.clearRecordedData=function(){r&&(r.clearRecordedData(),r=null),n&&(n.releaseStreams(),n=null)},this.addStreams=function(i){if(!i)throw"First parameter is required.";i instanceof Array||(i=[i]),e.concat(i),r&&n&&(n.appendStreams(i),t.previewStream&&"function"==typeof t.previewStream&&t.previewStream(n.getMixedStream()))},this.resetVideoStreams=function(e){n&&(!e||e instanceof Array||(e=[e]),n.resetVideoStreams(e))},this.getMixer=function(){return n},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}function RecordRTCPromisesHandler(e,t){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(void 0===e)throw'First argument "MediaStream" is required.';var n=this;n.recordRTC=new RecordRTC(e,t),this.startRecording=function(){return new Promise(function(e,t){try{n.recordRTC.startRecording(),e()}catch(e){t(e)}})},this.stopRecording=function(){return new Promise(function(e,t){try{n.recordRTC.stopRecording(function(r){return n.blob=n.recordRTC.getBlob(),n.blob&&n.blob.size?void e(r):void t("Empty blob.",n.blob)})}catch(e){t(e)}})},this.pauseRecording=function(){return new Promise(function(e,t){try{n.recordRTC.pauseRecording(),e()}catch(e){t(e)}})},this.resumeRecording=function(){return new Promise(function(e,t){try{n.recordRTC.resumeRecording(),e()}catch(e){t(e)}})},this.getDataURL=function(e){return new Promise(function(e,t){try{n.recordRTC.getDataURL(function(t){e(t)})}catch(e){t(e)}})},this.getBlob=function(){return new Promise(function(e,t){try{e(n.recordRTC.getBlob())}catch(e){t(e)}})},this.getInternalRecorder=function(){return new Promise(function(e,t){try{e(n.recordRTC.getInternalRecorder())}catch(e){t(e)}})},this.reset=function(){return new Promise(function(e,t){try{e(n.recordRTC.reset())}catch(e){t(e)}})},this.destroy=function(){return new Promise(function(e,t){try{e(n.recordRTC.destroy())}catch(e){t(e)}})},this.getState=function(){return new Promise(function(e,t){try{e(n.recordRTC.getState())}catch(e){t(e)}})},this.blob=null,this.version="5.5.9"}function WebAssemblyRecorder(e,t){function n(){return new ReadableStream({start:function(n){var r=document.createElement("canvas"),i=document.createElement("video");i.srcObject=e,i.onplaying=function(){r.width=t.width,r.height=t.height;var e=r.getContext("2d"),o=1e3/t.frameRate;setTimeout(function r(){e.drawImage(i,0,0),n.enqueue(e.getImageData(0,0,t.width,t.height)),setTimeout(r,o)},o)},i.play()}})}var r,i;"undefined"!=typeof ReadableStream&&"undefined"!=typeof WritableStream||console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),(t=t||{}).width=t.width||640,t.height=t.height||480,t.frameRate=t.frameRate||30,t.bitrate=t.bitrate||1200,this.record=function(){o=[],i=!1,this.blob=null,function e(a,s){if(t.workerPath||s){if(!t.workerPath&&s instanceof ArrayBuffer){var c=new Blob([s],{type:"text/javascript"});t.workerPath=URL.createObjectURL(c)}t.workerPath||console.error("workerPath parameter is missing."),(r=new Worker(t.workerPath)).postMessage(t.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),r.addEventListener("message",function(e){"READY"===e.data?(r.postMessage({width:t.width,height:t.height,bitrate:t.bitrate||1200,timebaseDen:t.frameRate||30,realtime:!0}),n().pipeTo(new WritableStream({write:function(e){r&&r.postMessage(e.data.buffer,[e.data.buffer])}}))):e.data&&(i||o.push(e.data))})}else fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then(function(t){t.arrayBuffer().then(function(t){e(a,t)})})}(e),"function"==typeof t.initCallback&&t.initCallback()},this.pause=function(){i=!0},this.resume=function(){i=!1};var o=[];this.stop=function(e){r&&(r.postMessage(null),r.terminate(),r=null),this.blob=new Blob(o,{type:"video/webm"}),e(this.blob)},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){o=[],i=!1,this.blob=null},this.blob=null}!function(e){if("function"==typeof bootstrap)bootstrap("hark",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeHark=e}else"undefined"!=typeof window?window.hark=e():global.hark=e()}(function(){return function(e,t,n){function r(n,o){if(!t[n]){if(!e[n]){var a="function"==typeof require&&require;if(!o&&a)return a(n,!0);if(i)return i(n,!0);throw new Error("Cannot find module '"+n+"'")}var s=t[n]={exports:{}};e[n][0].call(s.exports,function(t){var i=e[n][1][t];return r(i||t)},s,s.exports)}return t[n].exports}for(var i="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,t,n){var r,i=e("wildemitter");"undefined"!=typeof window&&(r=window.AudioContext||window.webkitAudioContext);var o=null;t.exports=function(e,t){var n=new i;if(!r)return n;var a,s,c,u=(t=t||{}).smoothing||.1,l=t.interval||50,d=t.threshold,f=t.play,p=t.history||10,h=!0;o=t.audioContext||o||new r,(c=o.createAnalyser()).fftSize=512,c.smoothingTimeConstant=u,s=new Float32Array(c.frequencyBinCount),e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(a=o.createMediaElementSource(e),void 0===f&&(f=!0),d=d||-50):(a=o.createMediaStreamSource(e),d=d||-50),a.connect(c),f&&c.connect(o.destination),n.speaking=!1,n.suspend=function(){return o.suspend()},n.resume=function(){return o.resume()},Object.defineProperty(n,"state",{get:function(){return o.state}}),o.onstatechange=function(){n.emit("state_change",o.state)},n.setThreshold=function(e){d=e},n.setInterval=function(e){l=e},n.stop=function(){h=!1,n.emit("volume_change",-100,d),n.speaking&&(n.speaking=!1,n.emit("stopped_speaking")),c.disconnect(),a.disconnect()},n.speakingHistory=[];for(var m=0;m<p;m++)n.speakingHistory.push(0);var g=function(){setTimeout(function(){if(h){var e=function(e,t){var n=-1/0;e.getFloatFrequencyData(t);for(var r=4,i=t.length;r<i;r++)t[r]>n&&t[r]<0&&(n=t[r]);return n}(c,s);n.emit("volume_change",e,d);var t=0;if(e>d&&!n.speaking){for(var r=n.speakingHistory.length-3;r<n.speakingHistory.length;r++)t+=n.speakingHistory[r];t>=2&&(n.speaking=!0,n.emit("speaking"))}else if(e<d&&n.speaking){for(r=0;r<n.speakingHistory.length;r++)t+=n.speakingHistory[r];0==t&&(n.speaking=!1,n.emit("stopped_speaking"))}n.speakingHistory.shift(),n.speakingHistory.push(0+(e>d)),g()}},l)};return g(),n}},{wildemitter:2}],2:[function(e,t,n){function r(){}t.exports=r,r.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,n){this.callbacks=this.callbacks||{};var r=3===arguments.length,i=r?arguments[1]:void 0,o=r?arguments[2]:arguments[1];return o._groupName=i,(this.callbacks[e]=this.callbacks[e]||[]).push(o),this},t.once=function(e,t,n){var r=this,i=3===arguments.length,o=i?arguments[1]:void 0,a=i?arguments[2]:arguments[1];return this.on(e,o,function t(){r.off(e,t),a.apply(this,arguments)}),this},t.releaseGroup=function(e){var t,n,r,i;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(n=0,r=(i=this.callbacks[t]).length;n<r;n++)i[n]._groupName===e&&(i.splice(n,1),n--,r--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var n,r=this.callbacks[e];return r?1===arguments.length?(delete this.callbacks[e],this):(n=r.indexOf(t),r.splice(n,1),0===r.length&&delete this.callbacks[e],this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,n,r,i=[].slice.call(arguments,1),o=this.callbacks[e],a=this.getWildcardCallbacks(e);if(o)for(t=0,n=(r=o.slice()).length;t<n&&r[t];++t)r[t].apply(this,i);if(a)for(n=a.length,t=0,n=(r=a.slice()).length;t<n&&r[t];++t)r[t].apply(this,[e].concat(i));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,n,r=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&e.slice(0,n[0].length)===n[0])&&(r=r.concat(this.callbacks[t]));return r}},r.mixin(r)},{}]},{},[1])(1)}),function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=e()}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return i(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";var r=(0,e("./adapter_factory.js").adapterFactory)({window:window});t.exports=r},{"./adapter_factory.js":2}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.adapterFactory=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).window,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},n=r.log,u=r.detectBrowser(e),l={browserDetails:u,commonShim:c,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(u.browser){case"chrome":if(!i||!i.shimPeerConnection||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),l;n("adapter.js shimming chrome."),(l.browserShim=i).shimGetUserMedia(e),i.shimMediaStream(e),i.shimPeerConnection(e),i.shimOnTrack(e),i.shimAddTrackRemoveTrack(e),i.shimGetSendersWithDtmf(e),i.shimGetStats(e),i.shimSenderReceiverGetStats(e),i.fixNegotiationNeeded(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;case"firefox":if(!a||!a.shimPeerConnection||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),l;n("adapter.js shimming firefox."),(l.browserShim=a).shimGetUserMedia(e),a.shimPeerConnection(e),a.shimOnTrack(e),a.shimRemoveStream(e),a.shimSenderGetStats(e),a.shimReceiverGetStats(e),a.shimRTCDataChannel(e),a.shimAddTransceiver(e),a.shimCreateOffer(e),a.shimCreateAnswer(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"edge":if(!o||!o.shimPeerConnection||!t.shimEdge)return n("MS edge shim is not included in this adapter release."),l;n("adapter.js shimming edge."),(l.browserShim=o).shimGetUserMedia(e),o.shimGetDisplayMedia(e),o.shimPeerConnection(e),o.shimReplaceTrack(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"safari":if(!s||!t.shimSafari)return n("Safari shim is not included in this adapter release."),l;n("adapter.js shimming safari."),(l.browserShim=s).shimRTCIceServerUrls(e),s.shimCreateOfferLegacy(e),s.shimCallbacksAPI(e),s.shimLocalStreamsAPI(e),s.shimRemoteStreamsAPI(e),s.shimTrackEventTransceiver(e),s.shimGetUserMedia(e),c.shimRTCIceCandidate(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;default:n("Unsupported browser!")}return l};var r=u(e("./utils")),i=u(e("./chrome/chrome_shim")),o=u(e("./edge/edge_shim")),a=u(e("./firefox/firefox_shim")),s=u(e("./safari/safari_shim")),c=u(e("./common_shim"));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var o=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),n.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},n.shimOnTrack=function(e){if("object"!==(void 0===e?"undefined":r(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)a.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id}):{track:r.track};var o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)}),t.stream.getTracks().forEach(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.id}):{track:r};var o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}},n.shimGetSendersWithDtmf=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},n.shimGetStats=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,n=Array.prototype.slice.call(arguments),r=n[0],i=n[1],o=n[2];if(0<arguments.length&&"function"==typeof r)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof r))return t.apply(this,[]);function a(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t}function s(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))}return 2<=arguments.length?t.apply(this,[function(e){i(s(a(e)))},r]):new Promise(function(n,r){t.apply(e,[function(e){n(s(a(e)))},r])}).then(i,o)}}},n.shimSenderReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach(function(t){return t._pc=e}),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return a.filterStats(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),a.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return a.filterStats(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(t){if(0<arguments.length&&t instanceof e.MediaStreamTrack){var n=t,r=void 0,i=void 0,a=void 0;return this.getSenders().forEach(function(e){e.track===n&&(r?a=!0:r=e)}),this.getReceivers().forEach(function(e){return e.track===n&&(i?a=!0:i=e),e.track===n}),a||r&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}}}},n.shimAddTrackRemoveTrackWithNative=c,n.shimAddTrackRemoveTrack=function(e){if(e.RTCPeerConnection){var t=a.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&65<=t.version)return c(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}r.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var o=this._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);this._streams[n.id]=a,this._reverseStreams[a.id]=n,this.addStream(a)}return this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t],r=s({},t,function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[function(n){var r=l(e,n);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then(function(t){return l(e,t)})});e.RTCPeerConnection.prototype[t]=r[t]});var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(e){return arguments.length&&e.type&&(e=function(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,e)),o.apply(this,arguments)};var u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=u.get.apply(this);return""===e.type?e:l(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var n=void 0;Object.keys(this._streams).forEach(function(r){t._streams[r].getTracks().find(function(t){return e.track===t})&&(n=t._streams[r])}),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function l(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}},n.shimPeerConnection=function(e){var t=a.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t],r=s({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=r[t]});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(e,r){return e?t.version<78&&e&&""===e.candidate?Promise.resolve():n.apply(this,arguments):(r&&r.apply(null),Promise.resolve())}}},n.fixNegotiationNeeded=function(e){a.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils.js"));function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var r=this.getSenders();n.apply(this,arguments);var i=this.getSenders().filter(function(e){return-1===r.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]}),i.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(function(t){var r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices){var n=i.detectBrowser(e);if(t.getUserMedia=function(e,n,r){c(e,function(e){t.webkitGetUserMedia(e,n,function(e){r&&r(u(e))})})}.bind(t),t.mediaDevices.getUserMedia){var a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return c(e,function(e){return a(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(u(e))})})}}}function s(e){if("object"!==(void 0===e?"undefined":r(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i="object"===r(e[n])?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var a={};"number"==typeof i.ideal?(a[o("min",n)]=i.ideal,t.optional.push(a),(a={})[o("max",n)]=i.ideal):a[o("",n)]=i.ideal,t.optional.push(a)}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=i[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t}function c(e,i){if(61<=n.version)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===r(e.audio)){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=s(e.audio)}if(e&&"object"===r(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":r(c))?c:{ideal:c});var u=n.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||u)){delete e.video.facingMode;var l=void 0;if("environment"===c.exact||"environment"===c.ideal?l=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(l=["front"]),l)return t.mediaDevices.enumerateDevices().then(function(t){var n=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return l.some(function(t){return e.label.toLowerCase().includes(t)})});return!n&&t.length&&l.includes("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=c.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=s(e.video),o("chrome: "+JSON.stringify(e)),i(e)})}e.video=s(e.video)}return o("chrome: "+JSON.stringify(e)),i(e)}function u(e){return 64<=n.version?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils.js")),o=i.log},{"../utils.js":15}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimRTCIceCandidate=function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),i=o.default.parseCandidate(e.candidate),a=Object.assign(n,i);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,a.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},n.shimMaxMessageSize=function(e){if(e.RTCPeerConnection){var t=a.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){if(this._sctp=null,"chrome"===t.browser&&76<=t.version&&"plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}),function(e){if(!e||!e.sdp)return!1;var t=o.default.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=o.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(e)){var r,i=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n}(e),a=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(i),s=function(e,n){var r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);var i=o.default.matchPrefix(e.sdp,"a=max-message-size:");return 0<i.length?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r}(e,i);r=0===a&&0===s?Number.POSITIVE_INFINITY:0===a||0===s?Math.max(a,s):Math.min(a,s);var c={};Object.defineProperty(c,"maxMessageSize",{get:function(){return r}}),this._sctp=c}return n.apply(this,arguments)}}},n.shimSendThrowTypeError=function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},a.wrapPeerConnectionEvent(e,"datachannel",function(e){return n(e.channel,e.target),e})}function n(e,t){var n=e.send;e.send=function(r){var i=r,o=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}},n.shimConnectionState=function(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}},n.removeAllowExtmapMixed=function(e){if(e.RTCPeerConnection){var t=a.detectBrowser(e);if(!("chrome"===t.browser&&71<=t.version)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n")),n.apply(this,arguments)}}}};var i,o=(i=e("sdp"))&&i.__esModule?i:{default:i},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./utils"))},{"./utils":15,sdp:17}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var r=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return r.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),n.shimPeerConnection=function(e){var t=a.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var r=(0,c.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,s.filterIceServers)(e.iceServers,t.version),a.log("ICE servers after filtering:",e.iceServers)),new r(e)},e.RTCPeerConnection.prototype=r.prototype},n.shimReplaceTrack=function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var o,a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils")),s=e("./filtericeservers"),c=(o=e("rtcpeerconnection-shim"))&&o.__esModule?o:{default:o}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.filterIceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"==typeof t;return i&&(t=[t]),t=t.filter(function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!n?n=!0:t&&!n}),delete e.url,e.urls=i?t[0]:t,!!t.length}})};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils"))},{"../utils":15}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetUserMedia=function(e){var t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var o=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),n.shimOnTrack=function(e){"object"===(void 0===e?"undefined":r(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},n.shimPeerConnection=function(e){var t=a.detectBrowser(e);if("object"===(void 0===e?"undefined":r(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t],r=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=r[t]}),t.version<68){var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(e,t){return e?e&&""===e.candidate?Promise.resolve():n.apply(this,arguments):(t&&t.apply(null),Promise.resolve())}}var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),n=e[0],r=e[1],a=e[2];return o.apply(this,[n||null]).then(function(e){if(t.version<53&&!r)try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(r,a)}}},n.shimSenderGetStats=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach(function(t){return t._pc=e}),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},n.shimReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach(function(t){return t._pc=e}),n}),a.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},n.shimRemoveStream=function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;a.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(n){n.track&&e.getTracks().includes(n.track)&&t.removeTrack(n)})})},n.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},n.shimAddTransceiver=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(e,n){this.setParametersPromises=[];var r=n,i=r&&"sendEncodings"in r;i&&r.sendEncodings.forEach(function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(1<=parseFloat(e.scaleResolutionDownBy)))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(0<=parseFloat(e.maxFramerate)))throw new RangeError("max_framerate must be >= 0.0")});var o=t.apply(this,arguments);if(i){var a=o.sender,s=a.getParameters();"encodings"in s||(s.encodings=r.sendEncodings,this.setParametersPromises.push(a.setParameters(s).catch(function(){})))}return o})}},n.shimCreateOffer=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=this,n=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(e,n)}).finally(function(){e.setParametersPromises=[]}):t.apply(this,arguments)}}},n.shimCreateAnswer=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,n=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(e,n)}).finally(function(){e.setParametersPromises=[]}):t.apply(this,arguments)}}};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(n&&n.video)return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n);var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)})}},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimGetUserMedia=function(e){var t=i.detectBrowser(e),n=e&&e.navigator,o=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(55<t.version&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":r(e))&&"object"===r(e.audio)&&(e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","mozAutoGainControl"),a(e.audio,"noiseSuppression","mozNoiseSuppression")),s(e)},o&&o.prototype.getSettings){var c=o.prototype.getSettings;o.prototype.getSettings=function(){var e=c.apply(this,arguments);return a(e,"mozAutoGainControl","autoGainControl"),a(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var u=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":r(e))&&(e=JSON.parse(JSON.stringify(e)),a(e,"autoGainControl","mozAutoGainControl"),a(e,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[e])}}}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils"))},{"../utils":15}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimLocalStreamsAPI=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(r){return t.call(n,r,e)}),e.getVideoTracks().forEach(function(r){return t.call(n,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){var r=n;return r&&(this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var r=e.getTracks();this.getSenders().forEach(function(e){r.includes(e.track)&&t.removeTrack(e)})}})}},n.shimRemoteStreamsAPI=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(0<=e._remoteStreams.indexOf(t))){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}})}),t.apply(e,arguments)}}},n.shimCallbacksAPI=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,o=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t,r){var i=2<=arguments.length?r:e,o=n.apply(this,[i]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t,n){var r=2<=arguments.length?n:e,o=i.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o};var c=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=c,c=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=c,c=function(e,t,n){var r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=c}},n.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(e){return r(o(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))},n.shimConstraints=o,n.shimRTCIceServerUrls=function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var r=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,r.push(a)):r.push(e.iceServers[o])}e.iceServers=r}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},n.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":r(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},n.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind});!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind});!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video")}return t.apply(this,arguments)}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils"));function o(e){return e&&void 0!==e.video?Object.assign({},e,{video:i.compactObject(e.video)}):e}},{"../utils":15}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.extractVersion=a,n.wrapPeerConnectionEvent=function(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);function o(e){var t=n(e);t&&r(t)}return this._eventMap=this._eventMap||{},this._eventMap[r]=o,i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);var r=this._eventMap[n];return delete this._eventMap[n],o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},n.disableLog=function(e){return"boolean"==typeof e?(i=e)?"adapter.js logging disabled":"adapter.js logging enabled":new Error("Argument type: "+(void 0===e?"undefined":r(e))+". Please use a boolean.")},n.disableWarnings=function(e){return"boolean"==typeof e?(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled")):new Error("Argument type: "+(void 0===e?"undefined":r(e))+". Please use a boolean.")},n.log=function(){if("object"===("undefined"==typeof window?"undefined":r(window))){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},n.deprecated=function(e,t){o&&console.warn(e+" is deprecated, please use "+t+" instead.")},n.detectBrowser=function(e){var t=e.navigator,n={browser:null,version:null};if(void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=a(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)n.browser="chrome",n.version=a(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=a(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=a(t.userAgent,/AppleWebKit\/(\d+)\./,1),n.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return n},n.compactObject=function e(t){return s(t)?Object.keys(t).reduce(function(n,r){var i=s(t[r]),o=i?e(t[r]):t[r],a=i&&!Object.keys(o).length;return void 0===o||a?n:Object.assign(n,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},r,o))},{}):t},n.walkStats=c,n.filterStats=function(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){e.forEach(function(n){n.type===r&&n.trackId===t.id&&c(e,n,i)})}),i};var i=!0,o=!0;function a(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function s(e){return"[object Object]"===Object.prototype.toString.call(e)}function c(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(function(r){r.endsWith("Id")?c(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(function(t){c(e,e.get(t),n)})}))}},{}],16:[function(e,t,n){"use strict";var r=e("sdp");function i(e,t,n,i,o){var a=r.writeRtpDescription(e.kind,t);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":o||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";a+="a="+c,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),a}function o(e,t){function n(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]}var r={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(i){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(i.name.toLowerCase()===a.name.toLowerCase()&&i.clockRate===a.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&a.parameters.apt&&(s=i,c=a,u=e.codecs,l=t.codecs,f=d=void 0,d=n(s.parameters.apt,u),f=n(c.parameters.apt,l),!d||!f||d.name.toLowerCase()!==f.name.toLowerCase()))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(i.numChannels,a.numChannels),r.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}var s,c,u,l,d,f}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}}),r}function a(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}t.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}function l(n){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&14393<=t&&-1===e.indexOf("?transport=udp"):n=!0}),delete e.url,e.urls=i?r[0]:r,!!r.length}})}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var a=n.iceCandidatePoolSize;0<a;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1}Object.defineProperty(l.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(l.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},l.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(e,t){var n=0<this.transceivers.length,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},l.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find(function(e){return e.track===t}))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r=r||this._createTransceiver(t.kind),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},l.prototype.addStream=function(e){var n=this;if(15025<=t)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},l.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&-1<this.localStreams.indexOf(r)&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},l.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},l.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},l.prototype._createIceGatherer=function(t,n){var r=this;if(n&&0<t)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},l.prototype._gather=function(t,n){var i=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var a=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&0<n)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),s.component=1,s.ufrag=o.getLocalParameters().usernameFragment;var u=r.writeCandidate(s);a.candidate=Object.assign(a.candidate,r.parseCandidate(u)),a.candidate.candidate=u,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var l=r.getMediaSections(i._localDescription.sdp);l[a.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",i._localDescription.sdp=r.getDescription(i._localDescription.sdp)+l.join("");var d=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",a),d&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){a.forEach(function(e){o.onlocalcandidate(e)})},0)}},l.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},l.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},l.prototype._transceive=function(e,n,i){var a=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),i&&e.rtpReceiver&&0<a.codecs.length&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?a.encodings=e.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},l.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=r.parseRtpParameters(e);i.transceivers[t].localCapabilities=n}),i.transceivers.forEach(function(e,t){i._gather(e.mid,t)});else if("answer"===e.type){t=r.splitSections(i._remoteDescription.sdp),n=t.shift();var s=0<r.matchPrefix(n,"a=ice-lite").length;t.forEach(function(e,t){var a=i.transceivers[t],c=a.iceGatherer,u=a.iceTransport,l=a.dtlsTransport,d=a.localCapabilities,f=a.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length||a.rejected)){var p=r.getIceParameters(e,n),h=r.getDtlsParameters(e,n);s&&(h.role="server"),i.usingBundle&&0!==t||(i._gather(a.mid,t),"new"===u.state&&u.start(c,p,s?"controlling":"controlled"),"new"===l.state&&l.start(h));var m=o(d,f);i._transceive(a,0<m.codecs.length,!1)}})}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(i){var l=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!a("setRemoteDescription",i.type,l.signalingState)||l._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+l.signalingState));var d={};l.remoteStreams.forEach(function(e){d[e.id]=e});var f=[],p=r.splitSections(i.sdp),h=p.shift(),m=0<r.matchPrefix(h,"a=ice-lite").length,g=0<r.matchPrefix(h,"a=group:BUNDLE ").length;l.usingBundle=g;var v=r.matchPrefix(h,"a=ice-options:")[0];return l.canTrickleIceCandidates=!!v&&0<=v.substr(14).split(" ").indexOf("trickle"),p.forEach(function(a,c){var u=r.splitLines(a),p=r.getKind(a),v=r.isRejected(a)&&0===r.matchPrefix(a,"a=bundle-only").length,y=u[0].substr(2).split(" ")[2],b=r.getDirection(a,h),S=r.parseMsid(a),C=r.getMid(a)||r.generateIdentifier();if(v||"application"===p&&("DTLS/SCTP"===y||"UDP/DTLS/SCTP"===y))l.transceivers[c]={mid:C,kind:p,protocol:y,rejected:!0};else{var w,T,R,k,_,E,P,I,M;!v&&l.transceivers[c]&&l.transceivers[c].rejected&&(l.transceivers[c]=l._createTransceiver(p,!0));var D,A,O=r.parseRtpParameters(a);v||(D=r.getIceParameters(a,h),(A=r.getDtlsParameters(a,h)).role="client"),P=r.parseRtpEncodingParameters(a);var x=r.parseRtcpParameters(a),U=0<r.matchPrefix(a,"a=end-of-candidates",h).length,B=r.matchPrefix(a,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!v&&g&&0<c&&l.transceivers[c]&&(l._disposeIceAndDtlsTransports(c),l.transceivers[c].iceGatherer=l.transceivers[0].iceGatherer,l.transceivers[c].iceTransport=l.transceivers[0].iceTransport,l.transceivers[c].dtlsTransport=l.transceivers[0].dtlsTransport,l.transceivers[c].rtpSender&&l.transceivers[c].rtpSender.setTransport(l.transceivers[0].dtlsTransport),l.transceivers[c].rtpReceiver&&l.transceivers[c].rtpReceiver.setTransport(l.transceivers[0].dtlsTransport)),"offer"!==i.type||v)"answer"!==i.type||v||(T=(w=l.transceivers[c]).iceGatherer,R=w.iceTransport,k=w.dtlsTransport,_=w.rtpReceiver,E=w.sendEncodingParameters,I=w.localCapabilities,l.transceivers[c].recvEncodingParameters=P,l.transceivers[c].remoteCapabilities=O,l.transceivers[c].rtcpParameters=x,B.length&&"new"===R.state&&(!m&&!U||g&&0!==c?B.forEach(function(e){s(w.iceTransport,e)}):R.setRemoteCandidates(B)),g&&0!==c||("new"===R.state&&R.start(T,D,"controlling"),"new"===k.state&&k.start(A)),!o(w.localCapabilities,w.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&w.sendEncodingParameters[0].rtx&&delete w.sendEncodingParameters[0].rtx,l._transceive(w,"sendrecv"===b||"recvonly"===b,"sendrecv"===b||"sendonly"===b),!_||"sendrecv"!==b&&"sendonly"!==b?delete w.rtpReceiver:(M=_.track,S?(d[S.stream]||(d[S.stream]=new e.MediaStream),n(M,d[S.stream]),f.push([M,_,d[S.stream]])):(d.default||(d.default=new e.MediaStream),n(M,d.default),f.push([M,_,d.default]))));else{(w=l.transceivers[c]||l._createTransceiver(p)).mid=C,w.iceGatherer||(w.iceGatherer=l._createIceGatherer(c,g)),B.length&&"new"===w.iceTransport.state&&(!U||g&&0!==c?B.forEach(function(e){s(w.iceTransport,e)}):w.iceTransport.setRemoteCandidates(B)),I=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(I.codecs=I.codecs.filter(function(e){return"rtx"!==e.name})),E=w.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var j,L=!1;"sendrecv"===b||"sendonly"===b?(L=!w.rtpReceiver,_=w.rtpReceiver||new e.RTCRtpReceiver(w.dtlsTransport,p),L&&(M=_.track,S&&"-"===S.stream||(j=S?(d[S.stream]||(d[S.stream]=new e.MediaStream,Object.defineProperty(d[S.stream],"id",{get:function(){return S.stream}})),Object.defineProperty(M,"id",{get:function(){return S.track}}),d[S.stream]):(d.default||(d.default=new e.MediaStream),d.default)),j&&(n(M,j),w.associatedRemoteMediaStreams.push(j)),f.push([M,_,j]))):w.rtpReceiver&&w.rtpReceiver.track&&(w.associatedRemoteMediaStreams.forEach(function(t){var n=t.getTracks().find(function(e){return e.id===w.rtpReceiver.track.id});n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)}),w.associatedRemoteMediaStreams=[]),w.localCapabilities=I,w.remoteCapabilities=O,w.rtpReceiver=_,w.rtcpParameters=x,w.sendEncodingParameters=E,w.recvEncodingParameters=P,l._transceive(l.transceivers[c],!1,L)}}}),void 0===l._dtlsRole&&(l._dtlsRole="offer"===i.type?"active":"passive"),l._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?l._updateSignalingState("have-remote-offer"):l._updateSignalingState("stable"),Object.keys(d).forEach(function(t){var n=d[t];if(n.getTracks().length){if(-1===l.remoteStreams.indexOf(n)){l.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout(function(){l._dispatchEvent("addstream",r)})}f.forEach(function(e){var t=e[0],r=e[1];n.id===e[2].id&&u(l,t,r,[n])})}}),f.forEach(function(e){e[2]||u(l,e[0],e[1],[])}),e.setTimeout(function(){l&&l.transceivers&&l.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},l.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},l.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",0<t.failed?e="failed":0<t.checking?e="checking":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected?e="connected":0<t.completed&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},l.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",0<t.failed?e="failed":0<t.connecting?e="connecting":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},l.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=n.transceivers.filter(function(e){return"audio"===e.kind}).length,a=n.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(o=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(n.transceivers.forEach(function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)});0<o||0<a;)0<o&&(n._createTransceiver("audio"),o--),0<a&&(n._createTransceiver("video"),a--);var u=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(i,o){var a=i.track,s=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(o,n.usingBundle));var u=e.RTCRtpSender.getCapabilities(s);t<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),u.headerExtensions.forEach(function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var l=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];a&&15019<=t&&"video"===s&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=u,i.sendEncodingParameters=l}),"max-compat"!==n._config.bundlePolicy&&(u+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n",n.transceivers.forEach(function(e,t){u+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),u+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,u+="a="+r.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(u+="a=end-of-candidates\r\n"))});var l=new e.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(l)},l.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var a=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(a+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n";var s=r.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach(function(e,r){if(!(s<r+1)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?a+="m=application 0 DTLS/SCTP 5000\r\n":a+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(a+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&15019<=t&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var u=o(e.localCapabilities,e.remoteCapabilities);!u.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=i(e,u,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}});var u=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(u)},l.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,o){if(!n._remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var u=0;u<n.transceivers.length;u++)if(n.transceivers[u].mid===e.sdpMid){a=u;break}var l=n.transceivers[a];if(!l)return o(c("OperationError","Can not add ICE candidate"));if(l.rejected)return i();var d=0<Object.keys(e.candidate).length?r.parseCandidate(e.candidate):{};if("tcp"===d.protocol&&(0===d.port||9===d.port))return i();if(d.component&&1!==d.component)return i();if((0===a||0<a&&l.iceTransport!==n.transceivers[0].iceTransport)&&!s(l.iceTransport,d))return o(c("OperationError","Can not add ICE candidate"));var f=e.candidate.trim();0===f.indexOf("a=")&&(f=f.substr(2)),(t=r.getMediaSections(n._remoteDescription.sdp))[a]+="a="+(d.type?f:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var p=0;p<n.transceivers.length&&(n.transceivers[p].rejected||(n.transceivers[p].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(n._remoteDescription.sdp))[p]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));p++);i()})},l.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),!n)throw c("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&r.push(e[t].getStats())})}),Promise.all(r).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(n){e[n].type=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}(e[n]),t.set(n,e[n])}),t})}}});var d=["createOffer","createAnswer"];return d.forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(d=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),l}},{sdp:17}],17:[function(e,t,n){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:0<t[0].indexOf("/")?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return-1<r?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);return{usernameFragment:(n=n.concat(r.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var o=n[i],a=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=r.parseRtpMap(a),c=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=0<t.codecs.length?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),0<i&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=0<s.length&&s[0].ssrc,u=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});0<u.length&&1<u[0].length&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var l=r.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=l})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=0<i.length,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=0<o.length,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return 0<i.length?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},r.parseSctpDescription=function(e){var t,n=r.parseMLine(e),i=r.matchPrefix(e,"a=max-message-size:");0<i.length&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var o=r.matchPrefix(e,"a=sctp-port:");if(0<o.length)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(0<r.matchPrefix(e,"a=sctpmap:").length){var a=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}},r.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,n){var i=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||r.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=r)},{}]},{},[1])(1)}),function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Owt=e()}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return i(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Base64=void 0;var r=function(){var e,t,n,r=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],i=[];for(n=0;n<r.length;n+=1)i[r[n]]=n;var o=function(n){e=n,t=0},a=function(){if(!e)return-1;if(t>=e.length)return-1;var n=255&e.charCodeAt(t);return t+=1,n},s=function(){if(!e)return-1;for(;;){if(t>=e.length)return-1;var n=e.charAt(t);if(t+=1,i[n])return i[n];if("A"===n)return 0}},c=function(e){return 1===(e=e.toString(16)).length&&(e="0"+e),e="%"+e,unescape(e)};return{encodeBase64:function(e){var t,n;o(e),t="";var i=new Array(3);for(n=!1;!n&&-1!==(i[0]=a());)i[1]=a(),i[2]=a(),t+=r[i[0]>>2],-1!==i[1]?(t+=r[i[0]<<4&48|i[1]>>4],-1!==i[2]?(t+=r[i[1]<<2&60|i[2]>>6],t+=r[63&i[2]]):(t+=r[i[1]<<2&60],t+="=",n=!0)):(t+=r[i[0]<<4&48],t+="=",t+="=",n=!0);return t},decodeBase64:function(e){var t,n;o(e),t="";var r=new Array(4);for(n=!1;!n&&-1!==(r[0]=s())&&-1!==(r[1]=s());)r[2]=s(),r[3]=s(),t+=c(r[0]<<2&255|r[1]>>4),-1!==r[2]?(t+=c(r[1]<<4&255|r[2]>>2),-1!==r[3]?t+=c(r[2]<<6&255|r[3]):n=!0):n=!0;return t}}}();n.Base64=r},{}],2:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.VideoEncodingParameters=n.VideoCodecParameters=n.VideoCodec=n.AudioEncodingParameters=n.AudioCodecParameters=n.AudioCodec=void 0,n.AudioCodec={PCMU:"pcmu",PCMA:"pcma",OPUS:"opus",G722:"g722",ISAC:"iSAC",ILBC:"iLBC",AAC:"aac",AC3:"ac3",NELLYMOSER:"nellymoser"},n.AudioCodecParameters=function e(t,n,i){r(this,e),this.name=t,this.channelCount=n,this.clockRate=i},n.AudioEncodingParameters=function e(t,n){r(this,e),this.codec=t,this.maxBitrate=n},n.VideoCodec={VP8:"vp8",VP9:"vp9",H264:"h264",H265:"h265"},n.VideoCodecParameters=function e(t,n){r(this,e),this.name=t,this.profile=n},n.VideoEncodingParameters=function e(t,n){r(this,e),this.codec=t,this.maxBitrate=n}},{}],3:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&function(e,t){(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(e,t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.IceEvent=n.MuteEvent=n.ErrorEvent=n.MessageEvent=n.OwtEvent=n.EventDispatcher=void 0,n.EventDispatcher=function(){var e={dispatcher:{}};e.dispatcher.eventListeners={},this.addEventListener=function(t,n){void 0===e.dispatcher.eventListeners[t]&&(e.dispatcher.eventListeners[t]=[]),e.dispatcher.eventListeners[t].push(n)},this.removeEventListener=function(t,n){if(e.dispatcher.eventListeners[t]){var r=e.dispatcher.eventListeners[t].indexOf(n);-1!==r&&e.dispatcher.eventListeners[t].splice(r,1)}},this.clearEventListener=function(t){e.dispatcher.eventListeners[t]=[]},this.dispatchEvent=function(t){e.dispatcher.eventListeners[t.type]&&e.dispatcher.eventListeners[t.type].map(function(e){e(t)})}};var c=function e(t){s(this,e),this.type=t};n.OwtEvent=c;var u=function(e){function t(e,n){var r;return s(this,t),(r=i(this,o(t).call(this,e))).origin=n.origin,r.message=n.message,r.to=n.to,r}return a(t,c),t}();n.MessageEvent=u;var l=function(e){function t(e,n){var r;return s(this,t),(r=i(this,o(t).call(this,e))).error=n.error,r}return a(t,c),t}();n.ErrorEvent=l;var d=function(e){function t(e,n){var r;return s(this,t),(r=i(this,o(t).call(this,e))).kind=n.kind,r}return a(t,c),t}();n.MuteEvent=d;var f=function(e){function t(e,n){var r;return s(this,t),(r=i(this,o(t).call(this,e))).currentstate=n.currentstate,r}return a(t,c),t}();n.IceEvent=f},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./mediastream-factory.js");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return r[e]}})});var i=e("./stream.js");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})});var o=e("./mediaformat.js");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})})},{"./mediaformat.js":6,"./mediastream-factory.js":7,"./stream.js":10}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(){var e=function(){},t={DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5};t.log=window.console.log.bind(window.console);var n=function(e){return"function"==typeof window.console[e]?window.console[e].bind(window.console):window.console.log.bind(window.console)},r=function(r){t.debug=r<=0?n("log"):e,t.trace=r<=1?n("trace"):e,t.info=r<=2?n("info"):e,t.warning=r<=3?n("warn"):e,t.error=r<=4?n("error"):e};return r(0),t.setLogLevel=r,t}();n.default=r},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Resolution=n.TrackKind=n.VideoSourceInfo=n.AudioSourceInfo=void 0,n.AudioSourceInfo={MIC:"mic",SCREENCAST:"screen-cast",FILE:"file",MIXED:"mixed"},n.VideoSourceInfo={CAMERA:"camera",SCREENCAST:"screen-cast",FILE:"file",MIXED:"mixed"},n.TrackKind={AUDIO:"audio",VIDEO:"video",AUDIO_AND_VIDEO:"av"},n.Resolution=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.width=t,this.height=n}},{}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MediaStreamFactory=n.StreamConstraints=n.VideoTrackConstraints=n.AudioTrackConstraints=void 0;var r,i=a(e("./utils.js")),o=((r=e("./logger.js"))&&r.__esModule,a(e("./mediaformat.js")));function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e){return"object"===c(e.video)&&e.video.source===o.VideoSourceInfo.SCREENCAST}n.AudioTrackConstraints=function e(t){if(u(this,e),!Object.values(o.AudioSourceInfo).some(function(e){return e===t}))throw new TypeError("Invalid source.");this.source=t,this.deviceId=void 0},n.VideoTrackConstraints=function e(t){if(u(this,e),!Object.values(o.VideoSourceInfo).some(function(e){return e===t}))throw new TypeError("Invalid source.");this.source=t,this.deviceId=void 0,this.resolution=void 0,this.frameRate=void 0},n.StreamConstraints=function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u(this,e),this.audio=t,this.video=n};var d=function(){function e(){u(this,e)}var t,n;return t=e,n=[{key:"createMediaStream",value:function(e){if("object"!==c(e)||!e.audio&&!e.video)return Promise.reject(new TypeError("Invalid constrains"));if(!l(e)&&"object"===c(e.audio)&&e.audio.source===o.AudioSourceInfo.SCREENCAST)return Promise.reject(new TypeError("Cannot share screen without video."));if(l(e)&&!i.isChrome()&&!i.isFirefox())return Promise.reject(new TypeError("Screen sharing only supports Chrome and Firefox."));if(l(e)&&"object"===c(e.audio)&&e.audio.source!==o.AudioSourceInfo.SCREENCAST)return Promise.reject(new TypeError("Cannot capture video from screen cast while capture audio from other source."));if(!e.audio&&!e.video)return Promise.reject(new TypeError("At least one of audio and video must be requested."));var t=Object.create({});return"object"===c(e.audio)&&e.audio.source===o.AudioSourceInfo.MIC?(t.audio=Object.create({}),i.isEdge()?t.audio.deviceId=e.audio.deviceId:t.audio.deviceId={exact:e.audio.deviceId}):e.audio.source===o.AudioSourceInfo.SCREENCAST?t.audio=!0:t.audio=e.audio,"object"===c(e.video)?(t.video=Object.create({}),"number"==typeof e.video.frameRate&&(t.video.frameRate=e.video.frameRate),e.video.resolution&&e.video.resolution.width&&e.video.resolution.height&&(e.video.source===o.VideoSourceInfo.SCREENCAST?(t.video.width=e.video.resolution.width,t.video.height=e.video.resolution.height):(t.video.width=Object.create({}),t.video.width.exact=e.video.resolution.width,t.video.height=Object.create({}),t.video.height.exact=e.video.resolution.height)),"string"==typeof e.video.deviceId&&(t.video.deviceId={exact:e.video.deviceId}),i.isFirefox()&&e.video.source===o.VideoSourceInfo.SCREENCAST&&(t.video.mediaSource="screen")):t.video=e.video,l(e)?navigator.mediaDevices.getDisplayMedia(t):navigator.mediaDevices.getUserMedia(t)}}],null&&s(t.prototype,null),n&&s(t,n),e}();n.MediaStreamFactory=d},{"./logger.js":5,"./mediaformat.js":6,"./utils.js":11}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PublishOptions=n.Publication=n.PublicationSettings=n.VideoPublicationSettings=n.AudioPublicationSettings=void 0;var r=o(e("./utils.js")),i=(o(e("./mediaformat.js")),e("../base/event.js"));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.AudioPublicationSettings=function e(t){l(this,e),this.codec=t},n.VideoPublicationSettings=function e(t,n,r,i,o,a){l(this,e),this.codec=t,this.resolution=n,this.frameRate=r,this.bitrate=i,this.keyFrameInterval=o,this.rid=a},n.PublicationSettings=function e(t,n){l(this,e),this.audio=t,this.video=n};var d=function(e){function t(e,n,i,o,c){var d,f;return l(this,t),this,d=!(f=s(t).call(this))||"object"!==a(f)&&"function"!=typeof f?u(this):f,Object.defineProperty(u(u(d)),"id",{configurable:!1,writable:!1,value:e||r.createUuid()}),d.stop=n,d.getStats=i,d.mute=o,d.unmute=c,d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,i.EventDispatcher),t}();n.Publication=d,n.PublishOptions=function e(t,n){l(this,e),this.audio=t,this.video=n}},{"../base/event.js":3,"./mediaformat.js":6,"./utils.js":11}],9:[function(e,t,n){"use strict";var r;function i(e,t,n,r){var i=e.split("\r\n");i.length<=1&&(i=e.split("\n"));var c=function(e,t){var n=function(e,t){var n=s(e,"a=rtpmap",t);return n?u(e[n]):null}(e,t);return n?s(e,"a=fmtp:"+n.toString()):null}(i,t),l={};if(null===c){var d=s(i,"a=rtpmap",t);if(null===d)return e;var f=u(i[d]);l.pt=f.toString(),l.params={},l.params[n]=r,i.splice(d+1,0,a(l))}else(l=o(i[c])).params[n]=r,i[c]=a(l);return i.join("\r\n")}function o(e){var t={},n=e.indexOf(" "),r=e.substring(n+1).split(";"),i=new RegExp("a=fmtp:(\\d+)"),o=e.match(i);if(!o||2!==o.length)return null;t.pt=o[1];for(var a={},s=0;s<r.length;++s){var c=r[s].split("=");2===c.length&&(a[c[0]]=c[1])}return t.params=a,t}function a(e){if(!e.hasOwnProperty("pt")||!e.hasOwnProperty("params"))return null;var t=e.pt,n=e.params,r=[],i=0;for(var o in n)r[i]=o+"="+n[o],++i;return 0===i?null:"a=fmtp:"+t.toString()+" "+r.join(";")}function s(e,t,n){return c(e,0,-1,t,n)}function c(e,t,n,r,i){for(var o=-1!==n?n:e.length,a=t;a<o;++a)if(0===e[a].indexOf(r)&&(!i||-1!==e[a].toLowerCase().indexOf(i.toLowerCase())))return a;return null}function u(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),n=e.match(t);return n&&2===n.length?n[1]:null}Object.defineProperty(n,"__esModule",{value:!0}),n.reorderCodecs=function(e,t,n){if(!n||0===n.length)return e;n="audio"===t?n.concat(l):n.concat(d);var r=e.split("\r\n"),i=s(r,"m=",t);if(null===i)return e;var a=r[i].split(" ");a.splice(0,3);var p=[],h=!0,m=!1,g=void 0;try{for(var v,y=n[Symbol.iterator]();!(h=(v=y.next()).done);h=!0)for(var b=v.value,S=0;S<r.length;S++){var C=c(r,S,-1,"a=rtpmap",b);if(null!==C){var w=u(r[C]);w&&(p.push(w),S=C)}}}catch(e){m=!0,g=e}finally{try{h||null==y.return||y.return()}finally{if(m)throw g}}p=function(e,t){var n=!0,r=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var u=s(e,"a=fmtp","apt="+a.value);if(null!==u){var l=o(e[u]);t.push(l.pt)}}}catch(e){r=!0,i=e}finally{try{n||null==c.return||c.return()}finally{if(r)throw i}}return t}(r,p),r[i]=function(e,t){var n=e.split(" ").slice(0,3);return(n=n.concat(t)).join(" ")}(r[i],p);var T=!0,R=!1,k=void 0;try{for(var _,E=a[Symbol.iterator]();!(T=(_=E.next()).done);T=!0){var P=_.value;-1===p.indexOf(P)&&(r=f(r,P))}}catch(e){R=!0,k=e}finally{try{T||null==E.return||E.return()}finally{if(R)throw k}}return r.join("\r\n")},n.addLegacySimulcast=function(e,t,n){var r,i;if(!(n&&n>1))return e;var o=e.split("\r\n"),a=s(o,"m=",t);if(null===a)return e;var u=c(o,a+1,-1,"m=");null===u&&(u=o.length);for(var l=function(e){return e.split(" ")[0].split(":")[1]},d=new Set,f=new Set,p=new Set,h=[],m=[],g=a+1;g<u;){var v=o[g];if(""===v)break;if(v.indexOf("a=ssrc:")>-1){var y=l(o[g]);if(f.add(y),v.indexOf("cname")>-1||v.indexOf("msid")>-1)for(var b=1;b<n;b++){var S=parseInt(y)+b+"";h.push(v.replace(y,S))}else d.add(v)}if(v.indexOf("a=ssrc-group:FID")>-1){var C=v.split(" ");p.add(C[2]);for(var w=1;w<n;w++){var T=parseInt(C[1])+w+"",R=parseInt(C[2])+w+"";m.push(v.replace(C[1],T).replace(C[2],R))}}g++}var k=g;return f.forEach(function(e){if(!p.has(e)){var t="a=ssrc-group:SIM";t=t+" "+e;for(var r=1;r<n;r++)t=t+" "+(parseInt(e)+r);m.push(t)}}),h.sort(),(r=o).splice.apply(r,[k,0].concat(m)),(i=o).splice.apply(i,[k,0].concat(h)),(o=o.filter(function(e){return!d.has(e)})).join("\r\n")},n.setMaxBitrate=function(e,t){var n=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;c.maxBitrate&&(e=i(e,c.codec.name,"x-google-max-bitrate",c.maxBitrate.toString()))}}catch(e){r=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw o}}return e},(r=e("./logger.js"))&&r.__esModule;var l=["CN","telephone-event"],d=["red","ulpfec"];function f(e,t){for(var n=new RegExp("a=(rtpmap|rtcp-fb|fmtp):"+t+"\\s"),r=e.length-1;r>0;r--)e[r].match(n)&&e.splice(r,1);return e}},{"./logger.js":5}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StreamEvent=n.RemoteStream=n.LocalStream=n.Stream=n.StreamSourceInfo=void 0,(r=e("./logger.js"))&&r.__esModule;var r,i=e("./event.js"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(e("./utils.js"));function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?l(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&function(e,t){(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){return t.some(function(t){return t===e})}n.StreamSourceInfo=function e(t,n){if(d(this,e),!f(t,[void 0,"mic","screen-cast","file","mixed"]))throw new TypeError("Incorrect value for audioSourceInfo");if(!f(n,[void 0,"camera","screen-cast","file","encoded-file","raw-file","mixed"]))throw new TypeError("Incorrect value for videoSourceInfo");this.audio=t,this.video=n};var p=function(e){function t(e,n,r){var i;if(d(this,t),i=s(this,c(t).call(this)),e&&!(e instanceof MediaStream)||"object"!==a(n))throw new TypeError("Invalid stream or sourceInfo.");if(e&&(e.getAudioTracks().length>0&&!n.audio||e.getVideoTracks().length>0&&!n.video))throw new TypeError("Missing audio source info or video source info.");return Object.defineProperty(l(l(i)),"mediaStream",{configurable:!1,writable:!0,value:e}),Object.defineProperty(l(l(i)),"source",{configurable:!1,writable:!1,value:n}),Object.defineProperty(l(l(i)),"attributes",{configurable:!0,writable:!1,value:r}),i}return u(t,i.EventDispatcher),t}();n.Stream=p;var h=function(e){function t(e,n,r){var i;if(d(this,t),!(e instanceof MediaStream))throw new TypeError("Invalid stream.");return i=s(this,c(t).call(this,e,n,r)),Object.defineProperty(l(l(i)),"id",{configurable:!1,writable:!1,value:o.createUuid()}),i}return u(t,p),t}();n.LocalStream=h;var m=function(e){function t(e,n,r,i,a){var u;return d(this,t),u=s(this,c(t).call(this,r,i,a)),Object.defineProperty(l(l(u)),"id",{configurable:!1,writable:!1,value:e||o.createUuid()}),Object.defineProperty(l(l(u)),"origin",{configurable:!1,writable:!1,value:n}),u.settings=void 0,u.extraCapabilities=void 0,u}return u(t,p),t}();n.RemoteStream=m;var g=function(e){function t(e,n){var r;return d(this,t),(r=s(this,c(t).call(this,e))).stream=n.stream,r}return u(t,i.OwtEvent),t}();n.StreamEvent=g},{"./event.js":3,"./logger.js":5,"./utils.js":11}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isFirefox=function(){return null!==window.navigator.userAgent.match("Firefox")},n.isChrome=function(){return null!==window.navigator.userAgent.match("Chrome")},n.isSafari=i,n.isEdge=function(){return null!==window.navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)},n.createUuid=function(){return"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},n.sysInfo=function(){var e=Object.create({});e.sdk={version:r,type:"JavaScript"};var t=navigator.userAgent,n=/Chrome\/([0-9\.]+)/.exec(t);return n?e.runtime={name:"Chrome",version:n[1]}:(n=/Firefox\/([0-9\.]+)/.exec(t))?e.runtime={name:"Firefox",version:n[1]}:(n=/Edge\/([0-9\.]+)/.exec(t))?e.runtime={name:"Edge",version:n[1]}:i()?(n=/Version\/([0-9\.]+) Safari/.exec(t),e.runtime={name:"Safari"},e.runtime.version=n?n[1]:"Unknown"):e.runtime={name:"Unknown",version:"Unknown"},(n=/Windows NT ([0-9\.]+)/.exec(t))?e.os={name:"Windows NT",version:n[1]}:(n=/Intel Mac OS X ([0-9_\.]+)/.exec(t))?e.os={name:"Mac OS X",version:n[1].replace(/_/g,".")}:(n=/iPhone OS ([0-9_\.]+)/.exec(t))?e.os={name:"iPhone OS",version:n[1].replace(/_/g,".")}:(n=/X11; Linux/.exec(t))?e.os={name:"Linux",version:"Unknown"}:(n=/Android( ([0-9\.]+))?/.exec(t))?e.os={name:"Android",version:n[1]||"Unknown"}:(n=/CrOS/.exec(t))?e.os={name:"Chrome OS",version:"Unknown"}:e.os={name:"Unknown",version:"Unknown"},e.capabilities={continualIceGathering:!1,unifiedPlan:!0,streamRemovable:"Firefox"!==e.runtime.name},e};var r="4.3";function i(){return/^((?!chrome|android).)*safari/i.test(window.navigator.userAgent)}},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ConferencePeerConnectionChannel=void 0;var r,i=(r=e("../base/logger.js"))&&r.__esModule?r:{default:r},o=e("../base/event.js"),a=e("../base/mediaformat.js"),s=e("../base/publication.js"),c=e("./subscription.js"),u=e("./error.js"),l=f(e("../base/utils.js")),d=f(e("../base/sdputils.js"));function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,m(t).call(this)))._config=e,r._options=null,r._videoCodecs=void 0,r._signaling=n,r._pc=null,r._internalId=null,r._pendingCandidates=[],r._subscribePromise=null,r._publishPromise=null,r._subscribedStream=null,r._publishedStream=null,r._publication=null,r._subscription=null,r._disconnectTimer=null,r._ended=!1,r._stopped=!1,r}var n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,o.EventDispatcher),n=t,(r=[{key:"onMessage",value:function(e,t){switch(e){case"progress":"soac"===t.status?this._sdpHandler(t.data):"ready"===t.status?this._readyHandler():"error"===t.status&&this._errorHandler(t.data);break;case"stream":this._onStreamEvent(t);break;default:i.default.warning("Unknown notification from MCU.")}}},{key:"publish",value:function(e,t,n){var r=this;if(void 0===t&&(t={audio:!!e.mediaStream.getAudioTracks().length,video:!!e.mediaStream.getVideoTracks().length}),"object"!==p(t))return Promise.reject(new TypeError("Options should be an object."));if(this._isRtpEncodingParameters(t.audio)&&this._isOwtEncodingParameters(t.video)||this._isOwtEncodingParameters(t.audio)&&this._isRtpEncodingParameters(t.video))return Promise.reject(new u.ConferenceError("Mixing RTCRtpEncodingParameters and AudioEncodingParameters/VideoEncodingParameters is not allowed."));if(void 0===t.audio&&(t.audio=!!e.mediaStream.getAudioTracks().length),void 0===t.video&&(t.video=!!e.mediaStream.getVideoTracks().length),t.audio&&!e.mediaStream.getAudioTracks().length||t.video&&!e.mediaStream.getVideoTracks().length)return Promise.reject(new u.ConferenceError("options.audio/video is inconsistent with tracks presented in the MediaStream."));if(!(!1!==t.audio&&null!==t.audio||!1!==t.video&&null!==t.video))return Promise.reject(new u.ConferenceError("Cannot publish a stream without audio and video."));if("object"===p(t.audio)){if(!Array.isArray(t.audio))return Promise.reject(new TypeError("options.audio should be a boolean or an array."));var a=!0,s=!1,c=void 0;try{for(var d,f=t.audio[Symbol.iterator]();!(a=(d=f.next()).done);a=!0){var h=d.value;if(!h.codec||"string"!=typeof h.codec.name||void 0!==h.maxBitrate&&"number"!=typeof h.maxBitrate)return Promise.reject(new TypeError("options.audio has incorrect parameters."))}}catch(e){s=!0,c=e}finally{try{a||null==f.return||f.return()}finally{if(s)throw c}}}if("object"===p(t.video)&&!Array.isArray(t.video))return Promise.reject(new TypeError("options.video should be a boolean or an array."));if(this._isOwtEncodingParameters(t.video)){var m=!0,g=!1,v=void 0;try{for(var y,b=t.video[Symbol.iterator]();!(m=(y=b.next()).done);m=!0){var S=y.value;if(!S.codec||"string"!=typeof S.codec.name||void 0!==S.maxBitrate&&"number"!=typeof S.maxBitrate||void 0!==S.codec.profile&&"string"!=typeof S.codec.profile)return Promise.reject(new TypeError("options.video has incorrect parameters."))}}catch(e){g=!0,v=e}finally{try{m||null==b.return||b.return()}finally{if(g)throw v}}}this._options=t;var C={};if(this._createPeerConnection(),e.mediaStream.getAudioTracks().length>0&&!1!==t.audio&&null!==t.audio){if(e.mediaStream.getAudioTracks().length>1&&i.default.warning("Publishing a stream with multiple audio tracks is not fully supported."),"boolean"!=typeof t.audio&&"object"!==p(t.audio))return Promise.reject(new u.ConferenceError("Type of audio options should be boolean or an object."));C.audio={},C.audio.source=e.source.audio}else C.audio=!1;if(e.mediaStream.getVideoTracks().length>0&&!1!==t.video&&null!==t.video){e.mediaStream.getVideoTracks().length>1&&i.default.warning("Publishing a stream with multiple video tracks is not fully supported."),C.video={},C.video.source=e.source.video;var w=e.mediaStream.getVideoTracks()[0].getSettings();C.video.parameters={resolution:{width:w.width,height:w.height},framerate:w.frameRate}}else C.video=!1;return this._publishedStream=e,this._signaling.sendSignalingMessage("publish",{media:C,attributes:e.attributes}).then(function(i){var a=new o.MessageEvent("id",{message:i.id,origin:r._remoteId});r.dispatchEvent(a),r._internalId=i.id;var s={};if("function"==typeof r._pc.addTransceiver){var c=Promise.resolve();if(C.audio&&e.mediaStream.getAudioTracks().length>0){var u={direction:"sendonly"};r._isRtpEncodingParameters(t.audio)&&(u.sendEncodings=t.audio);var d=r._pc.addTransceiver(e.mediaStream.getAudioTracks()[0],u);if(l.isFirefox()){var f=d.sender.getParameters();f.encodings=u.sendEncodings,c=d.sender.setParameters(f)}}if(C.video&&e.mediaStream.getVideoTracks().length>0){var p={direction:"sendonly"};r._isRtpEncodingParameters(t.video)&&(p.sendEncodings=t.video,r._videoCodecs=n);var h=r._pc.addTransceiver(e.mediaStream.getVideoTracks()[0],p);if(l.isFirefox()){var m=h.sender.getParameters();m.encodings=p.sendEncodings,c=c.then(function(){return h.sender.setParameters(m)})}}return c.then(function(){return s})}if(C.audio&&e.mediaStream.getAudioTracks().length>0){var g=!0,v=!1,y=void 0;try{for(var b,S=e.mediaStream.getAudioTracks()[Symbol.iterator]();!(g=(b=S.next()).done);g=!0){var w=b.value;r._pc.addTrack(w,e.mediaStream)}}catch(e){v=!0,y=e}finally{try{g||null==S.return||S.return()}finally{if(v)throw y}}}if(C.video&&e.mediaStream.getVideoTracks().length>0){var T=!0,R=!1,k=void 0;try{for(var _,E=e.mediaStream.getVideoTracks()[Symbol.iterator]();!(T=(_=E.next()).done);T=!0){var P=_.value;r._pc.addTrack(P,e.mediaStream)}}catch(e){R=!0,k=e}finally{try{T||null==E.return||E.return()}finally{if(R)throw k}}}return s.offerToReceiveAudio=!1,s.offerToReceiveVideo=!1,s}).then(function(e){var n;r._pc.createOffer(e).then(function(e){return t&&(e.sdp=r._setRtpReceiverOptions(e.sdp,t)),e}).then(function(e){return n=e,r._pc.setLocalDescription(e)}).then(function(){r._signaling.sendSignalingMessage("soac",{id:r._internalId,signaling:n})}).catch(function(e){i.default.error("Failed to create offer or set SDP. Message: "+e.message),r._unpublish(),r._rejectPromise(e),r._fireEndedEventOnPublicationOrSubscription()})}).catch(function(e){r._unpublish(),r._rejectPromise(e),r._fireEndedEventOnPublicationOrSubscription()}),new Promise(function(e,t){r._publishPromise={resolve:e,reject:t}})}},{key:"subscribe",value:function(e,t){var n=this;if(void 0===t&&(t={audio:!!e.settings.audio,video:!!e.settings.video}),"object"!==p(t))return Promise.reject(new TypeError("Options should be an object."));if(void 0===t.audio&&(t.audio=!!e.settings.audio),void 0===t.video&&(t.video=!!e.settings.video),void 0!==t.audio&&"object"!==p(t.audio)&&"boolean"!=typeof t.audio&&null!==t.audio||void 0!==t.video&&"object"!==p(t.video)&&"boolean"!=typeof t.video&&null!==t.video)return Promise.reject(new TypeError("Invalid options type."));if(t.audio&&!e.settings.audio||t.video&&!e.settings.video)return Promise.reject(new u.ConferenceError("options.audio/video cannot be true or an object if there is no audio/video track in remote stream."));if(!1===t.audio&&!1===t.video)return Promise.reject(new u.ConferenceError("Cannot subscribe a stream without audio and video."));this._options=t;var r={};if(t.audio){if("object"===p(t.audio)&&Array.isArray(t.audio.codecs)&&0===t.audio.codecs.length)return Promise.reject(new TypeError("Audio codec cannot be an empty array."));r.audio={},r.audio.from=e.id}else r.audio=!1;if(t.video){if("object"===p(t.video)&&Array.isArray(t.video.codecs)&&0===t.video.codecs.length)return Promise.reject(new TypeError("Video codec cannot be an empty array."));r.video={},r.video.from=e.id,(t.video.resolution||t.video.frameRate||t.video.bitrateMultiplier&&1!==t.video.bitrateMultiplier||t.video.keyFrameInterval)&&(r.video.parameters={resolution:t.video.resolution,framerate:t.video.frameRate,bitrate:t.video.bitrateMultiplier?"x"+t.video.bitrateMultiplier.toString():void 0,keyFrameInterval:t.video.keyFrameInterval}),t.video.rid&&(r.video.simulcastRid=t.video.rid,delete r.video.parameters,t.video=!0)}else r.video=!1;return this._subscribedStream=e,this._signaling.sendSignalingMessage("subscribe",{media:r}).then(function(e){var a=new o.MessageEvent("id",{message:e.id,origin:n._remoteId});n.dispatchEvent(a),n._internalId=e.id,n._createPeerConnection();var s={};"function"==typeof n._pc.addTransceiver?(r.audio&&n._pc.addTransceiver("audio",{direction:"recvonly"}),r.video&&n._pc.addTransceiver("video",{direction:"recvonly"})):(s.offerToReceiveAudio=!!t.audio,s.offerToReceiveVideo=!!t.video),n._pc.createOffer(s).then(function(e){t&&(e.sdp=n._setRtpReceiverOptions(e.sdp,t)),n._pc.setLocalDescription(e).then(function(){n._signaling.sendSignalingMessage("soac",{id:n._internalId,signaling:e})},function(e){i.default.error("Set local description failed. Message: "+JSON.stringify(e))})},function(e){i.default.error("Create offer failed. Error info: "+JSON.stringify(e))}).catch(function(e){i.default.error("Failed to create offer or set SDP. Message: "+e.message),n._unsubscribe(),n._rejectPromise(e),n._fireEndedEventOnPublicationOrSubscription()})}).catch(function(e){n._unsubscribe(),n._rejectPromise(e),n._fireEndedEventOnPublicationOrSubscription()}),new Promise(function(e,t){n._subscribePromise={resolve:e,reject:t}})}},{key:"_unpublish",value:function(){this._stopped||(this._stopped=!0,this._signaling.sendSignalingMessage("unpublish",{id:this._internalId}).catch(function(e){i.default.warning("MCU returns negative ack for unpublishing, "+e)}),this._pc&&"closed"!==this._pc.signalingState&&this._pc.close())}},{key:"_unsubscribe",value:function(){this._stopped||(this._stopped=!0,this._signaling.sendSignalingMessage("unsubscribe",{id:this._internalId}).catch(function(e){i.default.warning("MCU returns negative ack for unsubscribing, "+e)}),this._pc&&"closed"!==this._pc.signalingState&&this._pc.close())}},{key:"_muteOrUnmute",value:function(e,t,n){var r=this,i=t?"stream-control":"subscription-control",a=e?"pause":"play";return this._signaling.sendSignalingMessage(i,{id:this._internalId,operation:a,data:n}).then(function(){if(!t){var i=e?"mute":"unmute";r._subscription.dispatchEvent(new o.MuteEvent(i,{kind:n}))}})}},{key:"_applyOptions",value:function(e){if("object"!==p(e)||"object"!==p(e.video))return Promise.reject(new u.ConferenceError("Options should be an object."));var t={};return t.resolution=e.video.resolution,t.framerate=e.video.frameRate,t.bitrate=e.video.bitrateMultiplier?"x"+e.video.bitrateMultiplier.toString():void 0,t.keyFrameInterval=e.video.keyFrameInterval,this._signaling.sendSignalingMessage("subscription-control",{id:this._internalId,operation:"update",data:{video:{parameters:t}}}).then()}},{key:"_onRemoteStreamAdded",value:function(e){i.default.debug("Remote stream added."),this._subscribedStream?this._subscribedStream.mediaStream=e.streams[0]:i.default.warning("Received remote stream without subscription.")}},{key:"_onLocalIceCandidate",value:function(e){e.candidate?"stable"!==this._pc.signalingState?this._pendingCandidates.push(e.candidate):this._sendCandidate(e.candidate):i.default.debug("Empty candidate.")}},{key:"_fireEndedEventOnPublicationOrSubscription",value:function(){if(!this._ended){this._ended=!0;var e=new o.OwtEvent("ended");this._publication?(this._publication.dispatchEvent(e),this._publication.stop()):this._subscription&&(this._subscription.dispatchEvent(e),this._subscription.stop())}}},{key:"_rejectPromise",value:function(e){e||new u.ConferenceError("Connection failed or closed."),this._publishPromise?(this._publishPromise.reject(e),this._publishPromise=void 0):this._subscribePromise&&(this._subscribePromise.reject(e),this._subscribePromise=void 0)}},{key:"_onIceConnectionStateChange",value:function(e){e&&e.currentTarget&&(i.default.debug("ICE connection state changed to "+e.currentTarget.iceConnectionState),this._publication?this._publication.dispatchEvent(new o.IceEvent("icestatechange",{currentstate:e.currentTarget.iceConnectionState})):this._subscription&&this._subscription.dispatchEvent(new o.IceEvent("icestatechange",{currentstate:e.currentTarget.iceConnectionState})),"closed"!==e.currentTarget.iceConnectionState&&"failed"!==e.currentTarget.iceConnectionState||("failed"===e.currentTarget.iceConnectionState?this._handleError("connection failed."):this._fireEndedEventOnPublicationOrSubscription()))}},{key:"_onConnectionStateChange",value:function(e){"closed"!==this._pc.connectionState&&"failed"!==this._pc.connectionState||("failed"===this._pc.connectionState?this._handleError("connection failed."):this._fireEndedEventOnPublicationOrSubscription())}},{key:"_sendCandidate",value:function(e){this._signaling.sendSignalingMessage("soac",{id:this._internalId,signaling:{type:"candidate",candidate:{candidate:"a="+e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex}}})}},{key:"_createPeerConnection",value:function(){var e=this,t=this._config.rtcConfiguration||{};l.isChrome()&&(t.sdpSemantics="unified-plan"),this._pc=new RTCPeerConnection(t),this._pc.onicecandidate=function(t){e._onLocalIceCandidate.apply(e,[t])},this._pc.ontrack=function(t){e._onRemoteStreamAdded.apply(e,[t])},this._pc.oniceconnectionstatechange=function(t){e._onIceConnectionStateChange.apply(e,[t])},this._pc.onconnectionstatechange=function(t){e._onConnectionStateChange.apply(e,[t])}}},{key:"_getStats",value:function(){return this._pc?this._pc.getStats():Promise.reject(new u.ConferenceError("PeerConnection is not available."))}},{key:"_readyHandler",value:function(){var e=this;this._subscribePromise?(this._subscription=new c.Subscription(this._internalId,function(){e._unsubscribe()},function(){return e._getStats()},function(t){return e._muteOrUnmute(!0,!1,t)},function(t){return e._muteOrUnmute(!1,!1,t)},function(t){return e._applyOptions(t)}),this._subscribedStream.addEventListener("ended",function(){e._subscription.dispatchEvent("ended",new o.OwtEvent("ended"))}),this._subscribePromise.resolve(this._subscription)):this._publishPromise&&(this._publication=new s.Publication(this._internalId,function(){return e._unpublish(),Promise.resolve()},function(){return e._getStats()},function(t){return e._muteOrUnmute(!0,!0,t)},function(t){return e._muteOrUnmute(!1,!0,t)}),this._publishPromise.resolve(this._publication)),this._publishPromise=null,this._subscribePromise=null}},{key:"_sdpHandler",value:function(e){var t=this;"answer"===e.type&&((this._publication||this._publishPromise)&&this._options&&(e.sdp=this._setRtpSenderOptions(e.sdp,this._options)),this._pc.setRemoteDescription(e).then(function(){if(t._pendingCandidates.length>0){var e=!0,n=!1,r=void 0;try{for(var i,o=t._pendingCandidates[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t._sendCandidate(a)}}catch(e){n=!0,r=e}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}}},function(e){i.default.error("Set remote description failed: "+e),t._rejectPromise(e),t._fireEndedEventOnPublicationOrSubscription()}))}},{key:"_errorHandler",value:function(e){return this._handleError(e)}},{key:"_handleError",value:function(e){var t=new u.ConferenceError(e);if(this._publishPromise||this._subscribePromise)return this._rejectPromise(t);if(!this._ended){var n=this._publication||this._subscription;if(n){var r=new o.ErrorEvent("error",{error:t});n.dispatchEvent(r),this._fireEndedEventOnPublicationOrSubscription()}else i.default.warning("Neither publication nor subscription is available.")}}},{key:"_setCodecOrder",value:function(e,t){if(this._publication||this._publishPromise){if(t.audio){var n=Array.from(t.audio,function(e){return e.codec.name});e=d.reorderCodecs(e,"audio",n)}if(t.video){var r=Array.from(t.video,function(e){return e.codec.name});e=d.reorderCodecs(e,"video",r)}}else{if(t.audio&&t.audio.codecs){var i=Array.from(t.audio.codecs,function(e){return e.name});e=d.reorderCodecs(e,"audio",i)}if(t.video&&t.video.codecs){var o=Array.from(t.video.codecs,function(e){return e.name});e=d.reorderCodecs(e,"video",o)}}return e}},{key:"_setMaxBitrate",value:function(e,t){return"object"===p(t.audio)&&(e=d.setMaxBitrate(e,t.audio)),"object"===p(t.video)&&(e=d.setMaxBitrate(e,t.video)),e}},{key:"_setRtpSenderOptions",value:function(e,t){return this._isRtpEncodingParameters(t.audio)||this._isRtpEncodingParameters(t.video)?e:e=this._setMaxBitrate(e,t)}},{key:"_setRtpReceiverOptions",value:function(e,t){return this._isRtpEncodingParameters(t.video)&&l.isSafari()&&t.video.length>1&&(e=d.addLegacySimulcast(e,"video",t.video.length)),this._isRtpEncodingParameters(t.video)&&this._videoCodecs?e=d.reorderCodecs(e,"video",this._videoCodecs):this._isRtpEncodingParameters(t.audio)||this._isRtpEncodingParameters(t.video)?e:e=this._setCodecOrder(e,t)}},{key:"_onStreamEvent",value:function(e){var t,n;this._publication&&e.id===this._publication.id?t=this._publication:this._subscribedStream&&e.id===this._subscribedStream.id&&(t=this._subscription),t&&("audio.status"===e.data.field?n=a.TrackKind.AUDIO:"video.status"===e.data.field?n=a.TrackKind.VIDEO:i.default.warning("Invalid data field for stream update info."),"active"===e.data.value?t.dispatchEvent(new o.MuteEvent("unmute",{kind:n})):"inactive"===e.data.value?t.dispatchEvent(new o.MuteEvent("mute",{kind:n})):i.default.warning("Invalid data value for stream update info."))}},{key:"_isRtpEncodingParameters",value:function(e){if(!Array.isArray(e))return!1;var t=e[0];return t.codecPayloadType||t.dtx||t.active||t.ptime||t.maxFramerate||t.scaleResolutionDownBy||t.rid}},{key:"_isOwtEncodingParameters",value:function(e){return!!Array.isArray(e)&&!!e[0].codec}}])&&h(n.prototype,r),t}();n.ConferencePeerConnectionChannel=v},{"../base/event.js":3,"../base/logger.js":5,"../base/mediaformat.js":6,"../base/publication.js":8,"../base/sdputils.js":9,"../base/utils.js":11,"./error.js":14,"./subscription.js":21}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ConferenceClient=void 0;var r,i=g(e("../base/event.js")),o=e("./signaling.js"),a=(r=e("../base/logger.js"))&&r.__esModule?r:{default:r},s=e("../base/base64.js"),c=e("./error.js"),u=g(e("../base/utils.js")),l=g(e("../base/stream.js")),d=e("./participant.js"),f=e("./info.js"),p=e("./channel.js"),h=e("./mixedstream.js"),m=g(e("./streamutils.js"));function g(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}var v=function(e,t){var n=new i.OwtEvent(e,t);return n.participant=t.participant,n};n.ConferenceClient=function(e,t){Object.setPrototypeOf(this,new i.EventDispatcher),e=e||{};var n,r,g=this,y=1,b=t||new o.SioSignaling,S=new Map,C=new Map,w=new Map,T=new Map;function R(e){if("mixed"===e.type)return new h.RemoteMixedStream(e);var t,n;e.media.audio&&(t=e.media.audio.source),e.media.video&&(n=e.media.video.source);var r=new l.RemoteStream(e.id,e.info.owner,void 0,new l.StreamSourceInfo(t,n),e.info.attributes);return r.settings=m.convertToPublicationSettings(e.media),r.extraCapabilities=m.convertToSubscriptionCapabilities(e.media),r}function k(e,t){return b.send(e,t)}function _(){var t=Object.create(i.EventDispatcher);t.sendSignalingMessage=k;var n=new p.ConferencePeerConnectionChannel(e,t);return n.addEventListener("id",function(e){T.set(e.message,n)}),n}function E(){C.clear(),S.clear()}b.addEventListener("data",function(e){!function(e,t){if("soac"===e||"progress"===e){if(!T.has(t.id))return void a.default.warning("Cannot find a channel for incoming data.");T.get(t.id).onMessage(e,t)}else"stream"===e?"add"===t.status?function(e){var t=R(e);S.set(t.id,t);var n=new l.StreamEvent("streamadded",{stream:t});g.dispatchEvent(n)}(t.data):"remove"===t.status?function(e){if(S.has(e.id)){var t=S.get(e.id),n=new i.OwtEvent("ended");S.delete(t.id),t.dispatchEvent(n)}else a.default.warning("Cannot find specific remote stream.")}(t):"update"===t.status&&("audio.status"===t.data.field||"video.status"===t.data.field?T.forEach(function(n){n.onMessage(e,t)}):"activeInput"===t.data.field?function(e){if(S.has(e.id)){var t=S.get(e.id),n=new h.ActiveAudioInputChangeEvent("activeaudioinputchange",{activeAudioInputStreamId:e.data.value});t.dispatchEvent(n)}else a.default.warning("Cannot find specific remote stream.")}(t):"video.layout"===t.data.field?function(e){if(S.has(e.id)){var t=S.get(e.id),n=new h.LayoutChangeEvent("layoutchange",{layout:e.data.value});t.dispatchEvent(n)}else a.default.warning("Cannot find specific remote stream.")}(t):"."===t.data.field?function(e){if(S.has(e.id)){var t=S.get(e.id);t.settings=m.convertToPublicationSettings(e.media),t.extraCapabilities=m.convertToSubscriptionCapabilities(e.media);var n=new i.OwtEvent("updated");t.dispatchEvent(n)}else a.default.warning("Cannot find specific remote stream.")}(t.data.value):a.default.warning("Unknown stream event from MCU.")):"text"===e?function(e){var t=new i.MessageEvent("messagereceived",{message:e.message,origin:e.from,to:e.to});g.dispatchEvent(t)}(t):"participant"===e&&function(e){if("join"===e.action){e=e.data;var t=new d.Participant(e.id,e.role,e.user);C.set(e.id,t);var n=new v("participantjoined",{participant:t});g.dispatchEvent(n)}else if("leave"===e.action){var r=e.data;if(!C.has(r))return void a.default.warning("Received leave message from MCU for an unknown participant.");var o=C.get(r);C.delete(r),o.dispatchEvent(new i.OwtEvent("left"))}}(t)}(e.message.notification,e.message.data)}),b.addEventListener("disconnect",function(){E(),y=1,g.dispatchEvent(new i.OwtEvent("serverdisconnected"))}),b.addEventListener("connect",function(){E(),g.dispatchEvent(new i.OwtEvent("serverconnected"))}),Object.defineProperty(this,"info",{configurable:!1,get:function(){return r?new f.ConferenceInfo(r.id,Array.from(C,function(e){return e[1]}),Array.from(S,function(e){return e[1]}),n):null}}),this.join=function(e){return new Promise(function(t,i){var o=JSON.parse(s.Base64.decodeBase64(e)),a=!0===o.secure,l=o.host;if("string"==typeof l)if(-1===l.indexOf("http")&&(l=a?"https://"+l:"http://"+l),1===y){y=2;var p={token:e,userAgent:u.sysInfo(),protocol:"1.1"};b.connect(l,a,p).then(function(e){if(y=3,void 0!==(r=e.room).streams){var i=!0,o=!1,a=void 0;try{for(var s,c=r.streams[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;"mixed"===u.type&&(u.viewport=u.info.label),S.set(u.id,R(u))}}catch(e){o=!0,a=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw a}}}if(e.room&&void 0!==e.room.participants){var l=!0,p=!1,h=void 0;try{for(var m,g=e.room.participants[Symbol.iterator]();!(l=(m=g.next()).done);l=!0){var v=m.value;C.set(v.id,new d.Participant(v.id,v.role,v.user)),v.id===e.id&&(n=C.get(v.id))}}catch(e){p=!0,h=e}finally{try{l||null==g.return||g.return()}finally{if(p)throw h}}}t(new f.ConferenceInfo(e.room.id,Array.from(C.values()),Array.from(S.values()),n))},function(e){y=1,i(new c.ConferenceError(e))})}else i(new c.ConferenceError("connection state invalid"));else i(new c.ConferenceError("Invalid host."))})},this.publish=function(e,t,n){return e instanceof l.LocalStream?w.has(e.mediaStream.id)?Promise.reject(new c.ConferenceError("Cannot publish a published stream.")):_().publish(e,t,n):Promise.reject(new c.ConferenceError("Invalid stream."))},this.subscribe=function(e,t){return e instanceof l.RemoteStream?_().subscribe(e,t):Promise.reject(new c.ConferenceError("Invalid stream."))},this.send=function(e,t){return void 0===t&&(t="all"),k("text",{to:t,message:e})},this.leave=function(){return b.disconnect().then(function(){E(),y=1})}}},{"../base/base64.js":1,"../base/event.js":3,"../base/logger.js":5,"../base/stream.js":10,"../base/utils.js":11,"./channel.js":12,"./error.js":14,"./info.js":16,"./mixedstream.js":17,"./participant.js":18,"./signaling.js":19,"./streamutils.js":20}],14:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){var t="function"==typeof Map?new Map:void 0;return(i=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,n){return(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&o(i,n.prototype),i}).apply(null,arguments)}(e,arguments,a(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),o(r,e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.ConferenceError=void 0;var s=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,a(t).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(t,i(Error)),t}();n.ConferenceError=s},{}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"ConferenceClient",{enumerable:!0,get:function(){return r.ConferenceClient}}),Object.defineProperty(n,"SioSignaling",{enumerable:!0,get:function(){return i.SioSignaling}});var r=e("./client.js"),i=e("./signaling.js")},{"./client.js":13,"./signaling.js":19}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ConferenceInfo=void 0,n.ConferenceInfo=function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.participants=n,this.remoteStreams=r,this.self=i}},{}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LayoutChangeEvent=n.ActiveAudioInputChangeEvent=n.RemoteMixedStream=void 0;var r=a(e("../base/stream.js")),i=a(e("./streamutils.js")),o=e("../base/event.js");function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&function(e,t){(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(e,t)}var f=function(e){function t(e){var n;if(c(this,t),"mixed"!==e.type)throw new TypeError("Not a mixed stream");return(n=u(this,l(t).call(this,e.id,void 0,void 0,new r.StreamSourceInfo("mixed","mixed")))).settings=i.convertToPublicationSettings(e.media),n.extraCapabilities=new i.convertToSubscriptionCapabilities(e.media),n}return d(t,r.RemoteStream),t}();n.RemoteMixedStream=f;var p=function(e){function t(e,n){var r;return c(this,t),(r=u(this,l(t).call(this,e))).activeAudioInputStreamId=n.activeAudioInputStreamId,r}return d(t,o.OwtEvent),t}();n.ActiveAudioInputChangeEvent=p;var h=function(e){function t(e,n){var r;return c(this,t),(r=u(this,l(t).call(this,e))).layout=n.layout,r}return d(t,o.OwtEvent),t}();n.LayoutChangeEvent=h},{"../base/event.js":3,"../base/stream.js":10,"./streamutils.js":20}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Participant=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(e("../base/event.js"));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var c=function(e){function t(e,n,r){var a,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this,a=!(c=o(t).call(this))||"object"!==i(c)&&"function"!=typeof c?s(this):c,Object.defineProperty(s(s(a)),"id",{configurable:!1,writable:!1,value:e}),Object.defineProperty(s(s(a)),"role",{configurable:!1,writable:!1,value:n}),Object.defineProperty(s(s(a)),"userId",{configurable:!1,writable:!1,value:r}),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,r.EventDispatcher),t}();n.Participant=c},{"../base/event.js":3}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SioSignaling=void 0;var r,i=(r=e("../base/logger.js"))&&r.__esModule?r:{default:r},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(e("../base/event.js")),a=e("./error.js"),s=e("../base/base64.js");function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t,n,r){"ok"===e||"success"===e?n(t):"error"===e?r(t):i.default.error("MCU returns unknown ack.")}var h=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=l(this,d(t).call(this)))._socket=null,e._loggedIn=!1,e._reconnectTimes=0,e._reconnectionTicket=null,e._refreshReconnectionTicket=null,e}var n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,o.EventDispatcher),n=t,(r=[{key:"connect",value:function(e,t,n){var r=this;return new Promise(function(t,i){r._socket=io(e,{reconnection:!0,reconnectionAttempts:100,"force new connection":!0}),["participant","text","stream","progress"].forEach(function(e){r._socket.on(e,function(t){r.dispatchEvent(new o.MessageEvent("data",{message:{notification:e,data:t}}))})}),r._socket.on("reconnecting",function(){console.log("socket reconnecting..."),r._reconnectTimes++}),r._socket.on("reconnect_failed",function(){console.log("socket reconnection failed, attempt : ..."+_reconnectTimes),r._reconnectTimes>=100&&r.dispatchEvent(new o.OwtEvent("disconnect"))}),r._socket.on("connect_error",function(t){console.log("socket connection error, "+t),i("connect_error:".concat(e))}),r._socket.on("drop",function(){r._reconnectTimes=100}),r._socket.on("disconnect",function(){r.dispatchEvent(new o.OwtEvent("disconnect")),r._clearReconnectionTask(),r._reconnectTimes>=100&&(r._loggedIn=!1)}),r._socket.on("connect",function(){r.dispatchEvent(new o.OwtEvent("connect"))}),r._socket.emit("login",n,function(e,n){"ok"===e&&(r._loggedIn=!0,r._onReconnectionTicket(n.reconnectionTicket),r._socket.on("connect",function(){r._socket.emit("relogin",r._reconnectionTicket,function(e,t){"ok"===e?(r._reconnectTimes=0,r._onReconnectionTicket(t)):r.dispatchEvent(new o.OwtEvent("disconnect"))})})),p(e,n,t,i)})})}},{key:"disconnect",value:function(){var e=this;return!this._socket||this._socket.disconnected?Promise.reject(new a.ConferenceError("Portal is not connected.")):new Promise(function(t,n){e._socket.emit("logout",function(r,i){e._reconnectTimes=100,e._socket.disconnect(),p(r,i,t,n)})})}},{key:"send",value:function(e,t){var n=this;return new Promise(function(r,i){n._socket.emit(e,t,function(e,t){p(e,t,r,i)})})}},{key:"_onReconnectionTicket",value:function(e){var t=this;this._reconnectionTicket=e;var n=JSON.parse(s.Base64.decodeBase64(e)),r=Date.now();if(console.log("Inside reconnection ticket 1 %%%%%, ticket : "+e),n.notAfter<=r-1e4)return i.default.warning("Reconnection ticket expires too soon."),void console.log("Inside reconnection ticket 2 : ticket expires soon, so returning %%%%%");var o=n.notAfter-r-6e4;o<0&&(o=n.notAfter-r-1e4),console.log("Inside reconnection ticket 3, refresh after : "+o),this._clearReconnectionTask(),console.log("cleared reconnection task"),this._refreshReconnectionTicket=setTimeout(function(){console.log("firing refreshReconnectionTicket"),t._socket.emit("refreshReconnectionTicket",function(e,n){console.log("fired refreshReconnectionTicket, status : "+e),console.log("fired refreshReconnectionTicket, data : "+n),"ok"===e?t._onReconnectionTicket(n):i.default.warning("Failed to refresh reconnection ticket.")})},o)}},{key:"_clearReconnectionTask",value:function(){clearTimeout(this._refreshReconnectionTicket),this._refreshReconnectionTicket=null}}])&&u(n.prototype,r),t}();n.SioSignaling=h},{"../base/base64.js":1,"../base/event.js":3,"../base/logger.js":5,"./error.js":14}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.convertToPublicationSettings=function(e){var t,n,a,s,c,u,l,d=[],f=[];if(e.audio&&(e.audio.format&&(t=new o.AudioCodecParameters(e.audio.format.codec,e.audio.format.channelNum,e.audio.format.sampleRate)),d.push(new r.AudioPublicationSettings(t))),e.video){var p=!0,h=!1,m=void 0;try{for(var g,v=e.video.original[Symbol.iterator]();!(p=(g=v.next()).done);p=!0){var y=g.value;y.format&&(n=new o.VideoCodecParameters(y.format.codec,y.format.profile)),y.parameters&&(y.parameters.resolution&&(a=new i.Resolution(y.parameters.resolution.width,y.parameters.resolution.height)),s=y.parameters.framerate,c=1e3*y.parameters.bitrate,u=y.parameters.keyFrameInterval),y.simulcastRid&&(l=y.simulcastRid),f.push(new r.VideoPublicationSettings(n,a,s,c,u,l))}}catch(e){h=!0,m=e}finally{try{p||null==v.return||v.return()}finally{if(h)throw m}}}return new r.PublicationSettings(d,f)},n.convertToSubscriptionCapabilities=function(e){var t,n;if(e.audio){var r=[];if(e.audio&&e.audio.optional&&e.audio.optional.format){var s=!0,l=!1,d=void 0;try{for(var f,p=e.audio.optional.format[Symbol.iterator]();!(s=(f=p.next()).done);s=!0){var h=f.value,m=new o.AudioCodecParameters(h.codec,h.channelNum,h.sampleRate);r.push(m)}}catch(e){l=!0,d=e}finally{try{s||null==p.return||p.return()}finally{if(l)throw d}}}r.sort(),t=new a.AudioSubscriptionCapabilities(r)}if(e.video){var g=[];if(e.video&&e.video.optional&&e.video.optional.format){var v=!0,y=!1,b=void 0;try{for(var S,C=e.video.optional.format[Symbol.iterator]();!(v=(S=C.next()).done);v=!0){var w=S.value,T=new o.VideoCodecParameters(w.codec,w.profile);g.push(T)}}catch(e){y=!0,b=e}finally{try{v||null==C.return||C.return()}finally{if(y)throw b}}}g.sort();var R=Array.from(e.video.optional.parameters.resolution,function(e){return new i.Resolution(e.width,e.height)});R.sort(u);var k=Array.from(e.video.optional.parameters.bitrate,function(e){return function(e){return"string"==typeof e&&e.startsWith("x")?Number.parseFloat(e.replace(/^x/,"")):(L.Logger.warning("Invalid bitrate multiplier input."),0)}(e)});k.push(1),k.sort(c);var _=JSON.parse(JSON.stringify(e.video.optional.parameters.framerate));_.sort(c);var E=JSON.parse(JSON.stringify(e.video.optional.parameters.keyFrameInterval));E.sort(c),n=new a.VideoSubscriptionCapabilities(g,R,_,k,E)}return new a.SubscriptionCapabilities(t,n)};var r=s(e("../base/publication.js")),i=s(e("../base/mediaformat.js")),o=s(e("../base/codec.js")),a=s(e("./subscription.js"));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function c(e,t){return e-t}function u(e,t){return e.width!==t.width?e.width-t.width:e.height-t.height}},{"../base/codec.js":2,"../base/mediaformat.js":6,"../base/publication.js":8,"./subscription.js":21}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Subscription=n.SubscriptionUpdateOptions=n.VideoSubscriptionUpdateOptions=n.SubscribeOptions=n.VideoSubscriptionConstraints=n.AudioSubscriptionConstraints=n.SubscriptionCapabilities=n.VideoSubscriptionCapabilities=n.AudioSubscriptionCapabilities=void 0,i(e("../base/mediaformat.js")),i(e("../base/codec.js"));var r=e("../base/event.js");function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.AudioSubscriptionCapabilities=function e(t){u(this,e),this.codecs=t},n.VideoSubscriptionCapabilities=function e(t,n,r,i,o){u(this,e),this.codecs=t,this.resolutions=n,this.frameRates=r,this.bitrateMultipliers=i,this.keyFrameIntervals=o},n.SubscriptionCapabilities=function e(t,n){u(this,e),this.audio=t,this.video=n},n.AudioSubscriptionConstraints=function e(t){u(this,e),this.codecs=t},n.VideoSubscriptionConstraints=function e(t,n,r,i,o,a){u(this,e),this.codecs=t,this.resolution=n,this.frameRate=r,this.bitrateMultiplier=i,this.keyFrameInterval=o,this.rid=a},n.SubscribeOptions=function e(t,n){u(this,e),this.audio=t,this.video=n},n.VideoSubscriptionUpdateOptions=function e(){u(this,e),this.resolution=void 0,this.frameRate=void 0,this.bitrateMultipliers=void 0,this.keyFrameInterval=void 0},n.SubscriptionUpdateOptions=function e(){u(this,e),this.video=void 0};var l=function(e){function t(e,n,r,i,s,l){var d,f;if(u(this,t),this,d=!(f=a(t).call(this))||"object"!==o(f)&&"function"!=typeof f?c(this):f,!e)throw new TypeError("ID cannot be null or undefined.");return Object.defineProperty(c(c(d)),"id",{configurable:!1,writable:!1,value:e}),d.stop=n,d.getStats=r,d.mute=i,d.unmute=s,d.applyOptions=l,d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,r.EventDispatcher),t}();n.Subscription=l},{"../base/codec.js":2,"../base/event.js":3,"../base/mediaformat.js":6}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Conference=n.P2P=n.Base=void 0;var r=a(e("./base/export.js")),i=a(e("./p2p/export.js")),o=a(e("./conference/export.js"));function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}var s=r;n.Base=s;var c=i;n.P2P=c;var u=o;n.Conference=u},{"./base/export.js":4,"./conference/export.js":15,"./p2p/export.js":24}],23:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){var t="function"==typeof Map?new Map:void 0;return(o=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,n){return(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&a(i,n.prototype),i}).apply(null,arguments)}(e,arguments,s(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a(r,e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.getErrorByCode=function(e){return{2100:c.P2P_CONN_SERVER_UNKNOWN,2101:c.P2P_CONN_SERVER_UNAVAILABLE,2102:c.P2P_CONN_SERVER_BUSY,2103:c.P2P_CONN_SERVER_NOT_SUPPORTED,2110:c.P2P_CONN_CLIENT_UNKNOWN,2111:c.P2P_CONN_CLIENT_NOT_INITIALIZED,2120:c.P2P_CONN_AUTH_UNKNOWN,2121:c.P2P_CONN_AUTH_FAILED,2201:c.P2P_MESSAGING_TARGET_UNREACHABLE,2400:c.P2P_CLIENT_UNKNOWN,2401:c.P2P_CLIENT_UNSUPPORTED_METHOD,2402:c.P2P_CLIENT_ILLEGAL_ARGUMENT,2403:c.P2P_CLIENT_INVALID_STATE,2404:c.P2P_CLIENT_NOT_ALLOWED,2500:c.P2P_WEBRTC_UNKNOWN,2501:c.P2P_WEBRTC_SDP}[e]},n.P2PError=n.errors=void 0;var c={P2P_CONN_SERVER_UNKNOWN:{code:2100,message:"Server unknown error."},P2P_CONN_SERVER_UNAVAILABLE:{code:2101,message:"Server is unavaliable."},P2P_CONN_SERVER_BUSY:{code:2102,message:"Server is too busy."},P2P_CONN_SERVER_NOT_SUPPORTED:{code:2103,message:"Method has not been supported by server."},P2P_CONN_CLIENT_UNKNOWN:{code:2110,message:"Client unknown error."},P2P_CONN_CLIENT_NOT_INITIALIZED:{code:2111,message:"Connection is not initialized."},P2P_CONN_AUTH_UNKNOWN:{code:2120,message:"Authentication unknown error."},P2P_CONN_AUTH_FAILED:{code:2121,message:"Wrong username or token."},P2P_MESSAGING_TARGET_UNREACHABLE:{code:2201,message:"Remote user cannot be reached."},P2P_CLIENT_DENIED:{code:2202,message:"User is denied."},P2P_CLIENT_UNKNOWN:{code:2400,message:"Unknown errors."},P2P_CLIENT_UNSUPPORTED_METHOD:{code:2401,message:"This method is unsupported in current browser."},P2P_CLIENT_ILLEGAL_ARGUMENT:{code:2402,message:"Illegal argument."},P2P_CLIENT_INVALID_STATE:{code:2403,message:"Invalid peer state."},P2P_CLIENT_NOT_ALLOWED:{code:2404,message:"Remote user is not allowed."},P2P_WEBRTC_UNKNOWN:{code:2500,message:"WebRTC error."},P2P_WEBRTC_SDP:{code:2502,message:"SDP error."}};n.errors=c;var u=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=i(this,s(t).call(this,n))).code="number"==typeof e?e:e.code,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,o(Error)),t}();n.P2PError=u},{}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"P2PClient",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(n,"P2PError",{enumerable:!0,get:function(){return o.P2PError}});var r,i=(r=e("./p2pclient.js"))&&r.__esModule?r:{default:r},o=e("./error.js")},{"./error.js":23,"./p2pclient.js":25}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=c(e("../base/logger.js")),i=e("../base/event.js"),o=(s(e("../base/utils.js")),s(e("./error.js"))),a=c(e("./peerconnection-channel.js"));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function c(e){return e&&e.__esModule?e:{default:e}}n.default=function(e,t){Object.setPrototypeOf(this,new i.EventDispatcher);var n,s=e,c=t,u=new Map,l=this,d=1;c.onMessage=function(e,t){r.default.debug("Received signaling message from "+e+": "+t);var n=JSON.parse(t);"chat-closed"!==n.type?l.allowedRemoteIds.indexOf(e)>=0?p(e).onMessage(n):f(e,"chat-closed",o.errors.P2P_CLIENT_DENIED):u.has(e)&&(p(e).onMessage(n),u.delete(e))},c.onServerDisconnected=function(){d=1,l.dispatchEvent(new i.OwtEvent("serverdisconnected"))},this.allowedRemoteIds=[],this.connect=function(e){return 1!==d?(r.default.warning("Invalid connection state: "+d),Promise.reject(new o.P2PError(o.errors.P2P_CLIENT_INVALID_STATE))):(d=2,new Promise(function(t,r){c.connect(e).then(function(e){d=3,t(n=e)},function(e){r(new o.P2PError(o.getErrorByCode(e)))})}))},this.disconnect=function(){1!=d&&(u.forEach(function(e){e.stop()}),u.clear(),c.disconnect())},this.publish=function(e,t){return 3!==d?Promise.reject(new o.P2PError(o.errors.P2P_CLIENT_INVALID_STATE,"P2P Client is not connected to signaling channel.")):this.allowedRemoteIds.indexOf(e)<0?Promise.reject(new o.P2PError(o.errors.P2P_CLIENT_NOT_ALLOWED)):Promise.resolve(p(e).publish(t))},this.send=function(e,t){return 3!==d?Promise.reject(new o.P2PError(o.errors.P2P_CLIENT_INVALID_STATE,"P2P Client is not connected to signaling channel.")):this.allowedRemoteIds.indexOf(e)<0?Promise.reject(new o.P2PError(o.errors.P2P_CLIENT_NOT_ALLOWED)):Promise.resolve(p(e).send(t))},this.stop=function(e){u.has(e)?(u.get(e).stop(),u.delete(e)):r.default.warning("No PeerConnection between current endpoint and specific remote endpoint.")},this.getStats=function(e){return u.has(e)?u.get(e).getStats():Promise.reject(new o.P2PError(o.errors.P2P_CLIENT_INVALID_STATE,"No PeerConnection between current endpoint and specific remote endpoint."))};var f=function(e,t,n){var r={type:t};return n&&(r.data=n),c.send(e,JSON.stringify(r)).catch(function(e){if("number"==typeof e)throw o.getErrorByCode(e)})},p=function(e){if(!u.has(e)){var t=Object.create(i.EventDispatcher);t.sendSignalingMessage=f;var r=new a.default(s,n,e,t);r.addEventListener("streamadded",function(e){l.dispatchEvent(e)}),r.addEventListener("messagereceived",function(e){l.dispatchEvent(e)}),r.addEventListener("ended",function(){u.delete(e)}),u.set(e,r)}return u.get(e)}}},{"../base/event.js":3,"../base/logger.js":5,"../base/utils.js":11,"./error.js":23,"./peerconnection-channel.js":26}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.P2PPeerConnectionChannelEvent=void 0;var r,i=(r=e("../base/logger.js"))&&r.__esModule?r:{default:r},o=e("../base/event.js"),a=e("../base/publication.js"),s=d(e("../base/utils.js")),c=d(e("./error.js")),u=d(e("../base/stream.js")),l=d(e("../base/sdputils.js"));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function y(e){var t="function"==typeof Map?new Map:void 0;return(y=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,n){return(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&b(i,n.prototype),i}).apply(null,arguments)}(e,arguments,S(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),b(r,e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var C=function(e){function t(e){var n;return m(this,t),(n=g(this,S(t).call(this,e))).stream=e.stream,n}return v(t,y(Event)),t}();n.P2PPeerConnectionChannelEvent=C;var w="message",T="chat-closed",R="chat-track-sources",k="chat-stream-info",_="chat-signal",E="chat-tracks-added",P="chat-tracks-removed",I="chat-data-received",M="chat-ua",D=s.sysInfo(),A=function(e){function t(e,n,r,i){var o;return m(this,t),(o=g(this,S(t).call(this)))._config=e,o._localId=n,o._remoteId=r,o._signaling=i,o._pc=null,o._publishedStreams=new Map,o._pendingStreams=[],o._publishingStreams=[],o._pendingUnpublishStreams=[],o._remoteStreamInfo=new Map,o._remoteStreams=[],o._remoteTrackSourceInfo=new Map,o._publishPromises=new Map,o._unpublishPromises=new Map,o._publishingStreamTracks=new Map,o._publishedStreamTracks=new Map,o._isNegotiationNeeded=!1,o._remoteSideSupportsRemoveStream=!0,o._remoteSideSupportsPlanB=!0,o._remoteSideSupportsUnifiedPlan=!0,o._remoteIceCandidates=[],o._dataChannels=new Map,o._pendingMessages=[],o._dataSeq=1,o._sendDataPromises=new Map,o._addedTrackIds=[],o._isCaller=!0,o._infoSent=!1,o._disposed=!1,o._createPeerConnection(),o}var n,r;return v(t,o.EventDispatcher),n=t,(r=[{key:"publish",value:function(e){var t=this;return e instanceof u.LocalStream?this._publishedStreams.has(e)?Promise.reject(new c.P2PError(c.errors.P2P_CLIENT_ILLEGAL_ARGUMENT,"Duplicated stream.")):this._areAllTracksEnded(e.mediaStream)?Promise.reject(new c.P2PError(c.errors.P2P_CLIENT_INVALID_STATE,"All tracks are ended.")):Promise.all([this._sendClosedMsgIfNecessary(),this._sendSysInfoIfNecessary(),this._sendStreamInfo(e)]).then(function(){return new Promise(function(n,r){var i=!0,o=!1,a=void 0;try{for(var s,c=e.mediaStream.getTracks()[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;t._pc.addTrack(u,e.mediaStream)}}catch(e){o=!0,a=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw a}}t._onNegotiationneeded(),t._publishingStreams.push(e);var l=Array.from(e.mediaStream.getTracks(),function(e){return e.id});t._publishingStreamTracks.set(e.mediaStream.id,l),t._publishPromises.set(e.mediaStream.id,{resolve:n,reject:r})})}):Promise.reject(new TypeError("Invalid stream."))}},{key:"send",value:function(e){var t=this;if("string"!=typeof e)return Promise.reject(new TypeError("Invalid message."));var n={id:this._dataSeq++,data:e},r=new Promise(function(e,r){t._sendDataPromises.set(n.id,{resolve:e,reject:r})});return this._dataChannels.has(w)||this._createDataChannel(w),this._sendClosedMsgIfNecessary().catch(function(e){i.default.debug("Failed to send closed message."+e.message)}),this._sendSysInfoIfNecessary().catch(function(e){i.default.debug("Failed to send sysInfo."+e.message)}),"open"===this._dataChannels.get(w).readyState?this._dataChannels.get(w).send(JSON.stringify(n)):this._pendingMessages.push(n),r}},{key:"stop",value:function(){this._stop(void 0,!0)}},{key:"getStats",value:function(e){var t=this;if(this._pc){if(void 0===e)return this._pc.getStats();var n=[];return Promise.all([e.getTracks().forEach(function(e){t._getStats(e,n)})]).then(function(){return new Promise(function(e,t){e(n)})})}return Promise.reject(new c.P2PError(c.errors.P2P_CLIENT_INVALID_STATE))}},{key:"_getStats",value:function(e,t){return this._pc.getStats(e).then(function(e){t.push(e)})}},{key:"onMessage",value:function(e){this._SignalingMesssageHandler(e)}},{key:"_sendSdp",value:function(e){return this._signaling.sendSignalingMessage(this._remoteId,_,e)}},{key:"_sendSignalingMessage",value:function(e,t){return this._signaling.sendSignalingMessage(this._remoteId,e,t)}},{key:"_SignalingMesssageHandler",value:function(e){switch(i.default.debug("Channel received message: "+e),e.type){case M:this._handleRemoteCapability(e.data),this._sendSysInfoIfNecessary();break;case R:this._trackSourcesHandler(e.data);break;case k:this._streamInfoHandler(e.data);break;case _:this._sdpHandler(e.data);break;case E:this._tracksAddedHandler(e.data);break;case P:this._tracksRemovedHandler(e.data);break;case I:this._dataReceivedHandler(e.data);break;case T:this._chatClosedHandler(e.data);break;default:i.default.error("Invalid signaling message received. Type: "+e.type)}}},{key:"_tracksAddedHandler",value:function(e){var t=this,n=!0,r=!1,s=void 0;try{for(var u,l=function(){var e=u.value;t._publishingStreamTracks.forEach(function(n,r){for(var s=0;s<n.length;s++)n[s]===e&&(t._publishedStreamTracks.has(r)||t._publishedStreamTracks.set(r,[]),t._publishedStreamTracks.get(r).push(n[s]),n.splice(s,1)),0!=n.length||function(){if(!t._publishPromises.has(r))return i.default.warning("Cannot find the promise for publishing "+r),"continue";var n=t._publishingStreams.findIndex(function(e){return e.mediaStream.id==r}),s=t._publishingStreams[n];t._publishingStreams.splice(n,1);var u=new a.Publication(e,function(){t._unpublish(s).then(function(){u.dispatchEvent(new o.OwtEvent("ended"))},function(e){i.default.debug("Something wrong happened during stopping a publication. "+e.message)})},function(){return s&&s.mediaStream?t.getStats(s.mediaStream):Promise.reject(new c.P2PError(c.errors.P2P_CLIENT_INVALID_STATE,"Publication is not available."))});t._publishedStreams.set(s,u),t._publishPromises.get(r).resolve(u),t._publishPromises.delete(r)}()})},d=e[Symbol.iterator]();!(n=(u=d.next()).done);n=!0)l()}catch(e){r=!0,s=e}finally{try{n||null==d.return||d.return()}finally{if(r)throw s}}}},{key:"_tracksRemovedHandler",value:function(e){var t=this,n=!0,r=!1,i=void 0;try{for(var o,a=function(){var e=o.value;t._publishedStreamTracks.forEach(function(t,n){for(var r=0;r<t.length;r++)t[r]===e&&t.splice(r,1)})},s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0)a()}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}}},{key:"_dataReceivedHandler",value:function(e){this._sendDataPromises.has(e)?this._sendDataPromises.get(e).resolve():i.default.warning("Received unknown data received message. ID: "+e)}},{key:"_sdpHandler",value:function(e){"offer"===e.type?this._onOffer(e):"answer"===e.type?this._onAnswer(e):"candidates"===e.type&&this._onRemoteIceCandidate(e)}},{key:"_trackSourcesHandler",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this._remoteTrackSourceInfo.set(a.id,a.source)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"_streamInfoHandler",value:function(e){e?this._remoteStreamInfo.set(e.id,{source:e.source,attributes:e.attributes,stream:null,mediaStream:null,trackIds:e.tracks}):i.default.warning("Unexpected stream info.")}},{key:"_chatClosedHandler",value:function(e){this._disposed=!0,this._stop(e,!1)}},{key:"_onOffer",value:function(e){var t=this;i.default.debug("About to set remote description. Signaling state: "+this._pc.signalingState),e.sdp=this._setRtpSenderOptions(e.sdp,this._config),s.isFirefox()&&(e.sdp=this._setCodecOrder(e.sdp));var n=new RTCSessionDescription(e);this._pc.setRemoteDescription(n).then(function(){t._createAndSendAnswer()},function(e){i.default.debug("Set remote description failed. Message: "+e.message),t._stop(e,!0)})}},{key:"_onAnswer",value:function(e){var t=this;i.default.debug("About to set remote description. Signaling state: "+this._pc.signalingState),e.sdp=this._setRtpSenderOptions(e.sdp,this._config);var n=new RTCSessionDescription(e);this._pc.setRemoteDescription(new RTCSessionDescription(n)).then(function(){i.default.debug("Set remote descripiton successfully."),t._drainPendingMessages()},function(e){i.default.debug("Set remote description failed. Message: "+e.message),t._stop(e,!0)})}},{key:"_onLocalIceCandidate",value:function(e){e.candidate?this._sendSdp({type:"candidates",candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex}).catch(function(e){i.default.warning("Failed to send candidate.")}):i.default.debug("Empty candidate.")}},{key:"_onRemoteTrackAdded",value:function(e){i.default.debug("Remote track added.");var t=!0,n=!1,r=void 0;try{for(var o,a=e.streams[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var s=o.value;if(!this._remoteStreamInfo.has(s.id))return void i.default.warning("Missing stream info.");this._remoteStreamInfo.get(s.id).stream||this._setStreamToRemoteStreamInfo(s)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}"connected"===this._pc.iceConnectionState||"completed"===this._pc.iceConnectionState?this._checkIceConnectionStateAndFireEvent():this._addedTrackIds.concat(e.track.id)}},{key:"_onRemoteStreamAdded",value:function(e){if(i.default.debug("Remote stream added."),this._remoteStreamInfo.has(e.stream.id)){"connected"===this._pc.iceConnectionState||"completed"===this._pc.iceConnectionState?this._sendSignalingMessage(E,this._remoteStreamInfo.get(e.stream.id).trackIds):this._addedTrackIds=this._addedTrackIds.concat(this._remoteStreamInfo.get(e.stream.id).trackIds);var t=this._remoteStreamInfo.get(e.stream.id).source.audio,n=this._remoteStreamInfo.get(e.stream.id).source.video,r=new u.StreamSourceInfo(t,n);s.isSafari()&&(r.audio||e.stream.getAudioTracks().forEach(function(t){e.stream.removeTrack(t)}),r.video||e.stream.getVideoTracks().forEach(function(t){e.stream.removeTrack(t)}));var o=this._remoteStreamInfo.get(e.stream.id).attributes,a=new u.RemoteStream(void 0,this._remoteId,e.stream,r,o);if(a){this._remoteStreams.push(a);var c=new u.StreamEvent("streamadded",{stream:a});this.dispatchEvent(c)}}else i.default.warning("Cannot find source info for stream "+e.stream.id)}},{key:"_onRemoteStreamRemoved",value:function(e){i.default.debug("Remote stream removed.");var t=this._remoteStreams.findIndex(function(t){return t.mediaStream.id===e.stream.id});if(-1!==t){var n=this._remoteStreams[t];this._streamRemoved(n),this._remoteStreams.splice(t,1)}}},{key:"_onNegotiationneeded",value:function(){i.default.debug("On negotiation needed."),"stable"===this._pc.signalingState?this._doNegotiate():this._isNegotiationNeeded=!0}},{key:"_onRemoteIceCandidate",value:function(e){var t=new RTCIceCandidate({candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex});this._pc.remoteDescription&&""!==this._pc.remoteDescription.sdp?(i.default.debug("Add remote ice candidates."),this._pc.addIceCandidate(t).catch(function(e){i.default.warning("Error processing ICE candidate: "+e)})):(i.default.debug("Cache remote ice candidates."),this._remoteIceCandidates.push(t))}},{key:"_onSignalingStateChange",value:function(e){i.default.debug("Signaling state changed: "+this._pc.signalingState),"closed"===this._pc.signalingState||("stable"===this._pc.signalingState?(this._negotiating=!1,this._isNegotiationNeeded?this._onNegotiationneeded():(this._drainPendingStreams(),this._drainPendingMessages())):"have-remote-offer"===this._pc.signalingState&&this._drainPendingRemoteIceCandidates())}},{key:"_onIceConnectionStateChange",value:function(e){if("closed"===e.currentTarget.iceConnectionState||"failed"===e.currentTarget.iceConnectionState){var t=new c.P2PError(c.errors.P2P_WEBRTC_UNKNOWN,"ICE connection failed or closed.");this._stop(t,!0)}else"connected"!==e.currentTarget.iceConnectionState&&"completed"!==e.currentTarget.iceConnectionState||(this._sendSignalingMessage(E,this._addedTrackIds),this._addedTrackIds=[],this._checkIceConnectionStateAndFireEvent())}},{key:"_onDataChannelMessage",value:function(e){var t=JSON.parse(e.data);i.default.debug("Data channel message received: "+t.data),this._sendSignalingMessage(I,t.id);var n=new o.MessageEvent("messagereceived",{message:t.data,origin:this._remoteId});this.dispatchEvent(n)}},{key:"_onDataChannelOpen",value:function(e){i.default.debug("Data Channel is opened."),e.target.label===w&&(i.default.debug("Data channel for messages is opened."),this._drainPendingMessages())}},{key:"_onDataChannelClose",value:function(e){i.default.debug("Data Channel is closed.")}},{key:"_streamRemoved",value:function(e){this._remoteStreamInfo.has(e.mediaStream.id)||i.default.warning("Cannot find stream info."),this._sendSignalingMessage(P,this._remoteStreamInfo.get(e.mediaStream.id).trackIds);var t=new o.OwtEvent("ended");e.dispatchEvent(t)}},{key:"_isUnifiedPlan",value:function(){if(s.isFirefox())return!0;var e=new RTCPeerConnection({sdpSemantics:"unified-plan"});return e.getConfiguration()&&"plan-b"===e.getConfiguration().sdpSemantics}},{key:"_createPeerConnection",value:function(){var e=this,t=this._config.rtcConfiguration||{};s.isChrome()&&(t.sdpSemantics="unified-plan"),this._pc=new RTCPeerConnection(t),"function"==typeof this._pc.addTransceiver&&s.isSafari()&&(this._pc.addTransceiver("audio"),this._pc.addTransceiver("video")),this._isUnifiedPlan()?this._pc.ontrack=function(t){e._onRemoteTrackAdded.apply(e,[t])}:(this._pc.onaddstream=function(t){e._onRemoteStreamAdded.apply(e,[t])},this._pc.onremovestream=function(t){e._onRemoteStreamRemoved.apply(e,[t])}),this._pc.onicecandidate=function(t){e._onLocalIceCandidate.apply(e,[t])},this._pc.onsignalingstatechange=function(t){e._onSignalingStateChange.apply(e,[t])},this._pc.ondatachannel=function(t){i.default.debug("On data channel."),e._dataChannels.has(t.channel.label)||(e._dataChannels.set(t.channel.label,t.channel),i.default.debug("Save remote created data channel.")),e._bindEventsToDataChannel(t.channel)},this._pc.oniceconnectionstatechange=function(t){e._onIceConnectionStateChange.apply(e,[t])}}},{key:"_drainPendingStreams",value:function(){var e=!1;if(i.default.debug("Draining pending streams."),this._pc&&"stable"===this._pc.signalingState){i.default.debug("Peer connection is ready for draining pending streams.");for(var t=0;t<this._pendingStreams.length;t++){var n=this._pendingStreams[t];if(this._pendingStreams.shift(),n.mediaStream){var r=!0,o=!1,a=void 0;try{for(var s,c=n.mediaStream.getTracks()[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var u=s.value;this._pc.addTrack(u,n.mediaStream),e=!0}}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}i.default.debug("Added stream to peer connection."),this._publishingStreams.push(n)}}this._pendingStreams.length=0;for(var l=0;l<this._pendingUnpublishStreams.length;l++)this._pendingUnpublishStreams[l].mediaStream&&(this._pc.removeStream(this._pendingUnpublishStreams[l].mediaStream),e=!0,this._unpublishPromises.get(this._pendingUnpublishStreams[l].mediaStream.id).resolve(),this._publishedStreams.delete(this._pendingUnpublishStreams[l]),i.default.debug("Remove stream."));this._pendingUnpublishStreams.length=0}e&&this._onNegotiationneeded()}},{key:"_drainPendingRemoteIceCandidates",value:function(){for(var e=0;e<this._remoteIceCandidates.length;e++)i.default.debug("Add candidate"),this._pc.addIceCandidate(this._remoteIceCandidates[e]).catch(function(e){i.default.warning("Error processing ICE candidate: "+e)});this._remoteIceCandidates.length=0}},{key:"_drainPendingMessages",value:function(){if(i.default.debug("Draining pending messages."),0!=this._pendingMessages.length){var e=this._dataChannels.get(w);if(e&&"open"===e.readyState){for(var t=0;t<this._pendingMessages.length;t++)i.default.debug("Sending message via data channel: "+this._pendingMessages[t]),e.send(JSON.stringify(this._pendingMessages[t]));this._pendingMessages.length=0}else this._pc&&!e&&this._createDataChannel(w)}}},{key:"_sendStreamInfo",value:function(e){if(!e||!e.mediaStream)return new c.P2PError(c.errors.P2P_CLIENT_ILLEGAL_ARGUMENT);var t=[];return e.mediaStream.getTracks().map(function(n){t.push({id:n.id,source:e.source[n.kind]})}),Promise.all([this._sendSignalingMessage(R,t),this._sendSignalingMessage(k,{id:e.mediaStream.id,attributes:e.attributes,tracks:Array.from(t,function(e){return e.id}),source:e.source})])}},{key:"_sendSysInfoIfNecessary",value:function(){return this._infoSent?Promise.resolve():(this._infoSent=!0,this._sendSignalingMessage(M,D))}},{key:"_sendClosedMsgIfNecessary",value:function(){return null===this._pc.remoteDescription||""===this._pc.remoteDescription.sdp?this._sendSignalingMessage(T):Promise.resolve()}},{key:"_handleRemoteCapability",value:function(e){e.sdk&&e.sdk&&"JavaScript"===e.sdk.type&&e.runtime&&"Firefox"===e.runtime.name?(this._remoteSideSupportsRemoveStream=!1,this._remoteSideSupportsPlanB=!1,this._remoteSideSupportsUnifiedPlan=!0):(this._remoteSideSupportsRemoveStream=!0,this._remoteSideSupportsPlanB=!0,this._remoteSideSupportsUnifiedPlan=!1)}},{key:"_doNegotiate",value:function(){this._createAndSendOffer()}},{key:"_setCodecOrder",value:function(e){if(this._config.audioEncodings){var t=Array.from(this._config.audioEncodings,function(e){return e.codec.name});e=l.reorderCodecs(e,"audio",t)}if(this._config.videoEncodings){var n=Array.from(this._config.videoEncodings,function(e){return e.codec.name});e=l.reorderCodecs(e,"video",n)}return e}},{key:"_setMaxBitrate",value:function(e,t){return"object"===p(t.audioEncodings)&&(e=l.setMaxBitrate(e,t.audioEncodings)),"object"===p(t.videoEncodings)&&(e=l.setMaxBitrate(e,t.videoEncodings)),e}},{key:"_setRtpSenderOptions",value:function(e,t){return this._setMaxBitrate(e,t)}},{key:"_setRtpReceiverOptions",value:function(e){return this._setCodecOrder(e)}},{key:"_createAndSendOffer",value:function(){var e,t=this;this._pc?(this._isNegotiationNeeded=!1,this._isCaller=!0,this._pc.createOffer().then(function(n){if(n.sdp=t._setRtpReceiverOptions(n.sdp),e=n,"stable"===t._pc.signalingState)return t._pc.setLocalDescription(n).then(function(){return t._sendSdp(e)})}).catch(function(e){i.default.error(e.message+" Please check your codec settings.");var n=new c.P2PError(c.errors.P2P_WEBRTC_SDP,e.message);t._stop(n,!0)})):i.default.error("Peer connection have not been created.")}},{key:"_createAndSendAnswer",value:function(){var e,t=this;this._drainPendingStreams(),this._isNegotiationNeeded=!1,this._isCaller=!1,this._pc.createAnswer().then(function(n){return n.sdp=t._setRtpReceiverOptions(n.sdp),e=n,t._logCurrentAndPendingLocalDescription(),t._pc.setLocalDescription(n)}).then(function(){return t._sendSdp(e)}).catch(function(e){i.default.error(e.message+" Please check your codec settings.");var n=new c.P2PError(c.errors.P2P_WEBRTC_SDP,e.message);t._stop(n,!0)})}},{key:"_logCurrentAndPendingLocalDescription",value:function(){i.default.info("Current description: "+this._pc.currentLocalDescription),i.default.info("Pending description: "+this._pc.pendingLocalDescription)}},{key:"_getAndDeleteTrackSourceInfo",value:function(e){if(e.length>0){var t=e[0].id;if(this._remoteTrackSourceInfo.has(t)){var n=this._remoteTrackSourceInfo.get(t);return this._remoteTrackSourceInfo.delete(t),n}i.default.warning("Cannot find source info for "+t)}}},{key:"_unpublish",value:function(e){var t=this;return navigator.mozGetUserMedia||!this._remoteSideSupportsRemoveStream?(i.default.error("Stopping a publication is not supported on Firefox. Please use P2PClient.stop() to stop the connection with remote endpoint."),Promise.reject(new c.P2PError(c.errors.P2P_CLIENT_UNSUPPORTED_METHOD))):this._publishedStreams.has(e)?(this._pendingUnpublishStreams.push(e),new Promise(function(n,r){t._unpublishPromises.set(e.mediaStream.id,{resolve:n,reject:r}),t._drainPendingStreams()})):Promise.reject(new c.P2PError(c.errors.P2P_CLIENT_ILLEGAL_ARGUMENT))}},{key:"_createDataChannel",value:function(e){if(this._dataChannels.has(e))i.default.warning("Data channel labeled "+e+" already exists.");else if(this._pc){i.default.debug("Create data channel.");var t=this._pc.createDataChannel(e);this._bindEventsToDataChannel(t),this._dataChannels.set(w,t),this._onNegotiationneeded()}else i.default.debug("PeerConnection is not available before creating DataChannel.")}},{key:"_bindEventsToDataChannel",value:function(e){var t=this;e.onmessage=function(e){t._onDataChannelMessage.apply(t,[e])},e.onopen=function(e){t._onDataChannelOpen.apply(t,[e])},e.onclose=function(e){t._onDataChannelClose.apply(t,[e])},e.onerror=function(e){i.default.debug("Data Channel Error:",error)}}},{key:"_getStreamByTrack",value:function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var o,a=this._remoteStreamInfo[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=f(o.value,2),c=(s[0],s[1]);if(c.stream&&c.stream.mediaStream){var u=!0,l=!1,d=void 0;try{for(var p,h=c.stream.mediaStream.getTracks()[Symbol.iterator]();!(u=(p=h.next()).done);u=!0)e===p.value&&t.push(c.stream.mediaStream)}catch(e){l=!0,d=e}finally{try{u||null==h.return||h.return()}finally{if(l)throw d}}}}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return t}},{key:"_areAllTracksEnded",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=e.getTracks()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0)if("live"===i.value.readyState)return!1}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return!0}},{key:"_stop",value:function(e,t){var n=e;n||(n=new c.P2PError(c.errors.P2P_CLIENT_UNKNOWN));var r=!0,a=!1,s=void 0;try{for(var u,l=this._dataChannels[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){var d=f(u.value,2);d[0],d[1].close()}}catch(e){a=!0,s=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw s}}this._dataChannels.clear(),this._pc&&"closed"!==this._pc.iceConnectionState&&this._pc.close();var p=!0,h=!1,m=void 0;try{for(var g,v=this._publishPromises[Symbol.iterator]();!(p=(g=v.next()).done);p=!0){var y=f(g.value,2);y[0],y[1].reject(n)}}catch(e){h=!0,m=e}finally{try{p||null==v.return||v.return()}finally{if(h)throw m}}this._publishPromises.clear();var b=!0,S=!1,C=void 0;try{for(var w,R=this._unpublishPromises[Symbol.iterator]();!(b=(w=R.next()).done);b=!0){var k=f(w.value,2);k[0],k[1].reject(n)}}catch(e){S=!0,C=e}finally{try{b||null==R.return||R.return()}finally{if(S)throw C}}this._unpublishPromises.clear();var _,E=!0,P=!1,I=void 0;try{for(var M,D=this._sendDataPromises[Symbol.iterator]();!(E=(M=D.next()).done);E=!0){var A=f(M.value,2);A[0],A[1].reject(n)}}catch(e){P=!0,I=e}finally{try{E||null==D.return||D.return()}finally{if(P)throw I}}(this._sendDataPromises.clear(),this._publishedStreams.forEach(function(e){e.dispatchEvent(new o.OwtEvent("ended"))}),this._publishedStreams.clear(),this._remoteStreams.forEach(function(e){e.dispatchEvent(new o.OwtEvent("ended"))}),this._remoteStreams=[],this._disposed)||(t&&(e&&((_=JSON.parse(JSON.stringify(e))).message="Error happened at remote side."),this._sendSignalingMessage(T,_).catch(function(e){i.default.debug("Failed to send close."+e.message)})),this.dispatchEvent(new Event("ended")))}},{key:"_setStreamToRemoteStreamInfo",value:function(e){var t=this._remoteStreamInfo.get(e.id),n=t.attributes,r=new u.StreamSourceInfo(this._remoteStreamInfo.get(e.id).source.audio,this._remoteStreamInfo.get(e.id).source.video);t.stream=new u.RemoteStream(void 0,this._remoteId,e,r,n),t.mediaStream=e;var o=t.stream;o?this._remoteStreams.push(o):i.default.warning("Failed to create RemoteStream.")}},{key:"_checkIceConnectionStateAndFireEvent",value:function(){var e=this;if("connected"===this._pc.iceConnectionState||"completed"===this._pc.iceConnectionState){var t=!0,n=!1,r=void 0;try{for(var i,o=this._remoteStreamInfo[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=f(i.value,2),s=(a[0],a[1]);if(s.mediaStream){var c=new u.StreamEvent("streamadded",{stream:s.stream});if(this._isUnifiedPlan()){var l=!0,d=!1,p=void 0;try{for(var h,m=s.mediaStream.getTracks()[Symbol.iterator]();!(l=(h=m.next()).done);l=!0)h.value.addEventListener("ended",function(t){var n=e._getStreamByTrack(t.target),r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;e._areAllTracksEnded(c)&&e._onRemoteStreamRemoved(c)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}})}catch(e){d=!0,p=e}finally{try{l||null==m.return||m.return()}finally{if(d)throw p}}}this._sendSignalingMessage(E,s.trackIds),this._remoteStreamInfo.get(s.mediaStream.id).mediaStream=null,this.dispatchEvent(c)}}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}}}])&&h(n.prototype,r),t}();n.default=A},{"../base/event.js":3,"../base/logger.js":5,"../base/publication.js":8,"../base/sdputils.js":9,"../base/stream.js":10,"../base/utils.js":11,"./error.js":23}]},{},[22])(22)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EBML=e()}}(function(){return function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return i(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}}()({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i=e("./tools"),o=e("int64-buffer"),a=e("./tools"),s=e("matroska/lib/schema").byEbmlID;!function(e){e[e.STATE_TAG=1]="STATE_TAG",e[e.STATE_SIZE=2]="STATE_SIZE",e[e.STATE_CONTENT=3]="STATE_CONTENT"}(r||(r={}));var c=function(){function e(){this._buffer=new i.Buffer(0),this._tag_stack=[],this._state=r.STATE_TAG,this._cursor=0,this._total=0,this._schema=s,this._result=[]}return e.prototype.decode=function(e){this.readChunk(e);var t=this._result;return this._result=[],t},e.prototype.readChunk=function(e){for(this._buffer=a.concat([this._buffer,new i.Buffer(e)]);this._cursor<this._buffer.length&&(this._state!==r.STATE_TAG||this.readTag())&&(this._state!==r.STATE_SIZE||this.readSize())&&(this._state!==r.STATE_CONTENT||this.readContent()););},e.prototype.getSchemaInfo=function(e){return this._schema[e]||{name:"unknown",level:-1,type:"unknown",description:"unknown"}},e.prototype.readTag=function(){if(this._cursor>=this._buffer.length)return!1;var e=i.readVint(this._buffer,this._cursor);if(null==e)return!1;var t=this._buffer.slice(this._cursor,this._cursor+e.length).reduce(function(e,t,n,r){return e+t*Math.pow(16,2*(r.length-1-n))},0),n=this.getSchemaInfo(t),o={EBML_ID:t.toString(16),schema:n,type:n.type,name:n.name,level:n.level,tagStart:this._total,tagEnd:this._total+e.length,sizeStart:this._total+e.length,sizeEnd:null,dataStart:null,dataEnd:null,dataSize:null,data:null};return this._tag_stack.push(o),this._cursor+=e.length,this._total+=e.length,this._state=r.STATE_SIZE,!0},e.prototype.readSize=function(){if(this._cursor>=this._buffer.length)return!1;var e=i.readVint(this._buffer,this._cursor);if(null==e)return!1;var t=this._tag_stack[this._tag_stack.length-1];return t.sizeEnd=t.sizeStart+e.length,t.dataStart=t.sizeEnd,t.dataSize=e.value,-1===e.value?(t.dataEnd=-1,"m"===t.type&&(t.unknownSize=!0)):t.dataEnd=t.sizeEnd+e.value,this._cursor+=e.length,this._total+=e.length,this._state=r.STATE_CONTENT,!0},e.prototype.readContent=function(){var e=this._tag_stack[this._tag_stack.length-1];if("m"===e.type){if(e.isEnd=!1,this._result.push(e),this._state=r.STATE_TAG,0===e.dataSize){var t=Object.assign({},e,{isEnd:!0});this._result.push(t),this._tag_stack.pop()}return!0}if(this._buffer.length<this._cursor+e.dataSize)return!1;var n=this._buffer.slice(this._cursor,this._cursor+e.dataSize);switch(this._buffer=this._buffer.slice(this._cursor+e.dataSize),e.data=n,e.type){case"u":e.value=n.readUIntBE(0,n.length);break;case"i":e.value=n.readIntBE(0,n.length);break;case"f":e.value=4===e.dataSize?n.readFloatBE(0):8===e.dataSize?n.readDoubleBE(0):(console.warn("cannot read "+e.dataSize+" octets float. failback to 0"),0);break;case"s":e.value=n.toString("ascii");break;case"8":e.value=n.toString("utf8");break;case"b":e.value=n;break;case"d":e.value=i.convertEBMLDateToJSDate(new o.Int64BE(n).toNumber())}if(null===e.value)throw new Error("unknown tag type:"+e.type);for(this._result.push(e),this._total+=e.dataSize,this._state=r.STATE_TAG,this._cursor=0,this._tag_stack.pop();this._tag_stack.length>0;){var a=this._tag_stack[this._tag_stack.length-1];if(a.dataEnd<0)return this._tag_stack.pop(),!0;if(this._total<a.dataEnd)break;if("m"!==a.type)throw new Error("parent element is not master element");t=Object.assign({},a,{isEnd:!0});this._result.push(t),this._tag_stack.pop()}return!0},e}();n.default=c},{"./tools":5,"int64-buffer":15,"matroska/lib/schema":17}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./tools"),i=e("./tools"),o=e("matroska/lib/schema").byEbmlID,a=function(){function e(){this._schema=o,this._buffers=[],this._stack=[]}return e.prototype.encode=function(e){var t=this;return r.concat(e.reduce(function(e,n){return e.concat(t.encodeChunk(n))},[])).buffer},e.prototype.encodeChunk=function(e){return"m"===e.type?e.isEnd?this.endTag(e):this.startTag(e):this.writeTag(e),this.flush()},e.prototype.flush=function(){var e=this._buffers;return this._buffers=[],e},e.prototype.getSchemaInfo=function(e){for(var t=Object.keys(this._schema).map(Number),n=0;n<t.length;n++){var r=t[n];if(this._schema[r].name===e)return new i.Buffer(r.toString(16),"hex")}return null},e.prototype.writeTag=function(e){var t=e.name,n=this.getSchemaInfo(t),i=e.data;if(null==n)throw new Error("No schema entry found for "+t);var o=r.encodeTag(n,i);this._stack.length>0?this._stack[this._stack.length-1].children.push({tagId:n,elm:e,children:[],data:o}):this._buffers=this._buffers.concat(o)},e.prototype.startTag=function(e){var t=e.name,n=this.getSchemaInfo(t);if(null==n)throw new Error("No schema entry found for "+t);if(e.unknownSize){var o=r.encodeTag(n,new i.Buffer(0),e.unknownSize);this._buffers=this._buffers.concat(o)}else{var a={tagId:n,elm:e,children:[],data:null};this._stack.length>0&&this._stack[this._stack.length-1].children.push(a),this._stack.push(a)}},e.prototype.endTag=function(e){e.name;var t=this._stack.pop();if(null==t)throw new Error("EBML structure is broken");if(t.elm.name!==e.name)throw new Error("EBML structure is broken");var n=t.children.reduce(function(e,t){if(null===t.data)throw new Error("EBML structure is broken");return e.concat(t.data)},[]),i=r.concat(n);"m"===t.elm.type?t.data=r.encodeTag(t.tagId,i,t.elm.unknownSize):t.data=r.encodeTag(t.tagId,i),this._stack.length<1&&(this._buffers=this._buffers.concat(t.data))},e}();n.default=a},{"./tools":5,"matroska/lib/schema":17}],3:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("events"),a=e("./tools"),s=function(e){function t(){var t=e.call(this)||this;return t.logGroup="",t.hasLoggingStarted=!1,t.metadataloaded=!1,t.chunks=[],t.stack=[],t.segmentOffset=0,t.last2SimpleBlockVideoTrackTimecode=[0,0],t.last2SimpleBlockAudioTrackTimecode=[0,0],t.lastClusterTimecode=0,t.lastClusterPosition=0,t.timecodeScale=1e6,t.metadataSize=0,t.metadatas=[],t.cues=[],t.firstVideoBlockRead=!1,t.firstAudioBlockRead=!1,t.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null},t.trackTypes=[],t.trackDefaultDuration=[],t.trackCodecDelay=[],t.trackInfo={type:"nothing"},t.ended=!1,t.logging=!1,t.use_duration_every_simpleblock=!1,t.use_webp=!1,t.use_segment_info=!0,t.drop_default_duration=!0,t}return i(t,e),t.prototype.stop=function(){for(this.ended=!0,this.emit_segment_info();this.stack.length;)this.stack.pop(),this.logging&&console.groupEnd();this.logging&&this.hasLoggingStarted&&this.logGroup&&console.groupEnd()},t.prototype.emit_segment_info=function(){var e=this.chunks;if(this.chunks=[],this.metadataloaded){if(!this.use_segment_info)return;var t=this.lastClusterTimecode,n=this.duration,r=this.timecodeScale;this.emit("cluster",{timecode:t,data:e}),this.emit("duration",{timecodeScale:r,duration:n})}else{this.metadataloaded=!0,this.metadatas=e;var i=this.trackTypes.indexOf(1),o=this.trackTypes.indexOf(2);if(this.trackInfo=i>=0&&o>=0?{type:"both",trackNumber:i}:i>=0?{type:"video",trackNumber:i}:o>=0?{type:"audio",trackNumber:o}:{type:"nothing"},!this.use_segment_info)return;this.emit("metadata",{data:e,metadataSize:this.metadataSize})}},t.prototype.read=function(e){var t=this,n=!1;if(!this.ended){if("m"===e.type)if(e.isEnd)this.stack.pop();else{var r=this.stack[this.stack.length-1];if(null!=r&&r.level>=e.level){this.stack.pop(),this.logging&&console.groupEnd(),r.dataEnd=e.dataEnd,r.dataSize=e.dataEnd-r.dataStart,r.unknownSize=!1;var i=Object.assign({},r,{name:r.name,type:r.type,isEnd:!0});this.chunks.push(i)}this.stack.push(e)}if("m"===e.type&&"Segment"==e.name)0!=this.segmentOffset&&console.warn("Multiple segments detected!"),this.segmentOffset=e.dataStart,this.emit("segment_offset",this.segmentOffset);else if("b"===e.type&&"SimpleBlock"===e.name){var o=a.ebmlBlock(e.data),s=o.timecode,c=o.trackNumber,u=o.frames;if(1===this.trackTypes[c]){if(!this.firstVideoBlockRead&&(this.firstVideoBlockRead=!0,"both"===this.trackInfo.type||"video"===this.trackInfo.type)){var l=this.lastClusterTimecode+s;this.cues.push({CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:l}),this.emit("cue_info",{CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode}),this.emit("cue",{CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:l})}this.last2SimpleBlockVideoTrackTimecode=[this.last2SimpleBlockVideoTrackTimecode[1],s]}else if(2===this.trackTypes[c]){if(!this.firstAudioBlockRead&&(this.firstAudioBlockRead=!0,"audio"===this.trackInfo.type)){l=this.lastClusterTimecode+s;this.cues.push({CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:l}),this.emit("cue_info",{CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode}),this.emit("cue",{CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:l})}this.last2SimpleBlockAudioTrackTimecode=[this.last2SimpleBlockAudioTrackTimecode[1],s]}this.use_duration_every_simpleblock&&this.emit("duration",{timecodeScale:this.timecodeScale,duration:this.duration}),this.use_webp&&u.forEach(function(e){if("9d012a"===e.slice(3,6).toString("hex")){var n=a.VP8BitStreamToRiffWebPBuffer(e),r=new Blob([n],{type:"image/webp"}),i=t.duration;t.emit("webp",{currentTime:i,webp:r})}})}else"m"===e.type&&"Cluster"===e.name&&!1===e.isEnd?(this.firstVideoBlockRead=!1,this.firstAudioBlockRead=!1,this.emit_segment_info(),this.emit("cluster_ptr",e.tagStart),this.lastClusterPosition=e.tagStart):"u"===e.type&&"Timecode"===e.name?this.lastClusterTimecode=e.value:"u"===e.type&&"TimecodeScale"===e.name?this.timecodeScale=e.value:"m"===e.type&&"TrackEntry"===e.name?e.isEnd?(this.trackTypes[this.currentTrack.TrackNumber]=this.currentTrack.TrackType,this.trackDefaultDuration[this.currentTrack.TrackNumber]=this.currentTrack.DefaultDuration,this.trackCodecDelay[this.currentTrack.TrackNumber]=this.currentTrack.CodecDelay):this.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null}:"u"===e.type&&"TrackType"===e.name?this.currentTrack.TrackType=e.value:"u"===e.type&&"TrackNumber"===e.name?this.currentTrack.TrackNumber=e.value:"u"===e.type&&"CodecDelay"===e.name?this.currentTrack.CodecDelay=e.value:"u"===e.type&&"DefaultDuration"===e.name?this.drop_default_duration?(console.warn("DefaultDuration detected!, remove it"),n=!0):this.currentTrack.DefaultDuration=e.value:"unknown"===e.name&&console.warn(e);!this.metadataloaded&&e.dataEnd>0&&(this.metadataSize=e.dataEnd),n||this.chunks.push(e),this.logging&&this.put(e)}},Object.defineProperty(t.prototype,"duration",{get:function(){if("nothing"===this.trackInfo.type)return console.warn("no video, no audio track"),0;var e=0,t=0,n=0,r=this.trackDefaultDuration[this.trackInfo.trackNumber];if("number"==typeof r)e=r;else if("both"===this.trackInfo.type)this.last2SimpleBlockAudioTrackTimecode[1]>this.last2SimpleBlockVideoTrackTimecode[1]?(e=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale,"number"==typeof(i=this.trackCodecDelay[this.trackTypes.indexOf(2)])&&(t=i),n=this.last2SimpleBlockAudioTrackTimecode[1]):(e=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale,"number"==typeof(i=this.trackCodecDelay[this.trackTypes.indexOf(1)])&&(t=i),n=this.last2SimpleBlockVideoTrackTimecode[1]);else if("video"===this.trackInfo.type){e=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale,"number"==typeof(i=this.trackCodecDelay[this.trackInfo.trackNumber])&&(t=i),n=this.last2SimpleBlockVideoTrackTimecode[1]}else if("audio"===this.trackInfo.type){var i;e=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale,"number"==typeof(i=this.trackCodecDelay[this.trackInfo.trackNumber])&&(t=i),n=this.last2SimpleBlockAudioTrackTimecode[1]}var o=((this.lastClusterTimecode+n)*this.timecodeScale+e-t)/this.timecodeScale;return Math.floor(o)},enumerable:!0,configurable:!0}),t.prototype.addListener=function(t,n){return e.prototype.addListener.call(this,t,n)},t.prototype.put=function(e){this.hasLoggingStarted||(this.hasLoggingStarted=!0,this.logging&&this.logGroup&&console.groupCollapsed(this.logGroup)),"m"===e.type?e.isEnd?console.groupEnd():console.group(e.name+":"+e.tagStart):"b"===e.type?console.log(e.name,e.type):console.log(e.name,e.tagStart,e.type,e.value)},t}(o.EventEmitter);n.default=s},{"./tools":5,events:13}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./EBMLDecoder");n.Decoder=r.default;var i=e("./EBMLEncoder");n.Encoder=i.default;var o=e("./EBMLReader");n.Reader=o.default;var a=e("./tools");n.tools=a;var s=e("../package.json").version;n.version=s},{"../package.json":18,"./EBMLDecoder":1,"./EBMLEncoder":2,"./EBMLReader":3,"./tools":5}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("int64-buffer"),i=e("./EBMLEncoder"),o=e("buffer/"),a=e("ebml/lib/ebml/tools"),s=e("ebml-block");function c(e){return e.reduce(function(e,t){return"b"!==t.type?e:"SimpleBlock"!==t.name?e:n.ebmlBlock(t.data).frames.some(function(e){return"9d012a"===e.slice(3,6).toString("hex")})?e.concat(t):e},[])}function u(e){var t=l("VP8 ",e);return l("RIFF",g([new n.Buffer("WEBP","ascii"),t]))}function l(e,t){var r=new n.Buffer(4);return r.writeUInt32LE(t.byteLength,0),g([new n.Buffer(e.substr(0,4),"ascii"),r,t,new n.Buffer(t.byteLength%2==0?0:1)])}function d(e,t){for(var n=-1,r=0;r<t.length;r++){var i=t[r];if(i.name===e){if("m"!==i.type)return void t.splice(r,1);if(i.isEnd){if(-1==n)throw new Error("Detected "+e+" closing element before finding the start");return void t.splice(n,r-n+1)}n=r}}}function f(e,t){for(var n=[],r=-1,i=0;i<t.length;i++){var o=t[i];if(o.name===e){if("m"!==o.type){n.push(t[i]);break}if(o.isEnd){if(-1==r)throw new Error("Detected "+e+" closing element before finding the start");n=t.slice(r,i+1);break}r=i}}return n}function p(e){var t=new i.default;return e.reduce(function(e,n){return e.concat(t.encode([n]))},[]).reduce(function(e,t){return e+t.byteLength},0)}function h(e,t,r){var i=r.duration,o=r.clusterPtrs,a=r.cues,s=e.slice(0);if("number"==typeof i){var c=!1;s.forEach(function(e){"f"===e.type&&"Duration"===e.name&&(c=!0,e.data=b(i,8))}),c||m(s,"Info",[{name:"Duration",type:"f",data:b(i,8)}])}Array.isArray(a)&&m(s,"Cues",function(e,t){var n=[];return e.forEach(function(e){var r=e.CueTrack,i=e.CueClusterPosition,o=e.CueTime;n.push({name:"CuePoint",type:"m",isEnd:!1}),n.push({name:"CueTime",type:"u",data:v(o)}),n.push({name:"CueTrackPositions",type:"m",isEnd:!1}),n.push({name:"CueTrack",type:"u",data:v(r)}),n.push({name:"CueClusterPosition",type:"u",data:v(i+t)}),n.push({name:"CueTrackPositions",type:"m",isEnd:!0}),n.push({name:"CuePoint",type:"m",isEnd:!0})}),n}(a,t));var u=[];return Array.isArray(o)&&(console.warn("append cluster pointers to seekhead is deprecated. please use cues"),u=function(e,t){var r=[];return e.forEach(function(e){r.push({name:"Seek",type:"m",isEnd:!1}),r.push({name:"SeekID",type:"b",data:new n.Buffer([31,67,182,117])}),r.push({name:"SeekPosition",type:"u",data:v(e+t)}),r.push({name:"Seek",type:"m",isEnd:!0})}),r}(o,t)),m(s,"SeekHead",u,!0),s}function m(e,t,n,r){void 0===r&&(r=!1);for(var i=-1,o=0;o<e.length;o++){var a=e[o];if("m"===a.type&&a.name===t&&!1===a.isEnd){i=o;break}}i>=0?Array.prototype.splice.apply(e,[i+1,0].concat(n)):r?[].concat([{name:t,type:"m",isEnd:!1}],n,[{name:t,type:"m",isEnd:!0}]).reverse().forEach(function(t){e.unshift(t)}):(e.push({name:t,type:"m",isEnd:!1}),n.forEach(function(t){e.push(t)}),e.push({name:t,type:"m",isEnd:!0}))}function g(e){for(var t=0,r=0;t<e.length;++t)r+=e[t].length;var i=n.Buffer.allocUnsafe(r),o=0;for(t=0;t<e.length;++t){var a=e[t];a.copy(i,o),o+=a.length}return i}function v(e){for(var t=1;e>=Math.pow(2,8*t);t++);if(t>=7)return console.warn("7bit or more bigger uint not supported."),new r.Uint64BE(e).toBuffer();var i=new n.Buffer(t);return i.writeUIntBE(e,0,t),i}function y(e){for(var t=1;e>=Math.pow(2,8*t);t++);if(t>=7)return console.warn("7bit or more bigger uint not supported."),new r.Int64BE(e).toBuffer();var i=new n.Buffer(t);return i.writeIntBE(e,0,t),i}function b(e,t){var r;if(void 0===t&&(t=8),8===t)return(r=new n.Buffer(8)).writeDoubleBE(e,0),r;if(4===t)return(r=new n.Buffer(4)).writeFloatBE(e,0),r;throw new Error("float type bits must 4bytes or 8bytes")}n.Buffer=o.Buffer,n.readVint=a.readVint,n.writeVint=a.writeVint,n.ebmlBlock=s,n.readBlock=function(e){return n.ebmlBlock(new n.Buffer(e))},n.encodeTag=function(e,t,r){return void 0===r&&(r=!1),g([e,r?new n.Buffer("01ffffffffffffff","hex"):n.writeVint(t.length),t])},n.WebPFrameFilter=function(e){return c(e).reduce(function(e,t){return n.ebmlBlock(t.data).frames.reduce(function(e,t){var n=u(t),r=new Blob([n],{type:"image/webp"});return e.concat(r)},e)},[])},n.WebPBlockFilter=c,n.VP8BitStreamToRiffWebPBuffer=u,n.createRIFFChunk=l,n.makeMetadataSeekable=function(e,t,r){var o=f("EBML",e),a=p(o)+12,s=e[e.length-1].dataEnd-a,c=f("Info",e);d("Duration",c),c.splice(1,0,{name:"Duration",type:"f",data:b(t,8)});for(var u=p(c),l=f("Tracks",e),h=p(l),m=47,g=[],y=5+15*r.length,S=[],C=-1,w=function(e){var t=m,i=t+u,o=i+h,c=o+y-s;if((g=[]).push({name:"SeekHead",type:"m",isEnd:!1}),g.push({name:"Seek",type:"m",isEnd:!1}),g.push({name:"SeekID",type:"b",data:new n.Buffer([21,73,169,102])}),g.push({name:"SeekPosition",type:"u",data:v(t)}),g.push({name:"Seek",type:"m",isEnd:!0}),g.push({name:"Seek",type:"m",isEnd:!1}),g.push({name:"SeekID",type:"b",data:new n.Buffer([22,84,174,107])}),g.push({name:"SeekPosition",type:"u",data:v(i)}),g.push({name:"Seek",type:"m",isEnd:!0}),g.push({name:"Seek",type:"m",isEnd:!1}),g.push({name:"SeekID",type:"b",data:new n.Buffer([28,83,187,107])}),g.push({name:"SeekPosition",type:"u",data:v(o)}),g.push({name:"Seek",type:"m",isEnd:!0}),g.push({name:"SeekHead",type:"m",isEnd:!0}),m=p(g),(S=[]).push({name:"Cues",type:"m",isEnd:!1}),r.forEach(function(e){var t=e.CueTrack,n=e.CueClusterPosition,r=e.CueTime;S.push({name:"CuePoint",type:"m",isEnd:!1}),S.push({name:"CueTime",type:"u",data:v(r)}),S.push({name:"CueTrackPositions",type:"m",isEnd:!1}),S.push({name:"CueTrack",type:"u",data:v(t)}),n-=a,n+=c,S.push({name:"CueClusterPosition",type:"u",data:v(n)}),S.push({name:"CueTrackPositions",type:"m",isEnd:!0}),S.push({name:"CuePoint",type:"m",isEnd:!0})}),S.push({name:"Cues",type:"m",isEnd:!0}),y=p(S),C===c)return"break";if(C=c,9===e)throw new Error("Failed to converge to a stable metadata size")},T=0;T<10&&"break"!==w(T);T++);var R=[].concat.apply([],[o,{name:"Segment",type:"m",isEnd:!1,unknownSize:!0},g,c,l,S]);return(new i.default).encode(R)},n.removeElement=d,n.extractElement=f,n.putRefinedMetaData=function(e,t){Array.isArray(t.cueInfos)&&!Array.isArray(t.cues)&&(console.warn("putRefinedMetaData: info.cueInfos property is deprecated. please use info.cues"),t.cues=t.cueInfos);for(var r=[],o=[],a=0;a<e.length;a++){var s=e[a];if("m"===s.type&&"Segment"===s.name){if(r=e.slice(0,a),o=e.slice(a),s.unknownSize){o.shift();break}throw new Error("this metadata is not streaming webm file")}}if(!(o[o.length-1].dataEnd>0))throw new Error("metadata dataEnd has wrong number");var c,u=o[o.length-1].dataEnd,l=r[r.length-1].dataEnd,d=(new i.default).encode(r).byteLength-l,f=u-o[0].tagStart,p=(o[0].tagStart,o[0].tagStart,new n.Buffer([24,83,128,103])),m=new n.Buffer("01ffffffffffffff","hex"),g=p.byteLength+m.byteLength,v=f;for(c=1;c<20;c++){var y=h(o,d+(l+g+v-u),t),b=(new i.default).encode(y).byteLength;if(b===v)return(new i.default).encode([].concat(r,[{type:"m",name:"Segment",isEnd:!1,unknownSize:!0}],y));v=b}throw new Error("unable to refine metadata, stable size could not be found in "+c+" iterations!")},n.concat=g,n.encodeValueToBuffer=function(e){var t=new n.Buffer(0);if("m"===e.type)return e;switch(e.type){case"u":t=v(e.value);break;case"i":t=y(e.value);break;case"f":t=b(e.value);break;case"s":t=new n.Buffer(e.value,"ascii");break;case"8":t=new n.Buffer(e.value,"utf8");break;case"b":t=e.value;break;case"d":t=new r.Int64BE(e.value.getTime().toString()).toBuffer()}return Object.assign({},e,{data:t})},n.createUIntBuffer=v,n.createIntBuffer=y,n.createFloatBuffer=b,n.convertEBMLDateToJSDate=function(e){return e instanceof Date?e:new Date(new Date("2001-01-01T00:00:00.000Z").getTime()+Number(e)/1e3/1e3)}},{"./EBMLEncoder":2,"buffer/":8,"ebml-block":9,"ebml/lib/ebml/tools":12,"int64-buffer":15}],6:[function(e,t,n){"use strict";n.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},n.toByteArray=function(e){for(var t,n=u(e),r=n[0],a=n[1],s=new o(function(e,t,n){return 3*(t+n)/4-n}(0,r,a)),c=0,l=a>0?r-4:r,d=0;d<l;d+=4)t=i[e.charCodeAt(d)]<<18|i[e.charCodeAt(d+1)]<<12|i[e.charCodeAt(d+2)]<<6|i[e.charCodeAt(d+3)],s[c++]=t>>16&255,s[c++]=t>>8&255,s[c++]=255&t;2===a&&(t=i[e.charCodeAt(d)]<<2|i[e.charCodeAt(d+1)]>>4,s[c++]=255&t);1===a&&(t=i[e.charCodeAt(d)]<<10|i[e.charCodeAt(d+1)]<<4|i[e.charCodeAt(d+2)]>>2,s[c++]=t>>8&255,s[c++]=255&t);return s},n.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],a=0,s=n-i;a<s;a+=16383)o.push(l(e,a,a+16383>s?s:a+16383));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=a.length;s<c;++s)r[s]=a[s],i[a.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,o,a=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],7:[function(e,t,n){(function(t){"use strict";var r=e("base64-js"),i=e("ieee754"),o=e("isarray");function a(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=f(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|h(t,n),i=(e=s(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|p(t.length);return 0===(e=s(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?s(e,0):f(e,t);if("Buffer"===t.type&&o(t.data))return f(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(l(t),e=s(e,t<0?0:0|p(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|p(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function p(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function h(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return F(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return V(e).length;default:if(r)return F(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,i){var o,a=1,s=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,c/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=n;o<s;o++)if(u(e,o)===u(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===c)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(n+c>s&&(n=s-c),o=n;o>=0;o--){for(var d=!0,f=0;f<c;f++)if(u(e,o+f)!==u(t,f)){d=!1;break}if(d)return o}return-1}function y(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function b(e,t,n,r){return J(F(t,e.length-n),e,n,r)}function S(e,t,n,r){return J(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function C(e,t,n,r){return S(e,t,n,r)}function w(e,t,n,r){return J(V(t),e,n,r)}function T(e,t,n,r){return J(function(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function R(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function k(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,c,u=e[i],l=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=n)switch(d){case 1:u<128&&(l=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(l=c);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(c=(15&u)<<12|(63&o)<<6|63&a)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(c=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=d}return function(e){var t=e.length;if(t<=_)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=_));return n}(r)}n.Buffer=c,n.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},n.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),n.kMaxLength=a(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return d(null,e)},c.allocUnsafeSlow=function(e){return d(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var a=e[n];if(!c.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},c.byteLength=h,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?k(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,n);case"utf8":case"utf-8":return k(this,t,n);case"ascii":return E(this,t,n);case"latin1":case"binary":return P(this,t,n);case"base64":return R(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var o=i-r,a=n-t,s=Math.min(o,a),u=this.slice(r,i),l=e.slice(t,n),d=0;d<s;++d)if(u[d]!==l[d]){o=u[d],a=l[d];break}return o<a?-1:a<o?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return y(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return S(this,e,t,n);case"latin1":case"binary":return C(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var _=4096;function E(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function P(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function I(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=N(e[o]);return i}function M(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function D(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function A(e,t,n,r,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function O(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function x(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function U(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function B(e,t,n,r,o){return o||U(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function j(e,t,n,r,o){return o||U(e,0,n,8),i.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if(e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||D(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||D(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||D(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||D(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||D(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||A(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||A(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):O(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):O(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):x(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):x(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);A(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);A(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):O(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):O(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):x(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):x(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return B(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return B(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=c.isBuffer(e)?e:F(new c(e,r).toString()),s=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var L=/[^+\/0-9A-Za-z-_]/g;function N(e){return e<16?"0"+e.toString(16):e.toString(16)}function F(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function V(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(L,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function J(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":6,ieee754:14,isarray:16}],8:[function(e,t,n){"use strict";var r=e("base64-js"),i=e("ieee754");n.Buffer=s,n.SlowBuffer=function(e){+e!=e&&(e=0);return s.alloc(+e)},n.INSPECT_MAX_BYTES=50;var o=2147483647;function a(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=s.prototype,t}function s(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return l(e)}return c(e,t,n)}function c(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!s.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|p(e,t),r=a(n),i=r.write(e,t);i!==n&&(r=r.slice(0,i));return r}(e,t);if(ArrayBuffer.isView(e))return d(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(F(e,ArrayBuffer)||e&&F(e.buffer,ArrayBuffer))return function(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n);return r.__proto__=s.prototype,r}(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return s.from(r,t,n);var i=function(e){if(s.isBuffer(e)){var t=0|f(e.length),n=a(t);return 0===n.length?n:(e.copy(n,0,0,t),n)}if(void 0!==e.length)return"number"!=typeof e.length||V(e.length)?a(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return s.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return u(e),a(e<0?0:0|f(e))}function d(e){for(var t=e.length<0?0:0|f(e.length),n=a(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function f(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function p(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||F(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return L(e).length;default:if(i)return r?-1:j(e).length;t=(""+t).toLowerCase(),i=!0}}function h(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function m(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),V(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=s.from(t,r)),s.isBuffer(t))return 0===t.length?-1:g(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):g(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function g(e,t,n,r,i){var o,a=1,s=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,c/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=n;o<s;o++)if(u(e,o)===u(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===c)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(n+c>s&&(n=s-c),o=n;o>=0;o--){for(var d=!0,f=0;f<c;f++)if(u(e,o+f)!==u(t,f)){d=!1;break}if(d)return o}return-1}function v(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(V(s))return a;e[n+a]=s}return a}function y(e,t,n,r){return N(j(t,e.length-n),e,n,r)}function b(e,t,n,r){return N(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function S(e,t,n,r){return b(e,t,n,r)}function C(e,t,n,r){return N(L(t),e,n,r)}function w(e,t,n,r){return N(function(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function T(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function R(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,c,u=e[i],l=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=n)switch(d){case 1:u<128&&(l=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(l=c);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(c=(15&u)<<12|(63&o)<<6|63&a)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(c=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=d}return function(e){var t=e.length;if(t<=k)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=k));return n}(r)}n.kMaxLength=o,s.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),s.poolSize=8192,s.from=function(e,t,n){return c(e,t,n)},s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,s.alloc=function(e,t,n){return function(e,t,n){return u(e),e<=0?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)}(e,t,n)},s.allocUnsafe=function(e){return l(e)},s.allocUnsafeSlow=function(e){return l(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==s.prototype},s.compare=function(e,t){if(F(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),F(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=s.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(F(o,Uint8Array)&&(o=s.from(o)),!s.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},s.byteLength=p,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)h(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)h(this,t,t+3),h(this,t+1,t+2);return this},s.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)h(this,t,t+7),h(this,t+1,t+6),h(this,t+2,t+5),h(this,t+3,t+4);return this},s.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?R(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,n);case"utf8":case"utf-8":return R(this,t,n);case"ascii":return _(this,t,n);case"latin1":case"binary":return E(this,t,n);case"base64":return T(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},s.prototype.compare=function(e,t,n,r,i){if(F(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var o=i-r,a=n-t,c=Math.min(o,a),u=this.slice(r,i),l=e.slice(t,n),d=0;d<c;++d)if(u[d]!==l[d]){o=u[d],a=l[d];break}return o<a?-1:a<o?1:0},s.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},s.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},s.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)},s.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return y(this,e,t,n);case"ascii":return b(this,e,t,n);case"latin1":case"binary":return S(this,e,t,n);case"base64":return C(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function _(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function E(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function P(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=B(e[o]);return i}function I(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function M(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,n,r,i,o){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function A(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function O(e,t,n,r,o){return t=+t,n>>>=0,o||A(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function x(e,t,n,r,o){return t=+t,n>>>=0,o||A(e,0,n,8),i.write(e,t,n,r,52,8),n+8}s.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return r.__proto__=s.prototype,r},s.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},s.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},s.prototype.readUInt8=function(e,t){return e>>>=0,t||M(e,1,this.length),this[e]},s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||M(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||M(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||M(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||M(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},s.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},s.prototype.readInt8=function(e,t){return e>>>=0,t||M(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||M(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(e,t){e>>>=0,t||M(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||M(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||M(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return e>>>=0,t||M(e,4,this.length),i.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||M(e,4,this.length),i.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||M(e,8,this.length),i.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||M(e,8,this.length),i.read(this,e,!1,52,8)},s.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||D(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},s.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||D(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},s.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);D(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},s.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);D(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},s.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeFloatLE=function(e,t,n){return O(this,e,t,!0,n)},s.prototype.writeFloatBE=function(e,t,n){return O(this,e,t,!1,n)},s.prototype.writeDoubleLE=function(e,t,n){return x(this,e,t,!0,n)},s.prototype.writeDoubleBE=function(e,t,n){return x(this,e,t,!1,n)},s.prototype.copy=function(e,t,n,r){if(!s.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var o=i-1;o>=0;--o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return i},s.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!s.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var i=e.charCodeAt(0);("utf8"===r&&i<128||"latin1"===r)&&(e=i)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=s.isBuffer(e)?e:s.from(e,r),c=a.length;if(0===c)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=a[o%c]}return this};var U=/[^+/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function j(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function L(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(U,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function N(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function F(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function V(e){return e!=e}},{"base64-js":6,ieee754:14}],9:[function(e,t,n){var r=e("./lib/buffer-reader"),i=1,o=3,a=2;t.exports=function(e){var t={},n=new r(e);t.trackNumber=n.nextUIntV(),t.timecode=n.nextInt16BE();var s=n.nextUInt8();t.invisible=!!(8&s),t.keyframe=!!(128&s),t.discardable=!!(1&s);var c=(6&s)>>1;return t.frames=function(e,t){if(!t)return[e.nextBuffer()];var n,r,s=[],c=e.nextUInt8()+1;if(t===a){if(e.length%c!=0)throw new Error("Fixed-Size Lacing Error");for(r=e.length/c,n=0;n<c;n++)s.push(e.nextBuffer(r));return s}var u=[];if(t===i)for(n=0;n<c-1;n++){var l;r=0;do{l=e.nextUInt8(),r+=l}while(255===l);u.push(r)}else if(t===o)for(r=e.nextUIntV(),u.push(r),n=1;n<c-1;n++)r+=e.nextIntV(),u.push(r);for(n=0;n<c-1;n++)s.push(e.nextBuffer(u[n]));return s.push(e.nextBuffer()),s}(n,c),t}},{"./lib/buffer-reader":10}],10:[function(e,t,n){var r=e("./vint");function i(e){this.buffer=e,this.offset=0}i.prototype.nextInt16BE=function(){var e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e},i.prototype.nextUInt8=function(){var e=this.buffer.readUInt8(this.offset);return this.offset+=1,e},i.prototype.nextUIntV=function(){var e=r(this.buffer,this.offset);return this.offset+=e.length,e.value},i.prototype.nextIntV=function(){var e=r(this.buffer,this.offset,!0);return this.offset+=e.length,e.value},i.prototype.nextBuffer=function(e){var t=e?this.buffer.slice(this.offset,this.offset+e):this.buffer.slice(this.offset);return this.offset+=e||this.length,t},Object.defineProperty(i.prototype,"length",{get:function(){return this.buffer.length-this.offset}}),t.exports=i},{"./vint":11}],11:[function(e,t,n){t.exports=function(e,t,n){t=t||0;for(var r=1;r<=8&&!(e[t]>=Math.pow(2,8-r));r++);if(r>8)throw new Error("Unrepresentable length: "+r+" "+e.toString("hex",t,t+r));if(t+r>e.length)return null;var i,o=e[t]&(1<<8-r)-1;for(i=1;i<r;i++){if(7===i&&o>=Math.pow(2,45)&&e[t+7]>0)return{length:r,value:-1};o*=Math.pow(2,8),o+=e[t+i]}return n&&(o-=Math.pow(2,7*r-1)-1),{length:r,value:o}}},{}],12:[function(e,t,n){(function(e){var n={readVint:function(e,t){t=t||0;for(var n=1;n<=8&&!(e[t]>=Math.pow(2,8-n));n++);if(n>8)throw new Error("Unrepresentable length: "+n+" "+e.toString("hex",t,t+n));if(t+n>e.length)return null;for(var r=e[t]&(1<<8-n)-1,i=1;i<n;i++){if(7===i&&r>=Math.pow(2,45)&&e[t+7]>0)return{length:n,value:-1};r*=Math.pow(2,8),r+=e[t+i]}return{length:n,value:r}},writeVint:function(t){if(t<0||t>Math.pow(2,53))throw new Error("Unrepresentable value: "+t);for(var n=1;n<=8&&!(t<Math.pow(2,7*n)-1);n++);for(var r=new e(n),i=1;i<=n;i++){var o=255&t;r[n-i]=o,t-=o,t/=Math.pow(2,8)}return r[0]=r[0]|1<<8-n,r}};t.exports=n}).call(this,e("buffer").Buffer)},{buffer:7}],13:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,s,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(a(n=this._events[e]))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(o(n))for(s=Array.prototype.slice.call(arguments,1),r=(u=n.slice()).length,c=0;c<r;c++)u[c].apply(this,s);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var n,r,a,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=(n=this._events[e]).length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],14:[function(e,t,n){n.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,c=(1<<s)-1,u=c>>1,l=-7,d=n?i-1:0,f=n?-1:1,p=e[t+d];for(d+=f,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+e[t+d],d+=f,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+e[t+d],d+=f,l-=8);if(0===o)o=1-u;else{if(o===c)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=u}return(p?-1:1)*a*Math.pow(2,o-r)},n.write=function(e,t,n,r,i,o){var a,s,c,u=8*o-i-1,l=(1<<u)-1,d=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,h=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+d>=1?f/c:f*Math.pow(2,1-d))*c>=2&&(a++,c/=2),a+d>=l?(s=0,a=l):a+d>=1?(s=(t*c-1)*Math.pow(2,i),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),a=0));i>=8;e[n+p]=255&s,p+=h,s/=256,i-=8);for(a=a<<i|s,u+=i;u>0;e[n+p]=255&a,p+=h,a/=256,u-=8);e[n+p-h]|=128*m}},{}],15:[function(e,t,n){(function(e){!function(t){var n,r="undefined",i=r!==typeof e&&e,o=r!==typeof Uint8Array&&Uint8Array,a=r!==typeof ArrayBuffer&&ArrayBuffer,s=[0,0,0,0,0,0,0,0],c=Array.isArray||function(e){return!!e&&"[object Array]"==Object.prototype.toString.call(e)},u=4294967296,l=16777216;function d(e,c,d){var w=c?0:4,T=c?4:0,R=c?0:3,k=c?1:2,_=c?2:1,E=c?3:0,P=c?y:S,I=c?b:C,M=O.prototype,D="is"+e,A="_"+D;return M.buffer=void 0,M.offset=0,M[A]=!0,M.toNumber=x,M.toString=function(e){var t=this.buffer,n=this.offset,r=B(t,n+w),i=B(t,n+T),o="",a=!d&&2147483648&r;a&&(r=~r,i=u-i);e=e||10;for(;;){var s=r%e*u+i;if(r=Math.floor(r/e),i=Math.floor(s/e),o=(s%e).toString(e)+o,!r&&!i)break}a&&(o="-"+o);return o},M.toJSON=x,M.toArray=f,i&&(M.toBuffer=p),o&&(M.toArrayBuffer=h),O[D]=function(e){return!(!e||!e[A])},t[e]=O,O;function O(e,t,i,c){return this instanceof O?function(e,t,i,c,l){o&&a&&(t instanceof a&&(t=new o(t)),c instanceof a&&(c=new o(c)));if(!(t||i||c||n))return void(e.buffer=v(s,0));if(!m(t,i)){var d=n||Array;l=i,c=t,i=0,t=new d(8)}if(e.buffer=t,e.offset=i|=0,r===typeof c)return;"string"==typeof c?function(e,t,n,r){var i=0,o=n.length,a=0,s=0;"-"===n[0]&&i++;var c=i;for(;i<o;){var l=parseInt(n[i++],r);if(!(l>=0))break;s=s*r+l,a=a*r+Math.floor(s/u),s%=u}c&&(a=~a,s?s=u-s:a++);U(e,t+w,a),U(e,t+T,s)}(t,i,c,l||10):m(c,l)?g(t,i,c,l):"number"==typeof l?(U(t,i+w,c),U(t,i+T,l)):c>0?P(t,i,c):c<0?I(t,i,c):g(t,i,s,0)}(this,e,t,i,c):new O(e,t,i,c)}function x(){var e=this.buffer,t=this.offset,n=B(e,t+w),r=B(e,t+T);return d||(n|=0),n?n*u+r:r}function U(e,t,n){e[t+E]=255&n,n>>=8,e[t+_]=255&n,n>>=8,e[t+k]=255&n,n>>=8,e[t+R]=255&n}function B(e,t){return e[t+R]*l+(e[t+k]<<16)+(e[t+_]<<8)+e[t+E]}}function f(e){var t=this.buffer,r=this.offset;return n=null,!1!==e&&0===r&&8===t.length&&c(t)?t:v(t,r)}function p(t){var r=this.buffer,o=this.offset;if(n=i,!1!==t&&0===o&&8===r.length&&e.isBuffer(r))return r;var a=new i(8);return g(a,0,r,o),a}function h(e){var t=this.buffer,r=this.offset,i=t.buffer;if(n=o,!1!==e&&0===r&&i instanceof a&&8===i.byteLength)return i;var s=new o(8);return g(s,0,t,r),s.buffer}function m(e,t){var n=e&&e.length;return t|=0,n&&t+8<=n&&"string"!=typeof e[t]}function g(e,t,n,r){t|=0,r|=0;for(var i=0;i<8;i++)e[t++]=255&n[r++]}function v(e,t){return Array.prototype.slice.call(e,t,t+8)}function y(e,t,n){for(var r=t+8;r>t;)e[--r]=255&n,n/=256}function b(e,t,n){var r=t+8;for(n++;r>t;)e[--r]=255&-n^255,n/=256}function S(e,t,n){for(var r=t+8;t<r;)e[t++]=255&n,n/=256}function C(e,t,n){var r=t+8;for(n++;t<r;)e[t++]=255&-n^255,n/=256}d("Uint64BE",!0,!0),d("Int64BE",!0,!1),d("Uint64LE",!1,!0),d("Int64LE",!1,!1)}("object"==typeof n&&"string"!=typeof n.nodeName?n:this||{})}).call(this,e("buffer").Buffer)},{buffer:7}],16:[function(e,t,n){var r={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},{}],17:[function(e,t,n){"use strict";var r={128:{name:"ChapterDisplay",level:4,type:"m",multiple:!0,minver:1,webm:!0,description:"Contains all possible strings to use for the chapter display."},131:{name:"TrackType",level:3,type:"u",mandatory:!0,minver:1,range:"1-254",description:"A set of track types coded on 8 bits (1: video, 2: audio, 3: complex, 0x10: logo, 0x11: subtitle, 0x12: buttons, 0x20: control)."},133:{name:"ChapString",cppname:"ChapterString",level:5,type:"8",mandatory:!0,minver:1,webm:!0,description:"Contains the string to use as the chapter atom."},134:{name:"CodecID",level:3,type:"s",mandatory:!0,minver:1,description:"An ID corresponding to the codec, see the codec page for more info."},136:{name:"FlagDefault",cppname:"TrackFlagDefault",level:3,type:"u",mandatory:!0,minver:1,default:1,range:"0-1",description:"Set if that track (audio, video or subs) SHOULD be active if no language found matches the user preference. (1 bit)"},137:{name:"ChapterTrackNumber",level:5,type:"u",mandatory:!0,multiple:!0,minver:1,webm:!1,range:"not 0",description:"UID of the Track to apply this chapter too. In the absense of a control track, choosing this chapter will select the listed Tracks and deselect unlisted tracks. Absense of this element indicates that the Chapter should be applied to any currently used Tracks."},145:{name:"ChapterTimeStart",level:4,type:"u",mandatory:!0,minver:1,webm:!0,description:"Timestamp of the start of Chapter (not scaled)."},146:{name:"ChapterTimeEnd",level:4,type:"u",minver:1,webm:!1,description:"Timestamp of the end of Chapter (timestamp excluded, not scaled)."},150:{name:"CueRefTime",level:5,type:"u",mandatory:!0,minver:2,webm:!1,description:"Timestamp of the referenced Block."},151:{name:"CueRefCluster",level:5,type:"u",mandatory:!0,webm:!1,description:"The Position of the Cluster containing the referenced Block."},152:{name:"ChapterFlagHidden",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If a chapter is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},16980:{name:"ContentCompAlgo",level:6,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The compression algorithm used. Algorithms that have been specified so far are: 0 - zlib,   3 - Header Stripping"},16981:{name:"ContentCompSettings",level:6,type:"b",minver:1,webm:!1,description:"Settings that might be needed by the decompressor. For Header Stripping (ContentCompAlgo=3), the bytes that were removed from the beggining of each frames of the track."},17026:{name:"DocType",level:1,type:"s",mandatory:!0,default:"matroska",minver:1,description:"A string that describes the type of document that follows this EBML header. 'matroska' in our case or 'webm' for webm files."},17029:{name:"DocTypeReadVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The minimum DocType version an interpreter has to support to read this file."},17030:{name:"EBMLVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The version of EBML parser used to create the file."},17031:{name:"DocTypeVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The version of DocType interpreter used to create the file."},17476:{name:"SegmentFamily",level:2,type:"b",multiple:!0,minver:1,webm:!1,bytesize:16,description:"A randomly generated unique ID that all segments related to each other must use (128 bits)."},17505:{name:"DateUTC",level:2,type:"d",minver:1,description:"Date of the origin of timestamp (value 0), i.e. production date."},17540:{name:"TagDefault",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"0-1",description:"Indication to know if this is the default/original language to use for the given tag. (1 bit)"},17541:{name:"TagBinary",level:4,type:"b",minver:1,webm:!1,description:"The values of the Tag if it is binary. Note that this cannot be used in the same SimpleTag as TagString."},17543:{name:"TagString",level:4,type:"8",minver:1,webm:!1,description:"The value of the Element."},17545:{name:"Duration",level:2,type:"f",minver:1,range:"> 0",description:"Duration of the segment (based on TimecodeScale)."},17816:{name:"ChapterFlagEnabled",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"0-1",description:"Specify wether the chapter is enabled. It can be enabled/disabled by a Control Track. When disabled, the movie should skip all the content between the TimeStart and TimeEnd of this chapter (see flag notes). (1 bit)"},18016:{name:"FileMimeType",level:3,type:"s",mandatory:!0,minver:1,webm:!1,description:"MIME type of the file."},18017:{name:"FileUsedStartTime",level:3,type:"u",divx:!0,description:"DivX font extension"},18018:{name:"FileUsedEndTime",level:3,type:"u",divx:!0,description:"DivX font extension"},18037:{name:"FileReferral",level:3,type:"b",webm:!1,description:"A binary value that a track/codec can refer to when the attachment is needed."},20529:{name:"ContentEncodingOrder",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"Tells when this modification was used during encoding/muxing starting with 0 and counting upwards. The decoder/demuxer has to start with the highest order number it finds and work its way down. This value has to be unique over all ContentEncodingOrder elements in the segment."},20530:{name:"ContentEncodingScope",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"not 0",description:"A bit field that describes which elements have been modified in this way. Values (big endian) can be OR'ed. Possible values: 1 - all frame contents, 2 - the track's private data, 4 - the next ContentEncoding (next ContentEncodingOrder. Either the data inside ContentCompression and/or ContentEncryption)"},20531:{name:"ContentEncodingType",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"A value describing what kind of transformation has been done. Possible values: 0 - compression, 1 - encryption"},20532:{name:"ContentCompression",level:5,type:"m",minver:1,webm:!1,description:"Settings describing the compression used. Must be present if the value of ContentEncodingType is 0 and absent otherwise. Each block must be decompressable even if no previous block is available in order not to prevent seeking."},20533:{name:"ContentEncryption",level:5,type:"m",minver:1,webm:!1,description:"Settings describing the encryption used. Must be present if the value of ContentEncodingType is 1 and absent otherwise."},21368:{name:"CueBlockNumber",level:4,type:"u",minver:1,default:1,range:"not 0",description:"Number of the Block in the specified Cluster."},22100:{name:"ChapterStringUID",level:4,type:"8",mandatory:!1,minver:3,webm:!0,description:"A unique string ID to identify the Chapter. Use for WebVTT cue identifier storage."},22337:{name:"WritingApp",level:2,type:"8",mandatory:!0,minver:1,description:'Writing application ("mkvmerge-0.3.3").'},22612:{name:"SilentTracks",cppname:"ClusterSilentTracks",level:2,type:"m",minver:1,webm:!1,description:"The list of tracks that are not used in that part of the stream. It is useful when using overlay tracks on seeking. Then you should decide what track to use."},25152:{name:"ContentEncoding",level:4,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Settings for one content encoding like compression or encryption."},25188:{name:"BitDepth",cppname:"AudioBitDepth",level:4,type:"u",minver:1,range:"not 0",description:"Bits per sample, mostly used for PCM."},25906:{name:"SignedElement",level:3,type:"b",multiple:!0,webm:!1,description:"An element ID whose data will be used to compute the signature."},26148:{name:"TrackTranslate",level:3,type:"m",multiple:!0,minver:1,webm:!1,description:"The track identification for the given Chapter Codec."},26897:{name:"ChapProcessCommand",cppname:"ChapterProcessCommand",level:5,type:"m",multiple:!0,minver:1,webm:!1,description:"Contains all the commands associated to the Atom."},26914:{name:"ChapProcessTime",cppname:"ChapterProcessTime",level:6,type:"u",mandatory:!0,minver:1,webm:!1,description:"Defines when the process command should be handled (0: during the whole chapter, 1: before starting playback, 2: after playback of the chapter)."},26916:{name:"ChapterTranslate",level:2,type:"m",multiple:!0,minver:1,webm:!1,description:"A tuple of corresponding ID used by chapter codecs to represent this segment."},26931:{name:"ChapProcessData",cppname:"ChapterProcessData",level:6,type:"b",mandatory:!0,minver:1,webm:!1,description:"Contains the command information. The data should be interpreted depending on the ChapProcessCodecID value. For ChapProcessCodecID = 1, the data correspond to the binary DVD cell pre/post commands."},26948:{name:"ChapProcess",cppname:"ChapterProcess",level:4,type:"m",multiple:!0,minver:1,webm:!1,description:"Contains all the commands associated to the Atom."},26965:{name:"ChapProcessCodecID",cppname:"ChapterProcessCodecID",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"Contains the type of the codec used for the processing. A value of 0 means native Matroska processing (to be defined), a value of 1 means the DVD command set is used. More codec IDs can be added later."},29555:{name:"Tag",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Element containing elements specific to Tracks/Chapters."},29572:{name:"SegmentFilename",level:2,type:"8",minver:1,webm:!1,description:"A filename corresponding to this segment."},29766:{name:"AttachmentLink",cppname:"TrackAttachmentLink",level:3,type:"u",minver:1,webm:!1,range:"not 0",description:"The UID of an attachment that is used by this codec."},2459272:{name:"CodecName",level:3,type:"8",minver:1,description:"A human-readable string specifying the codec."},408125543:{name:"Segment",level:"0",type:"m",mandatory:!0,multiple:!0,minver:1,description:"This element contains all other top-level (level 1) elements. Typically a Matroska file is composed of 1 segment."},17530:{name:"TagLanguage",level:4,type:"s",mandatory:!0,minver:1,webm:!1,default:"und",description:"Specifies the language of the tag specified, in the Matroska languages form."},17827:{name:"TagName",level:4,type:"8",mandatory:!0,minver:1,webm:!1,description:"The name of the Tag that is going to be stored."},26568:{name:"SimpleTag",cppname:"TagSimple",level:3,recursive:"1",type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Contains general information about the target."},25542:{name:"TagAttachmentUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Attachment(s) the tags belong to. If the value is 0 at this level, the tags apply to all the attachments in the Segment."},25540:{name:"TagChapterUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Chapter(s) the tags belong to. If the value is 0 at this level, the tags apply to all chapters in the Segment."},25545:{name:"TagEditionUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the EditionEntry(s) the tags belong to. If the value is 0 at this level, the tags apply to all editions in the Segment."},25541:{name:"TagTrackUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Track(s) the tags belong to. If the value is 0 at this level, the tags apply to all tracks in the Segment."},25546:{name:"TargetType",cppname:"TagTargetType",level:4,type:"s",minver:1,webm:!1,strong:"informational",description:'An  string that can be used to display the logical level of the target like "ALBUM", "TRACK", "MOVIE", "CHAPTER", etc (see TargetType).'},26826:{name:"TargetTypeValue",cppname:"TagTargetTypeValue",level:4,type:"u",minver:1,webm:!1,default:50,description:"A number to indicate the logical level of the target (see TargetType)."},25536:{name:"Targets",cppname:"TagTargets",level:3,type:"m",mandatory:!0,minver:1,webm:!1,description:"Contain all UIDs where the specified meta data apply. It is empty to describe everything in the segment."},307544935:{name:"Tags",level:1,type:"m",multiple:!0,minver:1,webm:!1,description:"Element containing elements specific to Tracks/Chapters. A list of valid tags can be found here."},17677:{name:"ChapProcessPrivate",cppname:"ChapterProcessPrivate",level:5,type:"b",minver:1,webm:!1,description:'Some optional data attached to the ChapProcessCodecID information. For ChapProcessCodecID = 1, it is the "DVD level" equivalent.'},17278:{name:"ChapCountry",cppname:"ChapterCountry",level:5,type:"s",multiple:!0,minver:1,webm:!1,description:"The countries corresponding to the string, same 2 octets as in Internet domains."},17276:{name:"ChapLanguage",cppname:"ChapterLanguage",level:5,type:"s",mandatory:!0,multiple:!0,minver:1,webm:!0,default:"eng",description:"The languages corresponding to the string, in the bibliographic ISO-639-2 form."},143:{name:"ChapterTrack",level:4,type:"m",minver:1,webm:!1,description:"List of tracks on which the chapter applies. If this element is not present, all tracks apply"},25539:{name:"ChapterPhysicalEquiv",level:4,type:"u",minver:1,webm:!1,description:'Specify the physical equivalent of this ChapterAtom like "DVD" (60) or "SIDE" (50), see complete list of values.'},28348:{name:"ChapterSegmentEditionUID",level:4,type:"u",minver:1,webm:!1,range:"not 0",description:"The EditionUID to play from the segment linked in ChapterSegmentUID."},28263:{name:"ChapterSegmentUID",level:4,type:"b",minver:1,webm:!1,range:">0",bytesize:16,description:"A segment to play in place of this chapter. Edition ChapterSegmentEditionUID should be used for this segment, otherwise no edition is used."},29636:{name:"ChapterUID",level:4,type:"u",mandatory:!0,minver:1,webm:!0,range:"not 0",description:"A unique ID to identify the Chapter."},182:{name:"ChapterAtom",level:3,recursive:"1",type:"m",mandatory:!0,multiple:!0,minver:1,webm:!0,description:"Contains the atom information to use as the chapter atom (apply to all tracks)."},17885:{name:"EditionFlagOrdered",level:3,type:"u",minver:1,webm:!1,default:0,range:"0-1",description:"Specify if the chapters can be defined multiple times and the order to play them is enforced. (1 bit)"},17883:{name:"EditionFlagDefault",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If a flag is set (1) the edition should be used as the default one. (1 bit)"},17853:{name:"EditionFlagHidden",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If an edition is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},17852:{name:"EditionUID",level:3,type:"u",minver:1,webm:!1,range:"not 0",description:"A unique ID to identify the edition. It's useful for tagging an edition."},17849:{name:"EditionEntry",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!0,description:"Contains all information about a segment edition."},272869232:{name:"Chapters",level:1,type:"m",minver:1,webm:!0,description:"A system to define basic menus and partition data. For more detailed information, look at the Chapters Explanation."},18094:{name:"FileUID",level:3,type:"u",mandatory:!0,minver:1,webm:!1,range:"not 0",description:"Unique ID representing the file, as random as possible."},18012:{name:"FileData",level:3,type:"b",mandatory:!0,minver:1,webm:!1,description:"The data of the file."},18030:{name:"FileName",level:3,type:"8",mandatory:!0,minver:1,webm:!1,description:"Filename of the attached file."},18046:{name:"FileDescription",level:3,type:"8",minver:1,webm:!1,description:"A human-friendly name for the attached file."},24999:{name:"AttachedFile",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"An attached file."},423732329:{name:"Attachments",level:1,type:"m",minver:1,webm:!1,description:"Contain attached files."},235:{name:"CueRefCodecState",level:5,type:"u",webm:!1,default:0,description:"The position of the Codec State corresponding to this referenced element. 0 means that the data is taken from the initial Track Entry."},21343:{name:"CueRefNumber",level:5,type:"u",webm:!1,default:1,range:"not 0",description:"Number of the referenced Block of Track X in the specified Cluster."},219:{name:"CueReference",level:4,type:"m",multiple:!0,minver:2,webm:!1,description:"The Clusters containing the required referenced Blocks."},234:{name:"CueCodecState",level:4,type:"u",minver:2,webm:!1,default:0,description:"The position of the Codec State corresponding to this Cue element. 0 means that the data is taken from the initial Track Entry."},178:{name:"CueDuration",level:4,type:"u",mandatory:!1,minver:4,webm:!1,description:"The duration of the block according to the segment time base. If missing the track's DefaultDuration does not apply and no duration information is available in terms of the cues."},240:{name:"CueRelativePosition",level:4,type:"u",mandatory:!1,minver:4,webm:!1,description:"The relative position of the referenced block inside the cluster with 0 being the first possible position for an element inside that cluster.",position:"clusterRelative"},241:{name:"CueClusterPosition",level:4,type:"u",mandatory:!0,minver:1,description:"The position of the Cluster containing the required Block.",position:"segment"},247:{name:"CueTrack",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"The track for which a position is given."},183:{name:"CueTrackPositions",level:3,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contain positions for different tracks corresponding to the timestamp."},179:{name:"CueTime",level:3,type:"u",mandatory:!0,minver:1,description:"Absolute timestamp according to the segment time base."},187:{name:"CuePoint",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains all information relative to a seek point in the segment."},475249515:{name:"Cues",level:1,type:"m",minver:1,description:'A top-level element to speed seeking access. All entries are local to the segment. Should be mandatory for non "live" streams.'},18406:{name:"ContentSigHashAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The hash algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - SHA1-160 2 - MD5"},18405:{name:"ContentSigAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - RSA"},18404:{name:"ContentSigKeyID",level:6,type:"b",minver:1,webm:!1,description:"This is the ID of the private key the data was signed with."},18403:{name:"ContentSignature",level:6,type:"b",minver:1,webm:!1,description:"A cryptographic signature of the contents."},18402:{name:"ContentEncKeyID",level:6,type:"b",minver:1,webm:!1,description:"For public key algorithms this is the ID of the public key the the data was encrypted with."},18401:{name:"ContentEncAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The encryption algorithm used. The value '0' means that the contents have not been encrypted but only signed. Predefined values: 1 - DES, 2 - 3DES, 3 - Twofish, 4 - Blowfish, 5 - AES"},28032:{name:"ContentEncodings",level:3,type:"m",minver:1,webm:!1,description:"Settings for several content encoding mechanisms like compression or encryption."},196:{name:"TrickMasterTrackSegmentUID",level:3,type:"b",divx:!0,bytesize:16,description:"DivX trick track extenstions"},199:{name:"TrickMasterTrackUID",level:3,type:"u",divx:!0,description:"DivX trick track extenstions"},198:{name:"TrickTrackFlag",level:3,type:"u",divx:!0,default:0,description:"DivX trick track extenstions"},193:{name:"TrickTrackSegmentUID",level:3,type:"b",divx:!0,bytesize:16,description:"DivX trick track extenstions"},192:{name:"TrickTrackUID",level:3,type:"u",divx:!0,description:"DivX trick track extenstions"},237:{name:"TrackJoinUID",level:5,type:"u",mandatory:!0,multiple:!0,minver:3,webm:!1,range:"not 0",description:"The trackUID number of a track whose blocks are used to create this virtual track."},233:{name:"TrackJoinBlocks",level:4,type:"m",minver:3,webm:!1,description:"Contains the list of all tracks whose Blocks need to be combined to create this virtual track"},230:{name:"TrackPlaneType",level:6,type:"u",mandatory:!0,minver:3,webm:!1,description:"The kind of plane this track corresponds to (0: left eye, 1: right eye, 2: background)."},229:{name:"TrackPlaneUID",level:6,type:"u",mandatory:!0,minver:3,webm:!1,range:"not 0",description:"The trackUID number of the track representing the plane."},228:{name:"TrackPlane",level:5,type:"m",mandatory:!0,multiple:!0,minver:3,webm:!1,description:"Contains a video plane track that need to be combined to create this 3D track"},227:{name:"TrackCombinePlanes",level:4,type:"m",minver:3,webm:!1,description:"Contains the list of all video plane tracks that need to be combined to create this 3D track"},226:{name:"TrackOperation",level:3,type:"m",minver:3,webm:!1,description:"Operation that needs to be applied on tracks to create this virtual track. For more details look at the Specification Notes on the subject."},32123:{name:"ChannelPositions",cppname:"AudioPosition",level:4,type:"b",webm:!1,description:"Table of horizontal angles for each successive channel, see appendix."},159:{name:"Channels",cppname:"AudioChannels",level:4,type:"u",mandatory:!0,minver:1,default:1,range:"not 0",description:"Numbers of channels in the track."},30901:{name:"OutputSamplingFrequency",cppname:"AudioOutputSamplingFreq",level:4,type:"f",minver:1,default:"Sampling Frequency",range:"> 0",description:"Real output sampling frequency in Hz (used for SBR techniques)."},181:{name:"SamplingFrequency",cppname:"AudioSamplingFreq",level:4,type:"f",mandatory:!0,minver:1,default:8e3,range:"> 0",description:"Sampling frequency in Hz."},225:{name:"Audio",cppname:"TrackAudio",level:3,type:"m",minver:1,description:"Audio settings."},2327523:{name:"FrameRate",cppname:"VideoFrameRate",level:4,type:"f",range:"> 0",strong:"Informational",description:"Number of frames per second.  only."},3126563:{name:"GammaValue",cppname:"VideoGamma",level:4,type:"f",webm:!1,range:"> 0",description:"Gamma Value."},3061028:{name:"ColourSpace",cppname:"VideoColourSpace",level:4,type:"b",minver:1,webm:!1,bytesize:4,description:"Same value as in AVI (32 bits)."},21683:{name:"AspectRatioType",cppname:"VideoAspectRatio",level:4,type:"u",minver:1,default:0,description:"Specify the possible modifications to the aspect ratio (0: free resizing, 1: keep aspect ratio, 2: fixed)."},21682:{name:"DisplayUnit",cppname:"VideoDisplayUnit",level:4,type:"u",minver:1,default:0,description:"How DisplayWidth & DisplayHeight should be interpreted (0: pixels, 1: centimeters, 2: inches, 3: Display Aspect Ratio)."},21690:{name:"DisplayHeight",cppname:"VideoDisplayHeight",level:4,type:"u",minver:1,default:"PixelHeight",range:"not 0",description:"Height of the video frames to display. The default value is only valid when DisplayUnit is 0."},21680:{name:"DisplayWidth",cppname:"VideoDisplayWidth",level:4,type:"u",minver:1,default:"PixelWidth",range:"not 0",description:"Width of the video frames to display. The default value is only valid when DisplayUnit is 0."},21725:{name:"PixelCropRight",cppname:"VideoPixelCropRight",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the right of the image."},21708:{name:"PixelCropLeft",cppname:"VideoPixelCropLeft",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the left of the image."},21691:{name:"PixelCropTop",cppname:"VideoPixelCropTop",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the top of the image."},21674:{name:"PixelCropBottom",cppname:"VideoPixelCropBottom",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the bottom of the image (for HDTV content)."},186:{name:"PixelHeight",cppname:"VideoPixelHeight",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"Height of the encoded video frames in pixels."},176:{name:"PixelWidth",cppname:"VideoPixelWidth",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"Width of the encoded video frames in pixels."},21433:{name:"OldStereoMode",level:4,type:"u",maxver:"0",webm:!1,divx:!1,description:"DEPRECATED, DO NOT USE. Bogus StereoMode value used in old versions of libmatroska. (0: mono, 1: right eye, 2: left eye, 3: both eyes)."},21440:{name:"AlphaMode",cppname:"VideoAlphaMode",level:4,type:"u",minver:3,webm:!0,default:0,description:"Alpha Video Mode. Presence of this element indicates that the BlockAdditional element could contain Alpha data."},21432:{name:"StereoMode",cppname:"VideoStereoMode",level:4,type:"u",minver:3,webm:!0,default:0,description:"Stereo-3D video mode (0: mono, 1: side by side (left eye is first), 2: top-bottom (right eye is first), 3: top-bottom (left eye is first), 4: checkboard (right is first), 5: checkboard (left is first), 6: row interleaved (right is first), 7: row interleaved (left is first), 8: column interleaved (right is first), 9: column interleaved (left is first), 10: anaglyph (cyan/red), 11: side by side (right eye is first), 12: anaglyph (green/magenta), 13 both eyes laced in one Block (left eye is first), 14 both eyes laced in one Block (right eye is first)) . There are some more details on 3D support in the Specification Notes."},154:{name:"FlagInterlaced",cppname:"VideoFlagInterlaced",level:4,type:"u",mandatory:!0,minver:2,webm:!0,default:0,range:"0-1",description:"Set if the video is interlaced. (1 bit)"},224:{name:"Video",cppname:"TrackVideo",level:3,type:"m",minver:1,description:"Video settings."},26277:{name:"TrackTranslateTrackID",level:4,type:"b",mandatory:!0,minver:1,webm:!1,description:"The binary value used to represent this track in the chapter codec data. The format depends on the ChapProcessCodecID used."},26303:{name:"TrackTranslateCodec",level:4,type:"u",mandatory:!0,minver:1,webm:!1,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},26364:{name:"TrackTranslateEditionUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify an edition UID on which this translation applies. When not specified, it means for all editions found in the segment."},22203:{name:"SeekPreRoll",level:3,type:"u",mandatory:!0,multiple:!1,default:0,minver:4,webm:!0,description:"After a discontinuity, SeekPreRoll is the duration in nanoseconds of the data the decoder must decode before the decoded data is valid."},22186:{name:"CodecDelay",level:3,type:"u",multiple:!1,default:0,minver:4,webm:!0,description:"CodecDelay is The codec-built-in delay in nanoseconds. This value must be subtracted from each block timestamp in order to get the actual timestamp. The value should be small so the muxing of tracks with the same actual timestamp are in the same Cluster."},28587:{name:"TrackOverlay",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify that this track is an overlay track for the Track specified (in the u-integer). That means when this track has a gap (see SilentTracks) the overlay track should be used instead. The order of multiple TrackOverlay matters, the first one is the one that should be used. If not found it should be the second, etc."},170:{name:"CodecDecodeAll",level:3,type:"u",mandatory:!0,minver:2,webm:!1,default:1,range:"0-1",description:"The codec can decode potentially damaged data (1 bit)."},2536000:{name:"CodecDownloadURL",level:3,type:"s",multiple:!0,webm:!1,description:"A URL to download about the codec used."},3883072:{name:"CodecInfoURL",level:3,type:"s",multiple:!0,webm:!1,description:"A URL to find information about the codec used."},3839639:{name:"CodecSettings",level:3,type:"8",webm:!1,description:"A string describing the encoding setting used."},25506:{name:"CodecPrivate",level:3,type:"b",minver:1,description:"Private data only known to the codec."},2274716:{name:"Language",cppname:"TrackLanguage",level:3,type:"s",minver:1,default:"eng",description:"Specifies the language of the track in the Matroska languages form."},21358:{name:"Name",cppname:"TrackName",level:3,type:"8",minver:1,description:"A human-readable track name."},21998:{name:"MaxBlockAdditionID",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The maximum value of BlockAdditions for this track."},21375:{name:"TrackOffset",level:3,type:"i",webm:!1,default:0,description:"A value to add to the Block's Timestamp. This can be used to adjust the playback offset of a track."},2306383:{name:"TrackTimecodeScale",level:3,type:"f",mandatory:!0,minver:1,maxver:"3",webm:!1,default:1,range:"> 0",description:"DEPRECATED, DO NOT USE. The scale to apply on this track to work at normal speed in relation with other tracks (mostly used to adjust video speed when the audio length differs)."},2313850:{name:"DefaultDecodedFieldDuration",cppname:"TrackDefaultDecodedFieldDuration",level:3,type:"u",minver:4,range:"not 0",description:"The period in nanoseconds (not scaled by TimcodeScale)\nbetween two successive fields at the output of the decoding process (see the notes)"},2352003:{name:"DefaultDuration",cppname:"TrackDefaultDuration",level:3,type:"u",minver:1,range:"not 0",description:"Number of nanoseconds (not scaled via TimecodeScale) per frame ('frame' in the Matroska sense -- one element put into a (Simple)Block)."},28152:{name:"MaxCache",cppname:"TrackMaxCache",level:3,type:"u",minver:1,webm:!1,description:"The maximum cache size required to store referenced frames in and the current frame. 0 means no cache is needed."},28135:{name:"MinCache",cppname:"TrackMinCache",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The minimum number of frames a player should be able to cache during playback. If set to 0, the reference pseudo-cache system is not used."},156:{name:"FlagLacing",cppname:"TrackFlagLacing",level:3,type:"u",mandatory:!0,minver:1,default:1,range:"0-1",description:"Set if the track may contain blocks using lacing. (1 bit)"},21930:{name:"FlagForced",cppname:"TrackFlagForced",level:3,type:"u",mandatory:!0,minver:1,default:0,range:"0-1",description:"Set if that track MUST be active during playback. There can be many forced track for a kind (audio, video or subs), the player should select the one which language matches the user preference or the default + forced track. Overlay MAY happen between a forced and non-forced track of the same kind. (1 bit)"},185:{name:"FlagEnabled",cppname:"TrackFlagEnabled",level:3,type:"u",mandatory:!0,minver:2,webm:!0,default:1,range:"0-1",description:"Set if the track is usable. (1 bit)"},29637:{name:"TrackUID",level:3,type:"u",mandatory:!0,minver:1,range:"not 0",description:"A unique ID to identify the Track. This should be kept the same when making a direct stream copy of the Track to another file."},215:{name:"TrackNumber",level:3,type:"u",mandatory:!0,minver:1,range:"not 0",description:"The track number as used in the Block Header (using more than 127 tracks is not encouraged, though the design allows an unlimited number)."},174:{name:"TrackEntry",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Describes a track with all elements."},374648427:{name:"Tracks",level:1,type:"m",multiple:!0,minver:1,description:"A top-level block of information with many tracks described."},175:{name:"EncryptedBlock",level:2,type:"b",multiple:!0,webm:!1,description:"Similar to EncryptedBlock Structure)"},202:{name:"ReferenceTimeCode",level:4,type:"u",multiple:!1,mandatory:!0,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},201:{name:"ReferenceOffset",level:4,type:"u",multiple:!1,mandatory:!0,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},200:{name:"ReferenceFrame",level:3,type:"m",multiple:!1,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},207:{name:"SliceDuration",level:5,type:"u",default:0,description:"The (scaled) duration to apply to the element."},206:{name:"Delay",cppname:"SliceDelay",level:5,type:"u",default:0,description:"The (scaled) delay to apply to the element."},203:{name:"BlockAdditionID",cppname:"SliceBlockAddID",level:5,type:"u",default:0,description:"The ID of the BlockAdditional element (0 is the main Block)."},205:{name:"FrameNumber",cppname:"SliceFrameNumber",level:5,type:"u",default:0,description:"The number of the frame to generate from this lace with this delay (allow you to generate many frames from the same Block/Frame)."},204:{name:"LaceNumber",cppname:"SliceLaceNumber",level:5,type:"u",minver:1,default:0,divx:!1,description:"The reverse number of the frame in the lace (0 is the last frame, 1 is the next to last, etc). While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},232:{name:"TimeSlice",level:4,type:"m",multiple:!0,minver:1,divx:!1,description:"Contains extra time information about the data contained in the Block. While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},142:{name:"Slices",level:3,type:"m",minver:1,divx:!1,description:"Contains slices description."},30114:{name:"DiscardPadding",level:3,type:"i",minver:4,webm:!0,description:"Duration in nanoseconds of the silent data added to the Block (padding at the end of the Block for positive value, at the beginning of the Block for negative value). The duration of DiscardPadding is not calculated in the duration of the TrackEntry and should be discarded during playback."},164:{name:"CodecState",level:3,type:"b",minver:2,webm:!1,description:"The new codec state to use. Data interpretation is private to the codec. This information should always be referenced by a seek entry."},253:{name:"ReferenceVirtual",level:3,type:"i",webm:!1,description:"Relative position of the data that should be in position of the virtual block."},251:{name:"ReferenceBlock",level:3,type:"i",multiple:!0,minver:1,description:"Timestamp of another frame used as a reference (ie: B or P frame). The timestamp is relative to the block it's attached to."},250:{name:"ReferencePriority",cppname:"FlagReferenced",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"This frame is referenced and has the specified cache priority. In cache only a frame of the same or higher priority can replace this frame. A value of 0 means the frame is not referenced."},155:{name:"BlockDuration",level:3,type:"u",minver:1,default:"TrackDuration",description:'The duration of the Block (based on TimecodeScale). This element is mandatory when DefaultDuration is set for the track (but can be omitted as other default values). When not written and with no DefaultDuration, the value is assumed to be the difference between the timestamp of this Block and the timestamp of the next Block in "display" order (not coding order). This element can be useful at the end of a Track (as there is not other Block available), or when there is a break in a track like for subtitle tracks. When set to 0 that means the frame is not a keyframe.'},165:{name:"BlockAdditional",level:5,type:"b",mandatory:!0,minver:1,webm:!1,description:"Interpreted by the codec as it wishes (using the BlockAddID)."},238:{name:"BlockAddID",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"not 0",description:"An ID to identify the BlockAdditional level."},166:{name:"BlockMore",level:4,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Contain the BlockAdditional and some parameters."},30113:{name:"BlockAdditions",level:3,type:"m",minver:1,webm:!1,description:"Contain additional blocks to complete the main one. An EBML parser that has no knowledge of the Block structure could still see and use/skip these data."},162:{name:"BlockVirtual",level:3,type:"b",webm:!1,description:"A Block with no data. It must be stored in the stream at the place the real Block should be in display order. (see Block Virtual)"},161:{name:"Block",level:3,type:"b",mandatory:!0,minver:1,description:"Block containing the actual data to be rendered and a timestamp relative to the Cluster Timecode. (see Block Structure)"},160:{name:"BlockGroup",level:2,type:"m",multiple:!0,minver:1,description:"Basic container of information containing a single Block or BlockVirtual, and information specific to that Block/VirtualBlock."},163:{name:"SimpleBlock",level:2,type:"b",multiple:!0,minver:2,webm:!0,divx:!0,description:"Similar to SimpleBlock Structure"},171:{name:"PrevSize",cppname:"ClusterPrevSize",level:2,type:"u",minver:1,description:"Size of the previous Cluster, in octets. Can be useful for backward playing.",position:"prevCluster"},167:{name:"Position",cppname:"ClusterPosition",level:2,type:"u",minver:1,webm:!1,description:"The Position of the Cluster in the segment (0 in live broadcast streams). It might help to resynchronise offset on damaged streams.",position:"segment"},22743:{name:"SilentTrackNumber",cppname:"ClusterSilentTrackNumber",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"One of the track number that are not used from now on in the stream. It could change later if not specified as silent in a further Cluster."},231:{name:"Timecode",cppname:"ClusterTimecode",level:2,type:"u",mandatory:!0,minver:1,description:"Absolute timestamp of the cluster (based on TimecodeScale)."},524531317:{name:"Cluster",level:1,type:"m",multiple:!0,minver:1,description:"The lower level element containing the (monolithic) Block structure."},19840:{name:"MuxingApp",level:2,type:"8",mandatory:!0,minver:1,description:'Muxing application or library ("libmatroska-0.4.3").'},31657:{name:"Title",level:2,type:"8",minver:1,webm:!1,description:"General name of the segment."},2807730:{name:"TimecodeScaleDenominator",level:2,type:"u",mandatory:!0,minver:4,default:"1000000000",description:"Timestamp scale numerator, see TimecodeScale."},2807729:{name:"TimecodeScale",level:2,type:"u",mandatory:!0,minver:1,default:"1000000",description:"Timestamp scale in nanoseconds (1.000.000 means all timestamps in the segment are expressed in milliseconds)."},27045:{name:"ChapterTranslateID",level:3,type:"b",mandatory:!0,minver:1,webm:!1,description:"The binary value used to represent this segment in the chapter codec data. The format depends on the ChapProcessCodecID used."},27071:{name:"ChapterTranslateCodec",level:3,type:"u",mandatory:!0,minver:1,webm:!1,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},27132:{name:"ChapterTranslateEditionUID",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify an edition UID on which this correspondance applies. When not specified, it means for all editions found in the segment."},4096955:{name:"NextFilename",level:2,type:"8",minver:1,webm:!1,description:"An escaped filename corresponding to the next segment."},4110627:{name:"NextUID",level:2,type:"b",minver:1,webm:!1,bytesize:16,description:"A unique ID to identify the next chained segment (128 bits)."},3965867:{name:"PrevFilename",level:2,type:"8",minver:1,webm:!1,description:"An escaped filename corresponding to the previous segment."},3979555:{name:"PrevUID",level:2,type:"b",minver:1,webm:!1,bytesize:16,description:"A unique ID to identify the previous chained segment (128 bits)."},29604:{name:"SegmentUID",level:2,type:"b",minver:1,webm:!1,range:"not 0",bytesize:16,description:"A randomly generated unique ID to identify the current segment between many others (128 bits)."},357149030:{name:"Info",level:1,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains miscellaneous general information and statistics on the file."},21420:{name:"SeekPosition",level:3,type:"u",mandatory:!0,minver:1,description:"The position of the element in the segment in octets (0 = first level 1 element).",position:"segment"},21419:{name:"SeekID",level:3,type:"b",mandatory:!0,minver:1,description:"The binary ID corresponding to the element name.",type2:"ebmlID"},19899:{name:"Seek",cppname:"SeekPoint",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains a single seek entry to an EBML element."},290298740:{name:"SeekHead",cppname:"SeekHeader",level:1,type:"m",multiple:!0,minver:1,description:"Contains the position of other level 1 elements."},32379:{name:"SignatureElementList",level:2,type:"m",multiple:!0,webm:!1,i:"Cluster|Block|BlockAdditional",description:"A list consists of a number of consecutive elements that represent one case where data is used in signature. Ex:  means that the BlockAdditional of all Blocks in all Clusters is used for encryption."},32347:{name:"SignatureElements",level:1,type:"m",webm:!1,description:"Contains elements that will be used to compute the signature."},32437:{name:"Signature",level:1,type:"b",webm:!1,description:"The signature of the data (until a new."},32421:{name:"SignaturePublicKey",level:1,type:"b",webm:!1,description:"The public key to use with the algorithm (in the case of a PKI-based signature)."},32410:{name:"SignatureHash",level:1,type:"u",webm:!1,description:"Hash algorithm used (1=SHA1-160, 2=MD5)."},32394:{name:"SignatureAlgo",level:1,type:"u",webm:!1,description:"Signature algorithm used (1=RSA, 2=elliptic)."},458458727:{name:"SignatureSlot",level:-1,type:"m",multiple:!0,webm:!1,description:"Contain signature of some (coming) elements in the stream."},191:{name:"CRC-32",level:-1,type:"b",minver:1,webm:!1,description:"The CRC is computed on all the data of the Master element it's in. The CRC element should be the first in it's parent master for easier reading. All level 1 elements should include a CRC-32. The CRC in use is the IEEE CRC32 Little Endian",crc:!0},236:{name:"Void",level:-1,type:"b",minver:1,description:"Used to void damaged data, to avoid unexpected behaviors when using damaged data. The content is discarded. Also used to reserve space in a sub-element for later use."},17139:{name:"EBMLMaxSizeLength",level:1,type:"u",mandatory:!0,default:8,minver:1,description:"The maximum length of the sizes you'll find in this file (8 or less in Matroska). This does not override the element size indicated at the beginning of an element. Elements that have an indicated size which is larger than what is allowed by EBMLMaxSizeLength shall be considered invalid."},17138:{name:"EBMLMaxIDLength",level:1,type:"u",mandatory:!0,default:4,minver:1,description:"The maximum length of the IDs you'll find in this file (4 or less in Matroska)."},17143:{name:"EBMLReadVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The minimum EBML version a parser has to support to read this file."},440786851:{name:"EBML",level:"0",type:"m",mandatory:!0,multiple:!0,minver:1,description:"Set the EBML characteristics of the data to follow. Each EBML document has to start with this."}},i={},o={byEbmlID:r,byName:i};for(var a in r){i[r[a].name.replace("-","_")]=parseInt(a,10)}t.exports=o},{}],18:[function(e,t,n){t.exports={name:"ts-ebml",version:"2.0.2",description:"ebml decoder and encoder",scripts:{setup:"npm install -g http-server;",init:"npm run update; npm run mkdir; npm run build",update:"npm run reset; npm update",reset:"rm -rf node_modules",mkdir:"mkdir lib dist 2>/dev/null",clean:"rm -rf lib/* dist/* test/*.js; mkdir -p dist",build:"npm run clean   && tsc    -p .; npm run browserify",start:"http-server . -s & tsc -w -p .& watchify lib/example_seekable.js -o test/example_seekable.js",stop:"killall -- node */tsc -w -p",browserify:"browserify lib/index.js --standalone EBML -o dist/EBML.js",watchify:"watchify lib/index.js --standalone EBML -o dist/EBMl.js -v",test:"tsc; espower lib/test.js > lib/test.tmp; mv -f lib/test.tmp lib/test.js; browserify lib/test.js -o test/test.js",example:"tsc; browserify lib/example_seekable.js -o test/example_seekable.js",examples:"tsc; for file in `find lib -name 'example_*.js' -type f -printf '%f\\n'`; do browserify lib/$file -o test/$file; done",examples_bsd:"tsc; for file in `find lib -name 'example_*.js' -type f -print`; do browserify lib/$(basename $file) -o test/$(basename $file); done",check:"tsc -w --noEmit -p ./",lint:"tslint -c ./tslint.json --project ./tsconfig.json --type-check",doc:"typedoc --mode modules --out doc --disableOutputCheck"},repository:{type:"git",url:"git+https://github.com/legokichi/ts-ebml.git"},keywords:["ebml","webm","mkv","matrosika","webp"],author:"legokichi duckscallion",license:"MIT",bugs:{url:"https://github.com/legokichi/ts-ebml/issues"},homepage:"https://github.com/legokichi/ts-ebml#readme",dependencies:{buffer:"^5.0.7",commander:"^2.11.0",ebml:"^2.2.1","ebml-block":"^1.1.0",events:"^1.1.1","int64-buffer":"^0.1.9",matroska:"^2.2.3"},devDependencies:{"@types/commander":"^2.9.1","@types/qunit":"^2.0.31",browserify:"^13.1.0",empower:"^1.2.3","espower-cli":"^1.1.0","power-assert":"^1.4.4","power-assert-formatter":"^1.4.1","qunit-tap":"^1.5.1",qunitjs:"^2.4.0",tslint:"^3.15.1",typedoc:"^0.5.3",typescript:"^2.4.2",watchify:"^3.7.0"},bin:"./lib/cli.js",main:"./lib/index.js",typings:"./lib/index.d.ts"}},{}]},{},[4])(4)}),RecordRTC.version="5.5.9","undefined"!=typeof module&&(module.exports=RecordRTC),"function"==typeof define&&define.amd&&define("RecordRTC",[],function(){return RecordRTC}),RecordRTC.getFromDisk=function(e,t){if(!t)throw"callback is mandatory.";console.log("Getting recorded "+("all"===e?"blobs":e+" blob ")+" from disk!"),DiskStorage.Fetch(function(n,r){"all"!==e&&r===e+"Blob"&&t&&t(n),"all"===e&&t&&t(n,r.replace("Blob",""))})},RecordRTC.writeToDisk=function(e){console.log("Writing recorded blob(s) to disk!"),(e=e||{}).audio&&e.video&&e.gif?e.audio.getDataURL(function(t){e.video.getDataURL(function(n){e.gif.getDataURL(function(e){DiskStorage.Store({audioBlob:t,videoBlob:n,gifBlob:e})})})}):e.audio&&e.video?e.audio.getDataURL(function(t){e.video.getDataURL(function(e){DiskStorage.Store({audioBlob:t,videoBlob:e})})}):e.audio&&e.gif?e.audio.getDataURL(function(t){e.gif.getDataURL(function(e){DiskStorage.Store({audioBlob:t,gifBlob:e})})}):e.video&&e.gif?e.video.getDataURL(function(t){e.gif.getDataURL(function(e){DiskStorage.Store({videoBlob:t,gifBlob:e})})}):e.audio?e.audio.getDataURL(function(e){DiskStorage.Store({audioBlob:e})}):e.video?e.video.getDataURL(function(e){DiskStorage.Store({videoBlob:e})}):e.gif&&e.gif.getDataURL(function(e){DiskStorage.Store({gifBlob:e})})},MRecordRTC.getFromDisk=RecordRTC.getFromDisk,MRecordRTC.writeToDisk=RecordRTC.writeToDisk,void 0!==RecordRTC&&(RecordRTC.MRecordRTC=MRecordRTC);var browserFakeUserAgent="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";!function(e){e&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}},global.console||(global.console={}),void 0!==global.console.log&&void 0!==global.console.error||(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(e.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return e},e.HTMLVideoElement=function(){}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}),void 0===URL&&(e.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),e.window=global)}("undefined"!=typeof global?global:null);var requestAnimationFrame=window.requestAnimationFrame;if(void 0===requestAnimationFrame)if("undefined"!=typeof webkitRequestAnimationFrame)requestAnimationFrame=webkitRequestAnimationFrame;else if("undefined"!=typeof mozRequestAnimationFrame)requestAnimationFrame=mozRequestAnimationFrame;else if("undefined"!=typeof msRequestAnimationFrame)requestAnimationFrame=msRequestAnimationFrame;else if(void 0===requestAnimationFrame){var lastTime=0;requestAnimationFrame=function(e,t){var n=(new Date).getTime(),r=Math.max(0,16-(n-lastTime)),i=setTimeout(function(){e(n+r)},r);return lastTime=n+r,i}}var cancelAnimationFrame=window.cancelAnimationFrame;void 0===cancelAnimationFrame&&("undefined"!=typeof webkitCancelAnimationFrame?cancelAnimationFrame=webkitCancelAnimationFrame:"undefined"!=typeof mozCancelAnimationFrame?cancelAnimationFrame=mozCancelAnimationFrame:"undefined"!=typeof msCancelAnimationFrame?cancelAnimationFrame=msCancelAnimationFrame:void 0===cancelAnimationFrame&&(cancelAnimationFrame=function(e){clearTimeout(e)}));var AudioContext=window.AudioContext;void 0===AudioContext&&("undefined"!=typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(AudioContext=mozAudioContext));var URL=window.URL;void 0===URL&&"undefined"!=typeof webkitURL&&(URL=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var isEdge=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),isOpera=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(navigator.userAgent),isChrome=!isOpera&&!isEdge&&!!navigator.webkitGetUserMedia||isElectron()||-1!==navigator.userAgent.toLowerCase().indexOf("chrome/"),isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);isSafari&&!isChrome&&-1!==navigator.userAgent.indexOf("CriOS")&&(isSafari=!1,isChrome=!0);var MediaStream=window.MediaStream;void 0===MediaStream&&"undefined"!=typeof webkitMediaStream&&(MediaStream=webkitMediaStream),void 0!==MediaStream&&void 0===MediaStream.prototype.stop&&(MediaStream.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})}),void 0!==RecordRTC&&(RecordRTC.invokeSaveAsDialog=invokeSaveAsDialog,RecordRTC.getTracks=getTracks,RecordRTC.getSeekableBlob=getSeekableBlob,RecordRTC.bytesToSize=bytesToSize,RecordRTC.isElectron=isElectron);var Storage={};void 0!==AudioContext?Storage.AudioContext=AudioContext:"undefined"!=typeof webkitAudioContext&&(Storage.AudioContext=webkitAudioContext),void 0!==RecordRTC&&(RecordRTC.Storage=Storage),void 0!==RecordRTC&&(RecordRTC.MediaStreamRecorder=MediaStreamRecorder),void 0!==RecordRTC&&(RecordRTC.StereoAudioRecorder=StereoAudioRecorder),void 0!==RecordRTC&&(RecordRTC.CanvasRecorder=CanvasRecorder),void 0!==RecordRTC&&(RecordRTC.WhammyRecorder=WhammyRecorder);var Whammy=function(){function e(e){this.frames=[],this.duration=e||1,this.quality=.8}function t(e){function t(e,t,n){return[{data:e,id:231}].concat(n.map(function(e){var n=function(e){var t=0;if(e.keyframe&&(t|=128),e.invisible&&(t|=8),e.lacing&&(t|=e.lacing<<1),e.discardable&&(t|=1),e.trackNum>127)throw"TrackNumber > 127 not supported";return[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map(function(e){return String.fromCharCode(e)}).join("")+e.frame}({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(t)});return t+=e.duration,{data:n,id:163}}))}function n(e){for(var t=[];e>0;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function r(e){var t=[];e=(e.length%8?new Array(9-e.length%8).join("0"):"")+e;for(var n=0;n<e.length;n+=8)t.push(parseInt(e.substr(n,8),2));return new Uint8Array(t)}function i(e,t){return parseInt(e.substr(t+4,4).split("").map(function(e){var t=e.charCodeAt(0).toString(2);return new Array(8-t.length+1).join("0")+t}).join(""),2)}var o=new function(e){var i,o=function(e){if(e[0]){for(var t=e[0].width,n=e[0].height,r=e[0].duration,i=1;i<e.length;i++)r+=e[i].duration;return{duration:r,width:t,height:n}}postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."})}(e);if(!o)return[];for(var a=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(i=o.duration,[].slice.call(new Uint8Array(new Float64Array([i]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:o.width,id:176},{data:o.height,id:186}]}]}]}]}],s=0,c=0;s<e.length;){var u=[],l=0;do{u.push(e[s]),l+=e[s].duration,s++}while(s<e.length&&l<3e4);var d={id:524531317,data:t(c,0,u)};a[1].data.push(d),c+=l}return function e(t){for(var i=[],o=0;o<t.length;o++){var a=t[o].data;"object"==typeof a&&(a=e(a)),"number"==typeof a&&(a=r(a.toString(2))),"string"==typeof a&&(a=new Uint8Array(a.split("").map(function(e){return e.charCodeAt(0)})));var s=a.size||a.byteLength||a.length,c=Math.ceil(Math.ceil(Math.log(s)/Math.log(2))/8),u=s.toString(2),l=new Array(7*c+7+1-u.length).join("0")+u,d=new Array(c).join("0")+"1"+l;i.push(n(t[o].id)),i.push(r(d)),i.push(a)}return new Blob(i,{type:"video/webm"})}(a)}(e.map(function(e){var t=function(e){for(var t=e.RIFF[0].WEBP[0],n=t.indexOf("*"),r=0,i=[];r<4;r++)i[r]=t.charCodeAt(n+3+r);return{width:16383&(i[1]<<8|i[0]),height:16383&(i[3]<<8|i[2]),data:t,riff:e}}(function e(t){for(var n=0,r={};n<t.length;){var o=t.substr(n,4),a=i(t,n),s=t.substr(n+4+4,a);n+=8+a,r[o]=r[o]||[],"RIFF"===o||"LIST"===o?r[o].push(e(s)):r[o].push(s)}return r}(atob(e.image.slice(23))));return t.duration=e.duration,t}));postMessage(o)}return e.prototype.add=function(e,t){if("canvas"in e&&(e=e.canvas),"toDataURL"in e&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},e.prototype.compile=function(e){var n,r,i,o=(n=t,r=URL.createObjectURL(new Blob([n.toString(),"this.onmessage =  function (eee) {"+n.name+"(eee.data);}"],{type:"application/javascript"})),i=new Worker(r),URL.revokeObjectURL(r),i);o.onmessage=function(t){return t.data.error?void console.error(t.data.error):void e(t.data)},o.postMessage(this.frames)},{Video:e}}();void 0!==RecordRTC&&(RecordRTC.Whammy=Whammy);var DiskStorage={init:function(){function e(e){e.createObjectStore(n.dataStoreName)}function t(){function e(e){t.objectStore(n.dataStoreName).get(e).onsuccess=function(t){n.callback&&n.callback(t.target.result,e)}}var t=r.transaction([n.dataStoreName],"readwrite");n.videoBlob&&t.objectStore(n.dataStoreName).put(n.videoBlob,"videoBlob"),n.gifBlob&&t.objectStore(n.dataStoreName).put(n.gifBlob,"gifBlob"),n.audioBlob&&t.objectStore(n.dataStoreName).put(n.audioBlob,"audioBlob"),e("audioBlob"),e("videoBlob"),e("gifBlob")}var n=this;if("undefined"!=typeof indexedDB&&void 0!==indexedDB.open){var r,i=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),o=indexedDB.open(i,1);o.onerror=n.onError,o.onsuccess=function(){if((r=o.result).onerror=n.onError,r.setVersion)if(1!==r.version){r.setVersion(1).onsuccess=function(){e(r),t()}}else t();else t()},o.onupgradeneeded=function(t){e(t.target.result)}}else console.error("IndexedDB API are not available in this browser.")},Fetch:function(e){return this.callback=e,this.init(),this},Store:function(e){return this.audioBlob=e.audioBlob,this.videoBlob=e.videoBlob,this.gifBlob=e.gifBlob,this.init(),this},onError:function(e){console.error(JSON.stringify(e,null,"\t"))},dataStoreName:"recordRTC",dbName:null};void 0!==RecordRTC&&(RecordRTC.DiskStorage=DiskStorage),void 0!==RecordRTC&&(RecordRTC.GifRecorder=GifRecorder),void 0===RecordRTC&&("undefined"!=typeof module&&(module.exports=MultiStreamsMixer),"function"==typeof define&&define.amd&&define("MultiStreamsMixer",[],function(){return MultiStreamsMixer})),void 0!==RecordRTC&&(RecordRTC.MultiStreamRecorder=MultiStreamRecorder),void 0!==RecordRTC&&(RecordRTC.RecordRTCPromisesHandler=RecordRTCPromisesHandler),void 0!==RecordRTC&&(RecordRTC.WebAssemblyRecorder=WebAssemblyRecorder),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.io=t():e.io=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e,t){"object"===(void 0===e?"undefined":i(e))&&(t=e,e=void 0),t=t||{};var n,r=o(e),a=r.source,l=r.id,d=r.path,f=u[l]&&d in u[l].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||f?(c("ignoring socket cache for %s",a),n=s(a,t)):(u[l]||(c("new io instance for %s",a),u[l]=s(a,t)),n=u[l]),r.query&&!t.query&&(t.query=r.query),n.socket(r.path,t)}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(1),a=n(7),s=n(12),c=n(3)("socket.io-client");e.exports=t=r;var u=t.managers={};t.protocol=a.protocol,t.connect=r,t.Manager=n(12),t.Socket=n(37)},function(e,t,n){(function(t){"use strict";var r=n(2),i=n(3)("socket.io-client:url");e.exports=function(e,n){var o=e;n=n||t.location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e=void 0!==n?n.protocol+"//"+e:"https://"+e),i("parse %s",e),o=r(e)),o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443")),o.path=o.path||"/";var a=-1!==o.host.indexOf(":")?"["+o.host+"]":o.host;return o.id=o.protocol+"://"+a+":"+o.port,o.href=o.protocol+"://"+a+(n&&n.port===o.port?"":":"+o.port),o}}).call(t,function(){return this}())},function(e,t){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,i=e.indexOf("["),o=e.indexOf("]");-1!=i&&-1!=o&&(e=e.substring(0,i)+e.substring(i,o).replace(/:/g,";")+e.substring(o,e.length));for(var a=n.exec(e||""),s={},c=14;c--;)s[r[c]]=a[c]||"";return-1!=i&&-1!=o&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},function(e,t,n){(function(r){function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(5)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(o=++i)}),e.splice(o,0,r)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(t,n(4))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function o(){h&&f&&(h=!1,f.length?p=f.concat(p):m=-1,p.length&&a())}function a(){if(!h){var e=i(o);h=!0;for(var t=p.length;t;){for(f=p,p=[];++m<t;)f&&f[m].run();m=-1,t=p.length}f=null,h=!1,function(e){if(l===clearTimeout)return clearTimeout(e);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}(e)}}function s(e,t){this.fun=e,this.array=t}function c(){}var u,l,d=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(e){l=r}}();var f,p=[],h=!1,m=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new s(e,t)),1!==p.length||h||i(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.prependListener=c,d.prependOnceListener=c,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t,n){function r(e){function n(){if(n.enabled){var e=n,i=+new Date,o=i-(r||i);e.diff=o,e.prev=r,e.curr=i,r=i;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var i=t.formatters[r];if("function"==typeof i){var o=a[c];n=i.call(e,o),a.splice(c,1),c--}return n}),t.formatArgs.call(e,a),(n.log||t.log||console.log.bind(console)).apply(e,a)}}var r;return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),n.destroy=i,"function"==typeof t.init&&t.init(n),t.instances.push(n),n}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];var n,r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(6),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){function n(e){return r(e,s,"day")||r(e,a,"hour")||r(e,o,"minute")||r(e,i,"second")||e+" ms"}function r(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var i=1e3,o=60*i,a=60*o,s=24*a,c=365.25*s;e.exports=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*c;case"days":case"day":case"d":return n*s;case"hours":case"hour":case"hrs":case"hr":case"h":return n*a;case"minutes":case"minute":case"mins":case"min":case"m":return n*o;case"seconds":case"second":case"secs":case"sec":case"s":return n*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(e);if("number"===r&&!1===isNaN(e))return t.long?n(e):function(e){return e>=s?Math.round(e/s)+"d":e>=a?Math.round(e/a)+"h":e>=o?Math.round(e/o)+"m":e>=i?Math.round(e/i)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){function r(){}function i(e){var n=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(n+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(n+=e.nsp+","),null!=e.id&&(n+=e.id),null!=e.data){var r=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===r)return h;n+=r}return u("encoded %j as %s",e,n),n}function o(){this.reconstructor=null}function a(e){var n=0,r={type:Number(e.charAt(0))};if(null==t.types[r.type])return c("unknown packet type "+r.type);if(t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type){for(var i="";"-"!==e.charAt(++n)&&(i+=e.charAt(n),n!=e.length););if(i!=Number(i)||"-"!==e.charAt(n))throw new Error("Illegal attachments");r.attachments=Number(i)}if("/"===e.charAt(n+1))for(r.nsp="";++n;){if(","===(a=e.charAt(n)))break;if(r.nsp+=a,n===e.length)break}else r.nsp="/";var o=e.charAt(n+1);if(""!==o&&Number(o)==o){for(r.id="";++n;){var a;if(null==(a=e.charAt(n))||Number(a)!=a){--n;break}if(r.id+=e.charAt(n),n===e.length)break}r.id=Number(r.id)}if(e.charAt(++n)){var s=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(n));if(!(!1!==s&&(r.type===t.ERROR||f(s))))return c("invalid payload");r.data=s}return u("decoded %s as %j",e,r),r}function s(e){this.reconPack=e,this.buffers=[]}function c(e){return{type:t.ERROR,data:"parser error: "+e}}var u=n(3)("socket.io-parser"),l=n(8),d=n(9),f=n(10),p=n(11);t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=r,t.Decoder=o;var h=t.ERROR+'"encode error"';r.prototype.encode=function(e,n){(u("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)?function(e,t){d.removeBlobs(e,function(e){var n=d.deconstructPacket(e),r=i(n.packet),o=n.buffers;o.unshift(r),t(o)})}(e,n):n([i(e)])},l(o.prototype),o.prototype.add=function(e){var n;if("string"==typeof e)n=a(e),t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type?(this.reconstructor=new s(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!p(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",n))}},o.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},s.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=d.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},s.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,n){function r(e){if(e)return function(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}(e)}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r,i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,n){(function(e){var r=n(10),i=n(11),o=Object.prototype.toString,a="function"==typeof e.Blob||"[object BlobConstructor]"===o.call(e.Blob),s="function"==typeof e.File||"[object FileConstructor]"===o.call(e.File);t.deconstructPacket=function(e){var t=[],n=e.data,o=e;return o.data=function e(t,n){if(!t)return t;if(i(t)){var o={_placeholder:!0,num:n.length};return n.push(t),o}if(r(t)){for(var a=new Array(t.length),s=0;s<t.length;s++)a[s]=e(t[s],n);return a}if("object"==typeof t&&!(t instanceof Date)){for(var c in a={},t)a[c]=e(t[c],n);return a}return t}(n,t),o.attachments=t.length,{packet:o,buffers:t}},t.reconstructPacket=function(e,t){return e.data=function e(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(r(t))for(var i=0;i<t.length;i++)t[i]=e(t[i],n);else if("object"==typeof t)for(var o in t)t[o]=e(t[o],n);return t}(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){var n=0,o=e;(function e(c,u,l){if(!c)return c;if(a&&c instanceof Blob||s&&c instanceof File){n++;var d=new FileReader;d.onload=function(){l?l[u]=this.result:o=this.result,--n||t(o)},d.readAsArrayBuffer(c)}else if(r(c))for(var f=0;f<c.length;f++)e(c[f],f,c);else if("object"==typeof c&&!i(c))for(var p in c)e(c[p],p,c)})(o),n||t(o)}}).call(t,function(){return this}())},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){(function(t){e.exports=function(e){return n&&t.Buffer.isBuffer(e)||r&&(e instanceof t.ArrayBuffer||i(e))};var n="function"==typeof t.Buffer&&"function"==typeof t.Buffer.isBuffer,r="function"==typeof t.ArrayBuffer,i=r&&"function"==typeof t.ArrayBuffer.isView?t.ArrayBuffer.isView:function(e){return e.buffer instanceof t.ArrayBuffer}}).call(t,function(){return this}())},function(e,t,n){"use strict";function r(e,t){if(!(this instanceof r))return new r(e,t);e&&"object"===(void 0===e?"undefined":i(e))&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new p({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||c;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(13),a=n(37),s=n(8),c=n(7),u=n(39),l=n(40),d=n(3)("socket.io-client:manager"),f=n(36),p=n(41),h=Object.prototype.hasOwnProperty;e.exports=r,r.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)h.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},r.prototype.updateSocketIds=function(){for(var e in this.nsps)h.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},r.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},s(r.prototype),r.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},r.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},r.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},r.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},r.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},r.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},r.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},r.prototype.open=r.prototype.connect=function(e,t){if(d("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;d("opening %s",this.uri),this.engine=o(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var i=u(n,"open",function(){r.onopen(),e&&e()}),a=u(n,"error",function(t){if(d("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else r.maybeReconnectOnOpen()});if(!1!==this._timeout){var s=this._timeout;d("connect attempt will timeout after %d",s);var c=setTimeout(function(){d("connect attempt timed out after %d",s),i.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",s)},s);this.subs.push({destroy:function(){clearTimeout(c)}})}return this.subs.push(i),this.subs.push(a),this},r.prototype.onopen=function(){d("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(u(e,"data",l(this,"ondata"))),this.subs.push(u(e,"ping",l(this,"onping"))),this.subs.push(u(e,"pong",l(this,"onpong"))),this.subs.push(u(e,"error",l(this,"onerror"))),this.subs.push(u(e,"close",l(this,"onclose"))),this.subs.push(u(this.decoder,"decoded",l(this,"ondecoded")))},r.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},r.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},r.prototype.ondata=function(e){this.decoder.add(e)},r.prototype.ondecoded=function(e){this.emit("packet",e)},r.prototype.onerror=function(e){d("error",e),this.emitAll("error",e)},r.prototype.socket=function(e,t){function n(){~f(i.connecting,r)||i.connecting.push(r)}var r=this.nsps[e];if(!r){r=new a(this,e,t),this.nsps[e]=r;var i=this;r.on("connecting",n),r.on("connect",function(){r.id=i.generateId(e)}),this.autoConnect&&n()}return r},r.prototype.destroy=function(e){var t=f(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},r.prototype.packet=function(e){d("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(n){for(var r=0;r<n.length;r++)t.engine.write(n[r],e.options);t.encoding=!1,t.processPacketQueue()}))},r.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},r.prototype.cleanup=function(){d("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},r.prototype.close=r.prototype.disconnect=function(){d("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},r.prototype.onclose=function(e){d("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},r.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)d("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();d("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(d("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(d("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(d("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},r.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,n){e.exports=n(14),e.exports.parser=n(21)},function(e,t,n){(function(t){function r(e,n){if(!(this instanceof r))return new r(e,n);n=n||{},e&&"object"==typeof e&&(n=e,e=null),e?(e=u(e),n.hostname=e.host,n.secure="https"===e.protocol||"wss"===e.protocol,n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=u(n.host).host),this.secure=null!=n.secure?n.secure:t.location&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.agent=n.agent||!1,this.hostname=n.hostname||(t.location?location.hostname:"localhost"),this.port=n.port||(t.location&&location.port?location.port:this.secure?443:80),this.query=n.query||{},"string"==typeof this.query&&(this.query=l.decode(this.query)),this.upgrade=!1!==n.upgrade,this.path=(n.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!n.forceJSONP,this.jsonp=!1!==n.jsonp,this.forceBase64=!!n.forceBase64,this.enablesXDR=!!n.enablesXDR,this.timestampParam=n.timestampParam||"t",this.timestampRequests=n.timestampRequests,this.transports=n.transports||["polling","websocket"],this.transportOptions=n.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=n.policyPort||843,this.rememberUpgrade=n.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=n.onlyBinaryUpgrades,this.perMessageDeflate=!1!==n.perMessageDeflate&&(n.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=n.pfx||null,this.key=n.key||null,this.passphrase=n.passphrase||null,this.cert=n.cert||null,this.ca=n.ca||null,this.ciphers=n.ciphers||null,this.rejectUnauthorized=void 0===n.rejectUnauthorized||n.rejectUnauthorized,this.forceNode=!!n.forceNode;var i="object"==typeof t&&t;i.global===i&&(n.extraHeaders&&Object.keys(n.extraHeaders).length>0&&(this.extraHeaders=n.extraHeaders),n.localAddress&&(this.localAddress=n.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}var i=n(15),o=n(8),a=n(3)("engine.io-client:socket"),s=n(36),c=n(21),u=n(2),l=n(30);e.exports=r,r.priorWebsocketSuccess=!1,o(r.prototype),r.protocol=c.protocol,r.Socket=r,r.Transport=n(20),r.transports=n(15),r.parser=n(21),r.prototype.createTransport=function(e){a('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=c.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new i[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0})},r.prototype.open=function(){var e;if(this.rememberUpgrade&&r.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},r.prototype.setTransport=function(e){a("setting transport %s",e.name);var t=this;this.transport&&(a("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},r.prototype.probe=function(e){function t(){if(f.onlyBinaryUpgrades){var t=!this.supportsBinary&&f.transport.supportsBinary;d=d||t}d||(a('probe transport "%s" opened',e),l.send([{type:"ping",data:"probe"}]),l.once("packet",function(t){if(!d)if("pong"===t.type&&"probe"===t.data){if(a('probe transport "%s" pong',e),f.upgrading=!0,f.emit("upgrading",l),!l)return;r.priorWebsocketSuccess="websocket"===l.name,a('pausing current transport "%s"',f.transport.name),f.transport.pause(function(){d||"closed"!==f.readyState&&(a("changing transport and sending upgrade packet"),u(),f.setTransport(l),l.send([{type:"upgrade"}]),f.emit("upgrade",l),l=null,f.upgrading=!1,f.flush())})}else{a('probe transport "%s" failed',e);var n=new Error("probe error");n.transport=l.name,f.emit("upgradeError",n)}}))}function n(){d||(d=!0,u(),l.close(),l=null)}function i(t){var r=new Error("probe error: "+t);r.transport=l.name,n(),a('probe transport "%s" failed because of error: %s',e,t),f.emit("upgradeError",r)}function o(){i("transport closed")}function s(){i("socket closed")}function c(e){l&&e.name!==l.name&&(a('"%s" works - aborting "%s"',e.name,l.name),n())}function u(){l.removeListener("open",t),l.removeListener("error",i),l.removeListener("close",o),f.removeListener("close",s),f.removeListener("upgrading",c)}a('probing transport "%s"',e);var l=this.createTransport(e,{probe:1}),d=!1,f=this;r.priorWebsocketSuccess=!1,l.once("open",t),l.once("error",i),l.once("close",o),this.once("close",s),this.once("upgrading",c),l.open()},r.prototype.onOpen=function(){if(a("socket open"),this.readyState="open",r.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){a("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},r.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(a('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else a('packet received with socket readyState "%s"',this.readyState)},r.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},r.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},r.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){a("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},r.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},r.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},r.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(a("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},r.prototype.write=r.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},r.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var i={type:e,data:t,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}},r.prototype.close=function(){function e(){r.onClose("forced close"),a("socket closing - telling transport to close"),r.transport.close()}function t(){r.removeListener("upgrade",t),r.removeListener("upgradeError",t),e()}function n(){r.once("upgrade",t),r.once("upgradeError",t)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var r=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():e()}):this.upgrading?n():e()}return this},r.prototype.onError=function(e){a("socket error %j",e),r.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},r.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){a('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},r.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~s(this.transports,e[n])&&t.push(e[n]);return t}}).call(t,function(){return this}())},function(e,t,n){(function(e){var r=n(16),i=n(18),o=n(33),a=n(34);t.polling=function(t){var n=!1,a=!1,s=!1!==t.jsonp;if(e.location){var c="https:"===location.protocol,u=location.port;u||(u=c?443:80),n=t.hostname!==location.hostname||u!==t.port,a=t.secure!==c}if(t.xdomain=n,t.xscheme=a,"open"in new r(t)&&!t.forceJSONP)return new i(t);if(!s)throw new Error("JSONP disabled");return new o(t)},t.websocket=a}).call(t,function(){return this}())},function(e,t,n){(function(t){var r=n(17);e.exports=function(e){var n=e.xdomain,i=e.xscheme,o=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!n||r))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!i&&o)return new XDomainRequest}catch(e){}if(!n)try{return new(t[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}).call(t,function(){return this}())},function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(e,t,n){(function(t){function r(){}function i(e){if(c.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,t.location){var n="https:"===location.protocol,r=location.port;r||(r=n?443:80),this.xd=e.hostname!==t.location.hostname||r!==e.port,this.xs=e.secure!==n}}function o(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function a(){for(var e in o.requests)o.requests.hasOwnProperty(e)&&o.requests[e].abort()}var s=n(16),c=n(19),u=n(8),l=n(31),d=n(3)("engine.io-client:polling-xhr");e.exports=i,e.exports.Request=o,l(i,c),i.prototype.supportsBinary=!0,i.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new o(e)},i.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),i=this;r.on("success",t),r.on("error",function(e){i.onError("xhr post error",e)}),this.sendXhr=r},i.prototype.doPoll=function(){d("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},u(o.prototype),o.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var n=this.xhr=new s(e),r=this;try{d("xhr open %s: %s",this.method,this.uri),n.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var i in n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&n.setRequestHeader(i,this.extraHeaders[i])}catch(e){}if("POST"===this.method)try{this.isBinary?n.setRequestHeader("Content-type","application/octet-stream"):n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{n.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in n&&(n.withCredentials=!0),this.requestTimeout&&(n.timeout=this.requestTimeout),this.hasXDR()?(n.onload=function(){r.onLoad()},n.onerror=function(){r.onError(n.responseText)}):n.onreadystatechange=function(){if(2===n.readyState)try{var e=n.getResponseHeader("Content-Type");r.supportsBinary&&"application/octet-stream"===e&&(n.responseType="arraybuffer")}catch(e){}4===n.readyState&&(200===n.status||1223===n.status?r.onLoad():setTimeout(function(){r.onError(n.status)},0))},d("xhr data %s",this.data),n.send(this.data)}catch(e){return void setTimeout(function(){r.onError(e)},0)}t.document&&(this.index=o.requestsCount++,o.requests[this.index]=this)},o.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},o.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},o.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},o.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=r:this.xhr.onreadystatechange=r,e)try{this.xhr.abort()}catch(e){}t.document&&delete o.requests[this.index],this.xhr=null}},o.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},o.prototype.hasXDR=function(){return void 0!==t.XDomainRequest&&!this.xs&&this.enablesXDR},o.prototype.abort=function(){this.cleanup()},o.requestsCount=0,o.requests={},t.document&&(t.attachEvent?t.attachEvent("onunload",a):t.addEventListener&&t.addEventListener("beforeunload",a,!1))}).call(t,function(){return this}())},function(e,t,n){function r(e){var t=e&&e.forceBase64;l&&!t||(this.supportsBinary=!1),i.call(this,e)}var i=n(20),o=n(30),a=n(21),s=n(31),c=n(32),u=n(3)("engine.io-client:polling");e.exports=r;var l=null!=new(n(16))({xdomain:!1}).responseType;s(r,i),r.prototype.name="polling",r.prototype.doOpen=function(){this.poll()},r.prototype.pause=function(e){function t(){u("paused"),n.readyState="paused",e()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(u("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){u("pre-pause polling complete"),--r||t()})),this.writable||(u("we are currently writing - waiting to pause"),r++,this.once("drain",function(){u("pre-pause writing complete"),--r||t()}))}else t()},r.prototype.poll=function(){u("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},r.prototype.onData=function(e){var t=this;u("polling got data %s",e);a.decodePayload(e,this.socket.binaryType,function(e,n,r){return"opening"===t.readyState&&t.onOpen(),"close"===e.type?(t.onClose(),!1):void t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():u('ignoring poll - transport state "%s"',this.readyState))},r.prototype.doClose=function(){function e(){u("writing close packet"),t.write([{type:"close"}])}var t=this;"open"===this.readyState?(u("transport open - closing"),e()):(u("transport not open - deferring close"),this.once("open",e))},r.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};a.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},r.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||e.sid||(e.b64=1),e=o.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},function(e,t,n){function r(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}var i=n(21),o=n(8);e.exports=r,o(r.prototype),r.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},r.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},r.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},r.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},r.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},r.prototype.onData=function(e){var t=i.decodePacket(e,this.socket.binaryType);this.onPacket(t)},r.prototype.onPacket=function(e){this.emit("packet",e)},r.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t,n){(function(e){function r(e,n){return n("b"+t.packets[e.type]+e.data.data)}function i(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=e.data,o=new Uint8Array(i),a=new Uint8Array(1+i.byteLength);a[0]=g[e.type];for(var s=0;s<o.length;s++)a[s+1]=o[s];return r(a.buffer)}function o(e,n,r){if(!n)return t.encodeBase64Packet(e,r);if(m)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=new FileReader;return i.onload=function(){e.data=i.result,t.encodePacket(e,n,!0,r)},i.readAsArrayBuffer(e.data)}(e,n,r);var i=new Uint8Array(1);return i[0]=g[e.type],r(new b([i.buffer,e.data]))}function a(e,t,n){for(var r=new Array(e.length),i=d(e.length,n),o=function(e,n,i){t(n,function(t,n){r[e]=n,i(t,r)})},a=0;a<e.length;a++)o(a,e[a],i)}var s,c=n(22),u=n(23),l=n(24),d=n(25),f=n(26);e&&e.ArrayBuffer&&(s=n(28));var p="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),h="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),m=p||h;t.protocol=3;var g=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},v=c(g),y={type:"error",data:"parser error"},b=n(29);t.encodePacket=function(t,n,a,s){"function"==typeof n&&(s=n,n=!1),"function"==typeof a&&(s=a,a=null);var c=void 0===t.data?void 0:t.data.buffer||t.data;if(e.ArrayBuffer&&c instanceof ArrayBuffer)return i(t,n,s);if(b&&c instanceof e.Blob)return o(t,n,s);if(c&&c.base64)return r(t,s);var u=g[t.type];return void 0!==t.data&&(u+=a?f.encode(String(t.data),{strict:!1}):String(t.data)),s(""+u)},t.encodeBase64Packet=function(n,r){var i,o="b"+t.packets[n.type];if(b&&n.data instanceof e.Blob){var a=new FileReader;return a.onload=function(){var e=a.result.split(",")[1];r(o+e)},a.readAsDataURL(n.data)}try{i=String.fromCharCode.apply(null,new Uint8Array(n.data))}catch(e){for(var s=new Uint8Array(n.data),c=new Array(s.length),u=0;u<s.length;u++)c[u]=s[u];i=String.fromCharCode.apply(null,c)}return o+=e.btoa(i),r(o)},t.decodePacket=function(e,n,r){if(void 0===e)return y;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(r&&!1===(e=function(e){try{e=f.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return y;var i=e.charAt(0);return Number(i)==i&&v[i]?e.length>1?{type:v[i],data:e.substring(1)}:{type:v[i]}:y}i=new Uint8Array(e)[0];var o=l(e,1);return b&&"blob"===n&&(o=new b([o])),{type:v[i],data:o}},t.decodeBase64Packet=function(e,t){var n=v[e.charAt(0)];if(!s)return{type:n,data:{base64:!0,data:e.substr(1)}};var r=s.decode(e.substr(1));return"blob"===t&&b&&(r=new b([r])),{type:n,data:r}},t.encodePayload=function(e,n,r){"function"==typeof n&&(r=n,n=null);var i=u(e);return n&&i?b&&!m?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r):e.length?void a(e,function(e,r){t.encodePacket(e,!!i&&n,!1,function(e){r(null,function(e){return e.length+":"+e}(e))})},function(e,t){return r(t.join(""))}):r("0:")},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);var i;if("function"==typeof n&&(r=n,n=null),""===e)return r(y,0,1);for(var o,a,s="",c=0,u=e.length;c<u;c++){var l=e.charAt(c);if(":"===l){if(""===s||s!=(o=Number(s)))return r(y,0,1);if(s!=(a=e.substr(c+1,o)).length)return r(y,0,1);if(a.length){if(i=t.decodePacket(a,n,!1),y.type===i.type&&y.data===i.data)return r(y,0,1);if(!1===r(i,c+o,u))return}c+=o,s=""}else s+=l}return""!==s?r(y,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){return e.length?void a(e,function(e,n){t.encodePacket(e,!0,!0,function(e){return n(null,e)})},function(e,t){var r=t.reduce(function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2},0),i=new Uint8Array(r),o=0;return t.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);n=r.buffer}i[o++]=t?0:1;var s=n.byteLength.toString();for(a=0;a<s.length;a++)i[o++]=parseInt(s[a]);i[o++]=255;for(r=new Uint8Array(n),a=0;a<r.length;a++)i[o++]=r[a]}),n(i.buffer)}):n(new ArrayBuffer(0))},t.encodePayloadAsBlob=function(e,n){a(e,function(e,n){t.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);e=r.buffer,t[0]=0}var o=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),a=new Uint8Array(o.length+1);for(i=0;i<o.length;i++)a[i]=parseInt(o[i]);if(a[o.length]=255,b){var s=new b([t.buffer,a.buffer,e]);n(null,s)}})},function(e,t){return n(new b(t))})},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var i=e,o=[];i.byteLength>0;){for(var a=new Uint8Array(i),s=0===a[0],c="",u=1;255!==a[u];u++){if(c.length>310)return r(y,0,1);c+=a[u]}i=l(i,2+c.length),c=parseInt(c);var d=l(i,0,c);if(s)try{d=String.fromCharCode.apply(null,new Uint8Array(d))}catch(e){var f=new Uint8Array(d);d="";for(u=0;u<f.length;u++)d+=String.fromCharCode(f[u])}o.push(d),i=l(i,c)}var p=o.length;o.forEach(function(e,i){r(t.decodePacket(e,n,!0),i,p)})}}).call(t,function(){return this}())},function(e,t){e.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t}},function(e,t,n){(function(t){var r=n(10),i=Object.prototype.toString,o="function"==typeof t.Blob||"[object BlobConstructor]"===i.call(t.Blob),a="function"==typeof t.File||"[object FileConstructor]"===i.call(t.File);e.exports=function e(n){if(!n||"object"!=typeof n)return!1;if(r(n)){for(var i=0,s=n.length;i<s;i++)if(e(n[i]))return!0;return!1}if("function"==typeof t.Buffer&&t.Buffer.isBuffer&&t.Buffer.isBuffer(n)||"function"==typeof t.ArrayBuffer&&n instanceof ArrayBuffer||o&&n instanceof Blob||a&&n instanceof File)return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return e(n.toJSON(),!0);for(var c in n)if(Object.prototype.hasOwnProperty.call(n,c)&&e(n[c]))return!0;return!1}}).call(t,function(){return this}())},function(e,t){e.exports=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(n-t),a=t,s=0;a<n;a++,s++)o[s]=i[a];return o.buffer}},function(e,t){function n(){}e.exports=function(e,t,r){function i(e,n){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(o=!0,t(e),t=r):0!==i.count||o||t(null,n)}var o=!1;return r=r||n,i.count=e,0===e?t():i}},function(e,t,n){var r;(function(e,i){!function(o){function a(e){for(var t,n,r=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function s(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function c(e,t){return g(e>>t&63|128)}function u(e,t){if(0==(4294967168&e))return g(e);var n="";return 0==(4294965248&e)?n=g(e>>6&31|192):0==(4294901760&e)?(s(e,t)||(e=65533),n=g(e>>12&15|224),n+=c(e,6)):0==(4292870144&e)&&(n=g(e>>18&7|240),n+=c(e,12),n+=c(e,6)),n+g(63&e|128)}function l(){if(m>=h)throw Error("Invalid byte index");var e=255&p[m];if(m++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function d(e){var t,n;if(m>h)throw Error("Invalid byte index");if(m==h)return!1;if(t=255&p[m],m++,0==(128&t))return t;if(192==(224&t)){if((n=(31&t)<<6|l())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&t)){if((n=(15&t)<<12|l()<<6|l())>=2048)return s(n,e)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&((n=(7&t)<<18|l()<<12|l()<<6|l())>=65536&&n<=1114111))return n;throw Error("Invalid UTF-8 detected")}var f=("object"==typeof e&&e&&e.exports,"object"==typeof i&&i);f.global!==f&&f.window;var p,h,m,g=String.fromCharCode,v={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,r=a(e),i=r.length,o=-1,s="";++o<i;)s+=u(r[o],n);return s},decode:function(e,t){var n=!1!==(t=t||{}).strict;p=a(e),h=p.length,m=0;for(var r,i=[];!1!==(r=d(n));)i.push(r);return function(e){for(var t,n=e.length,r=-1,i="";++r<n;)(t=e[r])>65535&&(i+=g((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=g(t);return i}(i)}};void 0===(r=function(){return v}.call(t,n,t,e))||(e.exports=r)}()}).call(t,n(27)(e),function(){return this}())},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<e.length;r++)n[e.charCodeAt(r)]=r;t.encode=function(t){var n,r=new Uint8Array(t),i=r.length,o="";for(n=0;n<i;n+=3)o+=e[r[n]>>2],o+=e[(3&r[n])<<4|r[n+1]>>4],o+=e[(15&r[n+1])<<2|r[n+2]>>6],o+=e[63&r[n+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,r,i,o,a,s=.75*e.length,c=e.length,u=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var l=new ArrayBuffer(s),d=new Uint8Array(l);for(t=0;t<c;t+=4)r=n[e.charCodeAt(t)],i=n[e.charCodeAt(t+1)],o=n[e.charCodeAt(t+2)],a=n[e.charCodeAt(t+3)],d[u++]=r<<2|i>>4,d[u++]=(15&i)<<4|o>>2,d[u++]=(3&o)<<6|63&a;return l}}()},function(e,t){(function(t){function n(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var i=new Uint8Array(n.byteLength);i.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=i.buffer}e[t]=r}}}function r(e,t){t=t||{};var r=new o;n(e);for(var i=0;i<e.length;i++)r.append(e[i]);return t.type?r.getBlob(t.type):r.getBlob()}function i(e,t){return n(e),new Blob(e,t||{})}var o=t.BlobBuilder||t.WebKitBlobBuilder||t.MSBlobBuilder||t.MozBlobBuilder,a=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),s=a&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),c=o&&o.prototype.append&&o.prototype.getBlob;e.exports=a?s?t.Blob:i:c?r:void 0}).call(t,function(){return this}())},function(e,t){t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),r=0,i=n.length;r<i;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},function(e,t){e.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){"use strict";function n(e){var t="";do{t=o[e%a]+t,e=Math.floor(e/a)}while(e>0);return t}function r(){var e=n(+new Date);return e!==i?(c=0,i=e):e+"."+n(c++)}for(var i,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),a=64,s={},c=0,u=0;u<a;u++)s[o[u]]=u;r.encode=n,r.decode=function(e){var t=0;for(u=0;u<e.length;u++)t=t*a+s[e.charAt(u)];return t},e.exports=r},function(e,t,n){(function(t){function r(){}function i(e){o.call(this,e),this.query=this.query||{},s||(t.___eio||(t.___eio=[]),s=t.___eio),this.index=s.length;var n=this;s.push(function(e){n.onData(e)}),this.query.j=this.index,t.document&&t.addEventListener&&t.addEventListener("beforeunload",function(){n.script&&(n.script.onerror=r)},!1)}var o=n(19),a=n(31);e.exports=i;var s,c=/\n/g,u=/\\n/g;a(i,o),i.prototype.supportsBinary=!1,i.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),o.prototype.doClose.call(this)},i.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},i.prototype.doWrite=function(e,t){function n(){r(),t()}function r(){if(i.iframe)try{i.form.removeChild(i.iframe)}catch(e){i.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+i.iframeId+'">';o=document.createElement(e)}catch(e){(o=document.createElement("iframe")).name=i.iframeId,o.src="javascript:0"}o.id=i.iframeId,i.form.appendChild(o),i.iframe=o}var i=this;if(!this.form){var o,a=document.createElement("form"),s=document.createElement("textarea"),l=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=l,a.method="POST",a.setAttribute("accept-charset","utf-8"),s.name="d",a.appendChild(s),document.body.appendChild(a),this.form=a,this.area=s}this.form.action=this.uri(),r(),e=e.replace(u,"\\\n"),this.area.value=e.replace(c,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===i.iframe.readyState&&n()}:this.iframe.onload=n}}).call(t,function(){return this}())},function(e,t,n){(function(t){function r(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=d&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(f=i),o.call(this,e)}var i,o=n(20),a=n(21),s=n(30),c=n(31),u=n(32),l=n(3)("engine.io-client:websocket"),d=t.WebSocket||t.MozWebSocket;if("undefined"==typeof window)try{i=n(35)}catch(e){}var f=d;f||"undefined"!=typeof window||(f=i),e.exports=r,c(r,o),r.prototype.name="websocket",r.prototype.supportsBinary=!0,r.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?t?new f(e,t):new f(e):new f(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},r.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},r.prototype.write=function(e){var n=this;this.writable=!1;for(var r=e.length,i=0,o=r;i<o;i++)!function(e){a.encodePacket(e,n.supportsBinary,function(i){if(!n.usingBrowserWebSocket){var o={};if(e.options&&(o.compress=e.options.compress),n.perMessageDeflate)("string"==typeof i?t.Buffer.byteLength(i):i.length)<n.perMessageDeflate.threshold&&(o.compress=!1)}try{n.usingBrowserWebSocket?n.ws.send(i):n.ws.send(i,o)}catch(e){l("websocket closed before onclose event")}--r||(n.emit("flush"),setTimeout(function(){n.writable=!0,n.emit("drain")},0))})}(e[i])},r.prototype.onClose=function(){o.prototype.onClose.call(this)},r.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},r.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=u()),this.supportsBinary||(e.b64=1),(e=s.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},r.prototype.check=function(){return!(!f||"__initialize"in f&&this.name===r.prototype.name)}}).call(t,function(){return this}())},function(e,t){},function(e,t){var n=[].indexOf;e.exports=function(e,t){if(n)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}},function(e,t,n){"use strict";function r(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(7),a=n(8),s=n(38),c=n(39),u=n(40),l=n(3)("socket.io-client:socket"),d=n(30),f=n(23);e.exports=r;var p={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},h=a.prototype.emit;a(r.prototype),r.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[c(e,"open",u(this,"onopen")),c(e,"packet",u(this,"onpacket")),c(e,"close",u(this,"onclose"))]}},r.prototype.open=r.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},r.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},r.prototype.emit=function(e){if(p.hasOwnProperty(e))return h.apply(this,arguments),this;var t=s(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:f(t))?o.BINARY_EVENT:o.EVENT,data:t,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(l("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},r.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},r.prototype.onopen=function(){if(l("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"===i(this.query)?d.encode(this.query):this.query;l("sending connect packet with query %s",e),this.packet({type:o.CONNECT,query:e})}else this.packet({type:o.CONNECT})},r.prototype.onclose=function(e){l("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},r.prototype.onpacket=function(e){var t=e.nsp===this.nsp,n=e.type===o.ERROR&&"/"===e.nsp;if(t||n)switch(e.type){case o.CONNECT:this.onconnect();break;case o.EVENT:case o.BINARY_EVENT:this.onevent(e);break;case o.ACK:case o.BINARY_ACK:this.onack(e);break;case o.DISCONNECT:this.ondisconnect();break;case o.ERROR:this.emit("error",e.data)}},r.prototype.onevent=function(e){var t=e.data||[];l("emitting event %j",t),null!=e.id&&(l("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?h.apply(this,t):this.receiveBuffer.push(t)},r.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var r=s(arguments);l("sending ack %j",r),t.packet({type:f(r)?o.BINARY_ACK:o.ACK,id:e,data:r})}}},r.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(l("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):l("bad ack %s",e.id)},r.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},r.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)h.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},r.prototype.ondisconnect=function(){l("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},r.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},r.prototype.close=r.prototype.disconnect=function(){return this.connected&&(l("performing disconnect (%s)",this.nsp),this.packet({type:o.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},r.prototype.compress=function(e){return this.flags.compress=e,this},r.prototype.binary=function(e){return this.flags.binary=e,this}},function(e,t){e.exports=function(e,t){for(var n=[],r=(t=t||0)||0;r<e.length;r++)n[r-t]=e[r];return n}},function(e,t){"use strict";e.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},function(e,t){var n=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return t.apply(e,r.concat(n.call(arguments)))}}},function(e,t){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}}])}),function(e,t){"function"==typeof define&&define.amd?define(["exports"],t):"object"==typeof exports&&"string"!=typeof exports.nodeName?t(module.exports):t(e)}(this,function(e){var t;function n(e,t,n){null!=e&&("number"==typeof e?this.fromNumber(e,t,n):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function r(){return new n(null)}"Microsoft Internet Explorer"==navigator.appName?(n.prototype.am=function(e,t,n,r,i,o){for(var a=32767&t,s=t>>15;--o>=0;){var c=32767&this[e],u=this[e++]>>15,l=s*c+u*a;i=((c=a*c+((32767&l)<<15)+n[r]+(1073741823&i))>>>30)+(l>>>15)+s*u+(i>>>30),n[r++]=1073741823&c}return i},t=30):"Netscape"!=navigator.appName?(n.prototype.am=function(e,t,n,r,i,o){for(;--o>=0;){var a=t*this[e++]+n[r]+i;i=Math.floor(a/67108864),n[r++]=67108863&a}return i},t=26):(n.prototype.am=function(e,t,n,r,i,o){for(var a=16383&t,s=t>>14;--o>=0;){var c=16383&this[e],u=this[e++]>>14,l=s*c+u*a;i=((c=a*c+((16383&l)<<14)+n[r]+i)>>28)+(l>>14)+s*u,n[r++]=268435455&c}return i},t=28),n.prototype.DB=t,n.prototype.DM=(1<<t)-1,n.prototype.DV=1<<t;n.prototype.FV=Math.pow(2,52),n.prototype.F1=52-t,n.prototype.F2=2*t-52;var i,o,a="0123456789abcdefghijklmnopqrstuvwxyz",s=new Array;for(i="0".charCodeAt(0),o=0;o<=9;++o)s[i++]=o;for(i="a".charCodeAt(0),o=10;o<36;++o)s[i++]=o;for(i="A".charCodeAt(0),o=10;o<36;++o)s[i++]=o;function c(e){return a.charAt(e)}function u(e,t){var n=s[e.charCodeAt(t)];return null==n?-1:n}function l(e){var t=r();return t.fromInt(e),t}function d(e){var t,n=1;return 0!=(t=e>>>16)&&(e=t,n+=16),0!=(t=e>>8)&&(e=t,n+=8),0!=(t=e>>4)&&(e=t,n+=4),0!=(t=e>>2)&&(e=t,n+=2),0!=(t=e>>1)&&(e=t,n+=1),n}function f(e){this.m=e}function p(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function h(e,t){return e&t}function m(e,t){return e|t}function g(e,t){return e^t}function y(e,t){return e&~t}function b(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function S(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function C(){}function w(e){return e}function T(e){this.r2=r(),this.q3=r(),n.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}f.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},f.prototype.revert=function(e){return e},f.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},f.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},f.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},p.prototype.convert=function(e){var t=r();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(n.ZERO)>0&&this.m.subTo(t,t),t},p.prototype.revert=function(e){var t=r();return e.copyTo(t),this.reduce(t),t},p.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=32767&e[t],r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[n=t+this.m.t]+=this.m.am(0,r,e,t,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},p.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},p.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},n.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},n.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},n.prototype.fromString=function(e,t){var r;if(16==t)r=4;else if(8==t)r=3;else if(256==t)r=8;else if(2==t)r=1;else if(32==t)r=5;else{if(4!=t)return void this.fromRadix(e,t);r=2}this.t=0,this.s=0;for(var i=e.length,o=!1,a=0;--i>=0;){var s=8==r?255&e[i]:u(e,i);s<0?"-"==e.charAt(i)&&(o=!0):(o=!1,0==a?this[this.t++]=s:a+r>this.DB?(this[this.t-1]|=(s&(1<<this.DB-a)-1)<<a,this[this.t++]=s>>this.DB-a):this[this.t-1]|=s<<a,(a+=r)>=this.DB&&(a-=this.DB))}8==r&&0!=(128&e[0])&&(this.s=-1,a>0&&(this[this.t-1]|=(1<<this.DB-a)-1<<a)),this.clamp(),o&&n.ZERO.subTo(this,this)},n.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},n.prototype.dlShiftTo=function(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s},n.prototype.drShiftTo=function(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s},n.prototype.lShiftTo=function(e,t){var n,r=e%this.DB,i=this.DB-r,o=(1<<i)-1,a=Math.floor(e/this.DB),s=this.s<<r&this.DM;for(n=this.t-1;n>=0;--n)t[n+a+1]=this[n]>>i|s,s=(this[n]&o)<<r;for(n=a-1;n>=0;--n)t[n]=0;t[a]=s,t.t=this.t+a+1,t.s=this.s,t.clamp()},n.prototype.rShiftTo=function(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)t.t=0;else{var r=e%this.DB,i=this.DB-r,o=(1<<r)-1;t[0]=this[n]>>r;for(var a=n+1;a<this.t;++a)t[a-n-1]|=(this[a]&o)<<i,t[a-n]=this[a]>>r;r>0&&(t[this.t-n-1]|=(this.s&o)<<i),t.t=this.t-n,t.clamp()}},n.prototype.subTo=function(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);n<i;)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r-=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[n++]=this.DV+r:r>0&&(t[n++]=r),t.t=n,t.clamp()},n.prototype.multiplyTo=function(e,t){var r=this.abs(),i=e.abs(),o=r.t;for(t.t=o+i.t;--o>=0;)t[o]=0;for(o=0;o<i.t;++o)t[o+r.t]=r.am(0,i[o],t,o,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&n.ZERO.subTo(t,t)},n.prototype.squareTo=function(e){for(var t=this.abs(),n=e.t=2*t.t;--n>=0;)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()},n.prototype.divRemTo=function(e,t,i){var o=e.abs();if(!(o.t<=0)){var a=this.abs();if(a.t<o.t)return null!=t&&t.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=r());var s=r(),c=this.s,u=e.s,l=this.DB-d(o[o.t-1]);l>0?(o.lShiftTo(l,s),a.lShiftTo(l,i)):(o.copyTo(s),a.copyTo(i));var f=s.t,p=s[f-1];if(0!=p){var h=p*(1<<this.F1)+(f>1?s[f-2]>>this.F2:0),m=this.FV/h,g=(1<<this.F1)/h,v=1<<this.F2,y=i.t,b=y-f,S=null==t?r():t;for(s.dlShiftTo(b,S),i.compareTo(S)>=0&&(i[i.t++]=1,i.subTo(S,i)),n.ONE.dlShiftTo(f,S),S.subTo(s,s);s.t<f;)s[s.t++]=0;for(;--b>=0;){var C=i[--y]==p?this.DM:Math.floor(i[y]*m+(i[y-1]+v)*g);if((i[y]+=s.am(0,C,i,b,0,f))<C)for(s.dlShiftTo(b,S),i.subTo(S,i);i[y]<--C;)i.subTo(S,i)}null!=t&&(i.drShiftTo(f,t),c!=u&&n.ZERO.subTo(t,t)),i.t=f,i.clamp(),l>0&&i.rShiftTo(l,i),c<0&&n.ZERO.subTo(i,i)}}},n.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},n.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},n.prototype.exp=function(e,t){if(e>4294967295||e<1)return n.ONE;var i=r(),o=r(),a=t.convert(this),s=d(e)-1;for(a.copyTo(i);--s>=0;)if(t.sqrTo(i,o),(e&1<<s)>0)t.mulTo(o,a,i);else{var c=i;i=o,o=c}return t.revert(i)},n.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var n,r=(1<<t)-1,i=!1,o="",a=this.t,s=this.DB-a*this.DB%t;if(a-- >0)for(s<this.DB&&(n=this[a]>>s)>0&&(i=!0,o=c(n));a>=0;)s<t?(n=(this[a]&(1<<s)-1)<<t-s,n|=this[--a]>>(s+=this.DB-t)):(n=this[a]>>(s-=t)&r,s<=0&&(s+=this.DB,--a)),n>0&&(i=!0),i&&(o+=c(n));return i?o:"0"},n.prototype.negate=function(){var e=r();return n.ZERO.subTo(this,e),e},n.prototype.abs=function(){return this.s<0?this.negate():this},n.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var n=this.t;if(0!=(t=n-e.t))return this.s<0?-t:t;for(;--n>=0;)if(0!=(t=this[n]-e[n]))return t;return 0},n.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+d(this[this.t-1]^this.s&this.DM)},n.prototype.mod=function(e){var t=r();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(n.ZERO)>0&&e.subTo(t,t),t},n.prototype.modPowInt=function(e,t){var n;return n=e<256||t.isEven()?new f(t):new p(t),this.exp(e,n)},n.ZERO=l(0),n.ONE=l(1),C.prototype.convert=w,C.prototype.revert=w,C.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n)},C.prototype.sqrTo=function(e,t){e.squareTo(t)},T.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=r();return e.copyTo(t),this.reduce(t),t},T.prototype.revert=function(e){return e},T.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},T.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},T.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var R=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],k=(1<<26)/R[R.length-1];function _(){this.i=0,this.j=0,this.S=new Array}n.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},n.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),i=l(n),o=r(),a=r(),s="";for(this.divRemTo(i,o,a);o.signum()>0;)s=(n+a.intValue()).toString(e).substr(1)+s,o.divRemTo(i,o,a);return a.intValue().toString(e)+s},n.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var r=this.chunkSize(t),i=Math.pow(t,r),o=!1,a=0,s=0,c=0;c<e.length;++c){var l=u(e,c);l<0?"-"==e.charAt(c)&&0==this.signum()&&(o=!0):(s=t*s+l,++a>=r&&(this.dMultiply(i),this.dAddOffset(s,0),a=0,s=0))}a>0&&(this.dMultiply(Math.pow(t,a)),this.dAddOffset(s,0)),o&&n.ZERO.subTo(this,this)},n.prototype.fromNumber=function(e,t,r){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(n.ONE.shiftLeft(e-1),m,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(n.ONE.shiftLeft(e-1),this);else{var i=new Array,o=7&e;i.length=1+(e>>3),t.nextBytes(i),o>0?i[0]&=(1<<o)-1:i[0]=0,this.fromString(i,256)}},n.prototype.bitwiseTo=function(e,t,n){var r,i,o=Math.min(e.t,this.t);for(r=0;r<o;++r)n[r]=t(this[r],e[r]);if(e.t<this.t){for(i=e.s&this.DM,r=o;r<this.t;++r)n[r]=t(this[r],i);n.t=this.t}else{for(i=this.s&this.DM,r=o;r<e.t;++r)n[r]=t(i,e[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()},n.prototype.changeBit=function(e,t){var r=n.ONE.shiftLeft(e);return this.bitwiseTo(r,t,r),r},n.prototype.addTo=function(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);n<i;)r+=this[n]+e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r+=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r+=e[n],t[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t[n++]=r:r<-1&&(t[n++]=this.DV+r),t.t=n,t.clamp()},n.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},n.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},n.prototype.multiplyLowerTo=function(e,t,n){var r,i=Math.min(this.t+e.t,t);for(n.s=0,n.t=i;i>0;)n[--i]=0;for(r=n.t-this.t;i<r;++i)n[i+this.t]=this.am(0,e[i],n,i,0,this.t);for(r=Math.min(e.t,t);i<r;++i)this.am(0,e[i],n,i,0,t-i);n.clamp()},n.prototype.multiplyUpperTo=function(e,t,n){--t;var r=n.t=this.t+e.t-t;for(n.s=0;--r>=0;)n[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n[this.t+r-t]=this.am(t-r,e[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)},n.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(0==t)n=this[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this[r])%e;return n},n.prototype.millerRabin=function(e){var t=this.subtract(n.ONE),i=t.getLowestSetBit();if(i<=0)return!1;var o=t.shiftRight(i);(e=e+1>>1)>R.length&&(e=R.length);for(var a=r(),s=0;s<e;++s){a.fromInt(R[Math.floor(Math.random()*R.length)]);var c=a.modPow(o,this);if(0!=c.compareTo(n.ONE)&&0!=c.compareTo(t)){for(var u=1;u++<i&&0!=c.compareTo(t);)if(0==(c=c.modPowInt(2,this)).compareTo(n.ONE))return!1;if(0!=c.compareTo(t))return!1}}return!0},n.prototype.clone=function(){var e=r();return this.copyTo(e),e},n.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},n.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},n.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},n.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},n.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var n,r=this.DB-e*this.DB%8,i=0;if(e-- >0)for(r<this.DB&&(n=this[e]>>r)!=(this.s&this.DM)>>r&&(t[i++]=n|this.s<<this.DB-r);e>=0;)r<8?(n=(this[e]&(1<<r)-1)<<8-r,n|=this[--e]>>(r+=this.DB-8)):(n=this[e]>>(r-=8)&255,r<=0&&(r+=this.DB,--e)),0!=(128&n)&&(n|=-256),0==i&&(128&this.s)!=(128&n)&&++i,(i>0||n!=this.s)&&(t[i++]=n);return t},n.prototype.equals=function(e){return 0==this.compareTo(e)},n.prototype.min=function(e){return this.compareTo(e)<0?this:e},n.prototype.max=function(e){return this.compareTo(e)>0?this:e},n.prototype.and=function(e){var t=r();return this.bitwiseTo(e,h,t),t},n.prototype.or=function(e){var t=r();return this.bitwiseTo(e,m,t),t},n.prototype.xor=function(e){var t=r();return this.bitwiseTo(e,g,t),t},n.prototype.andNot=function(e){var t=r();return this.bitwiseTo(e,y,t),t},n.prototype.not=function(){for(var e=r(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},n.prototype.shiftLeft=function(e){var t=r();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},n.prototype.shiftRight=function(e){var t=r();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},n.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+b(this[e]);return this.s<0?this.t*this.DB:-1},n.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,n=0;n<this.t;++n)e+=S(this[n]^t);return e},n.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},n.prototype.setBit=function(e){return this.changeBit(e,m)},n.prototype.clearBit=function(e){return this.changeBit(e,y)},n.prototype.flipBit=function(e){return this.changeBit(e,g)},n.prototype.add=function(e){var t=r();return this.addTo(e,t),t},n.prototype.subtract=function(e){var t=r();return this.subTo(e,t),t},n.prototype.multiply=function(e){var t=r();return this.multiplyTo(e,t),t},n.prototype.divide=function(e){var t=r();return this.divRemTo(e,t,null),t},n.prototype.remainder=function(e){var t=r();return this.divRemTo(e,null,t),t},n.prototype.divideAndRemainder=function(e){var t=r(),n=r();return this.divRemTo(e,t,n),new Array(t,n)},n.prototype.modPow=function(e,t){var n,i,o=e.bitLength(),a=l(1);if(o<=0)return a;n=o<18?1:o<48?3:o<144?4:o<768?5:6,i=o<8?new f(t):t.isEven()?new T(t):new p(t);var s=new Array,c=3,u=n-1,h=(1<<n)-1;if(s[1]=i.convert(this),n>1){var m=r();for(i.sqrTo(s[1],m);c<=h;)s[c]=r(),i.mulTo(m,s[c-2],s[c]),c+=2}var g,v,y=e.t-1,b=!0,S=r();for(o=d(e[y])-1;y>=0;){for(o>=u?g=e[y]>>o-u&h:(g=(e[y]&(1<<o+1)-1)<<u-o,y>0&&(g|=e[y-1]>>this.DB+o-u)),c=n;0==(1&g);)g>>=1,--c;if((o-=c)<0&&(o+=this.DB,--y),b)s[g].copyTo(a),b=!1;else{for(;c>1;)i.sqrTo(a,S),i.sqrTo(S,a),c-=2;c>0?i.sqrTo(a,S):(v=a,a=S,S=v),i.mulTo(S,s[g],a)}for(;y>=0&&0==(e[y]&1<<o);)i.sqrTo(a,S),v=a,a=S,S=v,--o<0&&(o=this.DB-1,--y)}return i.revert(a)},n.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return n.ZERO;for(var r=e.clone(),i=this.clone(),o=l(1),a=l(0),s=l(0),c=l(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),t?(o.isEven()&&a.isEven()||(o.addTo(this,o),a.subTo(e,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(e,a),a.rShiftTo(1,a);for(;i.isEven();)i.rShiftTo(1,i),t?(s.isEven()&&c.isEven()||(s.addTo(this,s),c.subTo(e,c)),s.rShiftTo(1,s)):c.isEven()||c.subTo(e,c),c.rShiftTo(1,c);r.compareTo(i)>=0?(r.subTo(i,r),t&&o.subTo(s,o),a.subTo(c,a)):(i.subTo(r,i),t&&s.subTo(o,s),c.subTo(a,c))}return 0!=i.compareTo(n.ONE)?n.ZERO:c.compareTo(e)>=0?c.subtract(e):c.signum()<0?(c.addTo(e,c),c.signum()<0?c.add(e):c):c},n.prototype.pow=function(e){return this.exp(e,new C)},n.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),o=n.getLowestSetBit();if(o<0)return t;for(i<o&&(o=i),o>0&&(t.rShiftTo(o,t),n.rShiftTo(o,n));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return o>0&&n.lShiftTo(o,n),n},n.prototype.isProbablePrime=function(e){var t,n=this.abs();if(1==n.t&&n[0]<=R[R.length-1]){for(t=0;t<R.length;++t)if(n[0]==R[t])return!0;return!1}if(n.isEven())return!1;for(t=1;t<R.length;){for(var r=R[t],i=t+1;i<R.length&&r<k;)r*=R[i++];for(r=n.modInt(r);t<i;)if(r%R[t++]==0)return!1}return n.millerRabin(e)},n.prototype.square=function(){var e=r();return this.squareTo(e),e},_.prototype.init=function(e){var t,n,r;for(t=0;t<256;++t)this.S[t]=t;for(n=0,t=0;t<256;++t)n=n+this.S[t]+e[t%e.length]&255,r=this.S[t],this.S[t]=this.S[n],this.S[n]=r;this.i=0,this.j=0},_.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var E,P,I,M=256;if(null==P){var D;if(P=new Array,I=0,window.crypto&&window.crypto.getRandomValues){var A=new Uint32Array(256);for(window.crypto.getRandomValues(A),D=0;D<A.length;++D)P[I++]=255&A[D]}var O=function(e){if(this.count=this.count||0,this.count>=256||I>=M)window.removeEventListener?window.removeEventListener("mousemove",O,!1):window.detachEvent&&window.detachEvent("onmousemove",O);else try{var t=e.x+e.y;P[I++]=255&t,this.count+=1}catch(e){}};window.addEventListener?window.addEventListener("mousemove",O,!1):window.attachEvent&&window.attachEvent("onmousemove",O)}function x(){if(null==E){for(E=new _;I<M;){var e=Math.floor(65536*Math.random());P[I++]=255&e}for(E.init(P),I=0;I<P.length;++I)P[I]=0;I=0}return E.next()}function U(){}function B(e,t){return new n(e,t)}function j(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}U.prototype.nextBytes=function(e){var t;for(t=0;t<e.length;++t)e[t]=x()},j.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},j.prototype.setPublic=function(e,t){null!=e&&null!=t&&e.length>0&&t.length>0?(this.n=B(e,16),this.e=parseInt(t,16)):console.error("Invalid RSA public key")},j.prototype.encrypt=function(e){var t=function(e,t){if(t<e.length+11)return console.error("Message too long for RSA"),null;for(var r=new Array,i=e.length-1;i>=0&&t>0;){var o=e.charCodeAt(i--);o<128?r[--t]=o:o>127&&o<2048?(r[--t]=63&o|128,r[--t]=o>>6|192):(r[--t]=63&o|128,r[--t]=o>>6&63|128,r[--t]=o>>12|224)}r[--t]=0;for(var a=new U,s=new Array;t>2;){for(s[0]=0;0==s[0];)a.nextBytes(s);r[--t]=s[0]}return r[--t]=2,r[--t]=0,new n(r)}(e,this.n.bitLength()+7>>3);if(null==t)return null;var r=this.doPublic(t);if(null==r)return null;var i=r.toString(16);return 0==(1&i.length)?i:"0"+i},j.prototype.doPrivate=function(e){if(null==this.p||null==this.q)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),n=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(n)<0;)t=t.add(this.p);return t.subtract(n).multiply(this.coeff).mod(this.p).multiply(this.q).add(n)},j.prototype.setPrivate=function(e,t,n){null!=e&&null!=t&&e.length>0&&t.length>0?(this.n=B(e,16),this.e=parseInt(t,16),this.d=B(n,16)):console.error("Invalid RSA private key")},j.prototype.setPrivateEx=function(e,t,n,r,i,o,a,s){null!=e&&null!=t&&e.length>0&&t.length>0?(this.n=B(e,16),this.e=parseInt(t,16),this.d=B(n,16),this.p=B(r,16),this.q=B(i,16),this.dmp1=B(o,16),this.dmq1=B(a,16),this.coeff=B(s,16)):console.error("Invalid RSA private key")},j.prototype.generate=function(e,t){var r=new U,i=e>>1;this.e=parseInt(t,16);for(var o=new n(t,16);;){for(;this.p=new n(e-i,1,r),0!=this.p.subtract(n.ONE).gcd(o).compareTo(n.ONE)||!this.p.isProbablePrime(10););for(;this.q=new n(i,1,r),0!=this.q.subtract(n.ONE).gcd(o).compareTo(n.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var a=this.p;this.p=this.q,this.q=a}var s=this.p.subtract(n.ONE),c=this.q.subtract(n.ONE),u=s.multiply(c);if(0==u.gcd(o).compareTo(n.ONE)){this.n=this.p.multiply(this.q),this.d=o.modInverse(u),this.dmp1=this.d.mod(s),this.dmq1=this.d.mod(c),this.coeff=this.q.modInverse(this.p);break}}},j.prototype.decrypt=function(e){var t=B(e,16),n=this.doPrivate(t);return null==n?null:function(e,t){for(var n=e.toByteArray(),r=0;r<n.length&&0==n[r];)++r;if(n.length-r!=t-1||2!=n[r])return null;for(++r;0!=n[r];)if(++r>=n.length)return null;for(var i="";++r<n.length;){var o=255&n[r];o<128?i+=String.fromCharCode(o):o>191&&o<224?(i+=String.fromCharCode((31&o)<<6|63&n[r+1]),++r):(i+=String.fromCharCode((15&o)<<12|(63&n[r+1])<<6|63&n[r+2]),r+=2)}return i}(n,this.n.bitLength()+7>>3)},function(){j.prototype.generateAsync=function(e,t,i){var o=new U,a=e>>1;this.e=parseInt(t,16);var s=new n(t,16),c=this,u=function(){var t=function(){if(c.p.compareTo(c.q)<=0){var e=c.p;c.p=c.q,c.q=e}var t=c.p.subtract(n.ONE),r=c.q.subtract(n.ONE),o=t.multiply(r);0==o.gcd(s).compareTo(n.ONE)?(c.n=c.p.multiply(c.q),c.d=s.modInverse(o),c.dmp1=c.d.mod(t),c.dmq1=c.d.mod(r),c.coeff=c.q.modInverse(c.p),setTimeout(function(){i()},0)):setTimeout(u,0)},l=function(){c.q=r(),c.q.fromNumberAsync(a,1,o,function(){c.q.subtract(n.ONE).gcda(s,function(e){0==e.compareTo(n.ONE)&&c.q.isProbablePrime(10)?setTimeout(t,0):setTimeout(l,0)})})},d=function(){c.p=r(),c.p.fromNumberAsync(e-a,1,o,function(){c.p.subtract(n.ONE).gcda(s,function(e){0==e.compareTo(n.ONE)&&c.p.isProbablePrime(10)?setTimeout(l,0):setTimeout(d,0)})})};setTimeout(d,0)};setTimeout(u,0)};n.prototype.gcda=function(e,t){var n=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(n.compareTo(r)<0){var i=n;n=r,r=i}var o=n.getLowestSetBit(),a=r.getLowestSetBit();if(a<0)t(n);else{o<a&&(a=o),a>0&&(n.rShiftTo(a,n),r.rShiftTo(a,r));var s=function(){(o=n.getLowestSetBit())>0&&n.rShiftTo(o,n),(o=r.getLowestSetBit())>0&&r.rShiftTo(o,r),n.compareTo(r)>=0?(n.subTo(r,n),n.rShiftTo(1,n)):(r.subTo(n,r),r.rShiftTo(1,r)),n.signum()>0?setTimeout(s,0):(a>0&&r.lShiftTo(a,r),setTimeout(function(){t(r)},0))};setTimeout(s,10)}};n.prototype.fromNumberAsync=function(e,t,r,i){if("number"==typeof t)if(e<2)this.fromInt(1);else{this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(n.ONE.shiftLeft(e-1),m,this),this.isEven()&&this.dAddOffset(1,0);var o=this,a=function(){o.dAddOffset(2,0),o.bitLength()>e&&o.subTo(n.ONE.shiftLeft(e-1),o),o.isProbablePrime(t)?setTimeout(function(){i()},0):setTimeout(a,0)};setTimeout(a,0)}else{var s=new Array,c=7&e;s.length=1+(e>>3),t.nextBytes(s),c>0?s[0]&=(1<<c)-1:s[0]=0,this.fromString(s,256)}}}();var L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",N="=";function F(e){var t,n,r="";for(t=0;t+3<=e.length;t+=3)n=parseInt(e.substring(t,t+3),16),r+=L.charAt(n>>6)+L.charAt(63&n);for(t+1==e.length?(n=parseInt(e.substring(t,t+1),16),r+=L.charAt(n<<2)):t+2==e.length&&(n=parseInt(e.substring(t,t+2),16),r+=L.charAt(n>>2)+L.charAt((3&n)<<4));(3&r.length)>0;)r+=N;return r}function V(e){var t,n,r="",i=0;for(t=0;t<e.length&&e.charAt(t)!=N;++t)v=L.indexOf(e.charAt(t)),v<0||(0==i?(r+=c(v>>2),n=3&v,i=1):1==i?(r+=c(n<<2|v>>4),n=15&v,i=2):2==i?(r+=c(n),r+=c(v>>2),n=3&v,i=3):(r+=c(n<<2|v>>4),r+=c(15&v),i=0));return 1==i&&(r+=c(n<<2)),r}var J=J||{};J.env=J.env||{};var H=J,q=Object.prototype,G=["toString","valueOf"];J.env.parseUA=function(e){var t,n=function(e){var t=0;return parseFloat(e.replace(/\./g,function(){return 1==t++?"":"."}))},r=navigator,i={ie:0,opera:0,gecko:0,webkit:0,chrome:0,mobile:null,air:0,ipad:0,iphone:0,ipod:0,ios:null,android:0,webos:0,caja:r&&r.cajaVersion,secure:!1,os:null},o=e||navigator&&navigator.userAgent,a=window&&window.location,s=a&&a.href;return i.secure=s&&0===s.toLowerCase().indexOf("https"),o&&(/windows|win32/i.test(o)?i.os="windows":/macintosh/i.test(o)?i.os="macintosh":/rhino/i.test(o)&&(i.os="rhino"),/KHTML/.test(o)&&(i.webkit=1),(t=o.match(/AppleWebKit\/([^\s]*)/))&&t[1]&&(i.webkit=n(t[1]),/ Mobile\//.test(o)?(i.mobile="Apple",(t=o.match(/OS ([^\s]*)/))&&t[1]&&(t=n(t[1].replace("_","."))),i.ios=t,i.ipad=i.ipod=i.iphone=0,(t=o.match(/iPad|iPod|iPhone/))&&t[0]&&(i[t[0].toLowerCase()]=i.ios)):((t=o.match(/NokiaN[^\/]*|Android \d\.\d|webOS\/\d\.\d/))&&(i.mobile=t[0]),/webOS/.test(o)&&(i.mobile="WebOS",(t=o.match(/webOS\/([^\s]*);/))&&t[1]&&(i.webos=n(t[1]))),/ Android/.test(o)&&(i.mobile="Android",(t=o.match(/Android ([^\s]*);/))&&t[1]&&(i.android=n(t[1])))),(t=o.match(/Chrome\/([^\s]*)/))&&t[1]?i.chrome=n(t[1]):(t=o.match(/AdobeAIR\/([^\s]*)/))&&(i.air=t[0])),i.webkit||((t=o.match(/Opera[\s\/]([^\s]*)/))&&t[1]?(i.opera=n(t[1]),(t=o.match(/Version\/([^\s]*)/))&&t[1]&&(i.opera=n(t[1])),(t=o.match(/Opera Mini[^;]*/))&&(i.mobile=t[0])):(t=o.match(/MSIE\s([^;]*)/))&&t[1]?i.ie=n(t[1]):(t=o.match(/Gecko\/([^\s]*)/))&&(i.gecko=1,(t=o.match(/rv:([^\s\)]*)/))&&t[1]&&(i.gecko=n(t[1]))))),i},J.env.ua=J.env.parseUA(),J.isFunction=function(e){return"function"==typeof e||"[object Function]"===q.toString.apply(e)},J._IEEnumFix=J.env.ua.ie?function(e,t){var n,r,i;for(n=0;n<G.length;n+=1)i=t[r=G[n]],H.isFunction(i)&&i!=q[r]&&(e[r]=i)}:function(){},J.extend=function(e,t,n){if(!t||!e)throw new Error("extend failed, please check that all dependencies are included.");var r,i=function(){};if(i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor==q.constructor&&(t.prototype.constructor=t),n){for(r in n)H.hasOwnProperty(n,r)&&(e.prototype[r]=n[r]);H._IEEnumFix(e.prototype,n)}},"undefined"!=typeof KJUR&&KJUR||(KJUR={}),void 0!==KJUR.asn1&&KJUR.asn1||(KJUR.asn1={}),KJUR.asn1.ASN1Util=new function(){this.integerToByteHex=function(e){var t=e.toString(16);return t.length%2==1&&(t="0"+t),t},this.bigIntToMinTwosComplementsHex=function(e){var t=e.toString(16);if("-"!=t.substr(0,1))t.length%2==1?t="0"+t:t.match(/^[0-7]/)||(t="00"+t);else{var r=t.substr(1).length;r%2==1?r+=1:t.match(/^[0-7]/)||(r+=2);for(var i="",o=0;o<r;o++)i+="f";t=new n(i,16).xor(e).add(n.ONE).toString(16).replace(/^-/,"")}return t},this.getPEMStringFromHex=function(e,t){var n=CryptoJS.enc.Hex.parse(e),r=CryptoJS.enc.Base64.stringify(n).replace(/(.{64})/g,"$1\r\n");return"-----BEGIN "+t+"-----\r\n"+(r=r.replace(/\r\n$/,""))+"\r\n-----END "+t+"-----\r\n"}},KJUR.asn1.ASN1Object=function(){this.getLengthHexFromValue=function(){if(void 0===this.hV||null==this.hV)throw"this.hV is null or undefined.";if(this.hV.length%2==1)throw"value hex must be even length: n="+"".length+",v="+this.hV;var e=this.hV.length/2,t=e.toString(16);if(t.length%2==1&&(t="0"+t),e<128)return t;var n=t.length/2;if(n>15)throw"ASN.1 length too long to represent by 8x: n = "+e.toString(16);return(128+n).toString(16)+t},this.getEncodedHex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""}},KJUR.asn1.DERAbstractString=function(e){KJUR.asn1.DERAbstractString.superclass.constructor.call(this);this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=stohex(this.s)},this.setStringHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.str?this.setString(e.str):void 0!==e.hex&&this.setStringHex(e.hex))},J.extend(KJUR.asn1.DERAbstractString,KJUR.asn1.ASN1Object),KJUR.asn1.DERAbstractTime=function(e){KJUR.asn1.DERAbstractTime.superclass.constructor.call(this);this.localDateToUTC=function(e){return utc=e.getTime()+6e4*e.getTimezoneOffset(),new Date(utc)},this.formatDate=function(e,t){var n=this.zeroPadding,r=this.localDateToUTC(e),i=String(r.getFullYear());return"utc"==t&&(i=i.substr(2,2)),i+n(String(r.getMonth()+1),2)+n(String(r.getDate()),2)+n(String(r.getHours()),2)+n(String(r.getMinutes()),2)+n(String(r.getSeconds()),2)+"Z"},this.zeroPadding=function(e,t){return e.length>=t?e:new Array(t-e.length+1).join("0")+e},this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=stohex(this.s)},this.setByDateValue=function(e,t,n,r,i,o){var a=new Date(Date.UTC(e,t-1,n,r,i,o,0));this.setByDate(a)},this.getFreshValueHex=function(){return this.hV}},J.extend(KJUR.asn1.DERAbstractTime,KJUR.asn1.ASN1Object),KJUR.asn1.DERAbstractStructured=function(e){KJUR.asn1.DERAbstractString.superclass.constructor.call(this);this.setByASN1ObjectArray=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array=e},this.appendASN1Object=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array.push(e)},this.asn1Array=new Array,void 0!==e&&void 0!==e.array&&(this.asn1Array=e.array)},J.extend(KJUR.asn1.DERAbstractStructured,KJUR.asn1.ASN1Object),KJUR.asn1.DERBoolean=function(){KJUR.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV="0101ff"},J.extend(KJUR.asn1.DERBoolean,KJUR.asn1.ASN1Object),KJUR.asn1.DERInteger=function(e){KJUR.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=KJUR.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var t=new n(String(e),10);this.setByBigInteger(t)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.bigint?this.setByBigInteger(e.bigint):void 0!==e.int?this.setByInteger(e.int):void 0!==e.hex&&this.setValueHex(e.hex))},J.extend(KJUR.asn1.DERInteger,KJUR.asn1.ASN1Object),KJUR.asn1.DERBitString=function(e){KJUR.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(e){this.hTLV=null,this.isModified=!0,this.hV=e},this.setUnusedBitsAndHexValue=function(e,t){if(e<0||7<e)throw"unused bits shall be from 0 to 7: u = "+e;var n="0"+e;this.hTLV=null,this.isModified=!0,this.hV=n+t},this.setByBinaryString=function(e){var t=8-(e=e.replace(/0+$/,"")).length%8;8==t&&(t=0);for(var n=0;n<=t;n++)e+="0";var r="";for(n=0;n<e.length-1;n+=8){var i=e.substr(n,8),o=parseInt(i,2).toString(16);1==o.length&&(o="0"+o),r+=o}this.hTLV=null,this.isModified=!0,this.hV="0"+t+r},this.setByBooleanArray=function(e){for(var t="",n=0;n<e.length;n++)1==e[n]?t+="1":t+="0";this.setByBinaryString(t)},this.newFalseArray=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=!1;return t},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.hex?this.setHexValueIncludingUnusedBits(e.hex):void 0!==e.bin?this.setByBinaryString(e.bin):void 0!==e.array&&this.setByBooleanArray(e.array))},J.extend(KJUR.asn1.DERBitString,KJUR.asn1.ASN1Object),KJUR.asn1.DEROctetString=function(e){KJUR.asn1.DEROctetString.superclass.constructor.call(this,e),this.hT="04"},J.extend(KJUR.asn1.DEROctetString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERNull=function(){KJUR.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},J.extend(KJUR.asn1.DERNull,KJUR.asn1.ASN1Object),KJUR.asn1.DERObjectIdentifier=function(e){var t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t},r=function(e){var r="",i=new n(e,10).toString(2),o=7-i.length%7;7==o&&(o=0);for(var a="",s=0;s<o;s++)a+="0";i=a+i;for(s=0;s<i.length-1;s+=7){var c=i.substr(s,7);s!=i.length-7&&(c="1"+c),r+=t(parseInt(c,2))}return r};KJUR.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueOidString=function(e){if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var n="",i=e.split("."),o=40*parseInt(i[0])+parseInt(i[1]);n+=t(o),i.splice(0,2);for(var a=0;a<i.length;a++)n+=r(i[a]);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=n},this.setValueName=function(e){if(void 0===KJUR.asn1.x509.OID.name2oidList[e])throw"DERObjectIdentifier oidName undefined: "+e;var t=KJUR.asn1.x509.OID.name2oidList[e];this.setValueOidString(t)},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.oid?this.setValueOidString(e.oid):void 0!==e.hex?this.setValueHex(e.hex):void 0!==e.name&&this.setValueName(e.name))},J.extend(KJUR.asn1.DERObjectIdentifier,KJUR.asn1.ASN1Object),KJUR.asn1.DERUTF8String=function(e){KJUR.asn1.DERUTF8String.superclass.constructor.call(this,e),this.hT="0c"},J.extend(KJUR.asn1.DERUTF8String,KJUR.asn1.DERAbstractString),KJUR.asn1.DERNumericString=function(e){KJUR.asn1.DERNumericString.superclass.constructor.call(this,e),this.hT="12"},J.extend(KJUR.asn1.DERNumericString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERPrintableString=function(e){KJUR.asn1.DERPrintableString.superclass.constructor.call(this,e),this.hT="13"},J.extend(KJUR.asn1.DERPrintableString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERTeletexString=function(e){KJUR.asn1.DERTeletexString.superclass.constructor.call(this,e),this.hT="14"},J.extend(KJUR.asn1.DERTeletexString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERIA5String=function(e){KJUR.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="16"},J.extend(KJUR.asn1.DERIA5String,KJUR.asn1.DERAbstractString),KJUR.asn1.DERUTCTime=function(e){KJUR.asn1.DERUTCTime.superclass.constructor.call(this,e),this.hT="17",this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)},void 0!==e&&(void 0!==e.str?this.setString(e.str):void 0!==e.hex?this.setStringHex(e.hex):void 0!==e.date&&this.setByDate(e.date))},J.extend(KJUR.asn1.DERUTCTime,KJUR.asn1.DERAbstractTime),KJUR.asn1.DERGeneralizedTime=function(e){KJUR.asn1.DERGeneralizedTime.superclass.constructor.call(this,e),this.hT="18",this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"gen"),this.hV=stohex(this.s)},void 0!==e&&(void 0!==e.str?this.setString(e.str):void 0!==e.hex?this.setStringHex(e.hex):void 0!==e.date&&this.setByDate(e.date))},J.extend(KJUR.asn1.DERGeneralizedTime,KJUR.asn1.DERAbstractTime),KJUR.asn1.DERSequence=function(e){KJUR.asn1.DERSequence.superclass.constructor.call(this,e),this.hT="30",this.getFreshValueHex=function(){for(var e="",t=0;t<this.asn1Array.length;t++){e+=this.asn1Array[t].getEncodedHex()}return this.hV=e,this.hV}},J.extend(KJUR.asn1.DERSequence,KJUR.asn1.DERAbstractStructured),KJUR.asn1.DERSet=function(e){KJUR.asn1.DERSet.superclass.constructor.call(this,e),this.hT="31",this.getFreshValueHex=function(){for(var e=new Array,t=0;t<this.asn1Array.length;t++){var n=this.asn1Array[t];e.push(n.getEncodedHex())}return e.sort(),this.hV=e.join(""),this.hV}},J.extend(KJUR.asn1.DERSet,KJUR.asn1.DERAbstractStructured),KJUR.asn1.DERTaggedObject=function(e){KJUR.asn1.DERTaggedObject.superclass.constructor.call(this),this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(e,t,n){this.hT=t,this.isExplicit=e,this.asn1Object=n,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=n.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,t),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.tag&&(this.hT=e.tag),void 0!==e.explicit&&(this.isExplicit=e.explicit),void 0!==e.obj&&(this.asn1Object=e.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},J.extend(KJUR.asn1.DERTaggedObject,KJUR.asn1.ASN1Object),function(e){"use strict";var t,n={};n.decode=function(e){var n;if(void 0===t){var r="0123456789ABCDEF",i=" \f\n\r\t \u2028\u2029";for(t=[],n=0;n<16;++n)t[r.charAt(n)]=n;for(r=r.toLowerCase(),n=10;n<16;++n)t[r.charAt(n)]=n;for(n=0;n<i.length;++n)t[i.charAt(n)]=-1}var o=[],a=0,s=0;for(n=0;n<e.length;++n){var c=e.charAt(n);if("="==c)break;if(-1!=(c=t[c])){if(void 0===c)throw"Illegal character at offset "+n;a|=c,++s>=2?(o[o.length]=a,a=0,s=0):a<<=4}}if(s)throw"Hex encoding incomplete: 4 bits missing";return o},window.Hex=n}(),function(e){"use strict";var t,n={};n.decode=function(e){var n;if(void 0===t){var r="= \f\n\r\t \u2028\u2029";for(t=[],n=0;n<64;++n)t["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n)]=n;for(n=0;n<r.length;++n)t[r.charAt(n)]=-1}var i=[],o=0,a=0;for(n=0;n<e.length;++n){var s=e.charAt(n);if("="==s)break;if(-1!=(s=t[s])){if(void 0===s)throw"Illegal character at offset "+n;o|=s,++a>=4?(i[i.length]=o>>16,i[i.length]=o>>8&255,i[i.length]=255&o,o=0,a=0):o<<=6}}switch(a){case 1:throw"Base64 encoding incomplete: at least 2 bits missing";case 2:i[i.length]=o>>10;break;case 3:i[i.length]=o>>16,i[i.length]=o>>8&255}return i},n.re=/-----BEGIN [^-]+-----([A-Za-z0-9+\/=\s]+)-----END [^-]+-----|begin-base64[^\n]+\n([A-Za-z0-9+\/=\s]+)====/,n.unarmor=function(e){var t=n.re.exec(e);if(t)if(t[1])e=t[1];else{if(!t[2])throw"RegExp out of sync";e=t[2]}return n.decode(e)},window.Base64=n}(),function(e){"use strict";var t=function(e,t){var n=document.createElement(e);return n.className=t,n},n=function(e){return document.createTextNode(e)};function r(e,t){e instanceof r?(this.enc=e.enc,this.pos=e.pos):(this.enc=e,this.pos=t)}function i(e,t,n,r,i){this.stream=e,this.header=t,this.length=n,this.tag=r,this.sub=i}r.prototype.get=function(e){if(void 0===e&&(e=this.pos++),e>=this.enc.length)throw"Requesting byte offset "+e+" on a stream of length "+this.enc.length;return this.enc[e]},r.prototype.hexDigits="0123456789ABCDEF",r.prototype.hexByte=function(e){return this.hexDigits.charAt(e>>4&15)+this.hexDigits.charAt(15&e)},r.prototype.hexDump=function(e,t,n){for(var r="",i=e;i<t;++i)if(r+=this.hexByte(this.get(i)),!0!==n)switch(15&i){case 7:r+="  ";break;case 15:r+="\n";break;default:r+=" "}return r},r.prototype.parseStringISO=function(e,t){for(var n="",r=e;r<t;++r)n+=String.fromCharCode(this.get(r));return n},r.prototype.parseStringUTF=function(e,t){for(var n="",r=e;r<t;){var i=this.get(r++);n+=i<128?String.fromCharCode(i):i>191&&i<224?String.fromCharCode((31&i)<<6|63&this.get(r++)):String.fromCharCode((15&i)<<12|(63&this.get(r++))<<6|63&this.get(r++))}return n},r.prototype.parseStringBMP=function(e,t){for(var n="",r=e;r<t;r+=2){var i=this.get(r),o=this.get(r+1);n+=String.fromCharCode((i<<8)+o)}return n},r.prototype.reTime=/^((?:1[89]|2\d)?\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,r.prototype.parseTime=function(e,t){var n=this.parseStringISO(e,t),r=this.reTime.exec(n);return r?(n=r[1]+"-"+r[2]+"-"+r[3]+" "+r[4],r[5]&&(n+=":"+r[5],r[6]&&(n+=":"+r[6],r[7]&&(n+="."+r[7]))),r[8]&&(n+=" UTC","Z"!=r[8]&&(n+=r[8],r[9]&&(n+=":"+r[9]))),n):"Unrecognized time: "+n},r.prototype.parseInteger=function(e,t){var n=t-e;if(n>4){n<<=3;var r=this.get(e);if(0===r)n-=8;else for(;r<128;)r<<=1,--n;return"("+n+" bit)"}for(var i=0,o=e;o<t;++o)i=i<<8|this.get(o);return i},r.prototype.parseBitString=function(e,t){var n=this.get(e),r=(t-e-1<<3)-n,i="("+r+" bit)";if(r<=20){var o=n;i+=" ";for(var a=t-1;a>e;--a){for(var s=this.get(a),c=o;c<8;++c)i+=s>>c&1?"1":"0";o=0}}return i},r.prototype.parseOctetString=function(e,t){var n=t-e,r="("+n+" byte) ";n>100&&(t=e+100);for(var i=e;i<t;++i)r+=this.hexByte(this.get(i));return n>100&&(r+="…"),r},r.prototype.parseOID=function(e,t){for(var n="",r=0,i=0,o=e;o<t;++o){var a=this.get(o);if(r=r<<7|127&a,i+=7,!(128&a)){if(""===n){var s=r<80?r<40?0:1:2;n=s+"."+(r-40*s)}else n+="."+(i>=31?"bigint":r);r=i=0}}return n},i.prototype.typeName=function(){if(void 0===this.tag)return"unknown";var e=this.tag>>6,t=(this.tag,31&this.tag);switch(e){case 0:switch(t){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString";default:return"Universal_"+t.toString(16)}case 1:return"Application_"+t.toString(16);case 2:return"["+t+"]";case 3:return"Private_"+t.toString(16)}},i.prototype.reSeemsASCII=/^[ -~]+$/,i.prototype.content=function(){if(void 0===this.tag)return null;var e=this.tag>>6,t=31&this.tag,n=this.posContent(),r=Math.abs(this.length);if(0!==e){if(null!==this.sub)return"("+this.sub.length+" elem)";var i=this.stream.parseStringISO(n,n+Math.min(r,100));return this.reSeemsASCII.test(i)?i.substring(0,200)+(i.length>200?"…":""):this.stream.parseOctetString(n,n+r)}switch(t){case 1:return 0===this.stream.get(n)?"false":"true";case 2:return this.stream.parseInteger(n,n+r);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(n,n+r);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(n,n+r);case 6:return this.stream.parseOID(n,n+r);case 16:case 17:return"("+this.sub.length+" elem)";case 12:return this.stream.parseStringUTF(n,n+r);case 18:case 19:case 20:case 21:case 22:case 26:return this.stream.parseStringISO(n,n+r);case 30:return this.stream.parseStringBMP(n,n+r);case 23:case 24:return this.stream.parseTime(n,n+r)}return null},i.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null===this.sub?"null":this.sub.length)+"]"},i.prototype.print=function(e){if(void 0===e&&(e=""),document.writeln(e+this),null!==this.sub){e+="  ";for(var t=0,n=this.sub.length;t<n;++t)this.sub[t].print(e)}},i.prototype.toPrettyString=function(e){void 0===e&&(e="");var t=e+this.typeName()+" @"+this.stream.pos;if(this.length>=0&&(t+="+"),t+=this.length,32&this.tag?t+=" (constructed)":3!=this.tag&&4!=this.tag||null===this.sub||(t+=" (encapsulates)"),t+="\n",null!==this.sub){e+="  ";for(var n=0,r=this.sub.length;n<r;++n)t+=this.sub[n].toPrettyString(e)}return t},i.prototype.toDOM=function(){var e=t("div","node");e.asn1=this;var r=t("div","head"),i=this.typeName().replace(/_/g," ");r.innerHTML=i;var o=this.content();if(null!==o){o=String(o).replace(/</g,"&lt;");var a=t("span","preview");a.appendChild(n(o)),r.appendChild(a)}e.appendChild(r),this.node=e,this.head=r;var s=t("div","value");if(i="Offset: "+this.stream.pos+"<br/>",i+="Length: "+this.header+"+",this.length>=0?i+=this.length:i+=-this.length+" (undefined)",32&this.tag?i+="<br/>(constructed)":3!=this.tag&&4!=this.tag||null===this.sub||(i+="<br/>(encapsulates)"),null!==o&&(i+="<br/>Value:<br/><b>"+o+"</b>","object"==typeof oids&&6==this.tag)){var c=oids[o];c&&(c.d&&(i+="<br/>"+c.d),c.c&&(i+="<br/>"+c.c),c.w&&(i+="<br/>(warning!)"))}s.innerHTML=i,e.appendChild(s);var u=t("div","sub");if(null!==this.sub)for(var l=0,d=this.sub.length;l<d;++l)u.appendChild(this.sub[l].toDOM());return e.appendChild(u),r.onclick=function(){e.className="node collapsed"==e.className?"node":"node collapsed"},e},i.prototype.posStart=function(){return this.stream.pos},i.prototype.posContent=function(){return this.stream.pos+this.header},i.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},i.prototype.fakeHover=function(e){this.node.className+=" hover",e&&(this.head.className+=" hover")},i.prototype.fakeOut=function(e){var t=/ ?hover/;this.node.className=this.node.className.replace(t,""),e&&(this.head.className=this.head.className.replace(t,""))},i.prototype.toHexDOM_sub=function(e,r,i,o,a){if(!(o>=a)){var s=t("span",r);s.appendChild(n(i.hexDump(o,a))),e.appendChild(s)}},i.prototype.toHexDOM=function(e){var r=t("span","hex");if(void 0===e&&(e=r),this.head.hexNode=r,this.head.onmouseover=function(){this.hexNode.className="hexCurrent"},this.head.onmouseout=function(){this.hexNode.className="hex"},r.asn1=this,r.onmouseover=function(){var t=!e.selected;t&&(e.selected=this.asn1,this.className="hexCurrent"),this.asn1.fakeHover(t)},r.onmouseout=function(){var t=e.selected==this.asn1;this.asn1.fakeOut(t),t&&(e.selected=null,this.className="hex")},this.toHexDOM_sub(r,"tag",this.stream,this.posStart(),this.posStart()+1),this.toHexDOM_sub(r,this.length>=0?"dlen":"ulen",this.stream,this.posStart()+1,this.posContent()),null===this.sub)r.appendChild(n(this.stream.hexDump(this.posContent(),this.posEnd())));else if(this.sub.length>0){var i=this.sub[0],o=this.sub[this.sub.length-1];this.toHexDOM_sub(r,"intro",this.stream,this.posContent(),i.posStart());for(var a=0,s=this.sub.length;a<s;++a)r.appendChild(this.sub[a].toHexDOM(e));this.toHexDOM_sub(r,"outro",this.stream,o.posEnd(),this.posEnd())}return r},i.prototype.toHexString=function(e){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)},i.decodeLength=function(e){var t=e.get(),n=127&t;if(n==t)return n;if(n>3)throw"Length over 24 bits not supported at position "+(e.pos-1);if(0===n)return-1;t=0;for(var r=0;r<n;++r)t=t<<8|e.get();return t},i.hasContent=function(e,t,n){if(32&e)return!0;if(e<3||e>4)return!1;var o=new r(n);if(3==e&&o.get(),o.get()>>6&1)return!1;try{var a=i.decodeLength(o);return o.pos-n.pos+a==t}catch(e){return!1}},i.decode=function(e){e instanceof r||(e=new r(e,0));var t=new r(e),n=e.get(),o=i.decodeLength(e),a=e.pos-t.pos,s=null;if(i.hasContent(n,o,e)){var c=e.pos;if(3==n&&e.get(),s=[],o>=0){for(var u=c+o;e.pos<u;)s[s.length]=i.decode(e);if(e.pos!=u)throw"Content size is not correct for container starting at offset "+c}else try{for(;;){var l=i.decode(e);if(0===l.tag)break;s[s.length]=l}o=c-e.pos}catch(e){throw"Exception while decoding undefined length content: "+e}}else e.pos+=o;return new i(t,a,o,n,s)},i.test=function(){for(var e=[{value:[39],expected:39},{value:[129,201],expected:201},{value:[131,254,220,186],expected:16702650}],t=0,n=e.length;t<n;++t){var o=new r(e[t].value,0),a=i.decodeLength(o);a!=e[t].expected&&document.write("In test["+t+"] expected "+e[t].expected+" got "+a+"\n")}},window.ASN1=i}(),ASN1.prototype.getHexStringValue=function(){var e=this.toHexString(),t=2*this.header,n=2*this.length;return e.substr(t,n)},j.prototype.parseKey=function(e){try{var t=0,n=0,r=/^\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\s*)+$/.test(e)?Hex.decode(e):Base64.unarmor(e),i=ASN1.decode(r);if(3===i.sub.length&&(i=i.sub[2].sub[0]),9===i.sub.length){t=i.sub[1].getHexStringValue(),this.n=B(t,16),n=i.sub[2].getHexStringValue(),this.e=parseInt(n,16);var o=i.sub[3].getHexStringValue();this.d=B(o,16);var a=i.sub[4].getHexStringValue();this.p=B(a,16);var s=i.sub[5].getHexStringValue();this.q=B(s,16);var c=i.sub[6].getHexStringValue();this.dmp1=B(c,16);var u=i.sub[7].getHexStringValue();this.dmq1=B(u,16);var l=i.sub[8].getHexStringValue();this.coeff=B(l,16)}else{if(2!==i.sub.length)return!1;var d=i.sub[1].sub[0];t=d.sub[0].getHexStringValue(),this.n=B(t,16),n=d.sub[1].getHexStringValue(),this.e=parseInt(n,16)}return!0}catch(e){return!1}},j.prototype.getPrivateBaseKey=function(){var e={array:[new KJUR.asn1.DERInteger({int:0}),new KJUR.asn1.DERInteger({bigint:this.n}),new KJUR.asn1.DERInteger({int:this.e}),new KJUR.asn1.DERInteger({bigint:this.d}),new KJUR.asn1.DERInteger({bigint:this.p}),new KJUR.asn1.DERInteger({bigint:this.q}),new KJUR.asn1.DERInteger({bigint:this.dmp1}),new KJUR.asn1.DERInteger({bigint:this.dmq1}),new KJUR.asn1.DERInteger({bigint:this.coeff})]};return new KJUR.asn1.DERSequence(e).getEncodedHex()},j.prototype.getPrivateBaseKeyB64=function(){return F(this.getPrivateBaseKey())},j.prototype.getPublicBaseKey=function(){var e={array:[new KJUR.asn1.DERObjectIdentifier({oid:"1.2.840.113549.1.1.1"}),new KJUR.asn1.DERNull]},t=new KJUR.asn1.DERSequence(e);return e={array:[new KJUR.asn1.DERInteger({bigint:this.n}),new KJUR.asn1.DERInteger({int:this.e})]},e={hex:"00"+new KJUR.asn1.DERSequence(e).getEncodedHex()},e={array:[t,new KJUR.asn1.DERBitString(e)]},new KJUR.asn1.DERSequence(e).getEncodedHex()},j.prototype.getPublicBaseKeyB64=function(){return F(this.getPublicBaseKey())},j.prototype.wordwrap=function(e,t){if(t=t||64,!e)return e;var n="(.{1,"+t+"})( +|$\n?)|(.{1,"+t+"})";return e.match(RegExp(n,"g")).join("\n")},j.prototype.getPrivateKey=function(){var e="-----BEGIN RSA PRIVATE KEY-----\n";return e+=this.wordwrap(this.getPrivateBaseKeyB64())+"\n",e+="-----END RSA PRIVATE KEY-----"},j.prototype.getPublicKey=function(){var e="-----BEGIN PUBLIC KEY-----\n";return e+=this.wordwrap(this.getPublicBaseKeyB64())+"\n",e+="-----END PUBLIC KEY-----"},j.prototype.hasPublicKeyProperty=function(e){return(e=e||{}).hasOwnProperty("n")&&e.hasOwnProperty("e")},j.prototype.hasPrivateKeyProperty=function(e){return(e=e||{}).hasOwnProperty("n")&&e.hasOwnProperty("e")&&e.hasOwnProperty("d")&&e.hasOwnProperty("p")&&e.hasOwnProperty("q")&&e.hasOwnProperty("dmp1")&&e.hasOwnProperty("dmq1")&&e.hasOwnProperty("coeff")},j.prototype.parsePropertiesFrom=function(e){this.n=e.n,this.e=e.e,e.hasOwnProperty("d")&&(this.d=e.d,this.p=e.p,this.q=e.q,this.dmp1=e.dmp1,this.dmq1=e.dmq1,this.coeff=e.coeff)};var z=function(e){j.call(this),e&&("string"==typeof e?this.parseKey(e):(this.hasPrivateKeyProperty(e)||this.hasPublicKeyProperty(e))&&this.parsePropertiesFrom(e))};(z.prototype=new j).constructor=z;var K=function(e){e=e||{},this.default_key_size=parseInt(e.default_key_size)||1024,this.default_public_exponent=e.default_public_exponent||"010001",this.log=e.log||!1,this.key=null};K.prototype.setKey=function(e){this.log&&this.key&&console.warn("A key was already set, overriding existing."),this.key=new z(e)},K.prototype.setPrivateKey=function(e){this.setKey(e)},K.prototype.setPublicKey=function(e){this.setKey(e)},K.prototype.decrypt=function(e){try{return this.getKey().decrypt(V(e))}catch(e){return!1}},K.prototype.encrypt=function(e){try{return F(this.getKey().encrypt(e))}catch(e){return!1}},K.prototype.getKey=function(e){if(!this.key){if(this.key=new z,e&&"[object Function]"==={}.toString.call(e))return void this.key.generateAsync(this.default_key_size,this.default_public_exponent,e);this.key.generate(this.default_key_size,this.default_public_exponent)}return this.key},K.prototype.getPrivateKey=function(){return this.getKey().getPrivateKey()},K.prototype.getPrivateKeyB64=function(){return this.getKey().getPrivateBaseKeyB64()},K.prototype.getPublicKey=function(){return this.getKey().getPublicKey()},K.prototype.getPublicKeyB64=function(){return this.getKey().getPublicBaseKeyB64()},K.version="2.3.1",e.JSEncrypt=K});var CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},i=function(){},o=r.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=r.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new a.init(n,t)}}),s=n.enc={},c=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new a.init(n,t/2)}},u=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new a.init(n,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},d=r.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,s=i/(4*o);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*o,i=e.min(4*t,i),t){for(var c=0;c<t;c+=o)this._doProcessBlock(r,c);c=r.splice(0,t),n.sigBytes-=i}return new a.init(c,i)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=d.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=n.algo={};return n}(Math);function onMessageCallback(e){if("PermissionDeniedError"==e){if(chromeMediaSource="PermissionDeniedError",screenCallback)return screenCallback("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==e&&(chromeMediaSource="desktop",chromemediaSourceBkup="desktop"),e.sourceId&&screenCallback&&screenCallback(sourceId=e.sourceId)}!function(){var e=CryptoJS,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp(),e=[];for(var i=0;i<n;i+=3)for(var o=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;4>a&&i+.75*a<n;a++)e.push(r.charAt(o>>>6*(3-a)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var n=e.length,r=this._map;(i=r.charAt(64))&&(-1!=(i=e.indexOf(i))&&(n=i));for(var i=[],o=0,a=0;a<n;a++)if(a%4){var s=r.indexOf(e.charAt(a-1))<<a%4*2,c=r.indexOf(e.charAt(a))>>>6-a%4*2;i[o>>>2]|=(s|c)<<24-o%4*8,o++}return t.create(i,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,n,r,i,o,a){return((e=e+(t&n|~t&r)+i+a)<<o|e>>>32-o)+t}function n(e,t,n,r,i,o,a){return((e=e+(t&r|n&~r)+i+a)<<o|e>>>32-o)+t}function r(e,t,n,r,i,o,a){return((e=e+(t^n^r)+i+a)<<o|e>>>32-o)+t}function i(e,t,n,r,i,o,a){return((e=e+(n^(t|~r))+i+a)<<o|e>>>32-o)+t}for(var o=CryptoJS,a=(c=o.lib).WordArray,s=c.Hasher,c=o.algo,u=[],l=0;64>l;l++)u[l]=4294967296*e.abs(e.sin(l+1))|0;c=c.MD5=s.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,o){for(var a=0;16>a;a++){var s=e[d=o+a];e[d]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}a=this._hash.words;var c,l,d=e[o+0],f=(s=e[o+1],e[o+2]),p=e[o+3],h=e[o+4],m=e[o+5],g=e[o+6],v=e[o+7],y=e[o+8],b=e[o+9],S=e[o+10],C=e[o+11],w=e[o+12],T=e[o+13],R=e[o+14],k=e[o+15],_=a[0],E=i(E=i(E=i(E=i(E=r(E=r(E=r(E=r(E=n(E=n(E=n(E=n(E=t(E=t(E=t(E=t(E=a[1],l=t(l=a[2],c=t(c=a[3],_=t(_,E,l,c,d,7,u[0]),E,l,s,12,u[1]),_,E,f,17,u[2]),c,_,p,22,u[3]),l=t(l,c=t(c,_=t(_,E,l,c,h,7,u[4]),E,l,m,12,u[5]),_,E,g,17,u[6]),c,_,v,22,u[7]),l=t(l,c=t(c,_=t(_,E,l,c,y,7,u[8]),E,l,b,12,u[9]),_,E,S,17,u[10]),c,_,C,22,u[11]),l=t(l,c=t(c,_=t(_,E,l,c,w,7,u[12]),E,l,T,12,u[13]),_,E,R,17,u[14]),c,_,k,22,u[15]),l=n(l,c=n(c,_=n(_,E,l,c,s,5,u[16]),E,l,g,9,u[17]),_,E,C,14,u[18]),c,_,d,20,u[19]),l=n(l,c=n(c,_=n(_,E,l,c,m,5,u[20]),E,l,S,9,u[21]),_,E,k,14,u[22]),c,_,h,20,u[23]),l=n(l,c=n(c,_=n(_,E,l,c,b,5,u[24]),E,l,R,9,u[25]),_,E,p,14,u[26]),c,_,y,20,u[27]),l=n(l,c=n(c,_=n(_,E,l,c,T,5,u[28]),E,l,f,9,u[29]),_,E,v,14,u[30]),c,_,w,20,u[31]),l=r(l,c=r(c,_=r(_,E,l,c,m,4,u[32]),E,l,y,11,u[33]),_,E,C,16,u[34]),c,_,R,23,u[35]),l=r(l,c=r(c,_=r(_,E,l,c,s,4,u[36]),E,l,h,11,u[37]),_,E,v,16,u[38]),c,_,S,23,u[39]),l=r(l,c=r(c,_=r(_,E,l,c,T,4,u[40]),E,l,d,11,u[41]),_,E,p,16,u[42]),c,_,g,23,u[43]),l=r(l,c=r(c,_=r(_,E,l,c,b,4,u[44]),E,l,w,11,u[45]),_,E,k,16,u[46]),c,_,f,23,u[47]),l=i(l,c=i(c,_=i(_,E,l,c,d,6,u[48]),E,l,v,10,u[49]),_,E,R,15,u[50]),c,_,m,21,u[51]),l=i(l,c=i(c,_=i(_,E,l,c,w,6,u[52]),E,l,p,10,u[53]),_,E,S,15,u[54]),c,_,s,21,u[55]),l=i(l,c=i(c,_=i(_,E,l,c,y,6,u[56]),E,l,k,10,u[57]),_,E,g,15,u[58]),c,_,T,21,u[59]),l=i(l,c=i(c,_=i(_,E,l,c,h,6,u[60]),E,l,C,10,u[61]),_,E,f,15,u[62]),c,_,b,21,u[63]);a[0]=a[0]+_|0,a[1]=a[1]+E|0,a[2]=a[2]+l|0,a[3]=a[3]+c|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var o=e.floor(r/4294967296);for(n[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[14+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),n=(t=this._hash).words,r=0;4>r;r++)i=n[r],n[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return t},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),o.MD5=s._createHelper(c),o.HmacMD5=s._createHmacHelper(c)}(Math),function(){var e,t=CryptoJS,n=(e=t.lib).Base,r=e.WordArray,i=(e=t.algo).EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=(s=this.cfg).hasher.create(),i=r.create(),o=i.words,a=s.keySize,s=s.iterations;o.length<a;){c&&n.update(c);var c=n.update(e).finalize(t);n.reset();for(var u=1;u<s;u++)c=n.finalize(c),n.reset();i.concat(c)}return i.sigBytes=4*a,i}});t.EvpKDF=function(e,t,n){return i.create(n).compute(e,t)}}(),CryptoJS.lib.Cipher||function(e){var t=(p=CryptoJS).lib,n=t.Base,r=t.WordArray,i=t.BufferedBlockAlgorithm,o=p.enc.Base64,a=p.algo.EvpKDF,s=t.Cipher=i.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?h:f).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?h:f).decrypt(e,t,n,r)}}}});t.StreamCipher=s.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=p.mode={},u=function(e,t,n){var r=this._iv;r?this._iv=void 0:r=this._prevBlock;for(var i=0;i<n;i++)e[t+i]^=r[i]},l=(t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();l.Encryptor=l.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;u.call(this,e,t,r),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),l.Decryptor=l.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=e.slice(t,t+r);n.decryptBlock(e,t),u.call(this,e,t,r),this._prevBlock=i}}),c=c.CBC=l,l=(p.pad={}).Pkcs7={pad:function(e,t){for(var n,i=(n=(n=4*t)-e.sigBytes%n)<<24|n<<16|n<<8|n,o=[],a=0;a<n;a+=4)o.push(i);n=r.create(o,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=s.extend({cfg:s.cfg.extend({mode:c,padding:l}),reset:function(){s.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var d=t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),f=(c=(p.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?r.create([1398893684,1701076831]).concat(e).concat(t):t).toString(o)},parse:function(e){var t=(e=o.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var n=r.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return d.create({ciphertext:e,salt:n})}},t.SerializableCipher=n.extend({cfg:n.extend({format:c}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r);return t=i.finalize(t),i=i.cfg,d.create({ciphertext:t,key:n,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),p=(p.kdf={}).OpenSSL={execute:function(e,t,n,i){return i||(i=r.random(8)),e=a.create({keySize:t+n}).compute(e,i),n=r.create(e.words.slice(t),4*n),e.sigBytes=4*t,d.create({key:e,iv:n,salt:i})}},h=t.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:p}),encrypt:function(e,t,n,r){return n=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,(e=f.encrypt.call(this,e,t,n.key,r)).mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,f.decrypt.call(this,e,t,n.key,r)}})}(),function(){for(var e=CryptoJS,t=e.lib.BlockCipher,n=e.algo,r=[],i=[],o=[],a=[],s=[],c=[],u=[],l=[],d=[],f=[],p=[],h=0;256>h;h++)p[h]=128>h?h<<1:h<<1^283;var m=0,g=0;for(h=0;256>h;h++){var v=(v=g^g<<1^g<<2^g<<3^g<<4)>>>8^255&v^99;r[m]=v,i[v]=m;var y=p[m],b=p[y],S=p[b],C=257*p[v]^16843008*v;o[m]=C<<24|C>>>8,a[m]=C<<16|C>>>16,s[m]=C<<8|C>>>24,c[m]=C,C=16843009*S^65537*b^257*y^16843008*m,u[v]=C<<24|C>>>8,l[v]=C<<16|C>>>16,d[v]=C<<8|C>>>24,f[v]=C,m?(m=y^p[p[p[S^y]]],g^=p[p[g]]):m=g=1}var w=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=t.extend({_doReset:function(){for(var e=(n=this._key).words,t=n.sigBytes/4,n=4*((this._nRounds=t+6)+1),i=this._keySchedule=[],o=0;o<n;o++)if(o<t)i[o]=e[o];else{var a=i[o-1];o%t?6<t&&4==o%t&&(a=r[a>>>24]<<24|r[a>>>16&255]<<16|r[a>>>8&255]<<8|r[255&a]):(a=r[(a=a<<8|a>>>24)>>>24]<<24|r[a>>>16&255]<<16|r[a>>>8&255]<<8|r[255&a],a^=w[o/t|0]<<24),i[o]=i[o-t]^a}for(e=this._invKeySchedule=[],t=0;t<n;t++)o=n-t,a=t%4?i[o]:i[o-4],e[t]=4>t||4>=o?a:u[r[a>>>24]]^l[r[a>>>16&255]]^d[r[a>>>8&255]]^f[r[255&a]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,a,s,c,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,u,l,d,f,i),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,o,a,s){for(var c=this._nRounds,u=e[t]^n[0],l=e[t+1]^n[1],d=e[t+2]^n[2],f=e[t+3]^n[3],p=4,h=1;h<c;h++){var m=r[u>>>24]^i[l>>>16&255]^o[d>>>8&255]^a[255&f]^n[p++],g=r[l>>>24]^i[d>>>16&255]^o[f>>>8&255]^a[255&u]^n[p++],v=r[d>>>24]^i[f>>>16&255]^o[u>>>8&255]^a[255&l]^n[p++];f=r[f>>>24]^i[u>>>16&255]^o[l>>>8&255]^a[255&d]^n[p++],u=m,l=g,d=v}m=(s[u>>>24]<<24|s[l>>>16&255]<<16|s[d>>>8&255]<<8|s[255&f])^n[p++],g=(s[l>>>24]<<24|s[d>>>16&255]<<16|s[f>>>8&255]<<8|s[255&u])^n[p++],v=(s[d>>>24]<<24|s[f>>>16&255]<<16|s[u>>>8&255]<<8|s[255&l])^n[p++],f=(s[f>>>24]<<24|s[u>>>16&255]<<16|s[l>>>8&255]<<8|s[255&d])^n[p++],e[t]=m,e[t+1]=g,e[t+2]=v,e[t+3]=f},keySize:8});e.AES=t._createHelper(n)}(),window.addEventListener("message",function(e){e.origin==window.location.origin&&onMessageCallback(e.data)});var sourceId,screenCallback,chromemediaSourceBkup,chromeMediaSource="screen";function isChromeExtensionAvailable(e){if(e){if("desktop"==chromeMediaSource)return e(!0);window.postMessage("are-you-there","*"),setTimeout(function(){e("screen"!=chromeMediaSource)},2e3)}}function clearSourceId(){chromeMediaSource=chromemediaSourceBkup,sourceId=null}function getSourceId(e){if(!e)throw'"callback" parameter is mandatory.';if(sourceId)return e(sourceId);screenCallback=e,window.postMessage("get-sourceId","*")}isFirefox=void 0!==window.InstallTrigger,isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,isChrome=!!window.chrome&&!isOpera;function getChromeExtensionStatus(e,t){if(isFirefox)return t("not-chrome");2!=arguments.length&&(t=e,e="ajhifddimkapgcifgcodmmfdlknahffk");var n=document.createElement("img");n.src="chrome-extension://"+e+"/icon.png",n.onload=function(){chromeMediaSource="screen",window.postMessage("are-you-there","*"),setTimeout(function(){t("screen"==chromeMediaSource?e==e?"installed-enabled":"installed-disabled":"installed-enabled")},2e3)},n.onerror=function(){t("not-installed")}}function getScreenConstraints(e){if(isFirefox)return e(null,{mozMediaSource:"window",mediaSource:"window"});var t={mandatory:{chromeMediaSource:chromeMediaSource,maxWidth:1280,maxHeight:720},optional:[]};"desktop"!=chromeMediaSource||sourceId?("desktop"==chromeMediaSource&&(t.mandatory.chromeMediaSourceId=sourceId),e(null,t)):getSourceId(function(n){t.mandatory.chromeMediaSourceId=n,e("PermissionDeniedError"==n?n:null,t)})}function remotePeerStream(e){var t,n;this.addMediaStream=function(e){t=e},this.addScreenStream=function(e){n=e},this.getMediaStream=function(){return t},this.getScreenStream=function(){return n},this.removeMediaStream=function(){t=null},this.removeScreenStream=function(){n=null}}this.yConstants=new function(){var e=this;this.socketConnectUrl,this.chatServerUrl,this.masterAccountId,this.OSName,this.appId="",this.appSecret="",this.clientId="",this.signup="user/signup",this.logout="user/logout",this.login="oauth2/token",this.oneToOneCallInvitation="invitation/one-to-one-call",this.groupCallInvitation="group/call-invitation",this.getCallDetails="call/getCallDetails",this.verifyCallToken="call/verify/token",this.registerInCall="call/register_in_direct_call",this.deregisterInCall="call/deregister_in_direct_call",this.deregisterInXMSCall="xms/hangup_call",this.deregisterInICSCall="ics/hangup_ics_call",this.screenShare="xms/screen_share",this.addParticipantsToNonConferenceCall="chat/add-member",this.addParticipantsInConference="group/group-update",this.scheduleCall="scheduler/create_meeting",this.deleteScheduledCall="scheduler/meeting_delete",this.fetchChatRoom="chat/fetchChatRoom",this.fetchChatList="chat/roomList",this.fetchChatMessages="chat/get-messages",this.readRoomMessages="chat/markMessagesRead",this.deleteMessages="chat/delete-message",this.clearConversation="chat/clear-message-in-room",this.deleteConversation="chat/delete-conversation",this.getUpcomingMeetings="scheduler/upcoming_meetings",this.getRecentCalls="call_history/list",this.updateGroup="group/group-update",this.groupCreate="group/create-group",this.addMembersInGroup="group/add-members",this.removeMembersFromGroup="group/remove-members",this.addUserToChat="chat/add-member",this.addContactUrl="contact_book/add/",this.fetchContactDetailsUrl="contact_book/details",this.deleteContactUrl="contact_book/delete",this.fetchContactListUrl="contact_book/list",this.getAllContactUserStatus="user/get-contact-status",this.getParticularUserStatus="user/get-particular-contact-status",this.fetchRoomKeyUrl="chat/getKeyForRoom",this.fetchRoomDetails="group/room-details",this.userLastSeenUrl="last-seen",this.mcuHost="https://imcu.yuwee.com:3004",this.storageBucketName="yuweeProd",this.hostMeeting="meeting/hostMeeting",this.editMeeting="meeting/editMeeting",this.deleteMeeting="meeting/deleteMeeting",this.endMeeting="meeting/endMeeting",this.updateDiscussionMode="meeting/updateDiscussionMode",this.registerInMeeting="meeting/registerInMeeting",this.updateIcsParticipantId="ics/updateIcsParticipantId",this.getActiveCallParticipants="ics/getActiveCallParticipants/",this.getAllMeetings="meeting/getAllMeetings",this.updateMyCallStatus="call/controls/updateCallParticipantStatus/",this.toggleHandRaise="call/controls/toggleHandRaise/",this.toggleParticipantAudio="call/controls/toggleAudioForParticipant/",this.dropParticipant="call/controls/dropParticipant/",this.updatePresenters="call/controls/updatePresenters/",this.updateCallAdmins="call/controls/updateCallAdmins/",this.mixStreamUrl="ics/mix_stream",this.getPermittedResolution="ics/getPermittedResolution/",this.fetchNewICSTokenUrl="ics/reissue_call_token",this.updateRejoinStatus="ics/update_rejoin_status",this.defaultPublishOptions={width:640,height:480,maxBitrate:600},this.setEnvironment=function(t){"production"==t?(e.baseUrl="https://connect.yuwee.com/",e.socketConnectUrl="wss://chat.yuwee.com/",e.chatServerUrl="https://chat.yuwee.com/",e.siteUrl="https://connect.yuwee.com/api_v2/"):"dev"==t?(e.baseUrl="https://dev.yuwee.com/",e.socketConnectUrl="wss://devchat.yuwee.com/",e.chatServerUrl="https://devchat.yuwee.com/",e.siteUrl="https://dev.yuwee.com/api_v2/"):"local"==t?(e.baseUrl="http://localhost:3000/",e.socketConnectUrl="ws://localhost:3001/",e.chatServerUrl="http://localhost:3001/",e.siteUrl="http://localhost:3000/api_v2/"):console.error("Please provide a valid environment: production or dev")},this.mediaOptions={audio:{},video:{width:"1280",height:"720",framerate:"30"}},this.hdVideoConstraints=function(e){return vidResolution={mandatory:{maxWidth:"1280",maxHeight:"720",minWidth:"1280",minHeight:"720"}},{video:vidResolution,audio:e}},this.sdVideoConstraints=function(t){return e.mediaOptions.video.width="640",e.mediaOptions.video.height="480",vidResolution={mandatory:{maxWidth:"640",maxHeight:"480",minWidth:"640",minHeight:"480"}},{video:vidResolution,audio:t}},this.audioOnlyConstraints=function(){return{video:!1,audio:!0}},this.pcConfig={iceServers:[{urls:"turn:94.237.76.127:3478?transport=tcp",credential:"e6dbb590b10223b56bcbb42dbf67b585",username:"yuwee"},{urls:"turn:94.237.76.127:3478?transport=udp",credential:"e6dbb590b10223b56bcbb42dbf67b585",username:"yuwee"}]},this.pcConstraints={}},this.ConferenceManager=function(e,t,n,r){navigator.appVersion.indexOf("Mac");var i=this;e=e;this.myStream=n,this.icsConferenceObj=null,this.icsPublicationGlobal=null,this.screenStream=null,this.mixedStream=null,this.screenSubscriptionObj=null,this.mixedStreamSubscriptionObj=null,this.screenView=$("#screenView"),this.icsServerConnected=!1;var o=null,a=null;this.icsToken=null;var s={},c={},u=0;this.userToStreamMap={},this.userToRoleMap={};var l={},d=!0,f=null,p=null;this.createPCObject=function(t,n){var i;n&&r.cleanupPC(),console.log("inside createPCObject, PC being created for user: ",e),(i=new RTCPeerConnection(yConstants.pcConfig,yConstants.pcConstraints)).onicecandidate=this.handleIceCandidate,i.oniceconnectionstatechange=this.handleIceConnectionStateChange,i.onicegatheringstatechange=this.handleIceGatheringStateChange,i.onaddstream=this.handleOnAddRemoteStream,i.onremovestream=this.handleOnRemoveStream,i.addStream(this.myStream),r.pc[e]=i,t&&this.sendOfferMethod(e,{offerToReceiveAudio:!0,offerToReceiveVideo:!0})},this.renegotiateSdp=function(){2==r.screenShareStatus&&(r.screenShareStatus=0,r.getUserCb("onScreenShareStatusChanged")(r.screenShareStatus)),this.sendOfferMethod(e,{iceRestart:!0})},this.renegotiateSdpForAudioOnlyCall=function(t){this.sendOfferMethod(e,{offerToReceiveVideo:!t})},this.renegotiateIcsCall=function(e){r.isMCUCall&&(null!=i.icsPublicationGlobal&&i.icsPublicationGlobal.stop(),g(function(t,n){e&&e(t,n)}))},this.handleIceCandidate=function(t){t.candidate&&r.candidateQueue.push([e,t.candidate])},this.handleIceGatheringStateChange=function(t){switch(console.log("ice gathering state change: "),r.pc[e].iceGatheringState){case"new":console.log("NEW");case"complete":console.log("COMPLETE");break;case"gathering":console.log("GATHERING")}};this.handleIceConnectionStateChange=function(t){var n=r.isMCUCall?t:r.pc[e].iceConnectionState;if("disconnected"==n){if(!d)return console.log("ICE STATE DISCONNECTED: One REINIT call process is already in progress, returning");console.log("ICE STATE DISCONNECTED : No other process running, trying Reconnecting....."),d&&(d=!1,setTimeout(function(){d=!0},18e3)),console.log("TIMER SET TO REINIT ICE CONNECTION "+1e4),null==f&&(f=setTimeout(function(){f=null,null==p?p=setInterval(function(){!i.isMCUCall&&i.isHost&&navigator.onLine?(console.log("system online : lets reconnect 1-to-1 call via renegotiation"),clearTimeout(p),p=null,i.renegotiateSdp()):r.isMCUCall&&navigator.onLine&&r.isInternetOn()?(console.log("system online: lets reconnect, but first lets LEAVE the ongoing call"),i.icsConferenceObj.leave().then(function(e){console.log("ICS: Left successfully, Now Rejoining with new token after canceling the current timer: "),clearTimeout(p),p=null,h()},function(e){console.log("ICS: Failed to LEAVE, still trying to rejoin with new token after canceling the current timer: "+e),clearTimeout(p),p=null,h()})):navigator.onLine||console.log("NO INTERNET, system offline : lets wait before renegotiating")},2e3):console.log("reconnectTimer is already active, returning from here !!!")},1e4))}else"connected"==n&&null!=f&&(console.log("ICE CONNECTED, CLEARING THE TIMEOUT SET FOR ICE-RECONNECTION"),clearTimeout(f),f=null)},this.handleOnAddRemoteStream=function(t){if(console.log("remote stream received, being added to the view, from user ",e),null==r.remotePeerStream&&(r.remotePeerStream=new remotePeerStream),t.stream.getVideoTracks().length>1){var n=new MediaStream;n.addTrack(t.stream.getVideoTracks()[1]);t.stream.removeTrack(t.stream.getVideoTracks()[1]);r.remotePeerStream.addScreenStream(n);var i=new MediaStream;i.addTrack(t.stream.getVideoTracks()[0]),i.addTrack(t.stream.getAudioTracks()[0]),r.remotePeerStream.addMediaStream(i),null!=r.streamMixer&&r.streamMixer.resetVideoStreams([n,r.myStream,r.remotePeerStream.getMediaStream()]),r.getUserCb("onMultiRemoteStreamReceived")(t.stream,n)}else r.remotePeerStream.addMediaStream(t.stream),null!=r.streamMixer&&r.streamMixer.resetVideoStreams([r.myStream,r.remotePeerStream.getMediaStream()]),r.getUserCb("onRemoteStreamReceived")(t.stream,"p2p")},this.handleOnRemoveStream=function(e){console.log("Remote stream removed. Event: ",e)},this.handleCreateOfferError=function(e){console.log("Error when Creating Offer",e)},this.handleCreateAnswerError=function(e){console.log("Error when Creating Answer",e)},this.sendOfferMethod=function(e,t){console.log("Creating offer for: ",e),r.pc[e].createOffer(this.setLocalAndSendMessageOffer,this.handleCreateOfferError,t)},this.reinitialiseCall=function(){r.isMCUCall&&(r.isIntelMCU?(console.log("Rejoining ICS conference"),r.hangupICSCall("isRenegotiating",function(){r.ICSCallResourceId=null,i.sendOfferICS()})):r.hangupXmsCall("isRenegotiating",function(){r.XMSCallResourceId=null,this.isRegisteredInXMSCall=!1;i.createPCObject(!0,!0)}))},this.startAnswer=function(e){console.log("Creating Answer to be sent to user : ",e),r.pc[e].createAnswer(this.setLocalAndSendMessageAnswer,this.handleCreateAnswerError)},this.setLocalAndSendMessageOffer=function(n){var i;console.log("SDP set, Offer being triggered for user: ",e),console.log("offer message is",n),r.pc[e].setLocalDescription(n),r.CandidateTriggeringInitiated||r.fetchAndTriggerCandidatesFromQueue();var o=n.sdp;i={destinationId:e,senderUserId:t,type:"offer",sdp:o},r.sendWebRTCMessage("offer",i)},this.setLocalAndSendMessageAnswer=function(n){var i;console.log("Answer created, lets set localdescription and trigger for user: ",e),r.pc[e].setLocalDescription(n),r.CandidateTriggeringInitiated||r.fetchAndTriggerCandidatesFromQueue();var o=n.sdp;i={destinationId:e,senderUserId:t,type:"answer",sdp:o},console.log("answer message is",i),r.sendWebRTCMessage("answer",i)},updateIcsParticipantId=function(e){$.ajax({url:yConstants.siteUrl+yConstants.updateIcsParticipantId,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(e){e.setRequestHeader("Authorization",r.accessToken)},data:{icsParticipantId:e,callId:r.callId},success:function(e,t,n){console.log("Participant Id updated successfully"+e)},error:function(e,t,n){console.log(JSON.stringify(n))}})};this.sendOfferICS=function(t){r.isSFUMode=1==r.callMode;i.icsConferenceObj=new Owt.Conference.ConferenceClient,i.icsConferenceObj.addEventListener("serverdisconnected",icsDisconnectionHandler),i.icsConferenceObj.addEventListener("serverconnected",icsConnectionHandler),i.icsConferenceObj.addEventListener("streamadded",manageNewStreamHandler),i.icsConferenceObj.addEventListener("streamupdated",function(t){e=t.stream.info.attributes.userId;var n=t.stream.media.video.original[0].parameters.resolution;l[e]=n,console.log("%%%%%%%%%%%% stream updated %%%%%%%%%%%%%%%%"),console.log(t)}),r.isHostedMeeting?joinConference(t):registerCallResource(function(e,t){!e&&t.token?(r.icsToken=t.token,r.ICSCallResourceId=t.ICSCallResourceId,joinConference(null)):r.getUserCb("onRoomRegistrationFailure")(e)})};var h=function(){console.log("ICS REJOIN: RETRYING REJOIN ICS WITH NEW TOKEN"),r.icsToken=null,fetchNewICSTokenUrl=yConstants.siteUrl+yConstants.fetchNewICSTokenUrl,$.ajax({url:fetchNewICSTokenUrl,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(e){e.setRequestHeader("Authorization",r.accessToken)},data:{callId:r.callId},success:function(e,t,n){console.log("New ICS Token successfully fetched"+e),r.icsToken=e.token,rejoinStatus=2,function(e){console.log("INSIDE SUBSCRIPTIONS CLEANUP"),m();for(let[e,t]of Object.entries(c))t.stop(),delete c[e],delete s[t.id];r.currPresentersSubscribed=0,r.currSubPresentersSubscribed=0,e()}(function(){joinConference(rejoinStatus)})},error:function(e,t,n){console.log("Failed to fetch New ICS Token : "+JSON.stringify(n)),r.getUserCb("onRoomConnectionError")()}})};joinConference=function(e,t){r.initCallHeartBeat(),null==i.icsConferenceObj&&(i.icsConferenceObj=new Owt.Conference.ConferenceClient),i.icsConferenceObj.join(r.icsToken).then(function(t){onConferenceJoinSuccessHandler(t,null,e)},function(n){onConferenceJoinErrorHandler(n,t,e)})},onConferenceJoinSuccessHandler=function(e,n,i){if(e&&e.participants){var o=e.participants.filter(function(e){return e.userId===t})[0];o&&(myParticipantId=o.id,updateIcsParticipantId(myParticipantId)),null!=i&&(successMsg="Successfully joined the meeting",i(null,{message:successMsg}))}else errMsg="Failed to join Conference, Server Connection failed",console.error(errMsg),i?i(errMsg):r.getUserCb("onRoomRegistrationFailure")(errMsg);managePubSubPostJoin(e)},onConferenceJoinErrorHandler=function(e,t,n){++u<=3?(console.log("ICS JOIN FAILED : Trying again to join conference with same token, retry Count : "+u),setTimeout(function(){t=1,joinConference(null,t)},500)):1==t?(console.log("ICS JOIN FAILED : Failed to join conference with existing token, Retry limit reached"),h()):2==t&&(console.log("ICS JOIN FAILED : Failed to join conference even with the new token"),isNewToken=!0,didReconnect=!1,function(e,t,n){console.log("Updating Rejoin Status"),updateRejoinStatusUrl=yConstants.siteUrl+yConstants.updateRejoinStatus,$.ajax({url:updateRejoinStatusUrl,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(e){e.setRequestHeader("Authorization",r.accessToken)},data:{callId:r.callId,isNewToken:e,didReconnect:t,attemptCount:n},success:function(e,t,n){console.log("Rejoin Status successfully updated"+e)},error:function(e,t,n){console.log("Failed to update rejoin status")}})}(isNewToken,didReconnect,u),u=0,msg="Failed to register in the conference : "+e,console.log(msg),n(msg))},managePubSubPostJoin=function(e){r.ySocket.emit("call send_audio_video_call_status",{callId:r.callId,requestType:"callAccepted",room:r.roomId}),r.isPublisher="presenter"==r.currentUserRole||"subPresenter"==r.currentUserRole,r.isPublisher?(console.log("You are a publisher, publishing stream"),g()):console.log(" You are not a publisher"),manageExistingStreams(e.remoteStreams)};var m=function(){null!=i.icsPublicationGlobal&&i.icsPublicationGlobal.stop()},g=function(e){var t;attr={userId:r.currentUserId,streamType:"user",role:r.currentUserRole,userName:r.currentUserName},localStream=new Owt.Base.LocalStream(i.myStream,new Owt.Base.StreamSourceInfo("mic","camera"),attr),maxBitrate=r.myPermittedResAndBitrate.maxBitrate,t=r.joinMedia.video?{video:[{codec:{name:"vp8"},maxBitrate:maxBitrate},{codec:{name:"h264"},maxBitrate:maxBitrate},{codec:{name:"vp9"},maxBitrate:maxBitrate}]}:{video:!1},i.icsConferenceObj.publish(localStream,t).then(function(t){var n="Successfully Published the stream";console.log(n),e&&e(null,n),i.icsPublicationGlobal=t,r.isSFUMode||r.mixStream(r.callId,t.id),t.addEventListener("error",function(e){console.log("Publication error: "+e.error.message)}),t.addEventListener("icestatechange",function(e){i.handleIceConnectionStateChange(e.currentstate)})},function(t){var n="Failed to publish the stream";console.error(n+" : "+t),e&&e(n+" : "+t)})};registerCallResource=function(e){var t=yConstants.baseUrl+"api_v2/ics/register_ics_call_resource";a=r.isCallFromInvitation?"email":"direct",o=!r.isCallUpgradedToConference,$.ajax({url:t,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(e){e.setRequestHeader("Authorization",r.accessToken)},data:{callId:r.callId,isScheduledCall:r.isScheduledCall,isMakeNewSession:o,P2PCallResourceId:r.P2PCallResourceId,joinType:a,joinMedia:r.joinMedia},success:function(t,n,r){e(null,t)},error:function(t,n,r){console.log(t.responseText),e(t.responseText)}})},manageExistingStreams=function(e){e.forEach(function(e){r.isSFUMode?("mixed"!=e.source.video&&(screenType="screen-cast"==e.source.video?"screen":"forwarded"),manageStream(e,screenType)):"screen-cast"===e.source.video?(manageStream(i.screenStream,"screen"),i.screenStream=e):"mixed"==e.source.video&&(i.mixedStream=e,null==i.screenStream&&manageStream(i.mixedStream,"mixed"))})},manageNewStreamHandler=function(e){if(r.isSFUMode)"mixed"!=e.stream.source.video&&(screenType="screen-cast"==e.stream.source.video?"screen":"forwarded",manageStream(e.stream,screenType));else if("screen-cast"===e.stream.source.video){if(1==r.screenShareStatus||2==r.screenShareStatus)return void console.log("I am the host, so need to subscribe to the new stream in room, RETURNING");i.screenStream=e.stream,manageStream(i.screenStream,"screen"),r.currRecordingId&&r.changeVideoSourceInICSRecording(r.callId,r.currRecordingId,e.stream.id)}else"mixed"===e.stream.source.video&&(i.mixedStream=e.stream,manageStream(i.mixedStream,"mixed"))},manageStream=function(e,t){var n;"forwarded"==t?(n=e.attributes.userId,dataToPass=e.attributes):"mixed"==t?(n="mixed",dataToPass={streamType:"mixed"}):"screen"==t&&(n=e.attributes.userId+"_screen",dataToPass=e.attributes),console.log("Received new stream in the room, sharing : "+n),i.userToStreamMap[n]=e,i.userToRoleMap[n]=e.attributes.role,r.getUserCb("onRemoteStreamAvailable")(dataToPass)},this.subscribeStream=function(e,n,o,a,u){if(e==t)return errMessage="Cannot subscribe to own stream!",console.log(errMessage),a(errMessage);var d=i.userToStreamMap[e];if(!d)return errMessage="Failed to subscribe, stream not found",a(errMessage);var f=d.attributes.role;if("presenter"==f&&r.currPresentersSubscribed>=r.maxPresenters)return errMessage="Presenters Subscription Limit Exceeded",a(errMessage);if("subPresenter"==f&&r.currSubPresentersSubscribed>=r.maxSubPresenters)return errMessage="Sub presenters Subscription Limit Exceeded",a(errMessage);"presenter"==f?r.currPresentersSubscribed++:"subPresenter"==f&&r.currSubPresentersSubscribed++;const p={codecs:[{name:"vp8"},{name:"vp9"},{name:"h264"}]};isScreenStream="screen"==n,subscribeAudio=o.audio&&null!=d.source.audio&&!isScreenStream,subscribeVideo=o.video&&null!=d.source.video;subscribeVideo;subscribeVideo&&(console.log("Resolution of publisher ==> ",d.settings.video[0].resolution),console.log(d),u?console.log("Retrying subscription with a new resolution : "+JSON.stringify(u)):(console.log("myPermittedResAndBitrate ",i.myPermittedResAndBitrate),l[e]=p.resolution)),i.icsConferenceObj.subscribe(d,{audio:subscribeAudio,video:!!subscribeVideo&&p}).then(function(t){s[t.id]=e,c[e]=t,a(null,{stream:d.mediaStream,streamType:n}),t.addEventListener("error",function(i){console.log("ICS: Subscription error: "+i.error.message),data={userId:e,streamType:n},r.getUserCb("onRemoteStreamStopped")(data),t.stop()}),t.addEventListener("ended",function(i){console.log("ICS : Subscription Ended:"),v(t),data={userId:e,streamType:n},r.getUserCb("onRemoteStreamStopped")(data)}),t.addEventListener("icestatechange",function(e){i.handleIceConnectionStateChange(e.currentstate)})}).catch(function(t){console.log(t),"presenter"==f?r.currPresentersSubscribed--:"subPresenter"==f&&r.currSubPresentersSubscribed--,console.log("Subscription Failed, Retrying with New Current Resolution : "+JSON.stringify(l[e])),i.subscribeStream(e,n,o,a,l[e])}),d.addEventListener("ended",t=>{console.log("Remote Forwarded Stream Ended:"),isScreenStream="screen-cast"==d.source.video,isScreenStream&&(console.log("Was a Screen Stream!"),remoteScreenShareStatus=0,e=d.attributes.userId,r.getUserCb("onScreenShareStatusChanged")(remoteScreenShareStatus,null,e))})};var v=function(t){console.log(" %%% cleanupStreamAndSubscriptionCache called "+JSON.stringify(s)),e=s[t.id],console.log("userId : "+e),remoteUserRole=i.userToRoleMap[e],console.log,"presenter"==remoteUserRole?r.currPresentersSubscribed--:"subPresenter"==remoteUserRole&&r.currSubPresentersSubscribed--,sid=t.id,s&&delete s.sid,c&&delete c.userId,i.userToStreamMap&&delete i.userToStreamMap.userId,i.userToRoleMap&&delete i.userToRoleMap.userId};this.unsubscribeStream=function(e,n){if(e==t)return msg="Failed to unsubscribe : Cannot unsubscribe own stream!",console.log(msg),void n(msg);subscription=c[e],subscription?subscription.stop():(msg="Failed to unsubscribe the user",console.log(msg),n(msg)),remoteUserRole=i.userToRoleMap[e],"presenter"==remoteUserRole?r.currPresentersSubscribed--:"subPresenter"==remoteUserRole&&r.currSubPresentersSubscribed--,delete s.sid,delete c.userId,successObj={userId:e,message:"success"},n(null,successObj)},subscribeAndRenderScreenStream=function(e){const t={codecs:[{name:"vp8"},{name:"vp9"},{name:"h264"}]};i.icsConferenceObj.subscribe(e,{audio:!1,video:t}).then(t=>{i.screenSubscriptionObj=t,r.isDeviceSideMCURecordingEnabled&&null!=r.streamMixer&&(r.checkForStreamTimer=setInterval(function(){e.mediaStream&&(clearInterval(r.checkForStreamTimer),r.streamMixer.resetVideoStreams([e.mediaStream,i.mixedStream.mediaStream]))},1e3)),t.addEventListener("error",e=>{console.log("Subscription error: "+e.error.message),t.stop()}),t.addEventListener("ended",e=>{console.log("Subscription Ended:")}),t.addEventListener("icestatechange",function(e){i.handleIceConnectionStateChange(e.currentstate)}),r.getUserCb("onMultiRemoteStreamReceived")(i.mixedStream.mediaStream,e.mediaStream)}),e.addEventListener("ended",e=>{console.log("Remote Screen Stream Ended:"),remoteScreenShareStatus=0,r.getUserCb("onScreenShareStatusChanged")(remoteScreenShareStatus),r.currRecordingId?r.changeVideoSourceInICSRecording(r.callId,r.currRecordingId,i.mixedStream.id):null!=r.streamMixer&&r.streamMixer.resetVideoStreams([i.mixedStream.mediaStream]),i.screenSubscriptionObj.stop()})},subscribeAndRenderMixedStream=function(e){const t={codecs:[{name:"vp8"},{name:"vp9"},{name:"h264"}]};i.icsConferenceObj.subscribe(e,{audio:{codecs:[{name:"opus"}]},video:t}).then(function(t){i.mixedStreamSubscriptionObj=t,t.addEventListener("error",function(e){console.log("Subscription error: "+e.error.message),t.stop()}),t.addEventListener("ended",function(e){console.log("Subscription Ended:")}),t.addEventListener("icestatechange",function(e){i.handleIceConnectionStateChange(e.currentstate)}),r.getUserCb("onRemoteStreamReceived")(e.mediaStream,null,"mixed")})},icsDisconnectionHandler=function(){i.icsServerConnected=!1},icsConnectionHandler=function(){i.icsServerConnected=!0},window.onbeforeunload=function(e){i.icsConferenceObj.leave(),i.publicationGlobal.stop()}},this.YuWee=function(){var e=this;e.ySocket=null,e.eventList=[],e.callId=null,e.activeUsers=[],e.mediaCallType=null,e.mediaTypeCheck="video",e.isHDVideo=!0,e.isHost=null,e.myStream=null,e.callHostId=null,e.currentUserId=null,e.currentUserName=null,e.currentUserRole=null,e.userInfo=null,e.isCallFromInvitation=!1,e.isScheduledCallViaEmail=!1,e.accessToken=null,e.isRegisteredInRoom=!1,e.roomId=null,e.myRank=null,e.registeredVideoUsers=[],e.pc=null,e.conferenceManagerList=null,e.CandidateTriggeringInitiated=!1,e.candidateQueue=Array(),e.screenShareStatus=0,e.remoteStreams=null,e.remoteDescriptionSet=null,e.AmIBusy=!1,e.isCallTriggerer=!1,e.candidateTriggerTimer=null,e.isGuestUser=!1,e.isGroupCall=!1,e.isMCUCall=!1,e.isAudioMuted=!1,e.isVideoPaused=!1,e.screenShareStatus=0,e.screenStream=null,e.otherUserInP2PCall=null,e.currentCallGroupId=null,e.isScheduledCall=!1,e.connectionStatus=0,e.tokenExpirationTime=null,e.roomKeyCache={},e.jsEncrypt=null,e.rsaPrivateKey=null,e.receivers=null,e.callResponded=!1,e.isIntelMCU=!0,e.P2PCallResourceId=null,e.ICSCallResourceId=null,e.XMSCallResourceId=null,e.isCallUpgradedToConference=!1,e.reconnectTimer=null,e.recorder=null,e.isRecordingOn=!1,e.currRecordingId=null,e.streamMixer=null,e.isDeviceSideMCURecordingEnabled=!0,e.remotePeerStream=null,e.checkForStreamTimer=null,e.callMode=null,e.isSFUMode=!1,e.isPublisher=!0,e.callHeartBeatInterval=null,e.joinMedia={audio:!1,video:!1};var t=!0;e.forceStudentToPublish=!0,e.analyseActiveSpeakerForSPViews=!1,e.allRolesResAndBitrate={},e.myPermittedResAndBitrate={},e.harkAudioInit=!1,e.speakingActivityTimeout=null,e.speakingActivityInterval=null,e.isSpeaking=!1,e.permittedScreenResAndBitrate={resolution:{width:1280,height:720},maxBitrate:1500},e.maxPresenters=null,e.maxSubPresenters=null,e.currPresentersSubscribed=0,e.currSubPresentersSubscribed=0,e.cleanupPC=function(){for(var t in e.pc)e.pc[t].onicecandidate=null,e.pc[t].oniceconnectionstatechange=null,e.pc[t].onicegatheringstatechange=null,e.pc[t].onaddstream=null,e.pc[t].onremovestream=null},e.resetCallResources=function(){e.callId=null,e.activeUsers=[],e.mediaCallType=null,e.mediaTypeCheck="video",e.isHDVideo=!0,e.isHost=null,e.myStream=null,e.callHostId=null,e.currentUserId=null,e.currentUserName=null,e.currentUserRole=null,e.isCallFromInvitation=!1,e.isScheduledCallViaEmail=!1,e.isRegisteredInRoom=!1,e.roomId=null,e.myRank=null,e.registeredVideoUsers=[],e.pc=null,e.conferenceManagerList=null,e.CandidateTriggeringInitiated=!1,e.candidateQueue=Array(),e.screenShareStatus=0,e.remoteStreams=null,e.remoteDescriptionSet=null,e.AmIBusy=!1,e.isCallTriggerer=!1,e.candidateTriggerTimer=null,e.isGroupCall=!1,e.isGuestUser=!1,e.isMCUCall=!1,e.screenStream=null,e.otherUserInP2PCall=null,e.isScheduledCall=!1,e.currentCallGroupId=null,e.callResponded=!1,e.P2PCallResourceId=null,e.ICSCallResourceId=null,e.XMSCallResourceId=null,e.isCallUpgradedToConference=!1,e.cleanupPC(),e.reconnectTimer=null,e.remotePeerStream=null,e.isPublisher=!0,e.isSFUMode=!1,e.callHeartBeatInterval=null,e.joinMedia={audio:!1,video:!1},e.allRolesResAndBitrate={},e.myPermittedResAndBitrate={},e.harkAudioInit=!1,e.speakingActivityTimeout=null,e.speakingActivityInterval=null,e.isSpeaking=!1,e.maxPresenters=null,e.maxSubPresenters=null,e.currPresentersSubscribed=0,e.currSubPresentersSubscribed=0},this.setAppCredentials=function(e,t,n,r){r=null==r?"production":r,yConstants.setEnvironment(r),yConstants.appId=e,yConstants.appSecret=t,yConstants.clientId=n},this.createUser=function(t,n,r){var i={name:t,email:n,password:r,userCreatedBy:"EndUser"},o=yConstants.appId+":"+yConstants.appSecret,a=btoa(o),s=yConstants.siteUrl+yConstants.signup;$.ajax({url:s,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(e){e.setRequestHeader("Authorization","Basic "+a)},data:i,success:function(t,n,r){e.getUserCb("onAccountCreateSuccess")(t)},error:function(t,n,r){e.getUserCb("onAccountCreateFailure")(t.responseJSON)}})},ValidateEmail=function(e){return/\S+@\S+\.\S+/.test(e)},this.createSessionViaCredentials=function(t,n,r){if(!ValidateEmail(t))return data={message:"Please provide a valid email"},void e.getUserCb("onSessionCreateFailure")(data);if(null==n||""==n)return data={message:"Please provide a valid password"},void e.getUserCb("onSessionCreateFailure")(data);e.tokenExpirationTime=r;var i=yConstants.appId+":"+yConstants.appSecret,o=btoa(i),a={grant_type:"password",username:t,password:n,expiryTime:r,deviceCategory:"web"},s=yConstants.siteUrl+yConstants.login;$.ajax({url:s,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(e){e.setRequestHeader("Authorization","Basic "+o)},data:a,success:function(t,n,r){var i={};i.access_token=t.access_token,i.refresh_token=t.refresh_token,i.expires_in=t.expires_in,i.token_type=t.token_type,i.user=t.result.user,e.getUserCb("onSessionCreateSuccess")(i)},error:function(t,n,r){e.getUserCb("onSessionCreateFailure")(t.responseJSON.message),console.log(t.responseJSON)}})},this.createSessionViaToken=function(t){var n=yConstants.siteUrl+yConstants.verifyCallToken,r={token:t};$.ajax({url:n,type:"post",contentType:"application/x-www-form-urlencoded",data:r,success:function(t,n,r){"Conference Expired"!==t.message?(e.mediaCallType=t.callType,window.location.href.includes("/call/invitation")?e.isCallFromInvitation=!0:window.location.href.includes("/call/join")&&(e.isScheduledCallViaEmail=!0),e.getUserCb("onSessionCreateSuccess")(t)):e.getUserCb("onInvitationExpired")()},error:function(t,n,r){e.getUserCb("onSessionCreateFailure")(t.responseJSON.message)}})},initServerConnection=function(){null==e.ySocket&&(e.ySocket=io.connect(yConstants.socketConnectUrl,{query:{Authorization:e.accessToken,deviceCategory:"web",uniqueIdentifier:fetchSessionUniqueIdentifier()},reconnection:!0,reconnectionDelay:3e3,reconnectionDelayMax:3e3}),e.socketListenerSetup())},this.reinitServerConnection=function(){null!=e.ySocket&&(e.ySocket.disconnect(),e.ySocket=null),e.ySocket=io.connect(yConstants.socketConnectUrl,{query:{Authorization:e.accessToken,deviceCategory:"web",uniqueIdentifier:fetchSessionUniqueIdentifier()},reconnection:!0,reconnectionDelay:3e3,reconnectionDelayMax:3e3}),e.socketListenerSetup()},this.getServerConnectionStatus=function(){return 0==e.connectionStatus?"disconnected":1==e.connectionStatus?"connected":2==e.connectionStatus?"disconnected and reconnecting":void 0},this.refreshSession=function(){var t=yConstants.appId+":"+yConstants.appSecret,n=btoa(t),r={grant_type:"refresh_token",refresh_token:e.refreshToken,accessToken:e.accessToken},i=yConstants.siteUrl+yConstants.login;$.ajax({url:i,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(e){e.setRequestHeader("Authorization","Basic "+n)},data:r,success:function(t,n,r){if("ERROR"!=t.status&&null!=t.access_token){var i={};i.access_token=t.access_token,i.expires_in=t.expires_in,i.token_type=t.token_type,i.refresh_token=t.refresh_token,e.accessToken=t.access_token,e.refreshToken=t.refresh_token,e.getUserCb("onSessionRefreshSuccess")(i),e.reinitServerConnection()}else e.getUserCb("onSessionRefreshFailure")(t)},error:function(t,n,r){e.getUserCb("onSessionRefreshFailure")(r),console.log(r)}})},this.init=function(t){e.userInfo=t.user,e.currentUserId=e.userInfo._id.toString(),e.currentUserName=e.userInfo.name.toString(),e.rsaPrivateKey=e.userInfo.privateKey.toString(),t.access_token&&(e.accessToken=t.access_token),e.refreshToken=t.refresh_token,initServerConnection()},e.reinit=function(t){e.accessToken=t,e.reinitServerConnection()},this.on=function(e,t){if(-1==$.inArray(e,this.eventList)){this.eventList.push(e),this.ySocket.on(e,function(e){t(e)})}},this.emit=function(e,t,n){this.ySocket.emit(e,t)},setupInvitationCall=function(t){var n,r=(new Date).getTime(),i="",o="";t.groupId?i=t.groupId:o=t.callee[0]._id,n=t.callId,e.mediaCallType=t.callType.toLowerCase(),e.isGuestUser=4==t.user.status;var a={friendId:o,browserMessageId:r,groupId:i,messageType:"call",callId:n,message:JSON.stringify({source:"invitation",callType:e.mediaCallType,isInvitationResponse:!0,hostId:e.hostId})};if(e.ySocket.connected)e.ySocket.emit("send_message",a);else var s=setInterval(function(){e.ySocket.connected?(console.log("socket connected, lets emit socket"),e.ySocket.emit("send_message",a),clearTimeout(s)):console.log("socket not connected yet, lets wait for 500ms")},500)},setupScheduledCallViaEmail=function(t){var n,r=(new Date).getTime(),i="",o="";t.groupId?i=t.groupId:o=t.callee[0]._id,n=t.callId,e.mediaCallType=t.callType.toLowerCase(),e.isGuestUser=4==t.user.status;var a={friendId:o,browserMessageId:r,groupId:i,messageType:"call",callId:n,message:JSON.stringify({source:"join",callType:e.mediaCallType,isScheduleCallResponse:!0,hostId:e.hostId})};if(e.ySocket.connected)e.ySocket.emit("send_message",a);else var s=setInterval(function(){e.ySocket.connected?(console.log("socket connected, lets emit socket"),e.ySocket.emit("send_message",a),clearTimeout(s)):console.log("socket not connected yet, lets wait for 500ms")},500)},this.activateAudioAnalysis=function(t){if(null==e.myStream)return err="No Local sream found for audio analysis",t(err);t(null,{data:"success"}),e.harkAudioInit=!0;var n=hark(e.myStream,{});n.on("speaking",function(){console.log("Started Speaking"),e.speakingActivityTimeout=setTimeout(function(){e.isSpeaking=!0,null!=e.ySocket&&e.ySocket.emit("call active_speaker",{callId:e.callId,room:e.roomId,isSpeaking:!0}),null==e.speakingActivityInterval&&(e.speakingActivityInterval=setInterval(function(){console.log("Still Speaking"),null!=e.ySocket&&e.ySocket.emit("call active_speaker",{callId:e.callId,room:e.roomId,isSpeaking:!0})},1e3))},500)}),n.on("stopped_speaking",function(){console.log("Stopped Speaking"),e.isSpeaking&&null!=e.ySocket?e.ySocket.emit("call active_speaker",{callId:e.callId,room:e.roomId,isSpeaking:!1}):e.isSpeaking||clearTimeout(e.speakingActivityTimeout),clearInterval(e.speakingActivityInterval),e.speakingActivityInterval=null})},this.setupCall=function(t){if(e.isBrowserWebRTCCompatible())if(e.isCallFromInvitation)setupInvitationCall(t);else{if(!e.isScheduledCallViaEmail)return new Promise(function(n,r){var i={};if(0==t.isGroup){if(t.roomId)i.roomId=t.roomId;else{if(!t.inviteeEmail)return e.getUserCb("onCallSetupFailed")(),!1;i.name=t.inviteeName,i.email=t.inviteeEmail}i.message=t.invitationMessage,i.callType=t.callType,i.videoResolution=t.vidRes;var o=yConstants.siteUrl+yConstants.oneToOneCallInvitation;e.callSetupAPI(o,i)}else{if(i.groupName=t.groupName,i.callType=t.callType,i.message=t.invitationMessage,i.videoResolution=t.vidRes,t.roomId)i.roomId=t.roomId;else{if(!t.groupMembersEmailArr)return e.getUserCb("onCallSetupFailed")(),!1;i.members=t.groupMembersEmailArr}o=yConstants.siteUrl+yConstants.groupCallInvitation;e.callSetupAPI(o,i)}});setupScheduledCallViaEmail(t)}else e.getUserCb("onBrowserIncompatible")()},e.callSetupAPI=function(t,n){$.ajax({url:t,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:n,success:function(t,n,r){e.beginCall(t)},error:function(t,n,r){e.getUserCb("onCallSetupFailed")(t.responseJSON.message),console.log(t.responseJSON.message)}})},e.beginCall=function(t){e.isCallTriggerer=!0;var n=t.result.callId,r=null;"GROUP"==t.result.callOn?r=t.result.groupId:t.result.callee._id;var i={browserMessageId:(new Date).getTime(),messageType:"call",callMode:0,callId:n,callMessage:e.invitationMessage,callType:t.result.callType};if("GROUP"==t.result.callOn)e.currentCallGroupId=r,i.groupId=t.result.groupId,e.ySocket.emit("send_message",i);else{var o=[];o.push(t.result.callee.email),fetchChatRoom({emails:o,allowReuseOfRoom:!0},function(t,n){if(t)return message="Failed to fetch/create room",void e.getUserCb("onCallSetupFailed")(message);i.roomId=n._id,e.ySocket.emit("send_message",i)})}},newMemberAdded=function(t){paramsObj={newParticipantsInfo:t.newMembersInfo.newPraticipantsInfo,groupInfo:t.group},e.getUserCb("onNewMemberAddedToCall")(paramsObj)},this.handleNewIncomingVideoCallMessage=function(t){if(null!=t.purpose&&"memberadded"==t.purpose.toLowerCase()){isCallForNewMemberinGroup=0!=t.newMembersInfo.existingCallType,isCallForNewMemberinOneToOne=0==t.newMembersInfo.existingCallType;if(setCallDataFromSocketEvent(t,!0),isCallForNewMemberinOneToOne&&$.inArray(e.currentUserId,t.newMembersInfo.newParticipants)<0){try{var n=t;newMemberAdded(t),e.callId=n.callId,e.isGroupCall=!0,console.log("call upgraded from P2P based individual call to group call, need to upgrade to MCU."),e.upgradeToMCUCall(t.callId)}catch(e){}return}if(isCallForNewMemberinGroup&&$.inArray(e.currentUserId,t.newMembersInfo.newParticipants)<0)return newMemberAdded(t),void(3==t.receivers.length&&e.upgradeToMCUCall(t.callId))}setCallDataFromSocketEvent(t,!0),e.AmIBusy=!0,e.getUserCb("onIncomingCall")(t)},this.handleChatMessageDelivered=function(t){"TEXT"!=t.messageType||1!=t.isEncrypted&&"true"!=t.isEncrypted?e.getUserCb("onMessageDeliverySuccess")(t):fetchKeyAndDeEncryptMessage(t.message,t.roomId,function(n,r){n?console.log("incoming message couldnt be decrypted"):(t.message=r,e.getUserCb("onMessageDeliverySuccess")(t))})},this.handleNewIncomingChatMessage=function(t){"memberadded"==t.purpose?e.getUserCb("onNewMembersAddedToGroup")(t):"memberremoved"==t.purpose&&e.getUserCb("onMembersRemovedFromGroup")(t),"TEXT"!=t.messageType||1!=t.isEncrypted&&"true"!=t.isEncrypted?e.getUserCb("onNewMessageReceived")(t):fetchKeyAndDeEncryptMessage(t.message,t.roomId,function(n,r){n?console.log("incoming message couldnt be decrypted"):(t.message=r,e.getUserCb("onNewMessageReceived")(t))})},this.handleCallMessageDelivered=function(t){if(setCallDataFromSocketEvent(t),null!=t.purpose&&"memberadded"==t.purpose.toLowerCase())return isCallForNewMemberinGroup=0!=t.newMembersInfo.existingCallType,isCallForNewMemberinOneToOne=0==t.newMembersInfo.existingCallType,isCallForNewMemberinOneToOne?(e.callId=t.callId,e.isGroupCall=!0,e.upgradeToMCUCall(t.callId)):3==t.receivers.length&&e.upgradeToMCUCall(t.callId),void newMemberAdded(t);window.location.href.includes("/call/invitation");callType=t.callType.toLowerCase(),e.fetchAndSetActiveUsers(t);e.activeUsers.some(function(t){t!==e.currentUserId&&!0}),e.getUserCb("onReadyToInitiateCall")(e.mediaCallType,t.busyUserList)},setCallDataFromSocketEvent=function(t,n){e.receivers=t.receivers,e.callId=t.callId,e.roomId=t.roomId,e.isHost=t.hostId==e.currentUserId,e.isHostedMeeting=t.isHosted,e.mediaCallType=t.callType.toLowerCase(),e.isGroupCall=1==t.isGroup||"true"==t.isGroup,e.isGroupCall&&(e.currentCallGroupId=t.group.groupId),n&&!e.isGroupCall?e.otherUserInP2PCall=t.sender:n||e.isGroupCall||(e.otherUserInP2PCall=t.destination)},this.fetchAndSetActiveUsers=function(t){for(var n=0;n<t.receivers.length;n++)1==t.receivers[n].isOnline&&t.receivers[n]._id!=e.currentUserId&&e.activeUsers.push(t.receivers[n]._id);e.activeUsers.push(t.sender.senderId)},this.socketListenerSetup=function(){e.ySocket.on("connect",function(){console.log("Successfully connected to YuWee Server"),e.connectionStatus=1,e.getUserCb("onServerConnected")()}),e.ySocket.on("incomingMessage",function(t){"CALL"==t.messageType?e.handleNewIncomingVideoCallMessage(t):e.handleNewIncomingChatMessage(t)}),e.ySocket.on("new_group_creation",function(t){e.getUserCb("onNewGroupCreation")(t)}),e.ySocket.on("messageDelivered",function(t){"CALL"==t.messageType?e.handleCallMessageDelivered(t):e.handleChatMessageDelivered(t)}),e.ySocket.on("call ended",function(t){e.getUserCb("onCallEnded")(t)}),e.ySocket.on("call relay_info",function(t){"discussionMode"==t.type&&e.getUserCb("onDiscussionMode")(t.data)}),e.ySocket.on("chat receive_typing",function(t){var n=t.dataToSend;e.getUserCb("onUserTypingInRoom")(n)}),e.ySocket.on("chat delete_msg_for_all",function(t){e.getUserCb("onMessageDeletedBySender")(t)}),e.ySocket.on("call receive_audio_video_call_status",function(t){"stopRing"!==t.requestType||e.callResponded?"stopRing"===t.requestType&&e.isRegisteredInRoom||"userBusy"===t.requestType&&t.userId!==e.currentUserId&&e.callId==t.callId||"callAborted"===t.requestType&&e.callId==t.callId&&t.userId!==e.currentUserId||("callEnded"!==t.requestType||e.callId!=t.callId||t.userId===e.currentUserId||e.isRegisteredInRoom?"callRejected"===t.requestType&&t.userId!==e.currentUserId&&e.callId==t.callId?e.handleSocketEvent(t):e.isRegisteredInRoom&&e.callId==t.callId&&e.handleSocketEvent(t):e.getUserCb("onRemoteCallHangUp")(t)):e.getUserCb("onCallRespondedFromOtherLogin")()}),e.ySocket.on("scheduler welcome_notification",function(t){e.getUserCb("onMeetingCreatedSuccessfully")(t)}),e.ySocket.on("scheduler receive_notification",function(t){e.getUserCb("onMeetingCallActivated")(t)}),e.ySocket.on("scheduler expire_notification",function(t){e.getUserCb("onMeetingExpired")(t)}),e.ySocket.on("scheduler delete_notification",function(t){e.getUserCb("onMeetingDeleted")(t)}),e.ySocket.on("reconnecting",function(t){e.connectionStatus=2,e.getUserCb("onServerReconnecting")(t)}),e.ySocket.on("reconnect_failed",function(t){e.connectionStatus=0,e.getUserCb("onServerReconnectionFailed")(t)}),e.ySocket.on("disconnect",function(t){e.connectionStatus=2,e.getUserCb("onServerDisconnected")(t)}),e.ySocket.on("call participant_joined",function(t){e.getUserCb("onParticipantJoined")(t)}),e.ySocket.on("call participant_left",function(t){e.getUserCb("onParticipantLeft")(t)}),e.ySocket.on("call admins_updated",function(t){e.getUserCb("onAdminsUpdated")(t)}),e.ySocket.on("call presenters_updated",function(t){t.userId==e.currentUserId&&(e.currentUserRole=t.newRole,console.log("PRESENTERS UPDATED SOCKET RECVD : "+JSON.stringify(t)),t.isUpgradedFromSPtoP?(e.myPermittedResAndBitrate=e.allRolesResAndBitrate.presRes,e.updateAndPublishLocalStream(e.joinMedia.audio,e.joinMedia.video,function(){console.log(" You have been successfully upgraded to Presenter")})):t.isDowngradedFromPtoSP?(e.myPermittedResAndBitrate=e.allRolesResAndBitrate.subPresRes,e.updateAndPublishLocalStream(e.joinMedia.audio,e.joinMedia.video,function(){console.log(" You have been successfully downgraded to SubPresenter")})):e.getUserCb("onParticipantRoleUpdated")(t))}),e.ySocket.on("call participant_muted",function(t){e.getUserCb("onParticipantMuted")(t)}),e.ySocket.on("call participant_dropped",function(t){e.getUserCb("onParticipantDropped")(t)}),e.ySocket.on("call participant_status_updated",function(t){e.getUserCb("onParticipantStatusUpdated")(t)}),e.ySocket.on("call hand_raised",function(t){t.isHandRaised?e.getUserCb("onParticipantHandRaised")(t):e.getUserCb("onParticipantHandLowered")(t)}),e.ySocket.on("meeting_ended",function(t){e.getUserCb("onMeetingEnded")(t)}),e.ySocket.on("call active_speaker",function(t){e.getUserCb("onAudioActivity")(t)})},fetchSessionUniqueIdentifier=function(){var e=sessionStorage.getItem("sessionUniqueIdentifier");if(void 0!=e&&null!=e)return e;var t=generateUUID();return sessionStorage.setItem("sessionUniqueIdentifier",t),t},generateUUID=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})},this.handleSocketEvent=function(t,n){if("callRejected"===t.requestType&&t.userId!==e.currentUserId)e.getUserCb("onCallRejected")(t);else if("callEnded"===t.requestType&&t.userId!==e.currentUserId)e.getUserCb("onRemoteCallHangUp")(t);else if("callAccepted"===t.requestType&&t.userId!==e.currentUserId&&e.isCallTriggerer)e.getUserCb("onCallAccepted")(t);else if("videoToggled"===t.requestType&&t.userId!==e.currentUserId)e.getUserCb("onRemoteVideoToggle")(t);else if("audioToggled"===t.requestType&&t.userId!==e.currentUserId)e.getUserCb("onRemoteAudioToggle")(t);else{var r,i;if("videoToggled"===(i=t.requestType)||"audioToggled"===i||("string"==typeof i||i instanceof String)&&(data=t.data),"candidate"===data.type&&data.destinationId==this.currentUserId)r=new RTCIceCandidate({sdpMid:data.id,sdpMLineIndex:data.label,candidate:data.candidate}),console.log("ICE candidate received and being added",r),e.gotIceCandidate(r,data.senderUserId);else if("answer"===data.type&&data.destinationId==this.currentUserId)console.log("I was an offerer, Answer received",i),e.pc[data.senderUserId].setRemoteDescription(new RTCSessionDescription({type:data.type,sdp:data.sdp})),null===e.remoteDescriptionSet&&(e.remoteDescriptionSet=new Object),e.remoteDescriptionSet[data.senderUserId]=!0;else if("offer"===data.type&&data.destinationId==this.currentUserId)return console.log("Creating PC for incoming offer: incoming msg is ",t),null!=e.conferenceManagerList&&null!=e.conferenceManagerList[data.senderUserId]?conferenceManager=e.conferenceManagerList[data.senderUserId]:(conferenceManager=new ConferenceManager(data.senderUserId,this.currentUserId,e.myStream,e),null===e.conferenceManagerList&&(e.conferenceManagerList=new Object),null===e.pc&&(e.pc=new Object),null===e.remoteDescriptionSet&&(e.remoteDescriptionSet=new Object),e.conferenceManagerList[data.senderUserId]=conferenceManager,isOfferToBeGenerated=!1,conferenceManager.createPCObject(isOfferToBeGenerated)),e.pc[data.senderUserId].setRemoteDescription(new RTCSessionDescription({type:data.type,sdp:data.sdp})),e.remoteDescriptionSet[data.senderUserId]=!0,console.log("offer handlng over, lets answer now",data.sdp),void conferenceManager.startAnswer(data.senderUserId)}},e.accountCreateSuccessDefaultCB=function(){console.log("Account creation Success")},e.accountCreateFailureDefaultCB=function(){console.log("Account creation failed")},e.sessionCreateSuccessDefaultCB=function(){console.log("Session Creation success")},e.sessionCreateFailureDefaultCB=function(){console.log("Session Creation Failed")},e.allUserOfflineDefaultCB=function(e){console.log("All users offline")},e.allUsersBusyDefaultCB=function(e){console.log("All users Busy")},e.readyToInitiateCallDefaultCB=function(e,t){console.log(" call setup complete, ready to intitiate call : "+t)},e.localStreamReceivedDefaultCB=function(e,t){console.log(" Local stream received ")},e.streamRequestDowngraded=function(e){console.log("stream downgraded : "+e)},e.streamCaptureFailed=function(e){console.log("stream capture failed : "+e)},e.IncomingCallDefaultCB=function(e){console.log("Incoming Call")},e.InvitationExpiredDefaultCB=function(e){console.log("Incoming Call via invitation expired")},e.InitiatorOfflineDefaultCB=function(e){console.log("Initiator is offline, call cannot be connected")},e.remoteStreamReceivedDefaultCB=function(e){console.log("Remote stream received")},e.remoteStreamAvailableDefaultCB=function(e){console.log("Remote stream Available")},e.remoteStreamStoppedDefaultCB=function(e){console.log("Remote stream Stopped")},e.multiRemoteStreamReceivedDefaultCB=function(e,t){console.log("Camera stream received : "+JSON.stringify(e)),console.log("Screen stream received : "+JSON.stringify(t))},e.CallHangUpSuccessDefaultCB=function(e){console.log("Call hanged up successfully")},e.remoteCallHungDefaultCB=function(e){console.log("Call hung successfully by user: "+e)},e.callEndedDefaultCB=function(){console.log("Call Ended successfully")},e.callRejectedDefaultCB=function(e){console.log("Call rejected by user : "+e)},e.callAcceptedDefaultCB=function(e){console.log("Call Accepted by user : "+e)},e.callEndedDefaultCB=function(){console.log("Call Ended")},e.initialisationCompleteDefaultCB=function(){console.log("Initialisation Complete, socket connected")},e.roomRegistrationFailureDefaultCB=function(){console.log("Room Registration Failed")},e.roomRegistrationSuccessDefaultCB=function(){console.log("Room Registration Successful")},e.roomConnectionErrorDefaultCB=function(){console.log("Room Connectivity Error")},e.fetchRecentCallSuccessDefaultCB=function(){console.log("Recent Calls fetched successfully")},e.fetchRecentCallFailureDefaultCB=function(){console.log("Recent Calls fetched Failed")},e.joinOngoingCallFailedDefaultCB=function(){console.log("Faiuled to Join ongoing call")},e.incomingCallWhileBusyDefaultCB=function(){console.log("Received an incoming call while busy")},e.callRespondedFromOtherLoginDefaultCB=function(){console.log("Call responded from another device where the user is logged in")},e.browserIncompatibleDefaultCB=function(){console.log("This browser is incompatible and is currently not supported by YuWee. Please try with lastest versions of Chrome, Firefox or Safari")},e.videoToggleDefaultCB=function(){console.log("Video toggled successfully")},e.audioToggleDefaultCB=function(){console.log("Audio toggled successfully")},e.remoteAudioToggleDefaultCB=function(e){console.log("Remote Audio toggled by user: "+e.userName)},e.remoteVideoToggleDefaultCB=function(e){console.log("Remote Video toggled by :"+e.userName)},e.screenSharingErrorDefaultCB=function(e){console.log(e.message)},e.screenShareStatusChangedDefaultCB=function(e){console.log("Screen Share status changed to: "+e)},e.newMemberAddedToCallDefaultCB=function(e){console.log("New Member added to call CB: "+JSON.stringify(e))},e.meetingCreatedSuccessfullyDefaultCB=function(e){console.log("Meeting created successfully")},e.meetingCallActivatedDefaultCB=function(e){console.log("Meeting reminder received successfully")},e.meetingExpiredDefaultCB=function(e){console.log("Meeting expired successfully")},e.meetingDeletedDefaultCB=function(e){console.log("Meeting deleted successfully")},e.remoteUserJoiningMeetingDefaultCB=function(e){console.log("Remote user joined meeting "+JSON.stringify(e))},e.meetingCreationFailureDefaultCB=function(e){console.log("Meeting creation failed: "+e)},e.fetchUpcomingCallsSuccessDefaultCB=function(e){console.log("Upcoming calls fetched successfully")},e.fetchUpcomingCallsFailureDefaultCB=function(e){console.log("Fetch upcoming calls failed : "+e)},e.fetchChatRoomSuccessDefaultCB=function(e){console.log("Fetch Chat Room Success : "+JSON.stringify(e))},e.fetchChatRoomFailureDefaultCB=function(e){console.log("Fetch Chat Room failed: "+e)},e.callSetupFailureDefaultCB=function(e){console.log("Call setup failed: "+e)},e.messageDeliverySuccessDefaultCB=function(e){console.log("Message SUccessfully Delivered: "+JSON.stringify(e))},e.newMessageReceivedDefaultCB=function(e){console.log("New Message Received: "+JSON.stringify(e))},e.fetchChatListSuccessDefaultCB=function(e){console.log("Chat List successfully Fetched")},e.fetchChatListFailedDefaultCB=function(e){console.log("chat list fetch failed")},e.fetchChatMessageSuccessDefaultCB=function(e){console.log("successfully fetched room messages")},e.fetchChatMessageFailedDefaultCB=function(e){console.log("Room messages fetch failed")},e.readRoomMessageSuccessDefaultCB=function(e){console.log("room messages read successfully")},e.readRoomMessageFailedDefaultCB=function(e){console.log("read room messages failed")},e.messageDeletionSuccessDefaultCB=function(e){console.log("Message deleted sucessfully")},e.messageDeletionFailedDefaultCB=function(e){console.log("message deletion failed")},e.clearChatRoomSuccessDefaultCB=function(e){console.log("read room messages successfully")},e.clearChatRoomFailedDefaultCB=function(e){console.log("read room messages failed")},e.deleteChatRoomSuccessDefaultCB=function(e){console.log("Chat room deleted successfully")},e.deleteChatRoomFailedDefaultCB=function(e){console.log("chat room deletion failed")},e.readyToJoinMeetingDefaultCB=function(e){console.log("Ready to Join meeting")},e.meetingDeletionSuccessDefaultCB=function(e){console.log("Meeting Deleted Successfully")},e.readyToJoinMeetingDefaultCB=function(e){console.log("Meeting Deletion Failed")},e.userTypingInRoomDafaultCB=function(e){console.log("User Typing in room"),console.log(e)},e.messageDeletedBySenderDefaultCB=function(e){console.log("User Typing in room"),console.log(e)},e.membersAddedToGroupSuccessDefaultCB=function(e){console.log("Member Added to the room successfully"),console.log(e)},e.membersAddedToGroupFailureDefaultCB=function(e){console.log("Adding member to the room failed"),console.log(e)},e.newMembersAddedToGroupDefaultCB=function(e){console.log("new member added to group room"),console.log(e)},e.membersRemovedFromGroupSuccessDefaultCB=function(e){console.log("Member removed from the room successfully"),console.log(e)},e.membersRemovedFromGroupFailureDefaultCB=function(e){console.log("removing members from the room failed"),console.log(e)},e.newMembersRemovedFromGroupDefaultCB=function(e){console.log("Members removed from group room"),console.log(e)},e.serverConnectedDefaultCB=function(e){console.log("Connected to YuWee Server")},e.serverDisconnectedDefaultCB=function(e){console.log("YuWee Server Disconnected")},e.serverReconnectingDefaultCB=function(e){console.log("Trying to Reconnect with YuWee Server")},e.serverReconnectionFailedDefaultCB=function(e){console.log("Reconnection with YuWee Server Failed")},e.sessionRefreshSuccessDefaultCB=function(e){console.log("Session Refreshed Successfully")},e.sessionRefreshFailureDefaultCB=function(e){console.log("Session Refresh Failed")},e.contactAddSuccessDefaultCB=function(e){console.log("Contact Added Successfully")},e.contactAddFailedDefaultCB=function(e){console.log("Contact Addition Failed")},e.contactDeleteSuccessDefaultCB=function(e){console.log("Contact Deleted Successfully")},e.contactDeleteFailedDefaultCB=function(e){console.log("Contact Deletion Failed")},e.contactDetailsSuccessDefaultCB=function(e){console.log("Contact Details fetched Successfully : "+JSON.stringify(e))},e.contactDetailsFailedDefaultCB=function(e){console.log("Contact Details fetch Failed")},e.fetchContactListSuccessDefaultCB=function(e){console.log("Contact List Fetched Successfully : "+JSON.stringify(e))},e.fetchContactListFailedDefaultCB=function(e){console.log("Contact List Fetch Failed")},e.remoteUserStatusChangeDefaultCB=function(e){console.log("Remote User status changed : "+JSON.stringify(e))},e.userStatusFetchSuccessDefaultCB=function(e){console.log("Remote User status fetched successfully : "+JSON.stringify(e))},e.userStatusFetchFailedDefaultCB=function(e){console.log("Remote User status fetch failed : "+JSON.stringify(e))},e.allContactUserStatusFetchSuccessDefaultCB=function(e){console.log("All Contact Status List fetched successfully : "+JSON.stringify(e))},e.allContactUserStatusFetchFailedDefaultCB=function(e){console.log("Failed to fetch All Contact Status List ")},e.userLastSeenDetailsFetchSuccessDefaultCB=function(e){console.log("User last Seen Details fetched successfully : "+JSON.stringify(e))},e.userLastSeenDetailsFetchFailedDefaultCB=function(e){console.log("User last Seen Details fetch failed : "+JSON.stringify(e))},e.roomDetailsFetchSuccessDefaultCB=function(e){console.log("Room Details Fetched Successfully"+JSON.stringify(e))},e.roomDetailsFetchFailedDefaultCB=function(e){console.log("Failed to fetch room details : "+JSON.stringify(e))},e.addParticipantToCallFailedDefaultCB=function(e){console.log("Failed to add participant to the call :"+e)},e.onRecordingStartedDefaultCB=function(e){console.log("Recording Started Successfully")},e.onRecordingStoppedDefaultCB=function(e){console.log("Recording Stopped Successfully")},e.onRecordingFailedDefaultCB=function(e){console.log("Recording Failed")},e.onParticipantJoinedDefaultCB=function(e){console.log("New Participant Joined :"+JSON.stringify(e))},e.onParticipantLeftDefaultCB=function(e){console.log("Participant Left :"+JSON.stringify(e))},e.onAdminsUpdatedDefaultCB=function(e){console.log("Admins Added/Removed"+JSON.stringify(e))},e.onParticipantRoleUpdatedDefaultCB=function(e){console.log("Presenters Added/Removed"+JSON.stringify(e))},e.onParticipantMutedDefaultCB=function(e){console.log("Participant Muted"+JSON.stringify(e))},e.onParticipantDroppedDefaultCB=function(e){console.log("Participant Dropped"+JSON.stringify(e))},e.onParticipantStatusUpdatedDefaultCB=function(e){console.log("Participant Status Updated"+JSON.stringify(e))},e.onParticipantHandRaisedDefaultCB=function(e){console.log("Participant hand raised"+JSON.stringify(e))},e.onParticipantHandLoweredDefaultCB=function(e){console.log("Participant hand lowered"+JSON.stringify(e))},e.onMeetingEndedDefaultCB=function(e){console.log("Meeting Ended : "+JSON.stringify(e))},e.onAudioActivityDefaultCB=function(e){console.log("Audio Activity Event Received : "+JSON.stringify(e))},e.onDiscussionMode=function(e){console.log("On Discussion mode Event Received : "+JSON.stringify(e))},e.onGroupCreateSuccess=function(e){console.log("On Group creation success Event Received : "+JSON.stringify(e))},e.onGroupCreateFailure=function(e){console.log("On Group creation failure Event Received : "+JSON.stringify(e))},e.onNewGroupCreation=function(e){console.log("On New Group creation Event Received : "+JSON.stringify(e))},e.userCb={onAccountCreateSuccess:e.accountCreateSuccessDefaultCB,onAccountCreateFailure:e.accountCreateFailureDefaultCB,onSessionCreateSuccess:e.sessionCreateSuccessDefaultCB,onSessionCreateFailure:e.sessionCreateFailureDefaultCB,onCallSetupFailed:e.callSetupFailureDefaultCB,onAllUsersOffline:e.allUserOfflineDefaultCB,onAllUsersBusy:e.allUsersBusyDefaultCB,onReadyToInitiateCall:e.readyToInitiateCallDefaultCB,onLocalStreamReceived:e.localStreamReceivedDefaultCB,onStreamRequestDowngrade:e.streamRequestDowngraded,onStreamCaptureFailure:e.streamCaptureFailed,onIncomingCall:e.IncomingCallDefaultCB,onCallHangUpSuccess:e.CallHangUpSuccessDefaultCB,onRemoteCallHangUp:e.remoteCallHungDefaultCB,onInvitationExpired:e.InvitationExpiredDefaultCB,onInitiatorOffline:e.InitiatorOfflineDefaultCB,onRemoteStreamReceived:e.remoteStreamReceivedDefaultCB,onRemoteStreamAvailable:e.remoteStreamAvailableDefaultCB,onRemoteStreamStopped:e.remoteStreamStoppedDefaultCB,onMultiRemoteStreamReceived:e.multiRemoteStreamReceivedDefaultCB,onCallRejected:e.callRejectedDefaultCB,onCallAccepted:e.callAcceptedDefaultCB,onCallEnded:e.callEndedDefaultCB,onServerConnected:e.serverConnectedDefaultCB,onServerDisconnected:e.serverDisconnectedDefaultCB,onServerReconnecting:e.serverReconnectingDefaultCB,onServerReconnectionFailed:e.serverReconnectionFailedDefaultCB,onRoomRegistrationSuccess:e.roomRegistrationSuccessDefaultCB,onRoomRegistrationFailure:e.roomRegistrationFailureDefaultCB,onRoomConnectionError:e.roomConnectionErrorDefaultCB,onFetchRecentCallSuccess:e.fetchRecentCallSuccessDefaultCB,onFetchRecentCallFailure:e.fetchRecentCallFailureDefaultCB,onJoinOngoingCallFailed:e.onJoinOngoingCallFailedDefaultCB,onIncomingCallWhileBusy:e.incomingCallWhileBusyDefaultCB,onCallRespondedFromOtherLogin:e.callRespondedFromOtherLoginDefaultCB,onBrowserIncompatible:e.browserIncompatibleDefaultCB,onVideoToggle:e.videoToggleDefaultCB,onAudioToggle:e.audioToggleDefaultCB,onRemoteAudioToggle:e.remoteAudioToggleDefaultCB,onRemoteVideoToggle:e.remoteVideoToggleDefaultCB,onScreenSharingError:e.screenSharingErrorDefaultCB,onScreenShareStatusChanged:e.screenShareStatusChangedDefaultCB,onNewMemberAddedToCall:e.newMemberAddedToCallDefaultCB,onMeetingCreatedSuccessfully:e.meetingCreatedSuccessfullyDefaultCB,onMeetingCallActivated:e.meetingCallActivatedDefaultCB,onMeetingExpired:e.meetingExpiredDefaultCB,onMeetingDeleted:e.meetingDeletedDefaultCB,onReadyToJoinMeeting:e.readyToJoinMeetingDefaultCB,onRemoteUserJoiningMeeting:e.remoteUserJoiningMeetingDefaultCB,onMeetingCreationFailure:e.meetingCreationFailureDefaultCB,onDeleteMeetingSuccess:e.meetingDeletionSuccessDefaultCB,onDeleteMeetingError:e.meetingDeletionFailedDefaultCB,onFetchUpcomingCallSuccess:e.fetchUpcomingCallsSuccessDefaultCB,onFetchUpcomingCallFailure:e.fetchUpcomingCallsFailureDefaultCB,onFetchChatRoomSuccess:e.fetchChatRoomSuccessDefaultCB,onFetchChatRoomFailed:e.fetchChatRoomFailureDefaultCB,onMessageDeliverySuccess:e.messageDeliverySuccessDefaultCB,onNewMessageReceived:e.newMessageReceivedDefaultCB,onFetchChatListSuccess:e.fetchChatListSuccessDefaultCB,onFetchChatListFailed:e.fetchChatListFailedDefaultCB,onFetchChatMessageSuccess:e.fetchChatMessageSuccessDefaultCB,onFetchChatMessageFailed:e.fetchChatMessageFailedDefaultCB,onReadMessageInRoomSuccess:e.readRoomMessageSuccessDefaultCB,onReadMessageInRoomFailed:e.readRoomMessageFailedDefaultCB,onDeleteMessageInRoomSuccess:e.messageDeletionSuccessDefaultCB,onDeleteMessageInRoomFailed:e.messageDeletionFailedDefaultCB,onMessageDeletedBySender:e.messageDeletedBySenderDefaultCB,onClearChatRoomSuccess:e.clearChatRoomSuccessDefaultCB,onClearChatRoomFailed:e.clearChatRoomFailedDefaultCB,onDeleteChatRoomSuccess:e.deleteChatRoomSuccessDefaultCB,onDeleteChatRoomFailed:e.deleteChatRoomFailedDefaultCB,onUserTypingInRoom:e.userTypingInRoomDafaultCB,onMembersAddedToGroupSuccess:e.membersAddedToGroupSuccessDefaultCB,onMembersAddedToGroupFailure:e.membersAddedToGroupFailureDefaultCB,onNewMembersAddedToGroup:e.newMembersAddedToGroupDefaultCB,onMembersRemovedFromGroupSuccess:e.membersRemovedFromGroupSuccessDefaultCB,onMembersRemovedFromGroupFailure:e.membersRemovedFromGroupFailureDefaultCB,onMembersRemovedFromGroup:e.newMembersRemovedFromGroupDefaultCB,onSessionRefreshSuccess:e.sessionRefreshSuccessDefaultCB,onSessionRefreshFailure:e.sessionRefreshFailureDefaultCB,onContactAddSuccess:e.contactAddSuccessDefaultCB,onContactAddFailed:e.contactAddFailedDefaultCB,onContactDeleteSuccess:e.contactDeleteSuccessDefaultCB,onContactDeleteFailed:e.contactDeleteFailedDefaultCB,onContactDetailsSuccess:e.contactDetailsSuccessDefaultCB,onContactDetailsFailed:e.contactDetailsFailedDefaultCB,onFetchContactListSuccess:e.fetchContactListSuccessDefaultCB,onFetchContactListFailed:e.fetchContactListFailedDefaultCB,onRemoteUserStatusChange:e.remoteUserStatusChangeDefaultCB,onUserStatusFetchSuccess:e.userStatusFetchSuccessDefaultCB,onUserStatusFetchFailed:e.userStatusFetchFailedDefaultCB,onAllContactUserStatusFetchSuccess:e.allContactUserStatusFetchSuccessDefaultCB,onAllContactUserStatusFetchFailed:e.allContactUserStatusFetchFailedDefaultCB,onUserLastSeenDetailsFetchSuccess:e.userLastSeenDetailsFetchSuccessDefaultCB,onUserLastSeenDetailsFetchFailed:e.userLastSeenDetailsFetchFailedDefaultCB,onFetchRoomDetailsSuccess:e.roomDetailsFetchSuccessDefaultCB,onFetchRoomDetailsFailed:e.roomDetailsFetchFailedDefaultCB,onAddParticipantToCallFailed:e.addParticipantToCallFailedDefaultCB,onRecordingStarted:e.onRecordingStartedDefaultCB,onRecordingStopped:e.onRecordingStoppedDefaultCB,onRecordingFailed:e.onRecordingFailedDefaultCB,onParticipantJoined:e.onParticipantJoinedDefaultCB,onParticipantLeft:e.onParticipantLeftDefaultCB,onAdminsUpdated:e.onAdminsUpdatedDefaultCB,onParticipantRoleUpdated:e.onParticipantRoleUpdatedDefaultCB,onParticipantMuted:e.onParticipantMutedDefaultCB,onParticipantDropped:e.onParticipantDroppedDefaultCB,onParticipantStatusUpdated:e.onParticipantStatusUpdatedDefaultCB,onParticipantHandRaised:e.onParticipantHandRaisedDefaultCB,onParticipantHandLowered:e.onParticipantHandLoweredDefaultCB,onMeetingEnded:e.onMeetingEndedDefaultCB,onDiscussionMode:e.onDiscussionMode,onAudioActivity:e.onAudioActivityDefaultCB,onGroupCreateSuccess:e.onGroupCreateSuccess,onGroupCreateFailure:e.onGroupCreateFailure,onNewGroupCreation:e.onNewGroupCreation},e.setHandlers=function(e){if("object"!=typeof e)return console.log("bad args in setHandlers"),"error_bad_args";var t,n="ok";for(t in e)e.hasOwnProperty(t)&&t&&e[t]&&"function"==typeof e[t]&&("onAllUsersOffline"===t||"onAllUsersBusy"===t||"onInvitationExpired"===t||"onCallSetupFailed"===t||"onReadyToInitiateCall"===t||"onLocalStreamReceived"===t||"onStreamRequestDowngrade"===t||"onStreamCaptureFailure"===t||"onIncomingCall"===t||"invitationExpired"===t||"onInitiatorOffline"===t||"onRemoteStreamReceived"===t||"onRemoteStreamAvailable"===t||"onRemoteStreamStopped"===t||"onMultiRemoteStreamReceived"===t||"onCallHangUpSuccess"===t||"onCallRejected"===t||"onCallAccepted"===t||"onRemoteCallHangUp"===t||"onCallEnded"===t||"onAccountCreateSuccess"===t||"onAccountCreateFailure"===t||"onSessionCreateSuccess"===t||"onSessionCreateFailure"===t||"onServerConnected"===t||"onServerDisconnected"===t||"onServerReconnecting"===t||"onServerReconnectionFailed"===t||"onRoomRegistrationSuccess"===t||"onRoomRegistrationFailure"===t||"onRoomConnectionError"===t||"onFetchRecentCallSuccess"===t||"onFetchRecentCallFailure"===t||"onJoinOngoingCallFailed"===t||"onIncomingCallWhileBusy"===t||"onCallRespondedFromOtherLogin"===t||"onBrowserIncompatible"===t||"onVideoToggle"===t||"onAudioToggle"===t||"onRemoteVideoToggle"===t||"onRemoteAudioToggle"===t||"onScreenSharingError"===t||"onScreenShareStatusChanged"===t||"onNewMemberAddedToCall"===t||"onMeetingCreatedSuccessfully"===t||"onMeetingCreationFailure"===t||"onMeetingCallActivated"===t||"onMeetingExpired"===t||"onMeetingDeleted"===t||"onDeleteMeetingSuccess"===t||"onDeleteMeetingError"===t||"onReadyToJoinMeeting"===t||"onRemoteUserJoiningMeeting"===t||"onFetchUpcomingCallSuccess"===t||"onFetchUpcomingCallFailure"===t||"onFetchChatRoomSuccess"===t||"onFetchChatRoomFailed"===t||"onMessageDeliverySuccess"===t||"onNewMessageReceived"===t||"onFetchChatListSuccess"===t||"onFetchChatListFailed"===t||"onFetchChatMessageSuccess"===t||"onFetchChatMessageFailed"===t||"onReadMessageInRoomSuccess"===t||"onReadMessageInRoomFailed"===t||"onDeleteMessageInRoomSuccess"===t||"onDeleteMessageInRoomFailed"===t||"onMessageDeletedBySender"===t||"onClearChatRoomSuccess"===t||"onClearChatRoomFailed"===t||"onDeleteChatRoomSuccess"===t||"onDeleteChatRoomFailed"===t||"onUserTypingInRoom"===t||"onMembersAddedToGroupSuccess"===t||"onMembersAddedToGroupFailure"===t||"onNewMembersAddedToGroup"===t||"onMembersRemovedFromGroupSuccess"===t||"onMembersRemovedFromGroupFailure"===t||"onMembersRemovedFromGroup"===t||"onSessionRefreshSuccess"===t||"onSessionRefreshFailure"===t||"onContactAddSuccess"===t||"onContactAddFailed"===t||"onContactDeleteSuccess"===t||"onContactDeleteFailed"===t||"onContactDetailsSuccess"===t||"onContactDetailsFailed"===t||"onFetchContactListSuccess"===t||"onFetchContactListFailed"===t||"onRemoteUserStatusChange"===t||"onUserStatusFetchSuccess"===t||"onUserStatusFetchFailed"===t||"onAllContactUserStatus"===t||"onAllContactUserStatusFetchSuccess"===t||"onAllContactUserStatusFetchFailed"===t||"onUserLastSeenDetailsFetchSuccess"===t||"onUserLastSeenDetailsFetchFailed"===t||"onRoomKeyFetchSuccess"===t||"onRoomKeyFetchFailed"===t||"onAddParticipantToCallFailed"===t||"onFetchRoomDetailsSuccess"===t||"onFetchRoomDetailsFailed"===t||"onRecordingStarted"===t||"onRecordingStopped"===t||"onRecordingFailed"===t||"onParticipantJoined"===t||"onParticipantLeft"===t||"onAdminsUpdated"===t||"onParticipantRoleUpdated"===t||"onParticipantMuted"===t||"onParticipantDropped"===t||"onParticipantStatusUpdated"===t||"onParticipantHandRaised"===t||"onParticipantHandLowered"===t||"onMeetingEnded"===t||"onAudioActivity"===t||"onDiscussionMode"===t||"onGroupCreateSuccess"===t||"onGroupCreateFailure"===t||"onNewGroupCreation"===t?this.setUserCb(t,e[t]):(console.log("wrong callback name provided "+t),n="error_bad_args"));return n},this.setUserCb=function(t,n){e.userCb[t]=n},this.getUserCb=function(t){return e.userCb[t]};var n=function(e,t,n){console.log("isAudioOn ",e),console.log("isVideoOn ",t),console.log("resolution ",n),t&&(null!=n&&null!=n.width||(console.log("resolution is null !"),n=yConstants.defaultPublishOptions,console.log("resolution is -> ! ",n)),vidResolution={mandatory:{maxWidth:n.width,maxHeight:n.height,minWidth:n.width,minHeight:n.height}}),vidConstraints=!!t&&vidResolution;var r={video:vidConstraints,audio:e};return console.log("constraints ",r),r},r=function(e){console.log("RESOLUTION SCREEN"+e),null!=e&&null!=e.width||(e=yConstants.defaultPublishOptions),vidResolution={mandatory:{maxWidth:e.width,maxHeight:e.height}};var t={video:vidResolution,audio:!0};return console.log("constraints => ",JSON.stringify(t)),t};this.getMediaStream=function(t){if(e.joinMedia=t,e.releaseStream(),e.isBrowserWebRTCCompatible()){console.log("self.myPermittedResAndBitrate ",e.myPermittedResAndBitrate);var r=n(e.joinMedia.audio,e.joinMedia.video,e.myPermittedResAndBitrate);console.log("xyz ",r),navigator.mediaDevices.getUserMedia(r).then(gotMediaStream).catch(gotMediaCaptureError)}else e.getUserCb("onBrowserIncompatible")("end&Notify")},gotMediaStream=function(t){console.log("GetUserMedia success Called"),e.myStream=t,e.getUserCb("onLocalStreamReceived")(t)},gotMediaCaptureError=function(t){console.log(" GetUserMedia error called : "+t),"NotReadableError"==t.name?(message="Failed to access the Mic/Camera. Please check if another app is not using your mic/camera",console.log(message),e.joinMedia.audio=!1,e.joinMedia.video=!1,e.getUserCb("onStreamCaptureFailure")(message)):e.joinMedia.video&&e.joinMedia.audio?(message="Failed to access the Camera, Trying for an Audio call",e.getUserCb("onStreamRequestDowngrade")(message),e.joinMedia.video=!1,navigator.mediaDevices.getUserMedia(n(e.joinMedia.audio,e.joinMedia.video)).then(gotMediaStream).catch(gotMediaCaptureError)):(message="Failed to access the Microphone. Hint: Check your browser's Settings",e.joinMedia.audio=!1,e.getUserCb("onStreamCaptureFailure")(message))},this.updateDiscussionMode=function(t,n,r){var i=yConstants.siteUrl+yConstants.updateDiscussionMode,o={meetingTokenId:t,isDiscussionMode:n};$.ajax({url:i,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:o,success:function(t,i,o){e.ySocket.emit("call relay_info",{room:e.roomId,type:"discussionMode",data:{callId:e.callId,isDiscussionModeOn:n}}),r(null,o.responseJSON.message)},error:function(e,t,n){r(e.responseJSON.message,null)}})},this.attachMediaStream=function(e,t,n){return null==e?(msg="Cannot find an element to attach the stream",console.log(msg),void(n&&n(msg))):"video"!=e.tagName&&"VIDEO"!=e.tagName?(msg="Please pass a proper Video Tag HTML element",console.log(msg),void(n&&n(msg))):(void 0!==e.srcObject?e.srcObject=t:void 0!==e.mozSrcObject?e.mozSrcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):console.log("Error attaching stream to element."),void(n&&n(null,{message:"Success"})))},this.acceptCall=function(t){e.callResponded=!0,e.ySocket.emit("call send_audio_video_call_status",{callId:e.callId,isP2Pcall:!0,room:e.roomId,requestType:"callAccepted"})},this.rejectIncomingCall=function(){e.callResponded=!0,console.log("Rejecting call, firing notification socket to other users"),e.ySocket.emit("call send_audio_video_call_status",{callId:e.callId,room:e.roomId,requestType:"callRejected"})},this.registerInRoom=function(){if(console.log("registering in the room"),!e.isRegisteredInRoom)if(this.isGroupCall&&this.receivers.length>2)e.isMCUCall=!0,e.isIntelMCU?e.startOfferingICS():e.startOfferingXMS();else{e.isMCUCall=!1;var t=e.isCallFromInvitation?"email":"direct",n=yConstants.siteUrl+yConstants.registerInCall,r={callId:e.callId,joinType:t};$.ajax({url:n,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:r,success:function(t,n,r){e.P2PCallResourceId=t.result.callResourceId,e.initCallHeartBeat(),onCallRegistrationSuccessResponse(t)},error:function(t,n,r){console.log(r),e.getUserCb("onRoomRegistrationFailure")(t.responseJSON.message)}})}},onCallRegistrationSuccessResponse=function(t){e.roomId=t.result.roomId;for(var n=0;n<t.result.ranks.length;n++)t.result.ranks[n]==e.currentUserId&&(e.myRank=n);for(n=0;n<t.result.ranks.length;n++)null!=t.result.ranks[n]&&(e.registeredVideoUsers[n]=t.result.ranks[n]);e.isRegisteredInRoom=!0,e.startOffering()},this.forwardCandidatesToThePeers=function(t,n){data={type:"candidate",label:t.sdpMLineIndex,id:t.sdpMid,candidate:t.candidate,senderUserId:e.currentUserId,destinationId:n},e.sendWebRTCMessage("candidate",data)},this.sendWebRTCMessage=function(t,n){messageData={callId:e.callId,requestType:t,data:n,room:e.roomId},null!=e.ySocket?e.ySocket.emit("call send_audio_video_call_status",messageData):console.log("Socket hasnt been setup yet")},this.fetchAndTriggerCandidatesFromQueue=function(t){e.CandidateTriggeringInitiated=!0,e.candidateTriggerTimer=setInterval(function(){var t,n,r;0!==e.candidateQueue.length&&((new Date).getTime(),r=(n=e.candidateQueue.shift())[0],t=n[1],e.forwardCandidatesToThePeers(t,r))},250)},this.isBrowserWebRTCCompatible=function(){var e,t;return e=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia,!(!e&&!t)},this.startOffering=function(){var t;for(var n in console.log("inside offering"),e.pc=new Object,e.conferenceManagerList=new Object,e.registeredVideoUsers)if((t=e.registeredVideoUsers[n])!=e.currentUserId&&n<=e.myRank){console.log("Creating Offer for User: "+t);var r=new ConferenceManager(t,e.currentUserId,e.myStream,e);e.conferenceManagerList[t]=r,isOfferToBeGenerated=!0,r.createPCObject(isOfferToBeGenerated)}if(!e.CandidateTriggeringInitiated)return e.fetchAndTriggerCandidatesFromQueue();e.getUserCb("onRoomRegistrationSuccess")},this.startOfferingXMS=function(){var t;console.log("inside XMS offering"),e.pc=new Object,e.conferenceManagerList=new Object,console.log("Creating Offer for MCU"),t=new ConferenceManager("XMS",e.currentUserId,e.myStream,e),e.conferenceManagerList.XMS=t,isOfferToBeGenerated=!0,e.isRegisteredInRoom=!0,t.createPCObject(isOfferToBeGenerated),e.getUserCb("onRoomRegistrationSuccess")},this.startOfferingICS=function(){var t;console.log("inside ICS offering"),e.pc=new Object,e.conferenceManagerList=new Object,console.log("Creating Offer for ICS"),t=new ConferenceManager("ICS",e.currentUserId,e.myStream,e),e.conferenceManagerList.ICS=t,e.isRegisteredInRoom=!0,t.sendOfferICS(),e.getUserCb("onRoomRegistrationSuccess")},this.setBandwidth=function(e){var t={screen:300,audio:120,video:512};return e=BandwidthHandler.setApplicationSpecificBandwidth(e,t,!1),e=BandwidthHandler.setVideoBitrates(e,{min:t.video,max:t.video}),e=BandwidthHandler.setOpusAttributes(e)},this.toggleVideoPause=function(n){if(!t)return n({message:"Please wait. Video toggle already in process."});if(null!=e.myStream||0==e.joinMedia.video&&0==e.joinMedia.audio){t=!1;var r=e.joinMedia.video;e.joinMedia.video=!r,renegotiateSdpToToggleAudioVideo();var i={};i.isVideoOn=!r,n&&n(null,i),updateMyCallStatus(i,function(e,t){})}},this.toggleAudioMute=function(n){if(!t)return n({message:"Please wait. Audio/Video toggle already in process."});var r=e.joinMedia.audio;e.joinMedia.audio=!r,null!=e.myStream&&e.myStream.getAudioTracks().length>0?toggleAudioVideo(e.myStream.getAudioTracks(),e.joinMedia.audio):(e.audioVideoToggleMutex=!1,renegotiateSdpToToggleAudioVideo());var i={};i.isAudioOn=!r,n&&n(null,i),updateMyCallStatus(i,function(e,t){})},renegotiateSdpToToggleAudioVideo=function(){e.releaseStream(),console.log("self.myPermittedResAndBitrate ",e.myPermittedResAndBitrate),navigator.mediaDevices.getUserMedia(n(e.joinMedia.audio,e.joinMedia.video,e.myPermittedResAndBitrate)).then(gotMediaStreamAndRenegotiate).catch(gotMediaStreamAndRenegotiateError)},updateMyCallStatus=function(t,n){var r={};if(r.userId=e.currentUserId,r.callId=e.callId,t){for(key in t)r[key]=t[key];var i=yConstants.siteUrl+yConstants.updateMyCallStatus;$.ajax({url:i,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:r,success:function(e,t,r){n(null,e)},error:function(e,t,r){console.log(JSON.stringify(r)),n(r)}})}},toggleAudioVideo=function(e,t){var n;if(0!==e.length)for(n=0;n<e.length;)e[n].enabled=t,n++},this.insertVPXfmtp=function(e,t,n){return e.replace(/(a=rtpmap:(\d*) VP8\/90000\r\n)/,"$1a=fmtp:$2 max-fr="+t+"; max-fs="+n+"\r\n").replace(/(a=rtpmap:(\d*) VP9\/90000\r\n)/,"$1a=fmtp:$2 max-fr="+t+"; max-fs="+n+"\r\n")},this.reorderCodecs=function(e,t){var n=require("sdptransform"),r=n.parse(t);return r=this.doReorder("video",e,r),n.write(r)},this.doReorder=function(e,t,n){for(var r=0;r<n.media.length;r++)if(n.media[r].type===e){for(var i=n.media[r].rtp,o=[],a=0;a<t.length;a++)for(var s=0;s<i.length;s++)t[a]===i[s].codec&&o.push(i[s]);n.media[r].rtp=o;var c="";for(s=0;s<o.length;s++)c&&(c+=" "),c+=o[s].payload.toString();n.media[r].payloads=c;var u=n.media[r].fmtp,l=[];for(s=0;s<o.length;s++)for(var d=0;d<u.length;d++)o[s].payload===u[d].payload&&l.push(u[d]);n.media[r].fmtp=l}return n},this.modifyH264ProfileLevelId=function(e){for(var t=e.split("profile-level-id="),n=t.length,r="",i=0;i<n;i++){var o=t[i];0!==i&&(o=o.substring(0,4)+"1e"+o.substring(6)),r+=o,i!=n-1&&(r+="profile-level-id=")}return r},this.gotIceCandidate=function(t,n){null!=e.remoteDescriptionSet&&!0===e.remoteDescriptionSet[n]?(console.log("Adding Ice the Candidate to pc as remoteSDP already, sender userId : "+n),e.pc[n].addIceCandidate(t)):setTimeout(function(){return e.gotIceCandidate(t,n)},500)},this.releaseStream=function(){e.releaseMediaStream(),e.releaseScreenStream()},this.releaseMediaStream=function(){null!=e.myStream&&(e.myStream.getAudioTracks().length>0&&e.myStream.getAudioTracks()[0].stop(),e.myStream.getVideoTracks().length>0&&e.myStream.getVideoTracks()[0].stop())},this.releaseScreenStream=function(){null!=e.screenStream&&(!e.isIntelMCU&&e.screenStream.getAudioTracks().length>0&&e.screenStream.getAudioTracks()[0].stop(),e.screenStream.getVideoTracks().length>0&&e.screenStream.getVideoTracks()[0].stop()),clearSourceId()},this.hangupXmsCall=function(t,n){var r="isRenegotiating"==t,i=1==e.screenShareStatus||2==e.screenShareStatus,o=yConstants.siteUrl+yConstants.deregisterInXMSCall;$.ajax({url:o,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:{callResId:e.XMSCallResourceId,callId:e.callId,isRenegotiating:r,isScreenHost:i},success:function(r,i,o){e.triggerCallEndMessageAndCleanup(t,r.confParticipantsCount),n&&n()},error:function(r,i,o){console.log(JSON.stringify(o)),e.triggerCallEndMessageAndCleanup(t),n&&n()}})},this.hangupICSCall=function(t,n){var r="isRenegotiating"==t,i=(1==e.screenShareStatus||e.screenShareStatus,yConstants.siteUrl+yConstants.deregisterInICSCall);$.ajax({url:i,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:{callResId:e.ICSCallResourceId,callId:e.callId,isRenegotiating:r},success:function(r,i,o){var a=e.conferenceManagerList.ICS;a.icsPublicationGlobal&&a.icsPublicationGlobal.stop(),null!=a.screenSubscriptionObj&&a.screenSubscriptionObj.stop(),null!=a.mixedStreamSubscriptionObj&&a.mixedStreamSubscriptionObj.stop(),a.icsConferenceObj.leave(),e.triggerCallEndMessageAndCleanup(t,r.confParticipantsCount),n&&n(null,"Successfully left the call")},error:function(r,i,o){console.log(JSON.stringify(o)),e.triggerCallEndMessageAndCleanup(t),n&&n("Error while leaving the call : "+o)}})},this.deregisterInRoom=function(t,n){if(clearTimeout(e.callHeartBeatInterval),e.isRegisteredInRoom)if(e.isRegisteredInRoom=!1,e.isMCUCall&&e.isIntelMCU)e.hangupICSCall(t,n);else{console.log("deregistering in the room");var r=yConstants.siteUrl+yConstants.deregisterInCall,i={callId:e.callId,isScheduledCall:e.isScheduledCall,callResourceId:e.P2PCallResourceId},o=new XMLHttpRequest;o.onreadystatechange=function(){4===this.readyState&&200===this.status?t&&e.triggerCallEndMessageAndCleanup(t):4===this.readyState&&(console.log("Call Deregisteration failed"),t&&e.triggerCallEndMessageAndCleanup(t))},o.open("POST",r,!0),o.setRequestHeader("Content-type","application/json"),o.setRequestHeader("Authorization",e.accessToken),o.send(JSON.stringify(i))}else e.triggerCallEndMessageAndCleanup(t)},this.leaveMeeting=function(t){e.hangupCall("end",t)},this.hangupCall=function(t,n){e.isGuestUser&&e.clearSession(),1==e.screenShareStatus&&(e.screenShareStatus=0,e.getUserCb("onScreenShareStatusChanged")(e.screenShareStatus)),e.AmIBusy=!1,t?(e.releaseStream(),e.deregisterInRoom(t,n)):e.triggerCallEndMessageAndCleanup()},this.triggerCallEndMessageAndCleanup=function(t,n){if("abort&Notify"===t)e.sendWebRTCMessage("callAborted");else{if("isRenegotiating"===t)return;e.sendWebRTCMessage("callEnded",{isHost:e.isHost,confParticipantsCount:n})}e.getUserCb("onCallHangUpSuccess")(),e.resetCallResources()},this.clearSession=function(){window.localStorage.removeItem("yuvitimeStorage")},this.toggleScreenShare=function(t){if("presenter"!=e.currentUserRole)return errMsg="Only a presenter can share screen",void e.getUserCb("onScreenSharingError")(errMsg);if(console.log("inside toggle screen share"),navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices.getUserMedia,0==e.screenShareStatus){if(void 0==navigator.getUserMedia||null==navigator.getUserMedia){return void e.getUserCb("onScreenSharingError")({message:"This browser doesnt support screen sharing. please try with the latest versions of Chrome or Mozilla",isPluginMissing:!0})}console.log("myPermittedResAndBitrate for screen sharing => ",e.myPermittedResAndBitrate),screenStreamResolution=e.myPermittedResAndBitrate,navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia(r(screenStreamResolution)).then(gotScreenStream).catch(gotScreenCaptureError):navigator.getDisplayMedia?navigator.getDisplayMedia(r(screenStreamResolution)).then(gotScreenStream).catch(gotScreenCaptureError):getScreenConstraints(function(t,n){if(t){clearSourceId();var r={message:"Screen Sharing Cancelled",isPluginMissing:!1};e.getUserCb("onScreenSharingError")(r)}else if(null!=screenConstraints.mandatory.chromeMediaSourceId&&void 0!=screenConstraints.mandatory.chromeMediaSourceId){var i;i={audio:!0,video:screenConstraints},navigator.getUserMedia(i,gotScreenStream,gotScreenCaptureError)}else{clearSourceId();r={message:"Failed to share the screen. Please make sure that you have installed the YuViTime Screen Share plugin",isPluginMissing:!0};e.getUserCb("onScreenSharingError")(r)}})}else if(1==e.screenShareStatus)if(e.ySocket.emit("screenToggled",{isScreenSharingOn:!1}),e.screenShareStatus=2,e.isMCUCall){e.conferenceManagerList.ICS;e.getUserCb("onScreenShareStatusChanged")(e.screenShareStatus),e.unpublishScreenStreamICS()}else e.releaseStream(),console.log("self.myPermittedResAndBitrate ",e.myPermittedResAndBitrate),navigator.mediaDevices.getUserMedia(n(e.joinMedia.audio,e.joinMedia.video,e.myPermittedResAndBitrate)).then(gotMediaStreamAndRenegotiate).catch(gotMediaStreamAndRenegotiateError)},this.openScreenCaptureErrorModal=function(e){document.getElementById("ScreenCaptureErrorModal").style.display="block"},this.updateAndPublishLocalStream=function(t,n,r){if(!t&&!n)return errMesg="You cannot publish without any track, one of the Audio/Video is required",console.log(errMesg),r(errMesg);e.joinMedia.video=n,e.joinMedia.audio=t,renegotiateSdpToToggleAudioVideo();var i={};i.isVideoOn=n,i.isAudioOn=t,r&&r(null,i),updateMyCallStatus(i,function(e,t){})},updateStreamInPCAndRenegotiate=function(n){$.each(e.conferenceManagerList,function(r,i){e.isMCUCall?e.isMCUCall&&(i.myStream=n,i.renegotiateIcsCall(function(e,n){t=!0})):(e.pc[r].removeStream(i.myStream),e.pc[r].addStream(n),i.myStream=n,i.renegotiateSdp(),t=!0)})},gotScreenStream=function(t){if(e.screenStream=t,0==e.screenShareStatus)if(e.isMCUCall)e.isMCUCall&&0==e.screenShareStatus&&(e.screenShareStatus=1,e.screenStream.getAudioTracks().length>0&&(e.screenStream.getAudioTracks()[0].enabled=!1),e.handleNativeScreenShareEndButton(e.screenStream.getVideoTracks()[0]),e.publishScreenStreamICS(e.screenStream),e.isDeviceSideMCURecordingEnabled&&null!=e.streamMixer&&e.streamMixer.resetVideoStreams([e.screenStream,e.conferenceManagerList.ICS.mixedStream.mediaStream]),e.getUserCb("onScreenShareStatusChanged")(e.screenShareStatus,t));else{e.screenShareStatus=1,e.myStream.addTrack(t.getVideoTracks()[0]),e.handleNativeScreenShareEndButton(t.getVideoTracks()[0]),updateStreamInPCAndRenegotiate(e.myStream);var n=new MediaStream;n.addTrack(e.myStream.getVideoTracks()[1]),null!=e.streamMixer&&e.streamMixer.resetVideoStreams([n,e.myStream,e.remotePeerStream.getMediaStream()]),e.getUserCb("onScreenShareStatusChanged")(e.screenShareStatus,n)}},this.publishScreenStreamICS=function(t){var n=e.conferenceManagerList.ICS;attr={userId:e.currentUserId,streamType:"screen",role:e.currentUserRole,userName:e.currentUserName},screenStreamObj=new Owt.Base.LocalStream(t,new Owt.Base.StreamSourceInfo("mic","screen-cast"),attr);var r=e.myPermittedResAndBitrate.maxBitrate,i={video:[{codec:{name:"vp8"},maxBitrate:r},{codec:{name:"h264"},maxBitrate:r},{codec:{name:"vp9"},maxBitrate:r}]};console.log("publishOption for sharing screen stream -> ",JSON.stringify(i)),n.icsConferenceObj.publish(screenStreamObj,i).then(function(t){e.screenPublicationGlobal=t,t.addEventListener("error",function(e){console.log("Publication error: "+e.error.message)}),t.addEventListener("icestatechange",function(t){e.handleIceConnectionStateChange(t.currentstate)})})},this.unpublishScreenStreamICS=function(){console.log("UNPUBLISHING SCREEN STREAM!"),e.screenPublicationGlobal.stop(),e.screenShareStatus=0,e.releaseScreenStream(),e.isDeviceSideMCURecordingEnabled&&null!=e.streamMixer&&e.streamMixer.resetVideoStreams([e.conferenceManagerList.ICS.mixedStream.mediaStream])},gotMediaStreamAndRenegotiate=function(t){console.log("GetUserMedia success. Time to renegotiate"),e.getUserCb("onLocalStreamReceived")(t,e.currentUserRole),e.myStream=t,e.isMCUCall||null==e.streamMixer||e.streamMixer.resetVideoStreams([e.myStream,e.remotePeerStream.getMediaStream()]),updateStreamInPCAndRenegotiate(t),2==e.screenShareStatus&&e.getUserCb("onScreenShareStatusChanged")(e.screenShareStatus,t)},gotMediaStreamAndRenegotiateError=function(t){console.log(" GetUserMedia error called : "+t),e.joinMedia.video&&e.joinMedia.audio?(message="Failed to access the Camera, Trying for an Audio call",e.getUserCb("onStreamRequestDowngrade")(message),e.joinMedia.video=!1,navigator.mediaDevices.getUserMedia(n(e.joinMedia.audio,e.joinMedia.video)).then(gotMediaStreamAndRenegotiate).catch(gotMediaStreamAndRenegotiateError)):(message="Failed to access the Microphone. Hint: Check your browser's Settings",e.joinMedia.audio=!1,e.getUserCb("onStreamCaptureFailure")(message))},gotScreenCaptureError=function(t){console.log(" Get Screen Capture failed, error : "+t),clearSourceId();e.getUserCb("onScreenSharingError")({error:"Failed to share the screen."})},this.handleNativeScreenShareEndButton=function(t){t.onended=function(){console.log("native screen sharing stop button clicked"),e.toggleScreenShare()}},addParticipantsToDirectCall=function(t,n){if(null==n||""==n)return console.log("Group Name is mandatory"),void e.getUserCb("onAddParticipantToCallFailed")("Group Name is mandatory");var r={type:"call",members:t,existingMember:e.otherUserInP2PCall.email,groupName:n,callId:e.callId},i=yConstants.siteUrl+yConstants.addParticipantsToNonConferenceCall;$.ajax({url:i,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:r,success:function(n,r,i){console.log("member added successfully, data:"+n);var o=[],a=[];n.result.groupInfo.members.forEach(function(e){t.includes(e.email)&&(o.push(e._id),a.push(e))}),e.callId=n.result.callId;var s={friendId:"",browserMessageId:(new Date).getTime(),groupId:n.result.groupInfo._id,messageType:"call",roomId:n.result.roomId,eventType:"addingNewParticipant",callId:e.callId,p2pToGroupCallId:n.result.callId,purpose:"memberadded",newMembersInfo:{existingCallType:0,newParticipants:o,newPraticipantsInfo:a},callType:"video"};e.ySocket.emit("send_message",s)},error:function(t,n,r){console.log(JSON.stringify(r)),e.getUserCb("onAddParticipantToCallFailed")(r)}})},addParticipantsInConference=function(t,n){var r={groupId:n,isOnFly:!0,callId:e.callId,addMembers:JSON.stringify(t)},i=yConstants.siteUrl+yConstants.addParticipantsInConference;$.ajax({url:i,type:"PUT",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:r,success:function(r,i,o){var a=[],s=[];r.result.members.forEach(function(e){t.includes(e.email)&&(a.push(e._id),s.push(e))});var c={friendId:"",browserMessageId:(new Date).getTime(),groupId:n,messageType:"call",roomId:r.result.roomId,eventType:"addingNewParticipant",callId:e.callId,purpose:"memberadded",newMembersInfo:{existingCallType:1,newParticipants:a,newPraticipantsInfo:s},callType:"video"};e.ySocket.emit("send_message",c)},error:function(t,n,r){console.log(JSON.stringify(r)),e.getUserCb("onAddParticipantToCallFailed")(t.responseJSON)}})},addParticipantsToGroupWith2Pax=function(t,n){var r={};r.groupId=n,r.members=t,r.isOnFly=!0,r.callId=e.callId,r.type="call";var i=yConstants.siteUrl+yConstants.addParticipantsToNonConferenceCall;$.ajax({url:i,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:r,success:function(r,i,o){e.callId=r.result.callId,console.log("member added successfully, data:"+r);var a=[],s=[];r.result.groupInfo.members.forEach(function(e){t.includes(e.email)&&(a.push(e._id),s.push(e))});var c={friendId:"",browserMessageId:(new Date).getTime(),groupId:n,messageType:"call",roomId:r.result.roomId,eventType:"addingNewParticipant",callId:e.callId,purpose:"memberadded",newMembersInfo:{existingCallType:0,newParticipants:a,newPraticipantsInfo:s},callType:"video"};e.ySocket.emit("send_message",c)},error:function(t,n,r){console.log(JSON.stringify(r)),e.getUserCb("onAddParticipantToCallFailed")(r)}})},this.addParticipantsToCall=function(t,n){e.currentCallGroupId?e.receivers.length>2?addParticipantsInConference(t,e.currentCallGroupId):addParticipantsToGroupWith2Pax(t,e.currentCallGroupId):addParticipantsToDirectCall(t,n)},this.getRecentCalls=function(t,n){var r=yConstants.siteUrl+yConstants.getRecentCalls,i={skip:t,limit:n};$.ajax({url:r,type:"get",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:i,success:function(t,n,r){e.getUserCb("onFetchRecentCallSuccess")(t.result)},error:function(t,n,r){console.log(t.responseJSON.message),e.getUserCb("onFetchRecentCallFailure")(t.responseJSON.message)}})},this.joinOngoingCall=function(t,n){var r=yConstants.siteUrl+yConstants.getCallDetails,i={callId:t};$.ajax({url:r,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:i,success:function(t,r,i){setCallDataFromDetails(t.result),joinMedia="video"==n||"VIDEO"==n?{audio:!0,video:!0}:{audio:!0,video:!1},e.getMediaStream(joinMedia)},error:function(t,n,r){console.log(t.responseJSON.message),e.getUserCb("onJoinOngoingCallFailed")(t.responseJSON.message)}})},setCallDataFromDetails=function(t){e.receivers=t.participantsDetails,e.callId=t.callId,e.roomId=t.roomId,e.isHost=t.initiator._id==e.currentUserId,e.isHostedMeeting=t.isHosted,e.mediaCallType=t.callType.toLowerCase(),e.isGroupCall=!!t.groupId,e.isGroupCall&&(e.currentCallGroupId=t.groupId),e.isGroupCall||(e.otherUserInP2PCall=t.participantsDetails.find(function(t){return t._id!=e.currentUserId}))},this.removeTrack=function(t){e.pc[t].getSenders().forEach(function(n){e.myStream.getTracks().forEach(function(r){r==n.track&&e.pc[t].removeTrack(n)})})},this.upgradeToMCUCall=function(t){for(var n in console.log("Upgrading to MCU call.."),e.isCallUpgradedToConference=!0,e.isMCUCall=!0,e.pc)console.log("upgarding p2p to MCU Call, cleaning up pc for user "+n),e.removeTrack(n),e.pc[n].onicecandidate=null,e.pc[n].oniceconnectionstatechange=null,e.pc[n].onicegatheringstatechange=null,e.pc[n].onaddstream=null,e.pc[n].onremovestream=null,delete e.pc[n];1==e.screenShareStatus&&(console.log("Upgrading call from P2P to conference, turning off screen sharing"),e.ySocket.emit("screenToggled",{isScreenSharingOn:!1}),e.screenShareStatus=0,e.myStream.removeTrack(e.myStream.getVideoTracks()[1]),e.getUserCb("onScreenShareStatusChanged")(e.screenShareStatus,e.screenStream)),e.isIntelMCU?(userId="ICS",null!=e.conferenceManagerList&&null!=e.conferenceManagerList[userId]?(conferenceManager=e.conferenceManagerList[userId],conferenceManager.sendOfferICS()):(conferenceManager=new ConferenceManager(userId,e.currentUserId,e.myStream,e),e.conferenceManagerList[userId]=conferenceManager,conferenceManager.sendOfferICS())):(userId="XMS",console.log("Conf manager list : "+JSON.stringify(e.conferenceManagerList[userId])),null!=e.conferenceManagerList&&null!=e.conferenceManagerList[userId]?(console.log("reusing conf manager"),conferenceManager=e.conferenceManagerList[userId]):(console.log("create new conf manager"),conferenceManager=new ConferenceManager(userId,e.currentUserId,e.myStream,e),e.conferenceManagerList=null,e.conferenceManagerList=new Object,null===e.pc&&(e.pc=new Object),null===e.remoteDescriptionSet&&(e.remoteDescriptionSet=new Object),e.conferenceManagerList[userId]=conferenceManager,isOfferToBeGenerated=!0,conferenceManager.createPCObject(isOfferToBeGenerated)))},this.scheduleMeeting=function(t){var n={schedulerName:t.meetingName,schedulerDescription:t.meetingDescription,dateOfStart:t.date,time:t.time,duration:t.duration,schedulerMedia:t.mediaCallType,isRepeat:!1,frequency:0,timezone:t.timeZone,alertBeforeMeeting:t.alertBeforeMeeting,repeatInterval:0,groupId:"",members:t.members};console.log(n);var r=yConstants.siteUrl+yConstants.scheduleCall;$.ajax({url:r,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:n,success:function(e,t,n){console.log("Call Scheduled successfully")},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onMeetingCreationFailure")(t.responseJSON)}})},this.joinScheduledCall=function(t,n){var r=yConstants.siteUrl+yConstants.getCallDetails,i={callId:t};$.ajax({url:r,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:i,success:function(t,n,r){setCallDataFromDetails(t.result),"video"==e.mediaCallType||"VIDEO"==e.mediaCallType?joinMedia={audio:!0,video:!0}:joinMedia={audio:!0,video:!1},e.getMediaStream(joinMedia)},error:function(t,n,r){console.log(t.responseJSON.message),e.getUserCb("onJoinOngoingCallFailed")(t.responseJSON.message)}})},this.deleteScheduledCall=function(t){var n=yConstants.siteUrl+yConstants.deleteScheduledCall,r={schedulerId:t};$.ajax({url:n,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:r,success:function(t,n,r){e.getUserCb("onDeleteMeetingSuccess")(t.result)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onDeleteMeetingError")(t.responseJSON)}})},this.fetchAllUpcomingCalls=function(){var t=yConstants.siteUrl+yConstants.getUpcomingMeetings;$.ajax({url:t,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(t,n,r){e.getUserCb("onFetchUpcomingCallSuccess")(t.result)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onFetchUpcomingCallFailure")(t.responseJSON)}})},fetchChatRoom=function(t,n){var r=yConstants.siteUrl+yConstants.fetchChatRoom;$.ajax({url:r,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:t,success:function(t,r,i){n?n(null,t.result.room):e.getUserCb("onFetchChatRoomSuccess")(t.result.room)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onFetchChatRoomFailed")(t.responseJSON)}})},this.fetchChatRoombyUserIds=function(e,t,n){fetchChatRoom({userIds:e,allowReuseOfRoom:t,groupName:n})},this.fetchChatRoombyEmails=function(e,t,n){fetchChatRoom({emails:e,allowReuseOfRoom:t,groupName:n})},this.fetchRoomDetails=function(t){var n=yConstants.siteUrl+yConstants.fetchRoomDetails+"/"+t+"/";$.ajax({url:n,type:"get",contentType:"application/json",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(t,n,r){console.log(t.result),e.getUserCb("onFetchRoomDetailsSuccess")(t.result)},error:function(t,n,r){console.log(data.result),e.getUserCb("onFetchRoomDetailsFailed")(t.responseJSON)}})},this.sendMessage=function(t,n,r){fetchKeyAndEncryptMessage(n,t,function(n,i){var o={roomId:t,message:i,messageType:"TEXT",browserMessageId:r,isEncrypted:!0};e.ySocket.emit("send_message",o)})},this.shareFile=function(t,n,r){var i={roomId:t,fileInfo:n,messageType:"FILE",browserMessageId:r};e.ySocket.emit("send_message",i)},this.fetchChatList=function(){var t=yConstants.siteUrl+yConstants.fetchChatList;$.ajax({url:t,type:"get",contentType:"application/json",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(t,n,r){for(t.result.results=reorderResultData(t.result.results),roomListData=t.result.results,i=0;i<roomListData.length;i++)item=roomListData[i],roomId=item.roomId,key=t.result.keys[roomId],null!=key&&void 0!=key&&item.lastMessage&&"TEXT"==item.lastMessageByName.type&&item.lastMessageisEncrypted&&(isValidJson(item.lastMessage)?decryptedMessage=JSON.parse(item.lastMessage):""==item.lastMessage.replace(/\s/g,"")?decryptedMessage="":(decryptedAesKey=e.getDecryptedRoomKey(key,roomId),decryptedMessage=decryptMessage(item.lastMessage,decryptedAesKey),item.lastMessage=decryptedMessage));delete t.result.keys,e.getUserCb("onFetchChatListSuccess")(t.result)},error:function(t,n,r){console.log(r),e.getUserCb("onFetchChatListFailed")(t.responseJSON)}})},reorderResultData=function(t,n){for(var r=t,i=[],o=0;o<r.length;o++){var a={};if(1==r[o].isGroupChat)a.roomId=r[o]._id,a.isGroupChat=!0,a.lastMessage=r[o].lastMessage.message,a.lastMessageTime=r[o].lastMessage.dateOfCreation,a.lastMessageByName=r[o].lastMessage.senderInfo,a.lastMessageByName.type=r[o].lastMessage.messageType,a.lastMessageisEncrypted=r[o].lastMessage.isEncrypted,a.unreadMessageCount=r[o].unreadCount[0].messageCountId.unreadCount,3==r[o].status?a.isDeleted=!0:a.isDeleted=!1,a.name=r[o].groupInfo.name,a.image=r[o].groupInfo.image,a.groupAdmins=r[o].groupInfo.groupAdmins,a.members=r[o].membersInfo,a.lastModificationTime=r[o].dateOfModification;else{var s;s=r[o].membersInfo.find(function(t){if(t._id.toString()!=e.currentUserId)return t}),a.roomId=r[o]._id,a.contactUserId=s._id,a.isGroupChat=!1,a.lastMessage=r[o].lastMessage.message,a.lastMessageTime=r[o].lastMessage.dateOfCreation,a.lastMessageByName=r[o].lastMessage.senderInfo,a.lastMessageByName.type=r[o].lastMessage.messageType,a.lastMessageisEncrypted=r[o].lastMessage.isEncrypted,a.unreadMessageCount=r[o].unreadCount[0].messageCountId.unreadCount,a.isBlocked=s.isBlocked,a.isDeleted=s.isDeleted,a.name=s.name,a.image=s.image,a.email=s.email,a.lastModificationTime=r[o].dateOfModification,a.status=r[o].status}i.push(a)}return i},this.fetchChatMessages=function(t,n){var r={skip:n},o=yConstants.siteUrl+yConstants.fetchChatMessages+"/"+t;$.ajax({url:o,type:"get",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:r,success:function(n,r,o){e.fetchRoomKey(t,function(t,r){for(t&&(console.log("failed to fetch messages : "+t),e.getUserCb("onFetchChatMessageFailed")(t)),i=0;i<n.result.result.messages.length;i++)item=n.result.result.messages[i],item.message&&"TEXT"==item.messageType&&item.isEncrypted&&(isValidJson(item.message)?item.message=JSON.parse(item.message):""==item.message.replace(/\s/g,"")?item.message="":item.message=decryptMessage(item.message,r));e.getUserCb("onFetchChatMessageSuccess")(n.result)})},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onFetchChatMessageFailed")(t.responseJSON)}})},this.addMembersInGroupByEmail=function(e,t){addMembersInGroup({roomId:e,emails:t},{addedMembers:{emails:t}})},this.addMembersInGroupByUserId=function(e,t){addMembersInGroup({roomId:e,userIds:t},{addedMembers:{userIds:t}})},this.removeMembersFromGroupByEmail=function(e,t){removeMembersFromGroup({roomId:e,emails:t},{removedMembers:{emails:t}})},this.removeMembersFromGroupByuserId=function(e,t){removeMembersFromGroup({roomId:e,userIds:t},{removedMembers:{userIds:t}})},this.createGroup=function(t,n,r){var i=yConstants.siteUrl+yConstants.groupCreate,o={};o.members=t,o.groupName=n,o.image=r,$.ajax({url:i,type:"POST",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:o,success:function(t,n,r){e.getUserCb("onGroupCreateSuccess")(t)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onGroupCreateFailure")(t.responseJSON)}})},addMembersInGroup=function(t,n){var r=yConstants.siteUrl+yConstants.addMembersInGroup;$.ajax({url:r,type:"PUT",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:t,success:function(t,r,i){e.getUserCb("onMembersAddedToGroupSuccess")(t.result);var o={browserMessageId:(new Date).getTime(),roomId:t.result.roomId,messageType:"text",purpose:"memberadded",callHistoryId:"",message:"Added members to this chat.",extras:n};e.ySocket.emit("send_message",o)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onMembersAddedToGroupFailure")(t.responseJSON)}})},removeMembersFromGroup=function(t,n){var r=yConstants.siteUrl+yConstants.removeMembersFromGroup;$.ajax({url:r,type:"PUT",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:t,success:function(t,r,i){e.getUserCb("onMembersRemovedFromGroupSuccess")(t.result);var o={browserMessageId:(new Date).getTime(),roomId:t.result.roomId,messageType:"text",purpose:"memberremoved",callHistoryId:"",message:"Added members to this chat.",extras:n};e.ySocket.emit("send_message",o)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onMembersRemovedFromGroupFailure")(t.responseJSON)}})},this.markMessagesReadInRoom=function(t){var n={roomId:t},r=yConstants.siteUrl+yConstants.readRoomMessages;$.ajax({url:r,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:n,success:function(t,n,r){e.getUserCb("onReadMessageInRoomSuccess")(t.result.room)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onReadMessageInRoomFailed")(t.responseJSON)}})},this.deleteMessageInRoom=function(t,n,r){"FOR_ME"==r?r=0:"FOR_ALL"==r&&(r=1);var i={deleteType:r,roomId:t},o=yConstants.siteUrl+yConstants.deleteMessages+"/"+n;$.ajax({url:o,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:i,success:function(t,n,r){e.getUserCb("onDeleteMessageInRoomSuccess")(t.result)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onDeleteMessageInRoomFailed")(t.responseJSON)}})},this.clearChatRoom=function(t){var n=yConstants.siteUrl+yConstants.clearConversation+"/"+t;$.ajax({url:n,type:"delete",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(t,n,r){e.getUserCb("onClearChatRoomSuccess")(t.result.room)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onClearChatRoomFailed")(t.responseJSON)}})},this.deleteChatRoom=function(t){var n=yConstants.siteUrl+yConstants.deleteConversation+"/"+t;$.ajax({url:n,type:"delete",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(t,n,r){e.getUserCb("onDeleteChatRoomSuccess")(t.result)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onDeleteChatRoomFailed")(t.responseJSON)}})},this.addContact=function(t,n,r){var i=yConstants.siteUrl+yConstants.addContactUrl,o={};o.name=t,o.email=n,r&&(o.phoneNumber=r.phoneNumber,o.companyName=r.companyName,o.jobTitle=r.jobTitle,o.address=r.address,o.dob=r.dob,o.notes=r.notes,o.contactImage=r.contactImage),$.ajax({url:i,data:o,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(t,n,r){e.getUserCb("onContactAddSuccess")(t.result)},error:function(t,n,r){e.getUserCb("onContactAddFailed")(t.responseJSON)}})},this.fetchContactDetails=function(t){var n=yConstants.siteUrl+yConstants.fetchContactDetailsUrl+"/"+t;$.ajax({url:n,type:"get",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(t,n,r){e.getUserCb("onContactDetailsSuccess")(t.result)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onContactDetailsFailed")(t.responseJSON)}})},this.fetchContactList=function(){var t=yConstants.siteUrl+yConstants.fetchContactListUrl;$.ajax({url:t,type:"get",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(t,n,r){e.getUserCb("onFetchContactListSuccess")(t.result)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onFetchContactListFailed")(t.responseJSON)}})},this.deleteContact=function(t){var n=yConstants.siteUrl+yConstants.deleteContactUrl;postData={contactId:t},$.ajax({url:n,type:"delete",data:postData,contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(t,n,r){e.getUserCb("onContactDeleteSuccess")(t.result)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onContactDeleteFailed")(t.responseJSON)}})},socketCleanup=function(){e.ySocket.disconnect(),e.ySocket.eventList=[],e.ySocket.socket=null,e.jsEncrypt=null,e.rsaPrivateKey=null},this.logout=function(){var t=yConstants.siteUrl+yConstants.logout,n={};n.socketId=e.ySocket.id,$.ajax({url:t,type:"post",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:n,success:function(e,t,n){console.log("Log out success"),socketCleanup()},error:function(e,t,n){console.log("Log out failed"),socketCleanup()}})},this.sendTypingStatus=function(t){e.ySocket.emit("chat send_typing",t)},getUrlParam=function(e){var t=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null==t?null:decodeURI(t[1])||0},this.checkIfCallViaEmailInvite=function(e){return{isInvite:e.includes("/call/invitation")||e.includes("/call/join"),inviteToken:getUrlParam("key")}},this.setStatus=function(t){if("ONLINE"!=t&&"BUSY"!=t&&"AWAY"!=t&&"INVISIBLE"!=t)return console.log("Invalid Status parameter. It has to be one of - ONLINE, BUSY, AWAY, INVISIBLE"),"Invalid Status parameter. It has to be one of - ONLINE, BUSY, AWAY, INVISIBLE";e.ySocket.emit("update_my_status",t),console.log("Status successfully set : "+t)},getUserStatus=function(t){var n=yConstants.siteUrl+yConstants.getParticularUserStatus;$.ajax({url:n,type:"get",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},data:t,success:function(t,n,r){e.getUserCb("onUserStatusFetchSuccess")(t)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onUserStatusFetchFailed")(t.responseJSON)}})},this.getParticularUserStatus=function(e){getUserStatus({email:e})},this.getParticularUserStatusByEmail=function(e){getUserStatus({email:e})},this.getParticularUserStatusByUserId=function(e){getUserStatus({userId:e})},this.getParticularUserStatusByContactId=function(e){getUserStatus({contactId:e})},this.getAllContactUserStatus=function(){var t=yConstants.siteUrl+yConstants.getAllContactUserStatus;$.ajax({url:t,type:"get",contentType:"application/x-www-form-urlencoded",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(t,n,r){e.getUserCb("onAllContactUserStatusFetchSuccess")(t.result)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onAllContactUserStatusFetchFailed")(t.responseJSON)}})},this.getLastSeenofOfflineUserByEmail=function(t){if(void 0==t)return message="Email not provided.",void e.getUserCb("onUserLastSeenDetailsFetchFailed")(message);getLastSeenofOfflineUser({email:t})},this.getLastSeenofOfflineUserByContactId=function(t){if(void 0==t)return message="ContactId not provided.",void e.getUserCb("onUserLastSeenDetailsFetchFailed")(message);getLastSeenofOfflineUser({contactId:t})},this.getLastSeenofOfflineUserByUserId=function(t){if(void 0==t)return message="UserId not provided.",void e.getUserCb("onUserLastSeenDetailsFetchFailed")(message);getLastSeenofOfflineUser({userId:t})},getLastSeenofOfflineUser=function(t){var n=yConstants.chatServerUrl+yConstants.userLastSeenUrl;$.ajax({url:n,type:"get",contentType:"application/x-www-form-urlencoded",data:t,beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(t,n,r){e.getUserCb("onUserLastSeenDetailsFetchSuccess")(t.result)},error:function(t,n,r){console.log(t.responseJSON),e.getUserCb("onUserLastSeenDetailsFetchFailed")(t.responseJSON)}})},this.fetchRoomKey=function(t,n){if(e.roomKeyCache[t])return n(null,e.roomKeyCache[t]);var r=yConstants.siteUrl+yConstants.fetchRoomKeyUrl;$.ajax({url:r,type:"get",contentType:"application/x-www-form-urlencoded",data:{roomId:t},beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(r,i,o){null==e.jsEncrypt&&(e.jsEncrypt=new JSEncrypt,e.jsEncrypt.setPrivateKey(e.rsaPrivateKey));var a=e.jsEncrypt.decrypt(r.result);e.roomKeyCache[t]=a,n(null,a)},error:function(e,t,r){console.log(e.responseJSON),n(e.responseJSON)}})},this.getDecryptedRoomKey=function(t,n){null==e.jsEncrypt&&(e.jsEncrypt=new JSEncrypt,e.jsEncrypt.setPrivateKey(e.rsaPrivateKey));var r=e.jsEncrypt.decrypt(t);return e.roomKeyCache[n]=r,r},generateIV=function(){var e="";for(i=0;i<16;i++)e+="0123456789abcdefghijklmnopqrstuv".charAt(Math.floor(16*Math.random()));return e},encryptMessage=function(e,t){var n=generateIV();options={mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7,iv:CryptoJS.enc.Utf8.parse(n)};var r=CryptoJS.enc.Utf8.parse(t);return CryptoJS.AES.encrypt(e,r,options).ciphertext.toString(CryptoJS.enc.Base64)+n},decryptMessage=function(e,t){if("string"==typeof e){var n=e.length,r=e.substr(0,n-16),i=e.substr(n-16);if(options={mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7,iv:CryptoJS.enc.Utf8.parse(i)},r&&"string"==typeof r){var o=CryptoJS.AES.decrypt(r,CryptoJS.enc.Utf8.parse(t),options);decryptedMessage=o.toString(CryptoJS.enc.Utf8)}return decryptedMessage||e}},fetchKeyAndEncryptMessage=function(t,n,r){e.fetchRoomKey(n,function(e,n){e&&(console.log("failed to send message, server down"),r("failed to send message, server down")),encryptedMessage=encryptMessage(t,n),r(null,encryptedMessage)})},fetchKeyAndDeEncryptMessage=function(t,n,r){e.fetchRoomKey(n,function(e,n){e&&(console.log("failed to send message, server down"),r("failed to send message, server down")),decryptedMessage=decryptMessage(t,n),r(null,decryptedMessage)})},isValidJson=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},this.startRecording=function(){if(e.recorder=null,e.streamMixer=null,e.isMCUCall)if(e.isMCUCall&&e.isDeviceSideMCURecordingEnabled)e.myAudioStream=new MediaStream,e.myAudioStream.addTrack(e.myStream.getAudioTracks()[0]),e.streamMixer=new MultiStreamsMixer([e.conferenceManagerList.ICS.mixedStream.mediaStream,e.myAudioStream]),e.recorder=RecordRTC(e.streamMixer.getMixedStream(),{type:"video",bitsPerSecond:512e3,canvas:{width:1280,height:720}}),e.recorder.startRecording(),e.streamMixer.frameInterval=1,e.streamMixer.startDrawingFrames(),e.isRecordingOn=!0,e.getUserCb("onRecordingStarted")();else{if(!e.isIntelMCU)return void console.log("Cannot Record a Group Call!");var t=e.conferenceManagerList.ICS.mixedStream.id,n={audio:{from:t},video:{from:t,parameters:{keyFrameInterval:2,resolution:{width:640,height:480},bitrate:"x0.4"}}};roomId=e.callId,e.startRecordingICS(roomId,"mkv",n,function(t,n){t?(console.log("Recording Failed! Kindly retry"),console.log(t),e.getUserCb("onRecordingFailed")(t)):(console.log("Session Recording STARTED"),e.currRecordingId=n.id,e.isRecordingOn=!0,e.getUserCb("onRecordingStarted")())})}else e.streamMixer=new MultiStreamsMixer([e.myStream,e.remotePeerStream.getMediaStream()]),e.recorder=RecordRTC(e.streamMixer.getMixedStream(),{type:"video",bitsPerSecond:512e3,canvas:{width:1280,height:720}}),e.recorder.startRecording(),e.streamMixer.frameInterval=1,e.streamMixer.startDrawingFrames(),e.isRecordingOn=!0,e.getUserCb("onRecordingStarted")()},this.stopRecording=function(){e.isRecordingOn=!1,e.streamMixer=null,e.isMCUCall?e.isMCUCall&&e.isDeviceSideMCURecordingEnabled?e.recorder.stopRecording(function(){getSeekableBlob(e.recorder.getBlob(),function(t){invokeSaveAsDialog(t),e.getUserCb("onRecordingStopped")()})}):(roomId=e.callId,e.stopRecordingICS(roomId,e.currRecordingId,function(t,n){console.log("Session Recording STOPPED"),e.getUserCb("onRecordingStopped")()})):e.recorder.stopRecording(function(){getSeekableBlob(e.recorder.getBlob(),function(t){invokeSaveAsDialog(t),e.getUserCb("onRecordingStopped")()})})},this.startRecordingICS=function(t,n,r,i){o("POST","/rooms/"+t+"/recordings/",{container:n,media:r},function(n,r){n&&i(n);var o=JSON.parse(r);fileName=t+"_"+(new Date).getTime()+".mkv",fileExtension=".mkv",fileKey=o.storage.file.replace("/"+yConstants.storageBucketName+"/",""),e.createRecordingEntryInDB(e.currentUserId,fileName,fileKey,fileExtension),i(null,o)},yConstants.mcuHost)},this.stopRecordingICS=function(e,t,n){if("string"!=typeof t||0===t.trim().length)return n("Invalid recording ID");o("DELETE","/rooms/"+e+"/recordings/"+t,void 0,function(e){n(null,e)},yConstants.mcuHost)},this.changeVideoSourceInICSRecording=function(e,t,n){if("string"!=typeof t||0===t.trim().length)return callbackError("Invalid recording ID");item=[{op:"replace",path:"/media/video/from",value:n}],o("PATCH","/rooms/"+e+"/recordings/"+t,item,function(e){JSON.parse(e)},yConstants.mcuHost)},this.createRecordingEntryInDB=function(t,n,r,i){var o={roomId:roomId},a={fileName:n,fileKey:r,startUploadTime:(new Date).getTime(),endUploadTime:(new Date).getTime(),fileExtension:i,uploadedBy:t,isRecording:"true",fileType:"recording",recordingInfo:o},s=yConstants.baseUrl+"api_v2/storage/createFileEntry/";$.ajax({url:s,type:"post",data:JSON.stringify(a),beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken),t.setRequestHeader("Content-Type","application/json")},success:function(e,t,n){console.log("data ",e)},error:function(e,t,n){console.log("errorThrown ",JSON.stringify(n))}})};var o=function(e,t,n,r,i){var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState&&(200===o.status?r(null,o.responseText):r(o.responseText))};var a=generateUrl(i,t);o.open(e,a,!0),o.setRequestHeader("Content-Type","application/json"),void 0!==n?o.send(JSON.stringify(n)):o.send()};generateUrl=function(e,t){var n;void 0!==e?n=e+t:n=new URL(document.URL).origin+t;return n},onResponse=function(e){if(e)try{console.info("Result:",JSON.parse(e))}catch(t){console.info("Result:",e)}else console.info("Null")},this.mixStream=function(t,n,r,i){var o={callId:t,streamId:n},a=yConstants.siteUrl+yConstants.mixStreamUrl;$.ajax({url:a,type:"post",data:JSON.stringify(o),beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken),t.setRequestHeader("Content-Type","application/json")},success:function(e,t,n){console.log("Succesfully Mixed the published stream")},error:function(e,t,n){console.log("Error mixing the published stream")}})},this.createToken=function(e,t,n,r,i){o("POST","/tokens/",{room:e,user:t,role:n},i,r)},this.hostMeeting=function(t,n){var r={accessType:"open",meetingName:t.meetingName,maxAllowedParticipant:t.maxAllowedParticipant,callMode:t.callMode,meetingExpireDuration:60*t.meetingExpireDuration,isCallAllowedWithoutInitiator:!0,isVAD:t.activateVAD,presenters:t.presenters,callAdmins:t.callAdmins,meetingStartTime:t.meetingStartTime},i=yConstants.siteUrl+yConstants.hostMeeting;$.ajax({url:i,type:"post",data:JSON.stringify(r),contentType:"application/json",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(e,t,r){console.log("data ",e),n(null,e.result)},error:function(e,t,r){console.log("errorThrown ",e.responseJSON.message),n(e.responseJSON.message)}})},this.editMeeting=function(t,n,r){var i=yConstants.siteUrl+yConstants.editMeeting;n?(n.meetingTokenId=t,$.ajax({url:i,type:"post",data:JSON.stringify(n),contentType:"application/json",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(e,t,n){console.log("data ",e),r(null,e)},error:function(e,t,n){console.log("errorThrown ",e.responseJSON.message),r(e.responseJSON.message)}})):r("No Update Params Provided")},this.deleteMeeting=function(t,n){var r=yConstants.siteUrl+yConstants.deleteMeeting;$.ajax({url:r,type:"delete",contentType:"application/x-www-form-urlencoded",data:{meetingTokenId:t},beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(e,t,r){console.log("data ",e),n(null,e)},error:function(e,t,r){console.log("errorThrown ",e.responseJSON.message),n(e.responseJSON.message)}})},this.endMeeting=function(t,n){var r=yConstants.siteUrl+yConstants.endMeeting;$.ajax({url:r,type:"post",contentType:"application/x-www-form-urlencoded",data:{meetingTokenId:t},beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(e,t,r){console.log("data ",e),n&&n(null,e)},error:function(e,t,r){console.log("errorThrown ",e.responseJSON.message),n&&n(e.responseJSON.message)}})},this.registerInMeeting=function(t,n){e.isHostedMeeting=!0;var r={nickName:t.nickName,meetingTokenId:t.meetingTokenId,platform:"web",passcode:t.passcode,guestId:t.guestId};e.joinMedia&&(r.joinMedia={audio:e.joinMedia.audio,video:e.joinMedia.video});var i=yConstants.siteUrl+yConstants.registerInMeeting;$.ajax({url:i,type:"post",data:JSON.stringify(r),contentType:"application/json",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(t,r,i){console.log("data ",JSON.stringify(t)),e.currentUserRole=t.result.role,e.allRolesResAndBitrate=t.result.mediaInfo.res,e.maxPresenters=t.result.mediaInfo.maxPresenters,e.maxSubPresenters=t.result.mediaInfo.maxSubPresenters,t.result.mediaInfo?(a(t.result.mediaInfo.res),delete t.result.mediaInfo):a(yConstants.defaultPublishOptions),n(null,t.result)},error:function(e,t,r){console.log("errorThrown ",e.responseJSON.message),n(e.responseJSON)}})};var a=function(t){null!=t.width?e.myPermittedResAndBitrate=t:"subPresenter"==e.currentUserRole&&null!=t.subPresRes?e.myPermittedResAndBitrate=t.subPresRes:"presenter"==e.currentUserRole&&null!=t.presRes&&(e.myPermittedResAndBitrate=t.presRes)};this.joinMeeting=function(t,n){if(e.icsToken=t.icsToken,e.ICSCallResourceId=t.ICSCallResourceId,e.callId=t.callId,e.roomId=t.roomId,e.callMode=t.callMode,t.tokenInfo){var r={};r.user=t.tokenInfo.user,r.access_token=t.tokenInfo.access_token,e.init(r)}e.isMCUCall=!0,e.conferenceManagerList=new Object,memberId="ICS",console.log("Creating Offer for ICS"),conferenceManager=new ConferenceManager(memberId,e.currentUserId,e.myStream,e),e.conferenceManagerList[memberId]=conferenceManager,e.isRegisteredInRoom=!0,conferenceManager.sendOfferICS(n)},this.subscribeStream=function(t,n,r,i,o){var a=e.conferenceManagerList.ICS;"screen"==n?t+="_screen":"mixed"==n&&(t="mixed"),a.subscribeStream(t,n,r,i,o)},this.unsubscribeStream=function(t,n){e.conferenceManagerList.ICS.unsubscribeStream(t,n)},this.toggleHandRaise=function(t,n,r){var i={};i.callId=e.callId,i.raiseHand=n,i.userId=t;var o=yConstants.siteUrl+yConstants.toggleHandRaise;$.ajax({url:o,type:"post",data:JSON.stringify(i),contentType:"application/json",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(e,t,i){n?(message="Hand raised successfully",console.log("Hand raised successfully"),r(null,{message:message})):(message="Hand lowered successfully",console.log("Hand lowered successfully"),r(null,{message:message}))},error:function(e,t,n){console.log("errorThrown ",e.responseJSON.message),r(e.responseJSON.message)}})},this.toggleParticipantAudio=function(t,n,r){var i={};i.callId=e.callId,i.audioStatus=n,i.userId=t;var o=yConstants.siteUrl+yConstants.toggleParticipantAudio;$.ajax({url:o,type:"post",data:JSON.stringify(i),contentType:"application/json",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(e,t,i){n?(message="Participant unmuted successfully",console.log(message),r(null,{message:message})):(message="Participant muted successfully",console.log(message),r(null,{message:message}))},error:function(e,t,n){console.log("errorThrown ",e.responseJSON.message),r(e.responseJSON)}})},this.dropParticipant=function(t,n){var r={};r.callId=e.callId,r.userId=t;var i=yConstants.siteUrl+yConstants.dropParticipant;$.ajax({url:i,type:"post",data:JSON.stringify(r),contentType:"application/json",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(e,r,i){console.log("Participant dropped succesfully, userId :"+t),n(null,{message:"Participant dropped succesfully"})},error:function(e,t,r){console.log("errorThrown ",e.responseJSON.message),n(e.responseJSON.message)}})},this.updateParticipantsRole=function(t,n,r){var i={};i.callId=e.callId,i.userId=t,i.newRole=n;var o=yConstants.siteUrl+yConstants.updatePresenters;$.ajax({url:o,type:"post",data:JSON.stringify(i),contentType:"application/json",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(e,t,i){message="Participants presentation rights successfully updated to : "+n,console.log(message),r(null,{message:message})},error:function(e,t,n){console.log("errorThrown ",e.responseJSON.message),r(e.responseJSON.message)}})},this.makeOrRevokeAdmins=function(t,n,r){var i={};i.callId=e.callId,i.userId=t,i.isCallAdmin=n;var o=yConstants.siteUrl+yConstants.updateCallAdmins;$.ajax({url:o,type:"post",data:JSON.stringify(i),contentType:"application/json",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(e,t,i){n?(message="Participant upgraded to call admin",console.log(message),r(null,{message:message})):(message="Call admin rights revoked",console.log(message),r(null,{message:message}))},error:function(e,t,n){console.log("errorThrown ",e.responseJSON.message),r(e.responseJSON.message)}})},this.fetchActiveParticipantsList=function(t){params={callId:e.callId};var n=yConstants.siteUrl+yConstants.getActiveCallParticipants;$.ajax({url:n,type:"post",contentType:"application/json",data:JSON.stringify(params),beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(e,n,r){console.log(e),t&&t(null,e)},error:function(e,n,r){console.log("errorThrown ",e.responseJSON.message),t&&t(e.responseJSON.message)}})},this.fetchActiveMeetings=function(t){var n=yConstants.siteUrl+yConstants.getAllMeetings;$.ajax({url:n,type:"get",contentType:"application/json",beforeSend:function(t){t.setRequestHeader("Authorization",e.accessToken)},success:function(e,n,r){console.log(e),t(e)},error:function(e,n,r){console.log("errorThrown ",e.responseJSON.message),t(e.responseJSON.message)}})},this.initCallHeartBeat=function(){null!=e.callHeartBeatInterval&&(clearTimeout(e.callHeartBeatInterval),e.callHeartBeatInterval=null),e.callHeartBeatInterval=setInterval(function(){null!=e.ySocket&&e.ySocket.emit("call_heart_beat",{callId:e.callId,userId:e.currentUserId})},3e3),null!=e.ySocket&&e.ySocket.emit("call_heart_beat",{callId:e.callId,userId:e.currentUserId})},this.isInternetOn=function(){return isInternetOn=e.ySocket.connected,isInternetOn}};